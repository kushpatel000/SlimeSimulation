(function(c){var g=window.AmazonUIPageJS||window.P,h=g._namespace||g.attributeErrors,a=h?h("WidgetStreamer",""):g;a.guardFatal?a.guardFatal(c)(a,window):a.execute(function(){c(a,window)})})(function(c,g,h){c.when("jQuery","widget-streamer-action-ws-append","widget-streamer-action-ws-prepend","widget-streamer-action-ws-update","widget-streamer-action-ws-event").register("widget-streamer-actions",function(a,d,e,b,f){var c={"ws-append":d,"ws-prepend":e,"ws-update":b,"ws-event":f},k={execute:a.noop};
return{create:function(f){var b,e,d;b=k;if(a.isArray(f)&&f.length&&f[0]){b=f[0];e=c[b];d="widget-streamer-action-"+b;if("function"!==typeof e)throw Error("Action: "+b+" is not supported. Register component "+d+" to handle this action");b=e(f)}return b}}});"use strict";c.register("widget-streamer-jquery-action",function(){return function(a,d,e){var b,f;if(!a||3>a.length)throw Error("Can not create update action, insufficient data in chunk: "+JSON.stringify(a));b=a[1];f=a[2];return{execute:function(a){var c=
a._$target.find(b).add(a._$target.filter(b));a._isTargetUpdated?e(c,f):d(c.get(0),f)}}}});"use strict";c.when("widget-streamer-jquery-action").register("widget-streamer-action-ws-update",function(a){return function(d){return a(d,function(a,b){a.innerHTML=b},function(a,b){a.html(b)})}});"use strict";c.when("widget-streamer-jquery-action").register("widget-streamer-action-ws-append",function(a){return function(d){return a(d,function(a,b){a.innerHTML+=b},function(a,b){a.append(b)})}});"use strict";c.when("widget-streamer-jquery-action").register("widget-streamer-action-ws-prepend",
function(a){return function(d){return a(d,function(a,b){a.innerHTML=b+a.innerHTML},function(a,b){a.prepend(b)})}});c.register("widget-streamer-action-ws-event",function(){return function(a){var d=a[1],c;try{c=JSON.parse(a[2])}catch(b){c=null}return{execute:function(a){a._emitEvent(d,c)}}}});"use strict";c.register("widget-streamer-utils",function(){return{isStreamingAjax:function(a){if(a&&"function"===typeof a.getResponseHeader)a=a.getResponseHeader("Content-Type");else if(a&&a.http&&"function"===
typeof a.http.getResponseHeader)a=a.http.getResponseHeader("Content-Type");else throw Error("Unable to retrive headers for the given xhr object: "+a);return"application/json-amazonui-streaming"===a}}});"use strict";c.when("A","jQuery","widget-streamer-actions").register("widget-streamer",function(a,c,e){function b(a){a=a||{};this._$originalTarget=a.$target;this._$target=a.$target.clone();this._actions=[];this._isExecutable="undefined"===typeof a.immediateExecution||a.immediateExecution;this._onUpdate=
a.onUpdate||c.noop;this._hasExecutionStarted=!1;this._events=a.events||{};this._isTargetUpdated=!1;this._updateTriggerEvent=a.updateTriggerEvent;this.chunkHandler=c.proxy(this.chunkHandler,this)}b.prototype.chunkHandler=function(a){a=e.create(a);this._actions.push(a);this.executeActions()};b.prototype.enableExecution=function(){this._isExecutable=!0;this.executeActions()};b.prototype.executeActions=function(){var a;if(this._isExecutable&&this._actions.length)for(this._hasExecutionStarted||(this._hasExecutionStarted=
!0,this._updateTriggerEvent||this._updateTarget()),a=this._actions.shift();a;)a.execute(this),a=this._actions.shift()};b.prototype._emitEvent=function(a,b){var e=(this._events||{})[a]||c.noop;a===this._updateTriggerEvent&&this._updateTarget(b);e.call(this,b)};b.prototype._updateTarget=function(){this._onUpdate.apply(this,arguments);this._$originalTarget.html(this._$target.html());this._$target=this._$originalTarget;this._isTargetUpdated=!0};return function(a){return new b(a)}})});
/* ******** */
(function(r){var q=window.AmazonUIPageJS||window.P,F=q._namespace||q.attributeErrors,na=F?F("CheckoutCommonAsset",""):q;na.guardFatal?na.guardFatal(r)(na,window):na.execute(function(){r(na,window)})})(function(r,q,F){r.register("polyfill-indexof",function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a,k){if(null==this)throw new TypeError('"this" is null or not defined');var h=Object(this),b=h.length>>>0;if(0===b)return-1;k=+k||0;Infinity===Math.abs(k)&&(k=0);if(k>=b)return-1;for(k=
Math.max(0<=k?k:b-Math.abs(k),0);k<b;){if(k in h&&h[k]===a)return k;k++}return-1})});"use strict";r.register("polyfill-filter",function(){Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var k=Object(this),h=k.length>>>0;if("function"!==typeof a)throw new TypeError;for(var b=[],f=2<=arguments.length?arguments[1]:void 0,g=0;g<h;g++)if(g in k){var m=k[g];a.call(f,m,g,k)&&b.push(m)}return b})});"use strict";r.register("polyfill-json-stringify",
function(){"object"!==typeof JSON&&(JSON={});(function(){function a(a){return 10>a?"0"+a:a}function k(){return this.valueOf()}function h(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var b=v[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(a,c){var f,d,e=l,p,g=c[a];g&&"object"===typeof g&&"function"===typeof g.toJSON&&(g=g.toJSON(a));"function"===typeof t&&(g=t.call(c,a,g));switch(typeof g){case "string":return h(g);case "number":return isFinite(g)?
String(g):"null";case "boolean":case "null":return String(g);case "object":if(!g)return"null";l+=n;p=[];if("[object Array]"===Object.prototype.toString.apply(g)){d=g.length;for(a=0;a<d;a+=1)p[a]=b(a,g)||"null";c=0===p.length?"[]":l?"[\n"+l+p.join(",\n"+l)+"\n"+e+"]":"["+p.join(",")+"]";l=e;return c}if(t&&"object"===typeof t)for(d=t.length,a=0;a<d;a+=1)"string"===typeof t[a]&&(f=t[a],(c=b(f,g))&&p.push(h(f)+(l?": ":":")+c));else for(f in g)Object.prototype.hasOwnProperty.call(g,f)&&(c=b(f,g))&&p.push(h(f)+
(l?": ":":")+c);c=0===p.length?"{}":l?"{\n"+l+p.join(",\n"+l)+"\n"+e+"}":"{"+p.join(",")+"}";l=e;return c}}var f=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,m=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,e=/(?:^|:|,)(?:\s*\[)+/g,c=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=k,Number.prototype.toJSON=k,String.prototype.toJSON=k);var l,n,v,t;"function"!==typeof JSON.stringify&&(v={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=
function(a,c,f){var d;n=l="";if("number"===typeof f)for(d=0;d<f;d+=1)n+=" ";else"string"===typeof f&&(n=f);if((t=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,c){function b(a,f){var l,e,p=a[f];if(p&&"object"===typeof p)for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(e=b(p,l),e!==F?p[l]=e:delete p[l]);return c.call(a,f,p)}a=String(a);p.lastIndex=0;p.test(a)&&
(a=a.replace(p,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(f.test(a.replace(g,"@").replace(m,"]").replace(e,"")))return a=eval("("+a+")"),"function"===typeof c?b({"":a},""):a;throw new SyntaxError("JSON.parse");})})()});"use strict";r.when("A","jQuery","client-side-metrics","weblab-helper","polyfill-filter","polyfill-json-stringify").register("ajax-wrapper",function(a,k,h,b){function f(a,c){function b(a,c){for(var f=0;f<a._options.length;f++){var d=a._options[f];
if(d=c.call(a,d,"object"===typeof d?d.name:d))return d}}this._options=a instanceof f&&c&&c.length?a._options.concat(c):a instanceof f?a._options:a&&a.length?a:[];this.filter=function(a){var c={};b(this,function(b,f){f in a&&(c[f]=a[f])});return c};this.getOption=function(a){return b(this,function(c,b){if(b===a)return c})};return this}function g(a){this._options=a.allowedOptions;this._messageForViolation=a.messageForViolation;this._messageForViolationWithValue=a.messageForViolationWithValue;this._optionName=
a.optionName;this._valueName=a.valueName;this.validate=function(a){for(var c in a)if(a.hasOwnProperty(c)){var b=this._options.getOption(c);if(!b)throw b=this._messageForViolation.replace(this._optionName,c),Error(b);if("object"===typeof b&&!b.validate(a[c]))throw b=this._messageForViolationWithValue.replace(this._optionName,c),b=b.replace(this._valueName,a[c]),Error(b);}};return this}function m(a){try{B.validate(a)}catch(c){console.error(c)}var b=d.filter(a),b=k.extend(b,e(a));return k.ajax(b)}function e(a){if(a.params){if(a.data&&
a.params)throw Error("The option data can not be present with the emulated params option. Merge both and use just one.");return{data:a.params}}}function c(c){try{H.validate(c)}catch(f){console.error(f)}var d={url:F,options:u.filter(c)},e=new k.Deferred;d.url=c.url;if(c.data){if(c.data&&c.params)throw Error("Unsupported options. 'params' and 'data' options are both specified. Remove one of them.");if("object"===typeof c.data)d.options.params=c.data;else if("string"===typeof c.data)b.isSetParamsFormatAsStirngWeblabOn()?
"GET"===c.type?d.url+="?"+c.data:(d.options.params=c.data,d.options.paramsFormat="string"):d.url+="?"+c.data;else throw Error("Unsupported type provided in the 'data' attribute of an AJAX call");}if(c.type){if(c.type&&c.method)throw Error("Unsupported options. 'type' and 'method' options are both specified. Remove one of them.");d.options.method=c.type}if("crossDomain"in c){if("crossDomain"in c&&"withCredentials"in c)throw Error("Unsupported options. 'crossDomain' and 'withCredentials' options are both specified. Remove one of them.");
d.options.withCredentials=c.crossDomain}d=l(d,c,e);d=p(d,c,e);d=v(d,c,e);d=n(d,c,e);d=t(d,c,e);c.beforeSend&&c.beforeSend(d.options);d=A(d,c,e);c=a.ajax(d.url,d.options);return c=e.promise(c)}function p(a,c,b){var d=a.options.success;a.options.success=function(a,c,f){d&&d(a,c,f);b.resolve(a,c,f)};var f=a.options.error;a.options.error=function(a,c,d){f&&f(a,c,d);b.reject(a,c,d)};var e=a.options.abort;a.options.abort=function(a){e&&e(a);b.reject(a,"abort")};return a}function l(a,c){if(!c.complete)return a;
var b=a.options.success;a.options.success=function(a,d,f){b&&b(a,d,f);c.complete(f,"success")};var d=a.options.error;a.options.error=function(a,b,f){d&&d(a,b,f);c.complete(a,"error")};var f=a.options.abort;a.options.abort=function(a){f&&f(a);c.complete(a,"abort")};return a}function n(a,c){var b=a.options.success;a.options.success=function(a,d,f){b&&("text"===c.dataType&&"object"===typeof a&&(a=JSON.stringify(a)),b(a,d,f))};return a}function v(a,c){if(!c.useXMLHttp)return a;var b=a.options.success;
a.options.success=function(a,c,d){d&&(d=d.http);b(a,c,d)};var d=a.options.error;a.options.error=function(a,c,b){a&&(a=a.http);d(a,c,b)};var f=a.options.abort;a.options.abort=function(a){a&&(a=a.http);f(a)};return a}function t(a,c){var b=a.options.success;a.options.success=function(a,c,d){d&&304===d.http.status?b(a,"notmodified",d):b(a,"success",d)};var d=a.options.error;a.options.error=function(a,c,f){a&&a.http.readyState<z.DONE?d(a,"timeout",f):a&&200<=a.http.status&&300>a.http.status&&a.http.readyState===
z.DONE?b(a.http.responseText,"success",a):a&&0==a.http.status?d(a,"abort",f):d(a,"error",f)};return a}function A(a,c){var b=a.options.success;a.options.success=function(a,c,d){y(d,"success");b(a,c,d)};var d=a.options.error;a.options.error=function(a,c,b){y(a,"error");d(a,c,b)};return a}function y(a,c){a?(h.increaseCount("AUI:Ajax:"+c+":xhr:defined"),a.http?h.increaseCount("AUI:Ajax:"+c+":xhr:http:defined"):a.http===F?h.increaseCount("AUI:Ajax:"+c+":xhr:http:undefined"):null===a.http&&h.increaseCount("AUI:Ajax:"+
c+":xhr:http:null")):a===F?h.increaseCount("AUI:Ajax:"+c+":xhr:undefined"):null===a&&h.increaseCount("AUI:Ajax:"+c+":xhr:null")}var z={UNSET:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},d=new f("accepts async beforeSend cache complete contents contentType context converters crossDomain data dataFilter dataType error global headers ifModified isLocal jsonp jsonpCallback method mimeType password processData scriptCharset statusCode success timeout traditional type url username xhr xhrFields".split(" ")),
u=new f("abort accepts cache chunk contentType error headers indicator method params success timeout withCredentials".split(" ")),D=new f(u,[{name:"async",validate:function(a){return a}},"useXMLHttp","beforeSend","complete","crossDomain","dataType","data","type","url"]),w=new f(d,["params"]),H=new g({allowedOptions:D,messageForViolation:"The option %O is not supported in AUI ajax calls and default ajax. Consider using jQuery ajax.",messageForViolationWithValue:"The option %O with value %V is not supported in AUI ajax calls and default ajax. Consider using jQuery ajax.",
optionName:"%O",valueName:"%V"}),B=new g({allowedOptions:w,messageForViolation:"The option %O is not supported in jQuery ajax calls and default ajax. Consider using AUI ajax.",messageForViolationWithValue:"The option %O with value %V is not supported in jQuery ajax calls and default ajax. Consider using AUI ajax.",optionName:"%O",valueName:"%V"}),L=k("meta[name\x3ddefaultAJAX]").attr("content");"jQuery"!==L&&"AUI"!==L&&(L="jQuery");return{default:function(a){try{H.validate(a),B.validate(a)}catch(b){console.error(b)}if("jQuery"===
L)m(a);else if("AUI"===L)c(a);else throw Error("Unknown AJAX method: "+L);},jQuery:m,aui:c,READY_STATE:z}});"use strict";r.when("jQuery").register("weblab-helper",function(a){return{isAJAXWeblabOn:function(){return"1"===a("meta[name\x3dPAGE_CONDUCTOR_AUI_AJAX]").attr("content")},isAjaxStreamingEnabled:function(){return"1"===a("meta[name\x3dENABLE_AJAX_STREAMING]").attr("content")},isNavCFWeblabOn:function(){return"1"===a("meta[name\x3dEMIT_NAV_CF]").attr("content")},isRemoveOrderSummaryPrimaryActionBtnTextWeblabOff:function(){return"1"!==
a("#is-remove-os-pabt").val()},isSetParamsFormatAsStirngWeblabOn:function(){return"1"===a("meta[name\x3dSET_PARAMS_FORMAT_AS_STRING]").attr("content")},disablePrefetchForScheduledDeliveryWeblabOn:function(){return"1"===a("meta[name\x3dDISABLE_PREFETCH_FOR_SCHEDULED_DELIVERY]").attr("content")},isRemoveAddressFormOnDeleteAddressWeblabOn:function(){return"1"===a("meta[name\x3dREMOVE_ADDRESS_FORM_ON_DELETE_ADDRESS]").attr("content")},isSOSPExclusiveJSHandlerWeblabOn:function(){return"1"===a("meta[name\x3dSOSP_EXCLUSIVE_JS]").attr("content")},
sospPartialAvailabilityWeblabOn:function(){return"1"===a("meta[name\x3dSOSP_PARTIAL_UNAVAILABILITY]").attr("content")},refactorExtractURL:function(){return"1"===a("meta[name\x3dREFACTOR_EXTRACT_URL]").attr("content")},showGiftTextAreaOnWarning:function(){return"1"===a("meta[name\x3dSHOW_GIFT_TEXT_AREA_ON_WARNING]").attr("content")},isInterceptionAddressFormWidthFixEnabled:function(){return"1"===a("meta[name\x3dFIX_FIELD_WIDTH_IN_CHECKOUT_INTERCEPTION_FIX_ENABLED]").attr("content")},removesGiftOptionOnRush:function(){return"1"===
a("meta[name\x3dREMOVE_GIFT_OPTION_RUSH]").attr("content")},isSPCMobileDisplayMoreShipOptionsEnabled:function(){return"1"===a("meta[name\x3dSPC_MOBILE_DISPLAY_MORE_SHIP_OPTIONS]").attr("content")},isMCBMultiTenderWeblabEnabled:function(){return"1"===a("meta[name\x3dMCB_MULTI_TENDER_ENABLED]").attr("content")},isCreateAddressLinkForTaxAddressFormWeblabOn:function(){return"1"===a("meta[name\x3dCREATE_ADDRESS_IN_TAX_COLLECTION_ENABLED]").attr("content")},isMfaPSD2DeviceDescriptionCollectionEnabled:function(){return"1"===
a("meta[name\x3dMFA_PSD2_DEVICE_DESCRIPTION_COLLECTION_ENABLED]").attr("content")},isSospCalendarFixEnabled:function(){return"1"===a("meta[name\x3dSOSP_CALENDAR_FIX]").attr("content")},isUpdateMobileNumberEnabled:function(){return"1"===a("meta[name\x3dUPDATE_MOBILE_NUMBER]").attr("content")},isGILCreditCardEnabled:function(){return"1"===a("meta[name\x3dGIL_CREDIT_CARD_PAYMENT_METHOD]").attr("content")},isPyoClientSideInitiationEnabled:function(){return"1"===a("meta[name\x3dPYO_CLIENT_SIDE_INITIATION]").attr("content")},
isTFXCurrencyToggleOnTabletFixed:function(){return"1"===a("meta[name\x3dTFX_CURRENCY_TOGGLE_ON_TABLET_FIXED]").attr("content")},isTFXGuaranteedExchangeFeeEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_TFX_GUARANTEED_EXCHANGE_FEE]").attr("content")},isCSMErrorLoggingEnabled:function(){return"1"===a("meta[name\x3dENABLE_CSM_ERROR_LOGGING]").attr("content")},isLogAFFNFallbackEnabled:function(){return"1"===a("meta[name\x3dENABLE_AF_FN_FALLBACK]").attr("content")},isExecutionIdInQueryStringEnabled:function(){return"1"===
a("meta[name\x3dADD_EXECUTION_ID_TO_QUERY_STRING]").attr("content")},isDigitalAsinIndexingFixedOnSOSPEnabled:function(){return"1"===a("meta[name\x3dDIGITAL_ASIN_INDEXING_FIXED_ON_SOSP]").attr("content")},isCvfOldAmazonUiFixesEnabled:function(){return"1"===a("meta[name\x3dCVF_OLD_AUI_FIXES]").attr("content")},isHeadersCleaned:function(){return"1"===a("meta[name\x3dCLEAN_UP_HEADERS]").attr("content")},isItemAssociationDeleteConfirmationPopoverForWirelessPlansEnabled:function(){return"1"===a("#is-item-assoc-delete-confirmation-popover-for-wireless-plans").val()},
isSsdMdwEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SSD_MDW]").attr("content")},isSDGoldenCXSPCDesktopEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SD_GOLDEN_CX_DESKTOP_SPC]").attr("content")},isExcludeMdwFromGoldenCXWidgetRenamingWeblabEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_GOLDEN_CX_WIDGET_RENAMING_EXCLUDE_MDW]").attr("content")},isRemoveDigitalFlagForScheduledDeliveryShipmentEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SD_NOT_DIGITAL]").attr("content")},
isEGiftOptionsActive:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_EGIFT_OPTIONS_MOBILE]").attr("content")},isPipelineDispatchSendHeaderEnabled:function(){return"1"===a("meta[name\x3dSEND_HEADER_FOR_PIPELINE_REQUEST]").attr("content")},isIngressEnabled:function(){return"1"===a("meta[name\x3dINGRESS_ENABLED]").attr("content")},isISPUMasterEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_ISPU_MASTER]").attr("content")},isRushISPUMasterEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_RENDER_RUSH_ISPU_MASTER]").attr("content")},
isProgressiveOrderReviewCardAnchorEnabled:function(){return 1===a("#progressive-order-review-card-anchor").length},isHandlingMultipleFormIdEnabled:function(){return"1"===a("meta[name\x3dCJ_ARX_HANDLING_MULTIPLE_FORM_CHECKOUT_TSPC]").attr("content")},isTaxExemptionMessagingFixed:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_TAX_EXEMPTION_MSGING]").attr("content")},isTSPCGoldBoxTimerFixEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_TSPC_GOLD_BOX_COUNTER_FIX]").attr("content")},isProgressiveOrderReviewScrollingFixEnabled:function(){return"1"===
a("meta[name\x3dRCX_CHECKOUT_PROGRESSIVE_SCROLLING_FIX]").attr("content")},isSPCAutoScrollFixEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SPC_AUTO_SCROLL_FIX]").attr("content")},isVasTrueSPCEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_VAS_TRUESPC]").attr("content")},isSecureUnifiedDeliveryEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SECURE_UNIFIED_DELIVERY]").attr("content")},isChooseSDOButtonMultiClickFixEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_TSPC_CHOOSE_SDO_BUTTON_MULTI_CLICK_FIX]").attr("content")},
isBillingAddressMultipleUpdatesFixEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_TSPC_BILLING_ADDRESS_MULTIPLE_UPDATES_FIX]").attr("content")},isClearTemporaryPreferenceFixRemoveEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SWP_REMOVE_TPP_FIX]").attr("content")},isRushIspuSpeedInputUpdateFixEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_ADD_HIDDEN_INPUTS_FOR_GDO_SELECTION]").attr("content")},isPageConductorConvergenceEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_PAGE_CONDUCTOR_TANGO_INGRESS_CONVERGENCE]").attr("content")},
isProgressiveIndicatorScrollingFixEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_PROGRESS_INDICATOR_SCROLLING_FIX]").attr("content")},isOrderSummaryUpsellWidgetUpdateEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_PAGE_CONDUCTOR_OSU_WIDGET_UPDATE_ENABLED]").attr("content")},isPrimePresentationLoggerEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_PRIME_PRESENTATION_LOGGER_ENABLED]").attr("content")},isSnsChangeOrderTypeEnabled:function(){return"1"===a("meta[name\x3dRCX_CHECKOUT_SNS_CHANGE_ORDER_TYPE_ENABLED]").attr("content")}}});
"use strict";r.when("A","client-side-metrics").register("weekend-availability-expander-helper",function(a,k){function h(a){return(a=m[a])?g("#weekend-availability-expander-header-text-"+a).text():g("#weekend-availability-default").text()}function b(){return 1==g("input[name\x3d'isBusinessDefaultWeekendDeliveryEnabled']").attr("value")?!0:!1}function f(a,c){return a&&c?"BOTH":a?"SAT":c?"SUN":"NONE"}var g=a.$,m={BOTH:"both",SAT:"sat",SUN:"sun",NONE:"none"};return{isBusinessDefaultWeekendDeliveryViewActive:b,
logExpanderState:function(a,c,b,f){k.increaseCount("checkout:delivery-preferences:"+a+":expander:"+c+":"+(b&&f?"neverExpanded":f?"collapsed":"expanded"),1)},stateToCheckboxes:function(a){var c=!1,f=!1;if(b()){if("BOTH"===a||"SAT"===a)c=!0;if("BOTH"===a||"SUN"===a)f=!0}else{if("BOTH"===a||"OTH"===a||"SAT"===a)c=!0;if("BOTH"===a||"OTH"===a||"SUN"===a)f=!0}return{isSaturdayChecked:c,isSundayChecked:f}},updateAllOptOutMessages:function(a){1==g("input[name\x3d'isSundayDeliveryPreferenceSuppressed']").attr("value")?
a.isSaturdayChecked?g(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!0):(g(".weekend-availability-opt-out-message").text(g("#weekend-availability-opt-out-sat-text").text()),g(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1)):a.isSaturdayChecked||a.isSundayChecked?a.isSaturdayChecked?a.isSundayChecked?g(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!0):(g(".weekend-availability-opt-out-message").text(g("#weekend-availability-opt-out-sun-text").text()),
g(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1)):(g(".weekend-availability-opt-out-message").text(g("#weekend-availability-opt-out-sat-text").text()),g(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1)):(g(".weekend-availability-opt-out-message").text(g("#weekend-availability-opt-out-both-text").text()),g(".weekend-availability-opt-out-box").toggleClass("aok-hidden",!1))},updateAllTitles:function(a){a=f(a.isSaturdayChecked,a.isSundayChecked);g(".sat-sun-expander-heading-text").text(h(a))},
updateAllWeekendAvailabilityStates:function(a){a=f(a.isSaturdayChecked,a.isSundayChecked);g("input[name\x3d'BusinessHours']").attr("value",a)}}});"use strict";r.when("A","loading-spinner-controller","page-transition-controller","page-conductor","checkout-general-utils","address-utilities","page-detector-current-page","client-side-metrics","weblab-helper").register("address-popovers",function(a,k,h,b,f,g,m,e,c){function p(a){(c.isHeadersCleaned()?a.popoverValid:a.getResponseHeader("x-amz-checkout-popover-valid"))||
b.redirect({conductoraction:{url:"/gp/cart/view.html",type:"redirect"}})}function l(d,l,n){f.protectAgainstDoubleAction("show-add-address-popover",200)||(L=d.popover,!B('input[name\x3d"preloadAddressPopover"]').length||l.is(":empty")?(l.empty(),l.css("min-height",397),L.updatePosition(!0),k.showSpinner(l,!1,L),d=(new Date).getTime(),n=m.getCurrentPage(),e.increaseCount("checkout:address-popover-pagetype:".curPage,1),n="itemselect"===n||"spp-itemselect"===n?1:0,c.isHeadersCleaned()?B.ajax({type:"POST",
url:"/gp/buy/addressselect/handlers/popover/display.html?cachebuster\x3d"+d,data:{isBilling:q,isMultiAddress:n},dataType:"json",async:!0,cache:!1,headers:{"x-amz-checkout-page":"itemselect"},success:function(a,c,b){p(a);l.css("min-height",0);u(l,a.popoverContent)},error:b.ajaxRedirect}):B.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/display.html?cachebuster\x3d"+d,data:{isBilling:q,isMultiAddress:n},async:!0,cache:!1,headers:{"x-amz-checkout-page":"itemselect"},success:function(a,
c,b){p(b);l.css("min-height",0);u(l,a)},error:b.ajaxRedirect})):(g.customizeFormFromIdentity(l),g.countrySpecificPopoverOptimizationCheck(B("html")),n&&a.trigger("identity-assets")))}function n(a,d){if(!f.protectAgainstDoubleAction("add-new-address",200)){e.resetMetrics();var l=!1;B(".identity-protect-from-errant").each(function(){var a=B(this),a=a.is("input")?a:a.find("input:first");-1!==a.val().search(/(\d[ -]?){13}/)&&(l=!0)});if(l){var n=B(".address-form-security-error:first");n.length?alert(n.text()):
alert("Please check that the address you have entered is correct.")}else{d.$event.preventDefault();k.showSpinner(a,!1,L);var g=B("#domestic-address-popover-form, #international-address-popover-form, #address-popover-suggestions-form").filter(":visible"),n=g.serialize(),h=(new Date).getTime();d=d.$currentTarget.find('input[type\x3d"submit"]').attr("name");"useSelectedAddress"===d?n+="\x26fromSuggestionPage\x3d1":"fromAddressEditToContinue"===d&&(n+="\x26fromAddressEditToContinue\x3d1");B("#addAddressOnly").length&&
(n+="\x26addOnly\x3d1");q&&(n+="\x26isBilling\x3d1");var m="/gp/buy/addressselect/handlers/popover/new.html";if(L){if("domestic-address-popover-form"===g.attr("id")&&(g.find(".enterAddressFormField").blur(),g="#"+a.attr("id")+" div[id^\x3donblur-character-validation-error-]",0<B(g).size())){k.hideSpinner(a);return}m+="/ref\x3dchk_addr_editPopoverSubmit";b.isSPP()&&(L.lock(11),setTimeout(function(){L.unlock(12)},2E3))}var t=null!==X&&X!==F&&null!==R&&R!==F;"useSelectedAddress"===d&&!q&&t&&(n+="\x26fromSTMAPopover\x3d1");
B("#international-address-popover-form").filter(":visible").length&&(n+="\x26showSecondaryForm\x3d1");w()&&K?v(a,h,n):c.isHeadersCleaned()?B.ajax({type:"POST",url:m+"?cachebuster\x3d"+h,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",data:n,dataType:"json",async:!0,cache:!1,error:b.ajaxRedirect,success:function(c,d,f){b.isSPP()&&L.unlock(12);p(c);c.newPopoverType?A(c,d,c):c.reloadPopover?u(a,c.popoverContent):t?y(c):z("added",c.popoverContent)}}):B.ajax({type:"POST",url:m+"?cachebuster\x3d"+
h,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",data:n,async:!0,cache:!1,error:b.ajaxRedirect,success:function(c,d,f){b.isSPP()&&L.unlock(12);p(f);f.getResponseHeader("x-amz-checkout-open-new-popover")?A(c,d,f):f.getResponseHeader("x-amz-checkout-reload-popover")?u(a,c):t?y(f):z("added",f)}})}}}function v(a,d,l){var n=K.getNewTaxAddressPopoverURL();c.isHeadersCleaned()?B.ajax({type:"POST",url:n+"?cachebuster\x3d"+d,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",
data:l,dataType:"json",async:!0,cache:!1,error:b.ajaxRedirect,success:function(c,d,l){b.isSPP()&&L.unlock(12);p(c);c.reloadPopover?u(a,c.popoverContent):c.newAddressId&&(B(".a-button-close").trigger("click"),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"),K.submitTaxAddressFormWithNewAddressId(c.newAddressId))}}):B.ajax({type:"POST",url:n+"?cachebuster\x3d"+d,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",data:l,async:!0,cache:!1,error:b.ajaxRedirect,success:function(c,
d,l){b.isSPP()&&L.unlock(12);p(l);l.getResponseHeader("x-amz-checkout-reload-popover")?u(a,c):l.getResponseHeader("x-amz-checkout-new-address-id")&&(B(".a-button-close").trigger("click"),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"),c=l.getResponseHeader("x-amz-checkout-new-address-id"),K.submitTaxAddressFormWithNewAddressId(c))}})}function t(a){if(!f.protectAgainstDoubleAction("show-edit-address-popover",200)){var d=B("#address-suggestions-popover");a.$event.preventDefault();
k.showSpinner(d,!1,L);a=B("#address-popover-suggestions-form");var l=a.serialize();a.find('input[type\x3d"radio"]').each(function(){var a=B(this);a.attr("checked")&&(l+="\x26edit_"+a.val()+"\x3d1")});q&&(l+="\x26isBilling\x3d1");L&&b.isSPP()&&(L.lock(11),setTimeout(function(){L.unlock(12)},2E3));a=(new Date).getTime();c.isHeadersCleaned()?B.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+a,data:l,dataType:"json",async:!0,cache:!1,error:b.ajaxRedirect,success:function(a,
c,d){b.isSPP()&&L.unlock(12);p(a);A(a,c,a)}}):B.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+a,data:l,async:!0,cache:!1,error:b.ajaxRedirect,success:function(a,c,d){b.isSPP()&&L.unlock(12);p(d);A(a,c,d)}})}}function A(d,b,f){B('input[name\x3d"preloadAddressPopover"]').remove();c.isHeadersCleaned()?(b=f.newPopoverType,"suggestions"===b?(B("#address-suggestions-popover").empty().append(f.popoverContent),B("#address-suggestions-popover-link").trigger("click")):
"edit"===b&&(b=B("#edit-address-popover"),b.empty().append(f.popoverContent),B("#edit-address-popover-link").trigger("click"),u(b,f.popoverContent))):(b=f.getResponseHeader("x-amz-checkout-open-new-popover"),"suggestions"===b?(B("#address-suggestions-popover").empty().append(d),B("#address-suggestions-popover-link").trigger("click")):"edit"===b&&(b=B("#edit-address-popover"),b.empty().append(d),B("#edit-address-popover-link").trigger("click"),u(b,d)));a.trigger("identity-assets")}function y(a){a=
c.isHeadersCleaned()?a.newAddressId:a.getResponseHeader("x-amz-checkout-new-address-id");var d=(new Date).getTime();B.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html?cachebuster\x3d"+d,data:{action:"update-address",lineitems:X,quantities:R,addresses:a+".home..",returnHTML:0},async:!0,cache:!1,error:b.ajaxRedirect,success:function(a,c,d){z("applied",d)}})}function z(c,d){var l=(new Date).getTime();B('input[name\x3d"shipToAddress"]').length?(c=function(){b.isSPP()?(h.blockAllActions(),
h.shrinkPanel(B(".spp-panel.expanded"),!0)):h.show()},b.isNonBlockingAnimationEnabled()?a.delay(c,0):c(),c=m.getCurrentPage(),b.loadPage(c,"",F,{refTag:"chk_addr_editPopoverSubmit"},F,d)):(d=b.setAjaxTransitionHeader(),B.ajax({type:"POST",headers:d,url:"/gp/buy/shared/handlers/pipeline-dispatch.html?cachebuster\x3d"+l,data:{useCase:"multiAddress",showAddressAdded:c,page:"itemselect"},dataType:"text",async:!0,cache:!1,error:b.ajaxRedirect,success:function(a,c,d){b.ajaxUpdatePage(a,c,d);B(".a-button-close").trigger("click");
f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")}}))}function d(a){a=B("#"+a);a.length&&a.empty()}function u(c,d){c.html(d);g.customizeFormFromIdentity(c);L.updatePosition(!0);a.trigger("identity-assets");g.countrySpecificPopoverOptimizationCheck(B("html"))}function D(a){a=a.$currentTarget.closest(".lineitem");X=a.find('input[name^\x3d"lineItemEntityID."]').val();R=a.find('input[name^\x3d"quantity."]').val();a=B("#add-address-popover-link");a.length?a.trigger("click"):B("#add-new-address-popover").trigger("click")}
function w(){return c.isCreateAddressLinkForTaxAddressFormWeblabOn()&&0<B("#isTaxAddress").length}function H(){q=B("#isBilling").length?1:0;if(c.isInterceptionAddressFormWidthFixEnabled()){var a=B(".enter-address-form");g.customizeFormFromIdentity(a)}}var B=a.$,L,X,R,q=0,K=null;if(!B("html").hasClass("a-ie6"))return a.on("a:popover:show:add-address",function(a){d("edit-address-popover");d("add-billing-address-popover");q=0;l(a,B("#add-address-popover"),!1)}),a.on("a:popover:show:add-billing-address",
function(a){d("edit-address-popover");d("add-address-popover");l(a,B("#add-billing-address-popover"),!0)}),a.on("a:popover:show:address-suggestions",function(a){L=a.popover}),a.on("a:expander:delivery-expander:toggle:expand",function(a){a=B(".a-expander-content");g.fixOverflow(a)}),a.declarative("close-delete-popover",["click","touchend"],function(a){r.when("a-popover-base").execute(function(c){(c=c.get(a.data.popoverName))&&c.hide()})}),a.declarative("rm-address-action",["click","touchend"],function(a){r.when("a-popover-base").execute(function(c){(c=
c.get(a.data.popoverName))&&c.hide()});c.isRemoveAddressFormOnDeleteAddressWeblabOn()&&(d("edit-address-popover"),d("add-address-popover"),d("add-billing-address-popover"));r.when("page-conductor").execute(function(c){c.continueClicked(null,a.$target)})}),B(document).delegate("a.prevent-default-marker","click",function(a){a.preventDefault()}),a.declarative("select-billing-address-in-popover",["click","touchend"],function(a){a.$event.preventDefault();B("#address-list").submit();r.when("a-popover-base").execute(function(a){var d=
a.get("select-billing-address");d&&(c.isBillingAddressMultipleUpdatesFixEnabled()?a.remove("select-billing-address"):d.hide())})}),a.declarative("trigger-popover-from-link",["click","touchend"],function(a){f.protectAgainstDoubleAction("trigger-popover-from-link",200)||(R=X=null,B("#add-address-popover-link").trigger("click"))}),a.declarative("add-address-popover-submit",["click","touchend"],function(a){n(B("#add-address-popover"),a)}),a.declarative("add-billing-address-popover-submit",["click","touchend"],
function(a){n(B("#add-billing-address-popover"),a)}),a.declarative("edit-address-popover-submit",["click","touchend"],function(a){n(B("#edit-address-popover"),a)}),a.declarative("address-suggestions-submit",["click","touchend"],function(a){n(B("#address-suggestions-popover"),a)}),a.declarative("delete-address-popover-submit",["click","touchend"],function(a){a=B("#delete-address-button");0<a.length&&a.click()}),a.declarative("edit-address-suggestions",["click","touchend"],t),a.declarative("add-address-popover-edit",
["click","touchend"],function(a){if(!f.protectAgainstDoubleAction("add-address-popover-edit",200)){a.$event.preventDefault();var d=B("#add-address-popover");k.showSpinner(d,!1,L);a=B("#address-popover-suggestions-form").serialize()+"\x26"+a.$currentTarget.find('input[type\x3d"submit"]').attr("name")+"\x3d1";var l=(new Date).getTime();c.isHeadersCleaned()?B.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+l,data:a,dataType:"json",async:!0,cache:!1,error:b.ajaxRedirect,
success:function(a,c,b){p(a);u(d,a.popoverContent)}}):B.ajax({type:"POST",url:"/gp/buy/addressselect/handlers/popover/edit.html?cachebuster\x3d"+l,data:a,async:!0,cache:!1,error:b.ajaxRedirect,success:function(a,c,b){p(b);u(d,a)}})}}),a.declarative("add-address-popover-toggle",["click","touchend"],function(a){f.protectAgainstDoubleAction("add-address-popover-toggle",200)||(a.$event.preventDefault(),a=a.$currentTarget.closest(".enter-address-form"),g.toggleAddressForm(a,a.siblings(".enter-address-form")))}),
a.declarative("select-radio-option",["click","touchend"],function(a){a=a.$currentTarget.find(".radio-option");a.find('input[type\x3d"radio"]').attr("checked","checked");a.closest(".radio-option-list").find(".radio-option").removeClass("radio-option-selected");a.addClass("radio-option-selected")}),a.declarative("trigger-address-popover",["click","touchend"],function(a){f.protectAgainstDoubleAction("trigger-address-popover",200)||B("#add-address-popover-link").trigger("click")}),a.on("checkout:reload:spp-shipaddress",
H),a.on("checkout:reload:spp-billing-address",H),a.on("checkout:reload:itemselect",H),a.on("checkout:reload:spp-itemselect",H),{actionTriggerPopoverFromDropdown:D,actionRegisterTaxAddressController:function(a){w()&&!K&&a&&(K=a)}}});"use strict";r.when("A").register("address-book-controller",function(a){function k(){h("div.address-book").unbind("recalculate-address-height").bind("recalculate-address-height",function(){var a,f=h(),g=0,m=h("div.address-book .js-same-height"),e=m.length;m.css({height:"auto"}).each(function(c){var p=
h(this);a=a||p.offset().top;a!==p.offset().top&&(f.height(g),f=h(),g=0,a=p.offset().top);var l=p.height();f=f.add(p);l>g&&(g=l);c===e-1&&0<g&&f.height(g)})}).trigger("recalculate-address-height");h(q).unbind("resize.checkout-as").bind("resize.checkout-as",function(){h("div.address-book").trigger("recalculate-address-height")})}var h=a.$;a.on("checkout:reload:spp-shipaddress",k);a.on("checkout:reload:shipaddressselect",k);a.on("checkout:reload:billingaddressselect",k);a.on("checkout:reload:spp-billing-address",
k)});"use strict";r.when("A","client-side-metrics","weblab-helper").register("address-utilities",function(a,k,h){function b(a){a.find("input").each(function(){var a=e(this),c=a.outerWidth(!0),b=a.parent().outerWidth(!0);c>b&&a.attr("size")&&(document.getElementById(a.attr("id")).removeAttribute("size"),a.width("100%"))})}function f(a){if(e('input[name\x3d"useLiveAUI"]').length)r.when("p-detect").execute(function(b){b.capabilities.inputPlaceholder&&a.find(".field-description").each(function(){var a=
e(this),c=a.text(),b=a.closest(".a-col-right").find(":not(.address-form-skip-js-tweaks):not(.address-form-skip-js-tweaks *) input");b.attr("maxlength")<c.length&&b.attr("size",c.length);b.attr("placeholder",a.text())})}),a.find("input").each(function(){e(this).outerWidth()}),a.find("input[type\x3d'text'], select").each(function(){var a=e(this).closest(".full-width-config"),c=e(this);0===a.find(".a-popover-trigger").length&&(h.isInterceptionAddressFormWidthFixEnabled()?c.addClass("addressform-textfield-width"):
c.width("96%"))});else{r.when("p-detect").execute(function(b){b.capabilities.inputPlaceholder?a.find(".field-description").each(function(){var a=e(this),c=a.text(),b=a.closest(".a-column").find(":not(.address-form-skip-js-tweaks):not(.address-form-skip-js-tweaks *) input");b.attr("maxlength")<c.length&&b.attr("size",c.length);b.attr("placeholder",a.text())}):a.find(".field-description").each(function(){var a=e(this);a.find("br").remove();a.show()})});a.find(".popover-field-label").each(function(){var a=
e(this);a.find("b").each(function(){var a=e(this);a.text(e.trim(a.text()))});a.find("font").each(function(){var a=e(this);"-2"===a.attr("size")&&a.remove()})});var f=e(".enter-address-form");b(f);var l=0,f=a.find(".one-new-address-form-field").first();f.length&&f.find(".a-column").each(function(){l+=e(this).outerWidth()});a.width(0<l?l:"")}}function g(c){function b(){y=e.val();(z=m[y])&&g.find(".learn-more a").text(z.popOverLinkText)}var f=q.P&&q.P.AUI_BUILD_DATE,e=c.find("#enterAddressCountryCode"),
g=c.find(".country-specific-form-input"),h,m;f?(h=g.find("input"),m=c.find(".country-specific-config").data("popovercountryconfig")):(k.increaseCount("removeauijs2"),h=g.find("#"+g.data("inputid")),m=g.find(".country-specific-config").data("popovercountryconfig"));if(e.length&&g.length&&h.length&&m){var y=e.val(),z=m[y];e.unbind("change.countryChangeConfigUpdate").bind("change.countryChangeConfigUpdate",b);b();var d=f?"show":"beforeShow";a.on("a:popover:"+d+":checkout-"+g.data("inputid")+"Name",function(a){"beforeShow"===
d&&k.increaseCount("removeauijs3");z&&(a.popover.$popover.find(".a-popover-header h4").html(z.popOverTitle),a.popover.$popover.find(".a-popover-inner").html(z.popOverText),a.popover.updatePosition())})}}function m(a){function b(){var a=g.val();(a=A[a])?(a=(a=a.label)||"",m.attr("placeholder",e("\x3cdiv /\x3e").html(a).text().replace(":","")),h.show()):h.hide()}var f=q.P&&q.P.AUI_BUILD_DATE,g=a.find("#enterAddressCountryCode"),h=a.find(".country-specific-form-input-mobile"),m,A;f?(m=h.find("input"),
A=a.find(".country-specific-config").data("labelcountryconfig")):(k.increaseCount("removeauijs3"),m=h.find("#"+h.data("inputid")),A=h.find(".country-specific-config").data("labelcountryconfig"));g.length&&h.length&&m.length&&A&&(g.unbind("change.countryChangeLabelUpdate").bind("change.countryChangeLabelUpdate",function(){h.hasClass("initial-edit-value")?h.removeClass("initial-edit-value"):m.val("");b()}),b())}var e=a.$;r.when("a-checkbox").execute(function(c){a.declarative("delivery-preferences-weekend-availability-checkbox-triggered",
"click",function(a){if("undefined"!==typeof a.$target){var b=a.$target.val();a.$target.is(":checked")&&("NONE"===b?(c("#delivery-preferences-weekend-availability-sat").uncheck(),c("#delivery-preferences-weekend-availability-sun").uncheck()):"SAT"!==b&&"SUN"!==b||c("#delivery-preferences-weekend-availability-none").uncheck())}})});a.declarative("wdp-redesign-addresstype-radio-clicked","click",function(a){var b=a.$target.context.id;a=e(".com-businesshours-text");var f=e("#delivery-preferences-weekend-availability-sat").is(":checked"),
g=e("#delivery-preferences-weekend-availability-sun").is(":checked");"devyPrefs_AddressType_COM"===b?(k.increaseCount("WDPTotalCOMClick"),e(".wdp-res").removeClass("a-color-base-background").addClass("a-color-alternate-background"),e(".wdp-com").removeClass("a-color-alternate-background").addClass("a-color-base-background"),e(".wdp-BusinessHours").removeClass("aok-hidden")):"devyPrefs_AddressType_RES"===b?(k.increaseCount("WDPTotalRESClick"),e(".wdp-com").removeClass("a-color-base-background").addClass("a-color-alternate-background"),
e(".wdp-res").removeClass("a-color-alternate-background").addClass("a-color-base-background"),e(".wdp-BusinessHours").addClass("aok-hidden")):"delivery-preferences-weekend-availability-sat"===b?(k.increaseCount("WDPTotalSATClick"),b=f?g?"BOTH":"SAT":g?"SUN":"OTH",a.addClass("aok-hidden"),e(".com-businesshours-"+b).removeClass("aok-hidden")):"delivery-preferences-weekend-availability-sun"===b&&(k.increaseCount("WDPTotalSUNClick"),b=g?f?"BOTH":"SUN":f?"SAT":"OTH",a.addClass("aok-hidden"),e(".com-businesshours-"+
b).removeClass("aok-hidden"))});return{toggleAddressForm:function(a,g){a.hide();g.find("div.a-alert-error:not(.js-originally-shown-imb)").hide();a.find("input[type\x3d'text'], select, input[type\x3d'radio']:checked, input[type\x3d'hidden']").each(function(){var a=e(this),c=a.attr("name")||a.data("copyto")||a.attr("id");if(!a.is(":disabled")&&!a.find(":selected").is(".js-not-a-value")){var b=g.find("input[name\x3d'"+c+"']");"enterAddressLandmark"===c&&(b=g.find("input[name\x3d'Landmark']"));"Landmark"!==
c||b.length||(b=g.find("input[name\x3d'enterAddressLandmark']"));1<b.length&&a.is("input[type\x3d'radio']")?b.filter("[value\x3d'"+a.val()+"']").attr("checked",!0):b.is("select")?b.find("option[value\x3d'"+a.val()+"']").attr("selected",!0):a.is("input[type\x3d'hidden']")||b.is("input[type\x3d'hidden']")||b.val(a.val())}});g.show();b(g);f(g)},customizeFormFromIdentity:f,fixOverflow:b,countrySpecificLabelOptimizationCheck:function(a){var b=a.find(".enter-address-form");1===b.data("taxidOpt")?setTimeout(function(){m(b)},
100):m(b)},countrySpecificPopoverOptimizationCheck:function(a){var b=a.find(".enter-address-form");1===b.data("taxidOpt")?setTimeout(function(){g(b)},100):g(b)}}});"use strict";r.when("A","page-conductor","page-transition-controller","client-side-metrics","page-detector-current-page","checkout-general-utils","weblab-helper").register("address-form-helper",function(a,k,h,b,f,g,m){function e(a,c,b){v(".a-button-close").trigger("click");v('\x3cinput name\x3d"addressID"/\x3e').val(a).appendTo(b);v('\x3cinput name\x3d"purchaseId"/\x3e').val(c).appendTo(b);
k.continueClicked(null,b)}function c(a,c){c||(c=v("#address-ui-checkout-form"));l(c);var b=(new Date).getTime();v.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html?cachebuster\x3d"+b,data:{action:"update-address",lineitems:t,quantities:A,addresses:a,returnHTML:0},async:!0,cache:!1,error:function(){n(c);k.ajaxRedirect},success:function(a,b,d){p("applied",c)}})}function p(a,c){var b=(new Date).getTime(),f=k.setAjaxTransitionHeader();v.ajax({type:"POST",headers:f,url:"/gp/buy/shared/handlers/pipeline-dispatch.html?cachebuster\x3d"+
b,data:{useCase:"multiAddress",showAddressAdded:a,page:"itemselect"},dataType:"text",async:!0,cache:!1,error:function(){n(c);k.ajaxRedirect},success:function(a,b,d){n(c);k.ajaxUpdatePage(a,b,d);v(".a-button-close").trigger("click");g.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")}})}function l(a){k.isSPP()?(h.blockAllActions(),h.showTransitionInContainer(a)):h.show()}function n(a){k.isSPP()?(h.unblockAllActions(),v(a).find("div.section-overwrap").remove()):h.hide()}var v=a.$,t,A;
a.on("a:popover:afterUpdatePosition:edit-address",function(c){c.popover&&c.popover.isVisible()&&a.trigger("checkout:popoverContentLoaded:edit-address",c.popover)});a.on("a:popover:afterUpdatePosition:add-address",function(c){c.popover&&c.popover.isVisible()&&a.trigger("checkout:popoverContentLoaded:add-address",c.popover)});a.on("a:popover:visible:add-address",function(c){c.popover&&c.popover.isVisible()&&a.trigger("checkout:popoverContentLoaded:add-address",c.popover)});m.isHandlingMultipleFormIdEnabled()&&
(a.on("a:popover:beforeShow:add-address",function(){a.trigger("checkout:popover-beforeShow:add-address")}),a.on("a:popover:beforeShow:edit-address",function(){a.trigger("checkout:popover-beforeShow:edit-address")}),a.on("a:popover:invisible:add-address",function(){a.trigger("checkout:popover-hide:add-address")}),a.on("a:popover:invisible:edit-address",function(){a.trigger("checkout:popover-hide:edit-address")}),a.on("checkout:reload:spp-shipaddress",function(){a.trigger("checkout:reload:address-page")}));
a.declarative("itemselect-update-address",["change"],function(a){a=a.$currentTarget.closest(".lineitem");t=a.find('input[name^\x3d"lineItemEntityID."]').val();A=a.find('input[name^\x3d"quantity."]').val()});return{setDestination:function(a,l){a||(b.increaseCount("checkout:addressForm:setDestination:noRequest",1),a={});var d=a.addressId;d||b.increaseCount("checkout:addressForm:setDestination:noAddressId",1);var g=a.purchaseId||v("input[name\x3d'purchaseId']").val();g||b.increaseCount("checkout:addressForm:setDestination:noPurchaseId",
1);a=a.ref||"ox_shipaddress_add_new_addr";var n=f.getCurrentPage();if("itemselect"===n||"spp-itemselect"===n)return c(d,l);v('[name\x3d"isBilling"]')&&1==v('[name\x3d"isBilling"]').val()?(a="ox_billing_continue",(l=v("input[name\x3d'paymentInstrumentId']").val())||b.increaseCount("checkout:addressForm:setDestination:noPaymentInstrumentId",1),(n=v("input[name\x3d'paymentMethodCode']").val())||b.increaseCount("checkout:addressForm:setDestination:noPaymentMethodCode",1),a=v("\x3cform/\x3e").attr("action",
"/gp/buy/billingaddressselect/handlers/continue.html/ref\x3d"+a),v('\x3cinput name\x3d"paymentInstrumentId"/\x3e').val(l).appendTo(a),v('\x3cinput name\x3d"paymentMethodCode"/\x3e').val(n).appendTo(a),v('\x3cinput name\x3d"action" value\x3d"select-billing"/\x3e').appendTo(a),v('\x3cinput name\x3d"isAUIWSAddressCreationWorkflow" value\x3d"1"/\x3e').appendTo(a)):(a=v("\x3cform/\x3e").attr("action","/gp/buy/addressselect/handlers/continue.html/ref\x3d"+a),v('\x3cinput name\x3d"action" value\x3d"select-shipping"/\x3e').appendTo(a));
e(d,g,a)},onPageTransitionStart:l,onPageTransitionComplete:n}});"use strict";r.when("A","client-side-metrics","weblab-helper").register("action-logger",function(a,k){var h=a.$;a.declarative("ue-count",["click","touchend"],function(a){k.increaseCount(a.data.countFlag,a.data.countValue)});return{logUsedPrefetch:function(a,f,g,m){m||(k.increaseCount("Checkout:action-log:MissingRefMarker"),m="");h.ajax({type:"GET",url:"/gp/buy/shared/handlers/log-used-prefetch.html"+m,data:"pageType\x3d"+a+"\x26subPageType\x3d"+
f+"\x26relatedRequestId\x3d"+g,dataType:"text",cache:!1})}}});"use strict";r.when("A","weblab-helper").register("ajax-utility",function(a,k){return{jsonify:function(h){var b;if(b=k.isAJAXWeblabOn()){b=h instanceof Function;var f=h instanceof Array,g=h instanceof String;b=h instanceof Object&&!f&&!b&&!g}if(b)return h;try{h=a.$.parseJSON(h)}catch(m){h=null}return h}}});"use strict";r.when("A","page-conductor","client-side-metrics","weblab-helper").register("button-blocker",function(a,k,h,b){function f(a,
c,b,f){k.isSPP()?c.closest("span.a-declarative").data("blockerText",b):c.find("input.a-button-text").data("blockerText",b);g(f);n?(a.addClass("aok-hidden"),c.removeClass("aok-hidden"),m("#hasTVNavigation").length&&r.when("a-tv").execute(function(c){c.remove(a)})):(h.increaseCount("removeauijs10"),a.hide(),c.show(),c.hasClass("aok-hidden")&&c.removeClass("aok-hidden"))}function g(a){var c=m(".continue-button-blocker-text");c.length&&(a?(c.html(a),c.removeClass("aok-hidden")):(c.addClass("aok-hidden"),
c.empty()))}var m=a.$,e={},c=[],p,l,n=q.P&&q.P.AUI_BUILD_DATE,v=!1;b=b.isPyoClientSideInitiationEnabled()?"checkout:unload":"checkout:beforeReload";a.on(b,function(){c=[];e={};p=""});return{show:function(a,b,l){if(!v){var g=m(".continue-button");if(g.length)if(b){var d=m(".continue-button-blocker");if(d.length){l=l||"";var n=e[a]!==F&&e[a].tooltipText!==b,k=e[a]!==F&&e[a].buttonInlineText!==l;if(0===c.length||!e[a]||n||k)f(g,d,b,l),p=a;e[a]===F&&c.push(a);e[a]={tooltipText:b,buttonInlineText:l}}}else q.console&&
q.console.error&&console.error("showBlockerOnContinue should not be called with an empty tooltip."),h.increaseCount("Checkout:ButtonBlocker:EmptyTooltip")}},hide:function(a){if(!v){if(e[a]!==F){delete e[a];var b=m.inArray(a,c);c.splice(b,1)}var l=m(".continue-button");l.length&&(b=m(".continue-button-blocker"),b.length&&(0===c.length?(g(),n?(b.addClass("aok-hidden"),l.removeClass("aok-hidden"),m("#hasTVNavigation").length&&r.when("a-tv").execute(function(a){a.add(l)})):(h.increaseCount("removeauijs11"),
b.hide(),l.show(),l.hasClass("aok-hidden")&&l.removeClass("aok-hidden"))):p===a&&(p=c[0],f(l,b,e[p].tooltipText,e[p].buttonInlineText))))}},lock:function(){v=!0},unlock:function(){v=!1},getButtonBlocker:function(){l||(l=m(".continue-button-blocker"));return l}}});"use strict";r.when("A","button-blocker","client-side-metrics").register("button-blocker-controller",function(a,k,h){function b(a,c){m[a]!==F&&m[a].state!==c&&(m[a].state=c,f())}function f(){var a=!0,b;g.each(m,function(f,m){b=m.owner;if(m.state===
c.DISABLE_CONTINUE)return a=!1,k.show(b,m.toolTipMessage,m.buttonInlineMessage),e||(h.increaseCount("removeauijs12"),g(".continue-button-blocker").css("display","inline-block")),!1});a&&k.hide(b)}var g=a.$,m={},e=q.P&&q.P.AUI_BUILD_DATE,c={ENABLE_CONTINUE:"enableContinue",DISABLE_CONTINUE:"disableContinue"};a.on("checkout:beforeReload",function(){m={}});return{disableContinue:function(a,l,g,e){e=e||"";m[l]===F&&(g?(m[l]!==F||(m[l]={state:c.ENABLE_CONTINUE,owner:a,toolTipMessage:g,buttonInlineMessage:e}),
f()):q.console&&q.console.error&&console.error("_registerElement should not be called with an empty tooltip."));b(l,c.DISABLE_CONTINUE)},enableContinue:function(a){m[a]!==F&&b(a,c.ENABLE_CONTINUE)}}});"use strict";r.when("jQuery").register("cache-page-data-controller",function(a){var k={};return{clearCache:function(){k={}},setCachedPageData:function(h,b,f,g,m){var e=[],c=!0;a(".cacheable-spp-panel").each(function(){var b=a(this),f;f=!b||b.find(".is-scheduled-delivery").length?!1:!0;if(!f)return c=
!1;b.find(".expand-panel-button").removeClass("a-button-focus");e.push({id:b.attr("id"),content:b[0].outerHTML})});if(c){var p={panels:e};a(".cacheable-spp-section").each(function(){var c=a(this);p[c.attr("id")]=c[0].outerHTML});k[h+"-"+b]={curPageData:p,state:q.history?history.state:f,page:h,title:document.title||g,url:q.location.href||m}}},getCachedPageData:function(a,b){return k[a+"-"+b]}}});"use strict";r.when("A").register("checkout-general-utils",function(a){function k(a,g,m,e){var c=b.getAssocParamValuesFromUrl(a);
!m&&e?delete c[g]:c[g]=m;g=0<=a.indexOf("?")?a.substring(0,a.indexOf("?")):a;g=g+"?"+h.param(c,1);(a=b.getFragmentFromUrl(a))&&(g+="#"+a);return g}var h=a.$,b={moveToNextInput:function(a){a=a.nextAll(":visible").find("input").get(0);a!==[]&&a.focus()},hide:function(a){a.hide()},show:function(a){q.P&&q.P.AUI_BUILD_DATE&&a.hasClass("aok-hidden")&&a.removeClass("aok-hidden");a.show()},getAssocParamValuesFromUrl:function(a){var b={};if("string"!==typeof a||-1===a.indexOf("?"))return b;a=a.slice(a.indexOf("?")+
1);if(!a)return b;-1!=a.indexOf("#")&&(a=a.substring(a,a.indexOf("#")));a=a.split("\x26");for(var h=0;h<a.length;h++){var e=a[h].split("\x3d");b[e[0]]=e[1]}return b},addQueryStringParameter:function(a,b,h){return k(a,b,h,!1)},addQueryStringParameterOrDeleteIfEmpty:function(a,b,h){return k(a,b,h,!0)},getQueryStringParameter:function(a,g){a=b.getAssocParamValuesFromUrl(a);return g in a?a[g]:F},getFragmentFromUrl:function(a){var b=a.indexOf("#");return-1==b?F:a.substring(b+1)},extractURLParts:function(a){if(!a||
"string"!==typeof a)return{};a=/(.*html)(\/ref[^?\n]*)?[?]?(.*)/g.exec(a);var b={};a&&(a[1]&&(b.normalizedUrl=a[1]),a[2]&&(b.refMarker=a[2]),a[3]&&(b.query=a[3]));return b},redirectWithJavascript:function(a){q.location=b.addQueryStringParameter(a,"hasWorkingJavascript","1")},bindActionEnterKeyOnButton:function(a){a.keyup(function(a){13===a.which&&h(a.target).trigger("click")})},toggleExpanderContent:function(a){a=a.$target.closest(".a-box");a.hasClass("a-single")?a.removeClass("a-single").addClass("a-first"):
a.addClass("a-single").removeClass("a-first")},validateNumber:function(a,b,m){h.trim(a);return/^\d+$/.test(a)&&a>=b&&a<=m}};b.protectAgainstDoubleAction=function(){var a={};return function(b,h){if(!b)return q.console&&q.console.error&&console.error("Function is not used properly, use a unique owner to identify the caller."),!1;if(a.hasOwnProperty(b))return!0;a[b]=1;setTimeout(function(){delete a[b]},h||100);return!1}}();b.logErrorOnLevel=function(a,b){(q.ueLogError||h.noop)({message:a,logLevel:b});
if(q.console){var m={FATAL:q.console.error,"default":q.console.warn};b=m[b]||m["default"]}else b=h.noop;b.call(q,a)};b.logError=function(a){b.logErrorOnLevel(a,"FATAL")};b.updateCartByMash=function(a){r.when("safe-mash").execute(function(b){null!==a&&a!==F&&"1"===h("#updateCartByMash").attr("content")&&b&&b.cart&&b.cart.didUpdate&&b.cart.didUpdate({newCartQuantity:a})})};b.getPosition=function(a,b,h){for(var e=0,c=a.length,p=0;p<c;p++)if(a.charAt(p)===b&&(e++,e===h))return p;return-1};b.limitInputToNumbers=
function(a){var b=a.$event.keyCode;-1!==h.inArray(b,[46,8,9,37,39])||-1!==h.inArray(b,[65,67,86])&&!0===a.ctrlKey||(a.$event.shiftKey||(48>b||57<b)&&(96>b||105<b))&&a.$event.preventDefault()};b.nukeDropdowns=function(a){r.when("a-popover-base").execute(function(b){h.each(h(a),function(){b.remove(this.name)})})};a.on("checkout:reload",function(){h('input[name\x3d"useLiveAUI"]').length||a.defer(function(){h(".a-declarative, .a-button").filter("[data-action]").unbind("keypress.checkout-page").bind("keypress.checkout-page",
function(a){13===a.which&&h(this).trigger("click")})})});a.on("checkout:beforeLoadPage",function(){h("div.a-popover").find(".a-declarative:first:[data-action\x3dcustom-popover-close|a-popover-close]").click()});return b});"use strict";r.when("A","weblab-helper").register("client-side-metrics",function(a,k){var h=a.$,b=null,f=null,g=0,m,e=a.capabilities&&a.capabilities.isAmazonApp||q.amazon&&q.amazon.mash;a=function(){};var c=q.uet||a,p=q.uex||a,l=!1,n=!1,v=function(a){q.ue&&q.ue.t&&(q.uet(a,b),w("checkout:client-side-metrics:uet:marker:"+
a,1,1),null===b&&null===f&&q.ue.isl&&(w("checkout:client-side-metrics:mark:at",1,1),q.uex("at")));"af"===a?l=!0:"fn"===a&&(n=!0)},t=function(a){q.ue&&q.uex&&(q.uex(a,b),w("checkout:client-side-metrics:uex:marker:"+a,1,1))},A=function(a){q.ue&&q.ues&&q.ues("id",b,a)},y=function(){q.ue&&q.ues&&q.ues("ctb",b,"1")},z=function(){q.ue&&q.ues&&(e&&v("mts",b),q.ues("t0",b,(new Date).getTime()),v("ue"),v("bb"))},d=function(a){a?f="ctbajax"+g++:b="ajax"+g++};a=function(a){b=a};var u=function(){return b},D=
function(){return f},w=function(a,b,c){"undefined"!==typeof q.ue&&"undefined"!==typeof q.ue.count&&(b=b?b:1,c?q.ue.count(a,(q.ue.count(a)||0)+1):q.ue.count(a,b))},H=function(a){if(a&&a.length){var c=b;b=f;A(a);b=c}},B=function(){m===F&&(m=0<h("#transitionLogging").length);return m},L=function(a,b,c,d){q.ueLogError&&q.ueLogError(a,{message:b,attribution:c,logLevel:d})};return{getscope:u,getasyncscope:D,setmarker:v,sendue:t,setrid:A,setctb:y,resetue:z,createscope:d,setscope:a,getScope:u,getAsyncScope:D,
setMarker:v,sendUe:t,setRid:A,setCtb:y,resetUe:z,createScope:d,setScope:a,increaseCount:w,resetMetrics:function(){b=f;y();z()},setAsyncRequestId:H,sendUEPageLoadStats:function(){!k.isCSMErrorLoggingEnabled()||l&&n||L({message:"Logged ld without both af and fn logged first af:"+l+" fn:"+n},"","checkout-client-side-metrics","WARN");k.isLogAFFNFallbackEnabled()&&(!0===l&&w("checkout:client-side-metrics:page-load-stats:earlyaf",1),w("checkout:client-side-metrics:page-load-stats:af",1),v("af"));k.isLogAFFNFallbackEnabled()&&
(!0===n&&w("checkout:client-side-metrics:page-load-stats:earlyfn",1),w("checkout:client-side-metrics:page-load-stats:fn",1),v("fn"));t("ld");d(1);n=l=!1},isTransitionLoggingEnabled:B,logPageTransition:function(a,b,c,d){if(B()){var l=(new Date).getTime();h.ajax({type:"POST",url:"/gp/buy/shared/handlers/log-page-transition.html?cachebuster\x3d"+l,data:{fromPage:a,toPage:b},async:!0,cache:!1,timeout:1E3,success:function(a,b,d){var l=d.getResponseHeader("x-amz-checkout-requestid");H(l);c&&c.call(this,
a,b,d)},complete:function(a,b){d&&d.call(this,a,b)}})}},logError:L,startWidgetTiming:function(a){c("bb",a,{wb:1})},finishWidgetTiming:function(a){p("ld",a,{wb:1})},setMarkerForWidget:function(a,b){c(a,b,{wb:1})},emitNexusMetrics:function(a,b,c){"undefined"!==typeof q.ue&&"undefined"!==typeof q.ue.event&&q.ue.event(a,b,c)},setCountValue:function(a,b){w(a,b,!1)}}});"use strict";r.register("currency-formatter",function(){function a(k,h){isNaN(h)||(k=Number(k).toFixed(h));k=k.toString();h=0<=k.lastIndexOf(".")?
k.lastIndexOf("."):k.length;return 3>=h?k:a(k.substring(0,h-3),0)+","+k.substring(h-3)}return{getNumberWithSeparators:a}});"use strict";r.when("A","client-side-metrics","page-conductor","page-detector").register("delivery-preferences-csm-helper",function(a,k,h,b){function f(a){var c=h.isSPP()?"spp":"mpp",f="desktop";b.isMobile()?f="mobile":b.isTablet()&&(f="tablet");k.increaseCount("checkout:delivery-preferences:"+f+":"+c+":"+a,1)}function g(a){return 0===a.length?"NoValueSet":a}var m=a.$;return{recordCSM:f,
recordCSMWithCurrentFieldValues:function(a,b,p){b=m("input[name\x3d"+b+"]:checked");b.length&&(b=b.val(),f(a+":preference:"+g(b)));p=m("input[name\x3d"+p+"]");p.length&&f(a+":set-as-default:"+(p.is(":checked")?"yes":"no"))},recordCSMForEligiblePages:function(a){a=a||"";f(a+"eligible-page-displayed");var b=m("input[name\x3ddelivery-preferences-preference-set]");b.length&&f(a+"summary-displayed:preference:"+g(b.val()))}}});"use strict";r.when("page-detector-current-page","A").register("error-feature-detection",
function(a,k){function h(a){q.errorFeatureDetection&&q.errorFeatureDetection.safelyLogError?q.errorFeatureDetection.safelyLogError(a):(q.ueLogError&&q.ueLogError(a),q.console&&q.console.error&&console.error(a))}try{k.on("page-detector:page-changed",function(){var b=a.getCurrentPage();if(b&&"spc"===b)try{q.errorFeatureDetection&&q.errorFeatureDetection.enableErrorHandling&&q.errorFeatureDetection.enableErrorHandling()}catch(f){h(f)}else try{q.errorFeatureDetection&&q.errorFeatureDetection.disableErrorHandling&&
q.errorFeatureDetection.disableErrorHandling()}catch(f){h(f)}})}catch(b){h(b)}return{registerFeature:function(a,f){try{q.errorFeatureDetection&&q.errorFeatureDetection.registerFeature&&q.errorFeatureDetection.registerFeature(a,f)}catch(g){h(g)}},markFeatureAvailable:function(a){try{q.errorFeatureDetection&&q.errorFeatureDetection.markFeatureAvailable&&q.errorFeatureDetection.markFeatureAvailable(a)}catch(f){h(f)}},markFeatureUnavailable:function(a){try{q.errorFeatureDetection&&q.errorFeatureDetection.markFeatureUnavailable&&
q.errorFeatureDetection.markFeatureUnavailable(a)}catch(f){h(f)}}}});r.when("error-feature-detection").execute(function(a){a.registerFeature("continue-action",0);a.markFeatureAvailable("javascript-detection");a.markFeatureAvailable("continue-action")});"use strict";r.when("A","loading-spinner-controller","ajax-utility","currency-formatter","page-conductor","page-transition-controller").register("inline-points-register-controller",function(a,k,h,b,f,g){function m(a){var b=new RegExp(String.fromCharCode(65340),
"g"),c=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))}function e(a){var b=t.$popover.find(".rewards-registration");k.hideSpinner(b);b.children("div").hide();b=b.find(".rewards-registration-error");a&&a.error?(a=b.find("[data-error\x3d'"+a.error+"']"),a.length?a.show():b.find("[data-error\x3d'rewards_SystemUnavailable']").show()):
b.find("[data-error\x3d'rewards_SystemUnavailable']").show();b.fadeIn(300)}function c(a){t=a.popover;var b=t.$popover.find(".rewards-registration");k.showSpinner(b,!1,t);a=b.data("issuer-id");var c=b.data("program-id"),l=b.data("cc-issuer"),f=b.data("cc-brand"),b=b.data("parent-payment-method-id"),n="/gp/buy/payselect/handlers/get-rewards-configuration.html?cachebuster\x3d"+(new Date).getTime();v.ajax({type:"POST",url:n,data:"programid\x3d"+c+"\x26partner\x3d"+a+"\x26ccpaymentinstrumentid\x3d"+b+
"\x26issuer\x3d"+l+"\x26brand\x3d"+f+"\x26hasWorkingJavascript\x3d1",dataType:"text",async:!0,cache:!1,dataFilter:function(a){return h.jsonify(a)},success:function(a,b,c){b=t.$popover.find(".rewards-registration");k.hideSpinner(b);c=a.fields||{};for(var d in c)if(c.hasOwnProperty(d)){var l=c[d],f=b.find("[data-field\x3d'"+l.type+"']");l.value&&f.filter("input").attr("value",l.value);f.parents(".rewardsfield").show()}a.termshtml&&b.find(".rewardstermstext").html(m(a.termshtml));a.billingzip&&b.find("[data-field\x3dBILLING_POSTAL_CODE]").attr("value",
a.billingzip);if(a.displaydata){d=b.find("[data-field]");for(var e in a.displaydata)a.displaydata.hasOwnProperty(e)&&d.filter("[data-field\x3d"+e+"]").html(a.displaydata[e])}a.marketinglink&&b.find("[data-field\x3d'rewards_marketing_link']").html(a.marketinglink);b.find("#rewards-registration-image").show();b.find(".rewards-registration-main").fadeIn(300);t.updatePosition(!0)},error:function(a){e(a)}})}function p(){if(t){var a=t.$popover.find(".rewards-registration");k.hideSpinner(a);a.find(".rewards-registration-success").hide();
a=a.find(".rewards-registration-error");a.hide();a.find("h4").hide();A&&(g.show(),f.isSPP()?f.reloadPage():v("div.pay").length?f.loadPage("payselect","payselect"):v("div.spc").length&&f.loadPage("spc","spc"))}}function l(a){return a.is("input")?a:a.find("input")}function n(){if(t){var a=t.$popover.find(".rewards-registration");a.find(".rewards-registration-main").hide();a.find("#rewards-registration-image").hide();k.showSpinner(a,!1,t);var c=(new Date).getTime(),d="programid\x3d"+encodeURIComponent(a.data("programId")),
d=d+("\x26paymentinstrumentid\x3d"+encodeURIComponent(a.data("parent-payment-method-id"))+"\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1\x26cachebuster\x3d"+c),f=a.find("[data-field]");f.each(function(){var a=v(this).attr("data-field");if("CVV2"===a)d+="\x26registerRewardsCreditCardVerificationNumber\x3d"+encodeURIComponent(v(this).val());else if(v(this).data("entryindex")){if(1===v(this).data("entryindex")){var b=f.filter("[data-field\x3d"+a+"]").sort(function(a,b){return Number(v(a).data("entryindex"))-
Number(v(b).data("entryindex"))});d+="\x26"+a+"\x3d";b.each(function(){d+=encodeURIComponent(v(this).val())})}}else"TERMS_AND_CONDITIONS"===a?l(v(this)).is(":checked")&&(d+="\x26"+a+"\x3dtrue"):d+="\x26"+a+"\x3d"+encodeURIComponent(v(this).val())});c="ox_pay_page_swp_reg_popover_submit";a.data("programId")&&(c+="_"+a.data("programId"));a="/gp/buy/payselect/handlers/register-rewards-account.html/ref\x3d"+c+"?cachebuster\x3d"+(new Date).getTime();v.ajax({type:"POST",url:a,data:d,dataType:"text",async:!0,
cache:!1,dataFilter:function(a){return h.jsonify(a)},success:function(a,c,d){a?a&&0===a.success?e(a):t&&(c=t.$popover.find(".rewards-registration-success"),c.find(".customername").text(a.customername),a.dollarbalancedisplay&&a.pointsbalance&&(c.find("[data-field\x3d'rewardsamount']").html(a.dollarbalancedisplay),c.find("[data-field\x3d'pointsamount']").html(b.getNumberWithSeparators(a.pointsbalance,a.rewardsdecimalplaces)),c.find(".rewardsuccessbalance").show()),a.showwarnmessage&&c.find(".warnmessage").show(),
A=!0,c.fadeIn(300),k.hideSpinner(t.$popover.find(".rewards-registration"))):e()},error:function(a){e(a)}})}}var v=a.$,t,A=!1;a.on("a:popover:show:rewards-registration",c);a.on("a:popover:hide:rewards-registration",p);a.declarative("close-rewards",["click"],function(a){a.$event.preventDefault();a.$target.closest(".a-popover").find(".a-button-close").trigger("click")});a.declarative("rewards-signup",["click"],function(a){a.$event.preventDefault();n(a)});a.declarative("toggle-reward-signup-button","change",
function(a){a=a.$target;var b=t.$popover.find(".rewards-registration");a&&a.is(":checked")?(b.find("#reward-signup-button").removeClass("aok-hidden"),b.find("#disabled-reward-signup-button").addClass("aok-hidden")):(b.find("#reward-signup-button").addClass("aok-hidden"),b.find("#disabled-reward-signup-button").removeClass("aok-hidden"))});a.on("a:popover:beforeShow:cvv2helpcontent",function(a){a.popover.$popover.find(".a-popover-inner").html(v(".cvv2helpcontent").text());a.popover.updatePosition()});
return{displayRewardsRegister:c,hideRewardsRegister:p}});"use strict";r.when("A","error-feature-detection","safe-mash","ready").register("shared-kitchensink",function(a,k,h){var b=a.$;a.on("checkout:reload",function(){(b("body.a-touch").length||b("div.a-touch:first").length)&&b("html").addClass("a-touch");b("form").each(function(){var a=b(this).find('input[name\x3d"hasWorkingJavascript"]');a&&0<a.length?a.val("1"):b(this).append('\x3cinput type\x3d"hidden" name\x3d"hasWorkingJavascript" value\x3d"1" /\x3e')});
h&&(b("div.checkout-tablet a[target\x3d'AmazonHelp']").each(function(){var a=b(this).attr("href"),a=a+(0<=a.indexOf("?")?"\x26app-nav-type\x3dmodal":"?app-nav-type\x3dmodal"),a=a.replace("#","");b(this).attr("href",a);b(this).removeAttr("data-action");b(this).removeAttr("data-help-popup");b(this).removeAttr("onclick")}),b("div.checkout.mobile a[target\x3d'AmazonHelp']").each(function(){var a=b(this).attr("href"),a=a.replace("#","");b(this).attr("href",a);b(this).removeAttr("data-help-popup");b(this).removeAttr("onclick");
b(this).addClass("a-declarative help-popup");b(this).attr("data-action","help-popup")}));if(0<b("div.checkout-tablet").length)for(var a=document.getElementsByTagName("a"),g=0;g<a.length;g++)a[g].href||(a[g].href="#")});b(document).bind("jsdetection",function(){k.markFeatureAvailable("javascript-detection")})});r.when("A","safe-mash","ready").execute(function(a,k){var h=a.$;a.declarative("mash-navigate",["click"],function(a){a=a.$currentTarget.attr("href");k&&k.navigate?k.navigate({url:a}):q.location.href=
a});a.declarative("expander-scroll-there",["click"],function(a){if("false"!==a.$currentTarget.closest(".a-expander-container").find(".a-expander-content").attr("aria-expanded")){var f=h(q),g=h(document),m=a.$currentTarget.offset().top,e=0,c=0,p=function(){q.setTimeout(function(){f.scrollTop(m);e===g.height()?c++:(c=0,e=g.height());10>c&&p()},10)};p()}})});q.amz_js_PopWin=function(a,k,h){(a=q.open(a,k,h))&&a.focus&&a.focus();return!1};var na=!1;q.confirmPurchase_onSubmit||(q.confirmPurchase_onSubmit=
function(){return na?!1:na=!0});"use strict";r.when("A","error-feature-detection","loading-spinner-spp-controller","loading-spinner-aui-controller").register("loading-spinner-controller",function(a,k,h,b){function f(){return e("#checkout-spinner").length}function g(a){if(c&&p){var b,f,n;v&&y?(a=v.getContent(),b=a.innerHeight(),f=a.innerWidth()):(b=a.height(),f=a.width());n=a.offset();a=p.width();var g=p.height();if(l)n="1"===e("input[name\x3dfromAnywhere]").val()?e(document).height():e(q).height(),
c.width(e(document).width()).height(n).css("left","0px").css("z-index",2E3),p.css("left",f/2-a/2+"px").css("top",b/2-g/2+"px").css("z-index",4E3).show();else{var h=e(q),m=y?h.scrollLeft():0;c.css("position","fixed").width(f).height(b).css("z-index",3E3).css("left",n.left-m).css("top",n.top-h.scrollTop());t?p.css("position","fixed").css("left",n.left-m+(f/2-a/2)+"px").css("top",n.top-h.scrollTop()+(b/2-g/2)+"px").css("z-index",4E3).show():p.css("left",f/2-a/4+"px").css("top",b/2-g/4+"px").css("z-index",
4E3).show()}}}function m(){var a="https://images-na.ssl-images-amazon.com/images/G/01/amazonui/loading/loading-4x._V391853216_.gif",b=e("#first-pipeline-load-page-spinner-img");b.length&&(a=e.trim(b.attr("src")));1>e("#loading-spinner-blocker-doc").length&&(a=e(['\x3cdiv class\x3d"template loading-spinner" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading-spinner-blocker"\x3e\x3c/div\x3e\x3cdiv class\x3d"loading-spinner-inner"\x3e','\x3cimg id\x3d"loading-spinner-img" class\x3d"loading-spinner-img" src\x3d"'+
a+'"/\x3e','\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"loading-spinner-blocker-doc" class\x3d"loading-spinner-blocker" style\x3d"display:none;"\x3e\x3c/div\x3e\x3cdiv id\x3d"spinner-anchor" class\x3d"spinner-anchor" style\x3d"display:none"\x3e\x3c/div\x3e'].join("")),p=c=n=null,"1"===e("#showSpinnerWithoutBox").attr("content")&&a.find(".loading-spinner-inner").addClass("loading-spinner-inner-no-box"),e("body").prepend(a));e("input[name\x3duseModifiedSpinnerResizeFn]").length&&(t=!0);e("#useRelativeSpinner").length&&
(A=!0);e("#modifiedBlockerDivSize").length&&(y=!0)}var e=a.$,c,p,l,n,v,t=!1,A=!1,y=!1,z=!1;a.on("a:popover:positionUpdated",function(a){if(y&&v&&v.name===a.popover.name&&c&&p){var b=v.getContent();a=b.innerHeight();var l=b.innerWidth(),b=b.offset(),f=e(q);c.width(l).height(a).css("left",b.left-f.scrollLeft()).css("top",b.top-f.scrollTop());p.css("left",b.left-f.scrollLeft()+(l/2-p.width()/2)+"px").css("top",b.top-f.scrollTop()+(a/2-p.height()/2)+"px")}});m();a.on("checkout:reload",m);return{showSpinner:function(a,
u,m){if(A&&!u&&y&&t&&m)return z=!0,h.showSpinner(a,m);f()?b.showSpinner():(z=!1,0!==a.length&&(v=(l=u)?F:m,n||(n=e(".loading-spinner.template").clone().removeClass("template"),n.show()),a.append(n),l?(c=e("#loading-spinner-blocker-doc"),a.find(".loading-spinner-blocker").hide()):c=a.find(".loading-spinner-blocker"),c.show(),l&&k.markFeatureUnavailable("continue-action"),p=a.find(".loading-spinner-inner"),g(a)))},hideSpinner:function(a,e){if(f())return b.hideSpinner();if(z)return z=!1,h.hideSpinner(a,
e);z=!1;c&&(l&&(c.hide(),k.markFeatureAvailable("continue-action")),n.detach());e&&a.hide()},adjustSize:function(a){return f()?b.adjustSize():z?h.adjustSize():g(a)}}});"use strict";r.when("A","error-feature-detection").register("loading-spinner-spp-controller",function(a,k){function h(){if(f&&g){var a=e.innerHeight(),b=e.innerWidth();f.width(b).height(a);g.css("left",b/2-g.width()/2+"px").css("top",a/2-g.height()/2+"px")}}var b=a.$,f,g,m,e,c;a.on("a:popover:positionUpdated",function(a){c&&c.name===
a.popover.name&&h()});a.on("checkout:reload",function(){var a="https://images-na.ssl-images-amazon.com/images/G/01/amazonui/loading/loading-4x._V391853216_.gif",c=b("#first-pipeline-load-page-spinner-img");c.length&&(a=b.trim(c.attr("src")));1>b(".loading-spinner-spp").length&&(a=b(['\x3cdiv class\x3d"template loading-spinner-spp" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading-spinner-spp-blocker"\x3e\x3c/div\x3e\x3cdiv class\x3d"loading-spinner-spp-inner"\x3e','\x3cimg class\x3d"loading-spinner-spp-img" src\x3d"'+
a+'"/\x3e',"\x3c/div\x3e\x3c/div\x3e"].join("")),g=f=m=null,"1"===b("#showSpinnerWithoutBox").attr("content")&&a.find(".loading-spinner-inner").addClass("loading-spinner-inner-no-box"),b("body").prepend(a))});return{showSpinner:function(a,l){0!==a.length&&(c=l,e=a,m||(m=b(".loading-spinner-spp.template").clone().removeClass("template"),m.show()),l.getContent().before(m),e.prepend(m),f=e.find(".loading-spinner-spp-blocker"),f.show(),g=e.find(".loading-spinner-spp-inner"),h())},hideSpinner:function(a,
b){f&&m.detach();b&&a.hide()},adjustSize:h}});"use strict";r.when("A","error-feature-detection").register("loading-spinner-aui-controller",function(a,k){function h(){return b("#checkoutDisplayPage").outerHeight()}var b=a.$;return{showSpinner:function(){k.markFeatureUnavailable("continue-action");var f=b("#checkout-spinner");a.show(b("#checkout-spinner-overwrap").height(h()));f.attr("aria-busy","true");a.show(f)},hideSpinner:function(){k.markFeatureAvailable("continue-action");var f=b("#checkout-spinner");
a.hide(b("#checkout-spinner-overwrap"));f.attr("aria-busy","false");a.hide(f)},adjustSize:function(){var f=b("#checkout-spinner-overwrap");f.is(":visible")&&a.show(f.height(h()))}}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-detector-current-page","checkout-general-utils","client-side-metrics","safe-mash","cache-page-data-controller","ajax-wrapper","widget-streamer","widget-streamer-utils","weblab-helper","temporary-preference-indicator","payment-marketplace-helper").register("page-conductor",
function(a,k,h,b,f,g,m,e,c,p,l,n,v,t){function A(a){q.ueLogError&&q.ueLogError({message:a},{logLevel:"WARN",attribution:"CheckoutCommonAsset-PageConductor"})}function y(a){ka&&(a?(a["x-amz-checkout-transition"]||(a["x-amz-checkout-transition"]="ajax"),a["x-amz-checkout-type"]||(a["x-amz-checkout-type"]="spp")):a={"x-amz-checkout-transition":"ajax","x-amz-checkout-type":"spp"});n.isPipelineDispatchSendHeaderEnabled()&&(a?a["x-amz-checkout-transition"]||(a["x-amz-checkout-transition"]="ajax"):a={"x-amz-checkout-transition":"ajax"});
return a}function z(){J=!1;ea=null;sa=0;ja=!1;ra=qa=Fa=null}function d(a){var b=parseInt(O("#checkoutDisplayPage").data("delaySetTitle"),10)||0;b?q.setTimeout(function(){document.title=a},b):document.title=a}function u(b){"function"===typeof a.state.parse&&a.state.parse();a.trigger("checkout:beforeReload");a.trigger("checkout:reload");b&&("spp-revieworder"===b?a.trigger("checkout:reload:spc"):a.trigger("checkout:reload:"+b));a.trigger("checkout:afterReload")}function D(a){k.show();var b="/gp/buy/addtocart/handlers/display.html";
a&&(b+="?errorType\x3d"+a);q.location=b}function w(b){(b=O("#pageTypeRedirectedTo").text())&&a.trigger("checkout:reload:"+b)}function H(b,c){var l;if(c.getResponseHeader("x-amz-force-full-page-update"))B(b);else{if(c.getResponseHeader("x-amz-checkout-redirect-addtocart")){(c=h.jsonify(b))?D(c.errorCode):D();return}l=pa(b)}b=O("#pipelinedPageTitle").text();d(b);var f=c.getResponseHeader("x-amz-checkout-page");ka?a.delay(function(){u(f)},l):u(f)}function B(a){var b=document.open("text/html","replace");
b.write(a);b.close()}function L(a,b,c){try{if(b.getResponseHeader("x-amz-force-full-page-update"))B(a);else{if(!va)throw Error("Member _updateDisplayPageContent not set in page-conductor. Make sure 'initFunc' is called.");va(a,c)}}catch(l){a="Error while replacing page content.",l.message&&(a+="  Error message: "+l.message),r.error(a,"page-conductor","replaceDisplayPage",l)}a=O("#pipelinedPageTitle").text();d(a);b=b.getResponseHeader("x-amz-checkout-page");u(b)}function X(a){var b=parseInt(O("#showPageTransition").attr("content"),
10);(b=isNaN(b)?1:b)||k.hide();b="/gp/buy/shared/handlers/dispatch.html";a&&(a.conductoraction&&a.conductoraction.url?b=a.conductoraction.url:a.pipedata&&a.pipedata.conductoraction&&a.pipedata.conductoraction.url&&(b=a.pipedata.conductoraction.url));b=0<b.indexOf("?")?b+"\x26":b+"?";O("input[name\x3dfromAnywhere][value\x3d1]").length&&(b+="fromAnywhere\x3d1");b=W(b);m&&O("html").hasClass("a-tablet")&&-1<b.indexOf("/gp/cart/view.html")&&(b="/gp/aw/c?app-action\x3dcart");q.location=b}function R(a,b,
c,d,l){d=d||{};d.pushNewFrame=d.pushNewFrame||"true";d.anchor=d.anchor||F;z();"true"===d.pushNewFrame&&m&&m.navigate&&O("#checkoutDisplayPage").data("useMashNavigateForTransitions")?m.navigate({url:null,transitionEffect:"slide",successCallback:function(){V(a,b,c,d,l)},failCallback:function(a){}}):V(a,b,c,d,l);d.keepCachedPagesData||e.clearCache()}function G(){var a=O("input#isPipelinedPage");return 0<a.length&&"1"===a.val()}function K(a){return n.isExecutionIdInQueryStringEnabled()?a?a.getResponseHeader("x-amz-checkout-executionid"):
f.getQueryStringParameter(q.location.href,"executionId"):O("input#executionId").val()}function V(c,d,f,e,p){function m(a){var b=f.getResponseHeader(a);null==b&&(g.increaseCount("Checkout:PageConductor:Ajax:Update:MissingHeader"),g.increaseCount("Checkout:PageConductor:Ajax:Update:MissingHeader:"+a),A("performUpdatePageFromResponse is missing required header "+a));return b}function k(a){var b=/^\s*\<(?:!doctype|html)/;if("string"===typeof a&&a.match(b)){var b=(new DOMParser).parseFromString(a,"text/html"),
c=O(b).find("#checkoutDisplayPage");if(0<c.length)return g.increaseCount("Checkout:PageConductor:Ajax:Update:CenterContentExtracted"),c[0].outerHTML;b=O(b).find("body");if(0<b.length)return g.increaseCount("Checkout:PageConductor:Ajax:Update:BodyExtracted"),b[0].outerHTML}return a}e=e||{};e.pushNewFrame=e.pushNewFrame||"true";e.anchor=e.anchor||F;n.isPageConductorConvergenceEnabled()||(e.mixedContentFallback=e.mixedContentFallback||"fallback");var v=m("x-amz-checkout-page"),B=m("x-amz-checkout-requestid"),
la=b.getCurrentPage();b.setCurrentPage(v);if(e.freshLoad)e.freshLoad=!1,r.when("first-load-dependencies").execute(function(a){V(c,d,f,e)});else if(v){O("head .aui-page-asset").removeAttr("disabled");O("head .old-pipeline-asset").removeAttr("disabled");g.setAsyncRequestId(B);var da=f.getResponseHeader("x-amz-checkout-redirect");if(da)X({conductoraction:{url:da,type:"redirect"}});else{!n.isPageConductorConvergenceEnabled()&&ta(c)&&N(e);n.isIngressEnabled()&&(c=k(c));if(n.isAJAXWeblabOn()&&l.isStreamingAjax(f))n.isAjaxStreamingEnabled()?
u(v):(w(f),x(c,v));else if(a.trigger("checkout:unload"),0<O("#checkoutDisplayPage").length?L(c,f,v!==la):H(c,f),n.isAjaxStreamingEnabled()&&G()){var la=O("#pipelinedPageTitle").text(),da=m("x-amz-checkout-url"),z=f.getResponseHeader("x-amz-checkout-additional-page-args");aa(v,la,da,K(f),z,e.anchor,e.pushNewFrame)}!n.isAjaxStreamingEnabled()&&G()&&(la=O("#pipelinedPageTitle").text(),da=m("x-amz-checkout-url"),z=f.getResponseHeader("x-amz-checkout-additional-page-args"),aa(v,la,da,K(f),z,e.anchor,e.pushNewFrame));
e.anchor&&(v=O(e.anchor),0===v.length&&(v=e.anchor.replace("#",""),v=O(document.getElementsByName(v))),v.length&&O(document).scrollTop(v.offset().top));e.logUsedPrefetch&&r.when("action-logger").execute(function(a){a.logUsedPrefetch(m("x-amz-checkout-page-type"),m("x-amz-checkout-sub-page-type"),B,p)})}}else{if(q.getOldAjaxSuccessCallback)return q.getOldAjaxSuccessCallback("ajaxConductor","generalErrorHandling","generalErrorHandling")(c,d,f);c=h.jsonify(c);X(c)}}function aa(a,b,c,d,l,e,g){b&&c&&q.history&&
q.history.pushState&&(n.isExecutionIdInQueryStringEnabled()?"true"!==g||history.state&&history.state.page===a||(c=W(c),e&&(c+=e),d&&(c=f.addQueryStringParameterOrDeleteIfEmpty(c,"executionId",d)),history.pushState({page:a,additionalURLArgs:l},b,c)):(c=W(c),e&&(c+=e),d&&(c=f.addQueryStringParameter(c,"executionId",d)),"true"===g&&history.state&&history.state.page!==a&&history.pushState({page:a,additionalURLArgs:l},b,c)))}function x(a,b){a.executeActions();a=O("#pipelinedPageTitle").text();d(a);u(b)}
function P(){q.location=za?"/gp/buy/addtocart/handlers/display.html":"/gp/buy/payselect/handlers/error.html"}function T(b,d,f,e,g,p){e=e||{};e.refTag=e.refTag||"";e.pushNewFrame=e.pushNewFrame||"true";e.anchor=e.anchor||F;e.refTag&&0!==e.refTag.indexOf("/ref\x3d")&&(e.refTag="/ref\x3d"+e.refTag);b="fromPage\x3d"+b+"\x26page\x3d"+d;(p=K(p))&&(b+="\x26executionId\x3d"+p);f&&(b+="\x26"+f);f=function(){};p=function(){};var h;"function"===typeof e.resultscallback?(d=function(a,b,c){e.resultscallback(a,
b,c)},h=function(a,b,c){e.resultscallback(F,b,a)}):(f=function(b){a.trigger("checkout:beforeLoadPage");S&&S.abort();S=b},d=function(a,b,c){n.isAJAXWeblabOn()&&l.isStreamingAjax(c)||e.callbackBeforePageUpdate&&e.callbackBeforePageUpdate();R(a,b,c,e);e.callbackAfterPageUpdate&&e.callbackAfterPageUpdate()},h=function(a,b,d){"abort"!==b&&("error"===b&&a.readyState===c.READY_STATE.UNSET?r.when("a-tv","mash").execute(function(a,b){q.cordova.exec(null,null,"MASHDisplayErrorPlugin","execute",{})}):(ga(a,
b),P()))},p=function(a){S=null});g={type:"GET",url:(g?g:"/gp/buy/shared/handlers/pipeline-dispatch.html")+e.refTag,data:b,dataType:"text",async:!0,beforeSend:f,success:d,error:h,complete:p,cache:!1};if(ka||n.isPipelineDispatchSendHeaderEnabled())g.headers=y({"x-amz-checkout-transition":"ajax"});return n.isAJAXWeblabOn()?(g.useXMLHttp=!0,g=n.isAjaxStreamingEnabled()?U(g,e.callbackBeforePageUpdate,e.anchor,e.pushNewFrame):U(g,e.callbackBeforePageUpdate),c.aui(g)):O.ajax(g)}function U(c,e,f,g){c.timeout=
5E4;c.data=ba(c.data,"acceptsStreaming\x3d1");var h;h=c.data.match(/.*isAsync=1.*/)?!0:!1;Ca=p({$target:O("#checkoutDisplayPage"),updateTriggerEvent:"pageReady",immediateExecution:!h,updateTarget:O("#checkoutDisplayPage"),onUpdate:function(c){"function"===typeof e&&e();a.trigger("checkout:unload");d(c.title);aa(c.page,c.title,c.url,c.executionId,c.additionalURLArgs,f,g||"true");b.setCurrentPage(c.page)}});c.chunk=Ca.chunkHandler;if(!n.isAjaxStreamingEnabled()){var u=c.success;c.success=function(a,
b,c){u&&l.isStreamingAjax(c)?u(Ca,b,c):u&&u(a,b,c)}}return c}function ba(a,b){return a?a+"\x26"+b:b}function ga(a,b){g.increaseCount("Checkout:PageConductor:Ajax:Error");n.isAJAXWeblabOn()?(a?(g.increaseCount("Checkout:AUI:Ajax:jqXHR:defined"),A("jqXHR defined throw CheckoutErrorAW under AJAX Weblab, textStatus:"+b+" stateCode:"+a.state+" readyState:"+a.readyState)):a===F?(g.increaseCount("Checkout:AUI:Ajax:jqXHR:undefined"),A("jqXHR undefined throw CheckoutErrorAW under AJAX Weblab")):null===a&&
(g.increaseCount("Checkout:AUI:Ajax:jqXHR:null"),A("jqXHR null throw CheckoutErrorAW under AJAX Weblab")),g.increaseCount("Checkout:AUI:Ajax:Error:textStatus:"+b),g.increaseCount("Checkout:AUI:Ajax:Error:statusCode:"+a.status),g.increaseCount("Checkout:AUI:Ajax:Error:readyState:"+a.readyState)):(a?(g.increaseCount("Checkout:jQuery:Ajax:jqXHR:defined"),A("jqXHR defined throw CheckoutErrorAW using jQuery, textStatus:"+b+" stateCode:"+a.state+" readyState:"+a.readyState)):a===F?(g.increaseCount("Checkout:jQuery:Ajax:jqXHR:undefined"),
A("jqXHR undefined throw CheckoutErrorAW using jQuery")):null===a&&(g.increaseCount("Checkout:jQuery:Ajax:jqXHR:null"),A("jqXHR null throw CheckoutErrorAW using jQuery")),g.increaseCount("Checkout:jQuery:Ajax:Error:textStatus:"+b),g.increaseCount("Checkout:jQuery:Ajax:Error:statusCode:"+a.status),g.increaseCount("Checkout:jQuery:Ajax:Error:readyState:"+a.readyState))}function Y(a,b,d,e){var l=a;b=ba(b,"isClientTimeBased\x3d1");var p;if(n.refactorExtractURL()){p=f.extractURLParts(a);a=p.normalizedUrl;
if(!a)return g.increaseCount("Checkout:PageConductor:submitAjax:url:missingHtml:T1"),A("Unable to normalize url ["+l+"]. Ajax request aborted."),!1;var h=a.indexOf("/gp/buy/");0<h?(a=a.substring(h),g.increaseCount("Checkout:PageConductor:submitAjax:url:removedGpBuy:T1")):g.increaseCount("Checkout:PageConductor:submitAjax:url:missingGpBuy:T1");p.query?(b+="\x26"+p.query,g.increaseCount("Checkout:PageConductor:submitAjax:url:hasQueryPart:T1")):g.increaseCount("Checkout:PageConductor:submitAjax:url:missingQueryPart:T1");
p=p.refMarker;p||(g.increaseCount("Checkout:PageConductor:submitAjax:url:missingRefMarker:T1"),p="");p&&-1===p.indexOf("ref\x3d")&&(g.increaseCount("Checkout:PageConductor:submitAjax:url:refMarkerMalformed:T1"),p="")}else{var u=a.indexOf("?");0<u?(b+="\x26"+a.substring(u+1),a=a.substring(0,u),g.increaseCount("Checkout:PageConductor:submitAjax:url:hasQueryPart:C")):g.increaseCount("Checkout:PageConductor:submitAjax:url:missingQueryPart:C");h=a.indexOf("/gp/buy/");0<h?(a=a.substring(h),g.increaseCount("Checkout:PageConductor:submitAjax:url:removedGpBuy:C")):
g.increaseCount("Checkout:PageConductor:submitAjax:url:missingGpBuy:C");if(u=-1!=a.indexOf("/checkout/p/p-"))a=a.slice(a.indexOf("/checkout/p/p-")),g.increaseCount("Checkout:PageConductor:submitAjax:url:chewbacca:C");else{if(-1===a.indexOf(".html"))return g.increaseCount("Checkout:PageConductor:submitAjax:url:missingHtml:C"),A("url ["+l+"] is missing html extension and not a chewbacca call. Ajax request aborted."),!1;l=a.indexOf(".html");p=a.substring(l+5);a=a.substring(0,l+5)}p||g.increaseCount("Checkout:PageConductor:submitAjax:url:missingRefMarker:C");
p&&-1===p.indexOf("ref\x3d")&&(g.increaseCount("Checkout:PageConductor:submitAjax:url:refMarkerMalformed:C"),p="")}b+="\x26handler\x3d"+a;a={type:"POST",url:u?a:"/gp/buy/shared/handlers/async-continue.html"+p,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:y({"x-amz-checkout-transition":"ajax"}),data:b,dataType:"text",async:!0,success:d,error:function(a,b,d){"abort"!==b&&("error"===b&&a.readyState===c.READY_STATE.UNSET?r.when("a-tv","mash").execute(function(a,b){q.cordova.exec(null,
null,"MASHDisplayErrorPlugin","execute",{})}):"function"===typeof e&&(ga(a,b),e()))},cache:!1};return n.isAJAXWeblabOn()?(a.useXMLHttp=!0,U(a),c.aui(a)):O.ajax(a)}function Z(a,b,c,d,e){e=e&&e.action?e.action:a.attr("action");a=a.serialize();d&&(a+="\x26isAsync\x3d1");return Y(e,a,b,c)}function ca(a,b,c,d){a=W(a.attr("href"));d&&(a+="\x26isAsync\x3d1");return Y(a,"",b,c)}function C(a){a=a||{};a.logUsedPrefetch=1;R(ea.data,ea.status,ea.response,a,ea.refMarker)}function W(a){-1===a.toLowerCase().indexOf("hasworkingjavascript")&&
(a+=(0<=a.indexOf("?")?"\x26":"?")+"hasWorkingJavascript\x3d1");return a}function da(a){ja=!1;var c=b.getCurrentPage(),d=ra-qa,e=sa;fa&&clearTimeout(fa);if(a.is("form"))ia(a)?(C(),g.increaseCount("Checkout:"+c+":PageConductor:Prefetch:"+e+":Success"),g.increaseCount("Checkout:"+c+":PageConductor:Prefetch:"+e+":TimeSaved",d)):(Z(a,R,P),g.increaseCount("Checkout:"+c+":PageConductor:Prefetch:"+e+":Failure:Invalid"));else if(a.is("a"))if(la(a)){var l;1===parseInt(a.data("keepCachedPagesData"),10)&&(l=
{keepCachedPagesData:1});C(l);g.increaseCount("Checkout:"+c+":PageConductor:Prefetch:"+e+":Success");g.increaseCount("Checkout:"+c+":PageConductor:Prefetch:"+e+":TimeSaved",d)}else ca(a,R,P),g.increaseCount("Checkout:"+c+":PageConductor:Prefetch:"+e+":Failure:Invalid");else g.increaseCount("Checkout:"+c+":PageConductor:Prefetch:"+e+":Failure:NoTrigger"),r.error("function called without a trigger","page-conductor","handleContinueAction")}function ia(a){return a.is("form")&&null!==ea&&ea.serializedValue===
a.serialize()}function la(a){return a.is("a")&&null!==ea&&W(ea.serializedValue)===W(a.attr("href"))}function N(a){"reload"==a.mixedContentFallback?(g.increaseCount("Checkout:PageConductor:mixedContentFallback:"+a.mixedContentFallback),location.reload()):"fallback"==a.mixedContentFallback?(g.increaseCount("Checkout:PageConductor:mixedContentFallback:"+a.mixedContentFallback),X({conductoraction:{url:"/gp/buy/spc/handlers/display.html?_from\x3dcheetah",type:"redirect"}})):(g.increaseCount("Checkout:PageConductor:mixedContentFallback:Invalid"),
r.log("mixedContentFallback is invalid. mixedContentFallback should be reload or fallback","ERROR","mixedContentFallback"))}function Aa(a){return ua&&(a.is("form")&&ua!==a.serialize()||a.is("a")&&W(ua)!==W(a.attr("href")))}function oa(a,c,d,e,p){function u(b,f,B){var z=!0;if("success"===f){if(!n.isAJAXWeblabOn()||!l.isStreamingAjax(B)){var t=h.jsonify(b);null!==t&&t&&t.result&&"noPrefetch"===t.result&&(ea=null,z=!1)}z&&(ea={},ea.serializedValue=la,ea.data=b,ea.status=f,ea.response=B,ea.refMarker=
k,null==ra&&(ra=(new Date).getTime()))}else ea=null,g.increaseCount("Checkout:"+v+":PageConductor:Prefetch:"+sa+":Failure:Response");J=!1;ka&&r.when("spp-button-blocker").execute(function(a){a.hideDefaultContinueBtnBlocker()});if(ja)return da(Fa),!0;if(z){var ha=function(){e?oa(a,c,d,!0,p):Q(a)};if(null===ea||"form"===m&&ea.serializedValue!==a.serialize())return ha(),!0;c&&(0===c?g.increaseCount("checkoutPrefetchTimeoutSetToZero",1):fa=setTimeout(function(){ea=null;ha()},1E3*c))}return!0}if(!G()||
0===a.length)return!1;var m=a.get(0).tagName.toLowerCase();if("form"!==m&&"a"!==m||"function"===typeof p&&!p(m))return!1;c=c||0;d=d||0;e=e||!1;if(J||sa>=d)return!1;J=!0;ka&&r.when("spp-button-blocker").execute(function(a){a.showDefaultContinueBtnBlocker()});sa++;var v=b.getCurrentPage();qa=(new Date).getTime();ra=null;g.increaseCount("Checkout:"+v+":PageConductor:Prefetch:"+sa+":Attempted");fa&&clearTimeout(fa);var k=f.extractURLParts("form"===m?a.attr("action"):a.attr("href")).refMarker,B,la=null;
"form"===m?(la=a.serialize(),B=n.isAJAXWeblabOn()?Z(a,u,u,!0):Z(a,null,null,!0)):"a"===m&&(la=W(a.attr("href")),B=n.isAJAXWeblabOn()?ca(a,u,u,!0):ca(a,null,null,!0));n.isAjaxStreamingEnabled()&&la&&(ua=la);"object"!==typeof B||"function"!==typeof B.always||n.isAJAXWeblabOn()||B.always(u)}function Q(a){var b=parseInt(a.data("prefetchTimeout"),10),c=parseInt(a.data("maxPrefetches"),10);return oa(a,b,c,!1,function(b){if(a.find("input:checked").hasClass("no-prefetch"))return!1;if(n.disablePrefetchForScheduledDeliveryWeblabOn()){var c=
a.find("div.one-shipment:not(:hidden)").find("input:checked");if(c.parents('[data-a-input-name\x3d"'+c.attr("name")+'"]').hasClass("no-prefetch"))return!1}return"1"===O("input#block-prefetch").val()||"1"===O("input#block-all-prefetch").val()||"form"===b&&!a.data("checkoutFormReady")?!1:!0})}function Ba(){var a=b.getCurrentPage();return"payselect"===a||"spp-payment"===a||"pay"===a}function ta(a,b){return/.*\/checkout\/p\/.*\/spc/.test(b||q.window.location.pathname)&&/data-checkout-page/.test(a)}function wa(b,
c){J&&null==ra&&(ra=(new Date).getTime());b&&b.preventDefault();!n.isClearTemporaryPreferenceFixRemoveEnabled()&&Ba()&&v.hasActiveTemporaryPreference&&v.hasActiveTemporaryPreference()&&z();var d=b?O(b.currentTarget):c;b=function(){if(ka){k.blockAllActions();var a=d.data("shrink-panel"),b=d.data("loading-text");(a=O("#"+a))&&a.length?a.hasClass("expanded")||k.shrinkPanel(O(".spp-panel.expanded"),!1):a=O(".spp-panel.expanded");k.shrinkPanel(a,!0,b)}else k.show()};g.resetMetrics();!ha||ia(d)||la(d)?
b():a.delay(b,0);try{ja=!0,Fa=d,n.isAjaxStreamingEnabled()&&Ca&&!Aa(d)&&Ca.enableExecution(),J||da(d)}catch(e){b="An error occured while click on the continue button.",e.message&&(b+="  Error message: "+e.message),r.error(b,"page-conductor","continueClicked",e)}}function xa(){O("#checkout-btf-spinner").addClass("aok-hidden")}var O=a.$,J,qa,ra,S,ea,sa,ja,Fa,fa,ma,va,ua,pa=function(a){if(!ma)throw Error("Member _updatePageContent not set in page-conductor. Make sure 'initFunc' is called.");return ma(a)},
ka=!1,za=!1,M=!1,ha=!1,Ea=!1,Ca;z();a.declarative("page-transit-no-update-action","click",function(c){if(!M){c.$event.preventDefault();g.resetMetrics();var d=c.data.targetDeclarativeActionId;if(d&&(d=O("#"+d),d.length)){d.trigger("click");return}var l=c.data.toPage,d=c.data.fromPage||b.getCurrentPage(),f=c.data.refTag||"chk_"+d+"_cancel_pri",p=c.data.args,h=c.$currentTarget.find("a.checkout-pipeline-pref-link"),m=ka&&"function"===typeof t.isIN&&t.isIN();ka&&(!m||"spp-payment"!==d&&"spp-rxselect"!==
d?e.setCachedPageData(d,l):("spp-payment"==d&&g.increaseCount("checkout:trueSPC:disableCachingPSP:"+l,1),"spp-rxselect"==d&&g.increaseCount("checkout:trueSPC:disableCachingRxSelect:"+l,1)));if(e.getCachedPageData(l,d)){g.increaseCount("checkout:"+d+":cancelpri",1);f=e.getCachedPageData(l,d);z();b.setCurrentPage(f.page);var v;v=n.isAJAXWeblabOn()?pa(f.curPageData):pa(JSON.stringify(f.curPageData));if(ka)if(g.isTransitionLoggingEnabled()){var B=(new Date).getTime();g.logPageTransition(d+"-cached",l,
F,function(b){b=(new Date).getTime()-B;b<v?a.delay(function(){u(l)},v-b):u(l)})}else a.delay(function(){u(l)},v);else u(l);f.title&&f.url&&q.history&&q.history.pushState&&history.state&&history.state.page!==f.page&&history.pushState(f.state,f.title,f.url)}else h.length?wa(null,h):(g.increaseCount("checkoutSPPCancelNoCachedData",1),m&&"spp-payment"===l&&g.increaseCount("checkout:trueSPC:emptyPSPCacheFrom:"+d,1),h=function(){if(ka)if(k.blockAllActions(),c.data.noShrink)k.show();else{var a=c.data.loadingText,
b=O("#"+c.data.shrinkPanel);b.length||(b=c.$currentTarget.closest("div.spp-panel"));k.shrinkPanel(b,!0,a)}else k.show()},ha?a.delay(h,0):h(),T(d,l,p,{refTag:f,keepCachedPagesData:1}))}});n.isAjaxStreamingEnabled()&&(a.on("checkout:page:atf",function(){k.hide();O("#checkout-btf-spinner").removeClass("aok-hidden")}),a.on("checkout:page:end",function(){xa()}));a.on("ready",function(){ha=0<O("#executeNonBlockingAnimations").length;Ea=0<O("#prefetchFromAddressEnabled").length});a.on("checkout:afterReload",
function(){k.hide();n.isAjaxStreamingEnabled()&&xa();a.delay(g.sendUEPageLoadStats);if(G()){var b=O("form.checkout-page-form:not(:disabled):first"),c=O("a.checkout-continue-link:not(:disabled):first");O("#useFirstActivePrefetch").length&&(c=O("a.checkout-continue-link:not(:disabled)").filter(function(){return 0<(parseInt(O(this).data("maxPrefetches"),10)||0)}).first());var d=!1;b.length&&(d=Q(b));!d&&c.length&&(d=Q(c));!d&&ka&&(b=O("a.checkout-pipeline-pref-link:not(:disabled):first"),b.length&&(c=
b.data("fromPage"),d=b.data("toPage"),e.getCachedPageData(d,c)||(d=Q(b))))}});return{ajaxUpdatePage:R,ajaxRedirect:X,ajaxSorryPage:P,isPageLoadRequestInProgress:function(){return S?1:0},submitFormAjax:Z,reloadPage:function(){var a=b.getCurrentPage();T(a,a)},loadPage:T,usePrefetch:C,makePrefetch:Q,makePrefetchWithParams:oa,isPrefetchValidFor:function(a){if(null!==ea){var b=ea.response.getResponseHeader("x-amz-checkout-page");return a===b}return!1},redirect:X,continueClicked:wa,initFunc:function(a,
b){ma=a;va=b},overrideIsSPP:function(a){ka=a},isSPP:function(){return ka},overrideAddToCart:function(a){za=a},isAnimating:function(){return M},overrideIsAnimating:function(a){M=a},setAjaxTransitionHeader:y,isPipeliningOn:G,disablePageNoUpdateTransition:function(){Ea&&r.when("a-button").execute(function(a){var b=O(".spp-panel.expanded").data("stepIndex");O(".expand-collapsed-panel-trigger").each(function(){var c=O(this),d=c.parents(".spp-panel").data("stepIndex");if(!b||!d||d>b)c.filter(".clickable-heading").removeClass("clickable-heading").addClass("off-clickable-heading"),
a(c.filter(".expand-panel-button")).disable(),c.filter("a.expand-panel-button").addClass("disabled-link"),c.parents(".a-declarative").addClass("off-declarative").removeClass("a-declarative")});O(".panel-cancel-row").hide()})},enablePageNoUpdateTransition:function(){Ea&&r.when("a-button").execute(function(a){O(".off-clickable-heading").addClass("clickable-heading").removeClass("off-clickable-heading");a(".expand-collapsed-panel-trigger.expand-panel-button").enable();O(".off-declarative").addClass("a-declarative").removeClass("off-declarative")})},
isNonBlockingAnimationEnabled:function(){return ha},isPrefetchFromAddressEnabled:function(){return Ea},getExecutionId:K,isPrefetchRequestInProgress:function(){return J},isRequestMixedContent:ta,ajaxUpdate:function(b,c,d){d=d||{};"boolean"===typeof d.pushNewFrame&&(d.pushNewFrame=d.pushNewFrame.toString());var e="";c&&(e=a.map(c,function(a,b){return b+"\x3d"+a}).join("\x26"));fa&&clearTimeout(fa);g.resetMetrics();k.show();return Y(b,e,function(a,b,c){R(a,b,c,d)},P)}}});r.when("A","jQuery","page-transition-controller",
"ajax-utility","page-detector-current-page","checkout-general-utils","page-conductor","cache-page-data-controller","client-side-metrics","weblab-helper","ready").execute(function(a,k,h,b,f,g,m,e,c,p){if(m.isPipeliningOn()){q.history&&k(q).bind("popstate",function(){var a=this.history.state,b=f.getCurrentPage();a&&a.page&&b&&(a.page!==b||m.isPageLoadRequestInProgress())&&(h.show(),b=k("#checkoutDisplayPage"),b.data("wipeOnPipelineBackTransition")&&b.empty(),c.resetMetrics(),k("#useFastBackButton").length&&
m.isPrefetchValidFor(a.page)?m.usePrefetch({pushNewFrame:!1}):(b="spc"===a.page?"":a.page,m.loadPage(f.getCurrentPage(),b,a.additionalURLArgs,{refTag:"pipelinedBackButton",pushNewFrame:"false"})))});k(document).delegate("form.checkout-page-form","change",function(a){k(a.target).parent().hasClass("no-prefetch-on-change")||(a=k(a.currentTarget),m.makePrefetch(a))});k(document).delegate("form.checkout-page-form","submit",function(a){m.continueClicked(a)});k(document).delegate("a.checkout-continue-link",
"click",function(a){m.continueClicked(a)});p.isPageConductorConvergenceEnabled()&&a.declarative("checkout-page-form-submit","change",function(a){a=a.$target;(a.is("input[type\x3dradio]")||a.is("select"))&&a.closest("form.checkout-page-form").submit()});k(document).delegate("form.checkout-page-form .submit-button-with-name","click",function(a){a=k(a.currentTarget);k("\x3cinput\x3e").attr({type:"hidden",name:a.attr("name"),value:a.val()}).appendTo(a.closest("form.checkout-page-form"))});var l=!1;k(document).delegate("a.pipeline-link, div.pipeline-link, span.pipeline-link a",
"touchmove",function(a){l=!0});k(document).delegate("a.pipeline-link, div.pipeline-link, span.pipeline-link a","click keypress touchend",function(a){if(l)l=!1,a.preventDefault();else if(g.protectAgainstDoubleAction("pipeline-link"))a.preventDefault();else if("keypress"!==a.type||13===a.which){var b=k(a.currentTarget),f=b.data("pipelineLinkFromPage"),p=b.data("pipelineLinkToPage"),y=b.data("pipelineLinkAnchor"),z=b.data("pipelineLinkRef");z||((z=g.extractURLParts(b.attr("href")).refMarker)?c.increaseCount("Checkout:PageConductor:LoadPage:AddedRefMarker"):
c.increaseCount("Checkout:PageConductor:LoadPage:NoRefMarkerInUrl"));b=b.data("pipelineLinkArgs");p&&(c.resetMetrics(),a.preventDefault(),m.isSPP()&&e.setCachedPageData(f,p),h.show(),a={refTag:z,anchor:y},m.isSPP()&&(a.keepCachedPagesData=1),m.loadPage(f,p,b,a))}});k(document).delegate("a.spclite-dispatch-link","click keypress touchend",function(a){if("keypress"!==a.type||13===a.which){var b=k(a.currentTarget),c=b.data("spcliteLinkFromPage"),e=b.data("spcliteLinkToPage");b.data("spcliteLinkAnchor");
var l=b.data("spcliteLinkRef"),b=b.data("spcliteLinkArgs"),f=k("input#executionId").val(),b=b?b+("\x26executionId\x3d"+f):"executionId\x3d"+f;e&&(a.preventDefault(),h.show(),m.loadPage(c,e,b,{refTag:l},"/gp/buy/shared/handlers/spclite-dispatch.html"))}})}k(document).delegate("input.submit","click touchend",function(){c.resetMetrics()});k(document).delegate("form","submit",function(){c.resetMetrics()});k(document).delegate(".panel-cancel-row a, .clickable-heading","click",function(){c.isTransitionLoggingEnabled()&&
c.resetMetrics()});p.isExecutionIdInQueryStringEnabled()&&(k.ajaxSetup({beforeSend:function(a,b){b.url&&(a=g.getQueryStringParameter(q.location.href,"executionId"),b.url=g.addQueryStringParameterOrDeleteIfEmpty(decodeURIComponent(b.url),"executionId",a));return!0}}),k(document).ajaxSuccess(function(a,b,e){if(e&&e.url&&e.url.match(/\/async-continue|\/set-|\/update-|\/new/i)&&(a=b.getResponseHeader("x-amz-checkout-sub-page-type")||"Unknown",!a.match(/^p-/))){e=m.getExecutionId(b);if(q.history&&q.history.replaceState){var f=
g.addQueryStringParameterOrDeleteIfEmpty(q.location.href,"executionId",e,!0);q.history.replaceState(q.history.state,"",f)}else c.increaseCount("Checkout:PageConductor:NoReplaceState");e||(b=b.getResponseHeader("x-amz-checkout-page-type")||"Unknown",c.increaseCount("Checkout:PageConductor:"+(null===e?"ExecutionIdIsNotSet":"ExecutionIdIsEmpty")+":"+b+":"+a,1))}}))});"use strict";r.when("A","a-popover-base","a-popover-util").register("checkout-modal-popover",function(a,k,h){function b(b){return b.disableHide?
function(){}:function(){var d=this;d.animating=!0;a.fadeOut(this.$popover,250);b.secondaryPopover||c("#a-popover-modal").hide();a.delay(function(){d.animating=!1},250)}}function f(a,c){var e=b(c);a=a.$event.triggerPositioningElement?a.$event.triggerPositioningElement:a.$declarativeParent;(p=k.show({$trigger:a,name:c.name,skin:n(c.header,c.closeButton,c.closeTextOverride),content:c.content,url:c.url,data:c.data,update:t,alone:c.alone?"true"===c.alone:!0,position:c.position||"triggerVertical",hide:e}))&&
p.$trigger!==a&&(p.$trigger=a,p.updatePosition())}function g(a,d){d.disableHide=!0;var e=b(d);l=!1;(d=k.show({$trigger:a.$declarativeParent,skin:v(d.header,d.footer,d.closeButton,d.contentClass),name:d.name,requestURL:d.url,position:"windowCenter",update:t,data:d.data,updatePosition:d.allowScrollOnPage?A:y,modal:!0,alone:d.alone?"true"===d.alone:!0,show:function(){this.animating=!0;this.$popover.show();c("#a-popover-modal").show();this.animating=!1},hide:e}))&&d.$trigger!==a.$declarativeParent&&(d.$trigger=
a.$declarativeParent,d.updatePosition())}function m(b){var c=b.$declarativeParent;a.delay(function(){e(b,c)},250)}function e(b,c){p&&(h.eventOccursWithin(b,c)||h.eventOccursWithin(b,p.$popover))?a.delay(function(){e(b,c)},250):k.hide(c)}var c=a.$,p,l=!1,n=function(a,b,e){return function(f){var l=e;e===F&&(l=c("input#closeButtonText").val()||"");var g="";l&&(g='\x3ca href\x3d"#" data-action\x3d"custom-popover-close" class\x3d"a-declarative popover-close-link"\x3e'+l+"\x3c/a\x3e\x26nbsp;");l="false"===
b?"":['\x3cdiv class\x3d"popover-close-section"\x3e',g,'\x3c/div\x3e\x3cbutton data-action\x3d"custom-popover-close" class\x3d"a-button-close a-declarative" role\x3d"button"\x3e\x3ci class\x3d"a-icon a-icon-close"\x3e\x3c/i\x3e\x3c/button\x3e'].join("");return['\x3cdiv class\x3d"a-popover"\x3e\x3cdiv class\x3d"a-popover-wrapper"\x3e',a||l?['\x3cdiv class\x3d"a-popover-header"\x3e\x3ch4\x3e',a,"\x3c/h4\x3e",l,"\x3c/div\x3e"].join(""):"",'\x3cdiv class\x3d"a-popover-inner"\x3e',f,'\x3c/div\x3e\x3cdiv class\x3d"a-arrow-border"\x3e\x3cdiv class\x3d"a-arrow"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'].join("")}},
v=function(a,b,e,l){return function(f){var g=c("input#closeButtonText").val()||"",p="";g&&(p='\x3ca href\x3d"#" data-action\x3d"custom-popover-close" class\x3d"a-declarative popover-close-link"\x3e'+g+"\x3c/a\x3e\x26nbsp;");g="false"===e?"":['\x3cdiv class\x3d"popover-close-section"\x3e',p,'\x3c/div\x3e\x3cbutton data-action\x3d"custom-popover-close" class\x3d"a-button-close a-declarative" role\x3d"button"\x3e\x3ci class\x3d"a-icon a-icon-close"\x3e\x3c/i\x3e\x3c/button\x3e'].join("");g=a||g?['\x3cdiv class\x3d"a-popover-header huawei-device-header-fix"\x3e\x3ch4\x3e',
a,"\x3c/h4\x3e",g,"\x3c/div\x3e"].join(""):"";p="";if(b){var h=c("#a-popover-footer-"+b);0<h.length&&(p=['\x3cdiv class\x3d"a-popover-footer"\x3e',h.html(),"\x3c/div\x3e"].join(""))}return['\x3cdiv class\x3d"a-popover a-popover-modal"\x3e\x3cdiv class\x3d"a-popover-wrapper"\x3e',g,'\x3cdiv class\x3d"a-popover-inner ',l,'"\x3e',f,"\x3c/div\x3e",p,'\x3cdiv class\x3d"a-arrow-border"\x3e\x3cdiv class\x3d"a-arrow"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'].join("")}};a.declarative("custom-popover-close",
["click","touchend"],function(b){b.$event.preventDefault();var d=b.$target;c("html").hasClass("a-ie6")||c("html").hasClass("a-ie7")||c("html").hasClass("a-ie8")?d.closest(".a-popover").hide():a.fadeOut(d.closest(".a-popover"),250);c("#a-popover-modal").hide();a.trigger("a:declarative:a-popover-close:click",{$target:d,$event:b.$event,$currentTarget:b.$currentTarget})});a.on("a:popover:positionUpdated",function(a){a=a.popover.$popover;0>a.offset().left&&a.offset({left:0});0>a.offset().top&&a.offset({top:0})});
a.on("a:popover:show",function(a){if(a.popover&&a.popover.$trigger){var b=a.popover.$trigger.data("aCheckoutModalPopover");b&&b.allowScrollOnPage&&a.popover.$popover.css("position","absolute")}});var t=function(a){c(".a-popover-inner",this.$popover).html(a)},A=function(a){if(!l||a)y.call(this,!0),l=!0},y=function(a){var b=c(q),e=b.height()/2,l=b.width()/2,f=this.$popover.height()/2,g=this.$popover.width()/2,e=e-f;if(a||"fixed"!==this.$popover.css("position"))e+=b.scrollTop();a=Math.max(0,l-g);e=Math.max(0,
e);this.$popover.css({top:e,left:a})};a.declarative("a-checkout-popover",["click","mouseenter","mouseleave","keyup","touchend"],function(a){a.data.showOnHover&&"touchend"!==a.type?"mouseenter"===a.type||"click"===a.type?f(a,a.data):"mouseleave"===a.type&&m(a):("click"===a.type||"touchend"===a.type||"keyup"===a.type&&a.$event.manualTrigger)&&f(a,a.data)});a.declarative("a-checkout-modal-popover",["click","keyup","touchend"],function(a){("click"===a.type||"touchend"===a.type||"keyup"===a.type&&a.$event.manualTrigger)&&
g(a,a.data)});a.on("checkout:reload",function(){a.defer(function(){0===c("#a-popover-modal").length&&c("body").append('\x3cdiv id\x3d"a-popover-modal" /\x3e')})});return{hideById:function(a){k.hide(a)},createModal:g}});"use strict";(function(){var a=!1;r.when("A").register("page-detector",function(k){function h(){return b("checkout-as")}function b(a){c||(c={});c.hasOwnProperty(a)||(c[a]=0<e("div."+a).length);return c[a]}function f(){return b("checkout.pay")}function g(){return b("checkout.spc")||
-1<q.location.href.search(/\/checkout\/p\/p[-\d]+\/spc.*/)?!0:!1}function m(){return k.capabilities.mobile}var e=k.$,c;k.on("checkout:reload",function(){c={};a||r.when("page-detector-current-initializer").execute(function(a){a.initializeDetectorWithCurrentPage(null)})});return{isAddressSelect:h,isAddressTranslation:function(){return b("translate-address-form")},isDesktopPayment:function(){return f()&&b("pay-desktop")},isDesktopSpc:function(){return g()&&b("spc-desktop")},isMobileAddressSelect:function(){return h()&&
b("checkout-as-mobile")},isMobilePayment:function(){return f()&&b("pay-mobile")},isMobileSpc:function(){return g()&&m()},isTabletAddressSelect:function(){return h()&&b("checkout-as-tablet")},isTabletPayment:function(){return f()&&b("pay-tablet")},isTabletSpc:function(){return g()&&b("spc-tablet")},isSpcLite:function(){return g()&&b("spclite")},isPayment:f,isSosp:function(){return b("checkout.sosp")},isSpc:g,isMobile:m,isTablet:function(){return k.capabilities.tablet}}});r.register("page-detector-current-initializer",
function(){return{initializeDetectorWithCurrentPage:function(k){if(!a){var h=k;r.register("page-detector-current-page",function(){return{getCurrentPage:function(){return h},setCurrentPage:function(a){var f=h;h=a;r.when("A").execute(function(g){g.trigger("page-detector:page-changed",f,a)})}}});a=!0}}}})})();"use strict";r.when("jQuery","loading-spinner-controller").register("page-spinner-controller",function(a,k){function h(){"function"===typeof A.blockAllActions&&A.blockAllActions()}function b(){"function"===
typeof A.unblockAllActions&&A.unblockAllActions()}function f(a){"function"===typeof A.showTransitionInContainer&&A.showTransitionInContainer(a)}function g(){var b=a(q).width(),c=a(q).height(),e=a(q),l=0;null!==t&&(l=t.outerHeight()-a(q).scrollTop(),0>l&&(l=0));n.css("top",e.scrollTop()+l+"px").css("left",e.scrollLeft()+"px").width(b).height(c);"1"!==a("input[name\x3dfromAnywhere]").val()&&a("#loading-spinner-blocker-doc").css("top",e.scrollTop()+l+"px").css("left",e.scrollLeft()+"px").width(b).height(c)}
function m(){var b;b=document.activeElement?a(document.activeElement):a(":focus:first");b.is("button, a, input:enabled")&&b.blur()}function e(){if(y){h();r.when("spp-button-blocker").execute(function(a){a.hideContinueBtnBlocker()});var b=a(".spp-panel.expanded");if(0<b.length&&b.is(":visible")){f(b,1);return}}if(v)return n.length&&n.find(".loading-spinner-inner").show(),!1;v=!0;m();n=a("#spinner-anchor");n.find(".loading-spinner-inner").show();a("#unblockHeader").length&&(t=a("#header"));p=n.css("z-index");
a(q).unbind("scroll.checkout-page-spinner").bind("scroll.checkout-page-spinner",function(a){l&&q.clearTimeout(l);l=setTimeout(function(){g();l=null},50)});a(q).unbind("resize.checkout-page-spinner").bind("resize.checkout-page-spinner",function(){g();k.adjustSize(n)});a(q).unbind("orientationchange.checkout-page-spinner").bind("orientationchange.checkout-page-spinner",function(){g();k.adjustSize(n)});g();n.show();n.css("z-index",2E3);k.showSpinner(n,!0);return!0}function c(){if(y)b(),"function"===
typeof A.hideSpinner&&A.hideSpinner();else{a("#first-pipeline-load-page-spinner").remove();if(!v)return!1;v=!1;n.length&&n.find(".loading-spinner-inner").show();n&&(a(q).unbind(".checkout-page-spinner"),n.hide(),n.css("z-index",p),k.hideSpinner(n));return!0}}var p,l=null,n,v=!1,t=null,A={},y=!1;return{show:e,showPageTransition:function(){return"0"===a("#showPageTransition").attr("content")?!1:e()},hide:c,hidePageTransition:function(){"0"===a("#showPageTransition").attr("content")&&c();return!0},hideAnimatedSpinnerImage:function(){n.length&&
n.find(".loading-spinner-inner").hide()},initFunc:function(a){null!==a&&(A=a,y=!0)},blockAllActions:h,unblockAllActions:b,showTransitionInContainer:f,shrinkPanel:function(a,b,c){"function"===typeof A.shrinkPanel&&A.shrinkPanel(a,b,c)},clearFocus:m}});"use strict";r.when("A").execute(function(a){a=a.$;var k="",k="mash-transitions"===a("input[name\x3dpageTransitionType]").val()?"page-mash-transition-controller":"page-spinner-controller";r.when(k).register("page-transition-controller",function(a){r.when("A").execute(function(b){b.declarative("page-spinner-show",
["click"],{allowLinkDefault:!0},function(b){b=b.$target;b.hasClass("a-button-disabled")||b.closest(".a-button-disabled").length||a.showPageTransition()})});r.when("A").execute(function(b){b.declarative("page-spinner-show-on-submit",["submit"],{allowLinkDefault:!0},function(b){a.showPageTransition()})});return{show:a.show,hide:a.hide,showPageTransition:a.showPageTransition,hidePageTransition:a.hidePageTransition,blockAllActions:a.blockAllActions,unblockAllActions:a.unblockAllActions,showTransitionInContainer:a.showTransitionInContainer,
shrinkPanel:a.shrinkPanel}})});"use strict";r.when("A","page-conductor","client-side-metrics","page-detector-current-page","a-popover","ready").execute(function(a,k,h,b){function f(a,b,f){k.isSPP()&&h.setmarker&&h.setmarker("af");h.sendUEPageLoadStats()}var g=a.$,m=!1;a.on("a:popover:afterHide",function(a){a.popover&&(m=!1)});a.on("a:popover:beforeShow",function(a){var b=a.popover;b&&(m=!0,b.$trigger.find(".modal-parameters").each(function(){g.each(g(this).data(),function(a,e){b.attrs(a,e)})}))});
a.on("a:popover:dismiss",function(a){a=a.popover;if(h.isTransitionLoggingEnabled()&&a&&m){m=!1;var c,g;"prime-acquisition-spc-popover"===a.name&&(c="prime-acquisition",g=b.getCurrentPage());c||g||!a.attrs||(c=a.attrs("returnfrom"),g=a.attrs("returnto"));c&&g&&(h.resetMetrics(),h.logPageTransition(c,g,f))}})});"use strict";r.when("A","page-detector-current-page","checkout-general-utils","client-side-metrics").register("first-load-dependencies-base",function(a,k,h,b){function f(){"function"===typeof q.uet&&
"function"===typeof q.uex&&(q.uet("cf","first-load-dependencies-ready",{wb:1}),q.uex("ld","first-load-dependencies-ready",{wb:1}));b.startWidgetTiming("first-load-dependencies:checkout:beforeReload");a.trigger("checkout:beforeReload");b.finishWidgetTiming("first-load-dependencies:checkout:beforeReload");b.startWidgetTiming("first-load-dependencies:checkout:reload");a.trigger("checkout:reload");b.finishWidgetTiming("first-load-dependencies:checkout:reload");var e;m&&(e="spp-revieworder"===m?"spc":
m);e&&(b.finishWidgetTiming("first-load-dependencies:checkout:reload:"+e),a.trigger("checkout:reload:"+e),b.finishWidgetTiming("first-load-dependencies:checkout:reload:"+e));b.startWidgetTiming("first-load-dependencies:checkout:afterReload");a.trigger("checkout:afterReload");b.finishWidgetTiming("first-load-dependencies:checkout:afterReload");setTimeout(function(){var a=g("#first-pipeline-load-page-spinner");a.is(":visible")&&(a.remove(),b.increaseCount("checkout:pageload:timeout"),h.logError("The page has taken more than 90 seconds to load, or there was a JS error preventing it from loading, hiding page spinner."))},
9E4)}var g=a.$,m=k.getCurrentPage();"function"===typeof q.uet&&q.uet("bb","first-load-dependencies-ready",{wb:1});return{allDependenciesCheck:function(a){if(a&&a.length){var c=!1,p={};g.each(a,function(a,c){b.startWidgetTiming("checkout:dependency:"+c+":ready");p[c]=1;r.when(c).execute(function(){b.finishWidgetTiming("checkout:dependency:"+c+":ready");delete p[c]})});var l=function(a){a="Page ("+m+") is missing dependencies ["+a.join(", ")+"] after 5 secs.";b.increaseCount("checkout:dependency:missed:regular-page:error");
h.logErrorOnLevel(a,"ERROR")},n=setTimeout(function(){if(!c){var a=[];g.each(p,function(c){b.increaseCount("checkout:dependency:"+c+":missed");a.push(c)});b.increaseCount("checkout:dependency:missed");0<g("#assets-prefetch").length?b.increaseCount("checkout:dependency:missed:assets-prefetch"):(b.increaseCount("checkout:dependency:missed:regular-page"),l(a));f()}},5E3);r.when.apply(r,a).execute(function(){c=!0;q.clearTimeout&&n&&q.clearTimeout(n);f()})}else f()}}});"use strict";r.when("A","page-detector",
"client-side-metrics").register("gift-utility",function(a,k,h){var b=a.$,f=/[^\s\u0020-\u007E\u00A0-\u00FF]/g,g=q.P&&q.P.AUI_BUILD_DATE,m=/((?:file|https?|ftps?|sip):\/\/)/im,e=/((?:\b|[\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?])www\.(?:(?:[^\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?]+\.[^\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?]+))+)(?:[\s!@#$%^&*()_=+[\]{}\|;:'",<>\?]|$|\b)/im,c=/([^\s!@#$%^&*()_=+[\]{}\|;:'",.<>\?\/]+\.(?:[a-z][a-z]|aero|arpa|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|om|pro|qa|tel|travel|xxx)(?:\b|$))/im,
p=/^\S+\@\S+\.\S+$/im;return{getInput:function(a){return a.is("input")?a:a.find("input")},getCharCount:function(a,b){return b?q.unescape(encodeURIComponent(a)).length:a.length},getLineCount:function(a,b){var c=a.split("\n").length;b=Math.floor(b);a=a.split("\n");for(var e=0;e<a.length;e++)a[e].length>b&&(c+=Math.floor(a[e].length/b),0===a[e].length%b&&c--);return c},getNameWithNoTitle:function(a){var b=!1;a=a.split(" ");/^(?:Dr|Mr|Mrs|Ms|Mme|Lt|Attn|Attn:|Prof|Pt|The)\.?$/i.test(a[0])&&(b=!0);b&&
a.shift();return a.join(" ")},getFirstName:function(a){var b=!1;a=a.split(" ");/^(?:Dr|Mr|Mrs|Ms|Mme|Lt|Attn|Attn:|Prof|Pt|The)\.?$/i.test(a[0])&&(b=!0);b&&a.shift();return a.shift()},toggleGiftMessageWarning:function(a,c){var e=c.find(".gift-message-warning");if(f.test(a.val())){var p=c.find(".gift-message-preview-trigger"),m=a.val().replace(f,"?");g?r.when("a-popover").execute(function(a){var b=a.get(p);b?b.update({content:m}):a.create(p,{inlineContent:m,position:"triggerVertical",closeButton:"false"})}):
(h.increaseCount("removeauijs13"),p.unbind("click.preview").bind("click.preview",function(a){r.when("a-popover-base").execute(function(c){var d=b(a.target);d.data("popoverid")&&(c=c.get(d.data("popoverid")))&&(c.update(m),c.updatePosition())})}));a.addClass("a-form-error");e.show()}else a.removeClass("a-form-error"),e.hide()},valueContainsUrl:function(a){return m.test(a)||e.test(a)||c.test(a)},isValidEmail:function(a){return p.test(""+a)}}});"use strict";r.when("A","page-detector","safe-mash","client-side-metrics").register("help-popup",
function(a,k,h,b){function f(){if(g("div#help-popover").length){g(q).unbind("resize.checkout-help-popover");var a=g("#help-popover-frame")[0];g(a.contentWindow?a.contentWindow:a.contentDocument.defaultView).undelegate("a","click");g("div#help-popover").remove()}}var g=a.$;k=k.isMobile();b=g("input#isPipelinedPage");b=0<b.length&&"1"===b.val();var m=k&&b&&h&&h.navigate;a.declarative("help-popup",["click"],function(a){if(!g(".a-touch").length||m){a.$event.preventDefault();a.data&&"1"===a.data.stopPropagation&&
a.$event.stopPropagation();var b=a.$target.closest("a").attr("href");a=a.data;m?h.navigate({url:b,transitionEffect:"slide"}):(a.width||(a.width="340"),a.height||(a.height="340"),q.open(b,"AmazonHelp","width\x3d"+a.width+",height\x3d"+a.height+",left\x3d10,top\x3d10,resizable\x3dyes,scrollbars\x3dyes,menubar\x3dno,toolbar\x3dyes,location\x3dno,directories\x3dno,status\x3dyes"))}else q.open(a.$target.closest("a").attr("href"),"AmazonHelp")});if(m)a.on("checkout:reload",f)});"use strict";r.execute("persistent-order-controller",
function(){return{}});"use strict";r.when("jQuery","page-conductor").register("quantity-service",function(a,k){function h(b,f){f=f||{};var g;f.additionalData&&(g=f.additionalData);var h="/gp/buy/pipeline/handlers/update-quantity.html",e={returnFullHTML:1,cachebuster:(new Date).getTime(),isClientTimeBased:0,hasWorkingJavascript:1};g&&g.deletePrimeMembership&&g.primeMembershipASIN&&(e.deletePrimeMembershipItemIn=g.deletePrimeMembership,e.deletedPrimeMembershipASINIn=g.primeMembershipASIN);f.ref&&(h+=
"/ref\x3d"+f.ref,delete f.ref);g=f.success;delete f.success;var c=k.ajaxRedirect;f.error&&(c=f.error,delete f.error);a.extend(e,f);f=[];for(var p in b)b[p]!==F&&(f.push(p),e[p]=b[p]);e.entityids=f;b=k.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"});a.ajax({type:"POST",url:h,data:a.param(e,!0),dataType:"text",async:!0,cache:!1,headers:b,success:g,error:c})}return{callBatch:function(a,f){h(a,f)},call:function(a,f,g){var m={};m[a]=f;h(m,g)}}});"use strict";r.when("jQuery").register("scroll-controller",
function(a){return{scrollToTop:function(){a(q).scrollTop(0)},toggleScrollOn:function(){a(document).unbind("touchmove")},toggleScrollOff:function(){a(document).bind("touchmove",function(a){a.preventDefault()})}}});"use strict";r.when("A","checkout-general-utils","ready").execute(function(a,k){var h=a.capabilities&&a.capabilities.isAmazonApp,b=q.amazon&&q.amazon.mash;a=a.$("#checkout-mash-will-load").length;h||b||a?r.when("mash").execute(function(a){var b;"object"===typeof a?b=a:q.amazon&&q.amazon.mash&&
(b=q.amazon.mash);"object"!==typeof b?k.logError("MASH is expected but can't be found!"):(r.register("safe-mash",function(){return b}),q.ue&&q.ue.tag&&q.ue.tag("safe-mash:mash"))}):(r.register("safe-mash",function(){}),q.ue&&q.ue.tag&&q.ue.tag("safe-mash:no-mash"));q.ue&&q.ue.tag&&(h&&q.ue.tag("safe-mash:A.capabilities.isAmazonApp"),b&&q.ue.tag("safe-mash:window.amazon.mash"),a&&q.ue.tag("safe-mash:checkout-mash-will-load"),!h&&b&&q.ue.tag("safe-mash:fallback:window.amazon.mash"),h||b||!a||q.ue.tag("safe-mash:fallback:checkout-mash-will-load"))});
"use strict";r.when("A","scheduled-delivery-external-interface","shipping-speed-selection-controller","page-detector","ready").register("scheduled-delivery-controller",function(a,k,h,b){var f=a.$,g={};h=function(){g={};f("div.fake-label input[type\x3d'radio']:checked").each(function(){var a=f(this),b=a.closest("div.fake-label");(b=k.getSdWidgetRootId(b))&&(g[a.attr("name")]=b)})};a.on("checkout:reload:shipoptionselect",h);a.on("checkout:reload:spp-revieworder",h);b.isSosp()&&h();f(document).delegate("div.fake-label",
"click",function(){if(b.isSosp()){var h=f(this),e=h.find("input[type\x3d'radio']");e.attr("disabled")||(e=e.attr("name"),h=k.getSdWidgetRootId(h),a.trigger("scheduled-delivery:ship-option-changed",{current:h,previous:g[e]}),g[e]=h)}});f(document).delegate(".ship-option.is-scheduled-delivery","click",function(){if(b.isSpc()){var g=f(this);g.find("input[type\x3d'radio']").attr("disabled")||(g=k.getSdWidgetRootId(g))&&a.trigger("scheduled-delivery:ship-option-changed",{current:g,previous:null})}});a.on("scheduled-delivery:unblock-continue",
function(){r.when("button-blocker").execute(function(a){a.hide("scheduled-delivery")})});a.on("scheduled-delivery:block-continue",function(a){r.when("button-blocker").execute(function(b){b.show("scheduled-delivery",a)})});a.on("scheduled-delivery:disable-ship-option",function(a,e){var c;a=f("#"+a);if(0!==a.length){if(b.isSpc())a=a.closest(".shipping-speed");else if(b.isSosp())a=a.closest("div.fake-label.a-box");else return;c=a.find("input[type\x3d'radio']");c.attr("disabled",!0);c.is(":checked")&&
e&&(e=f("input[name\x3d"+c.attr("name")+"]:radio:not(:disabled):first"),e.prop("checked",!0),e.trigger("change"));a.addClass("sd-disabled")}});a.on("scheduled-delivery:enable-ship-option",function(a){var e;a=f("#"+a);if(0!==a.length){if(b.isSpc())a=a.closest(".shipping-speed");else if(b.isSosp())a=a.closest("div.fake-label.a-box");else return;e=a.find("input[type\x3d'radio']");e.removeAttr("disabled");a.removeClass("sd-disabled")}})});"use strict";r.when("A","ready").register("mobile-nav-bar-back-controller",
function(a){a.capabilities.history&&(a=a.$,a=a("#mobile-top-bar-navigation-back"),1<=a.length&&a.click(function(a){a.preventDefault();q.history.back()}))});"use strict";r.when("A","page-spinner-controller","page-detector","page-conductor","weblab-helper","ready").execute(function(a,k,h,b,f){function g(a,b){var c=[];a.addressId||c.push("addressId");a.slotKey||c.push("slotKey");a.shippingOfferingId||c.push("shippingOfferingId");a.conflictItems&&!n.isArray(a.conflictItems)&&c.push("conflictItems");if(0<
c.length){a="Error calling fresh widget callback on "+b+": Bad or Missing Input: "+c[0];for(b=1;b<c.length;b++)a+=", "+c[b];console.error(a);return 0}return 1}function m(){n("#freshSlotKey").val("");n("#freshAddressId").val("");n("#freshReservationToCancel").val("");n("#freshConflictingItems").val("");n("#freshShipOfferingId").val("")}function e(a){var b="",c=f.sospPartialAvailabilityWeblabOn();if(a&&n.isArray(a)&&0<a.length)for(var b=a[0].asin+":"+a[0].merchantId+(c?"|"+a[0].maxQtyAvailable:""),
e=1;e<a.length;e++)b+="-"+a[e].asin+":"+a[e].merchantId+(c?"|"+a[e].maxQtyAvailable:"");return b}function c(a){var c;c="page\x3dspc\x26returnFullHTML\x3d1\x26callSetters\x3d1\x26freshSlotKey\x3d"+a.addressId;c+="\x26freshAddressId\x3d"+a.slotKey;a.reservationToCancel&&(c+="\x26freshReservationToCancel\x3d"+a.reservationToCancel);(a=e(a.conflictItems))&&(c+="\x26freshConflictingItems\x3d"+a);a=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});k.show();n.ajax({type:"POST",url:"/gp/buy/shared/handlers/handle-fresh-widget-results.html/ref\x3dset-fresh-information",
data:c,dataType:"text",async:!0,cache:!1,headers:a,success:function(a,c,e){return e.getResponseHeader("x-amz-checkout-page")?b.ajaxUpdatePage(a,c,e):b.redirect(a)},error:function(a,c,e){b.ajaxRedirect(a,c,e)}})}function p(){n(".sosp-continue-button").removeClass("js-hide").removeClass("aok-hidden");n(".continue-button-blocker").addClass("aok-hidden")}function l(){n(".sosp-continue-button").addClass("aok-hidden");n(".continue-button-blocker").removeClass("aok-hidden")}var n=a.$;a.on("handle-fresh-results",
function(a){if(n("#isfresh").val())if(a)if(h.isSosp())if(g(a,"sosp")){n("#freshSlotKey").val(a.slotKey);n("#freshAddressId").val(a.addressId);n("#freshReservationToCancel").val(a.reservationToCancel);var f=e(a.conflictItems);n("#freshConflictingItems").val(f);n("#freshShipOfferingId").val(a.shippingOfferingId);f&&0<f.length?n("input#block-prefetch").val(1):n("input#block-prefetch").val(0);f=n("#shippingOptionFormId");a.conflictItems&&0<a.conflictItems.length||b.makePrefetch(f);p()}else m(),l();else h.isSpc()?
g(a,"spc")&&c(a):console.error("remote fresh widget JS callback called on unsupported page.");else console.error("remote fresh widget JS callback called with empty data.");else console.error("remote fresh widget JS callback called without isfresh flag on page")});a.on("block-continue",function(a){n("#isfresh").val()?a?"undefined"===typeof a.blockContinue?console.error("block continue callback - missing blockContinue"):h.isSosp()?1===a.blockContinue?(l(),m()):0===a.blockContinue?p():console.error("block continue callback - invalid value"):
console.error("block continue callback called on unsupported page."):console.error("block continue callback called with no argument"):console.error("block continue callback called without isfresh flag on page")});a.on("confirm-and-continue",function(){n("div.sosp-fresh #shippingOptionFormId").submit()});a.on("redirect-to-spc",function(){b.redirect({conductoraction:{url:'/gp/buy/spc/handlers/display.html/ref\x3d"cancel-fresh-address-select"',type:"redirect"}})})});"use strict";r.when("A","ready").execute(function(a){function k(){(0<
h(".change-preference-block").length||0<h(".mobile-change-preference-block").length)&&!1===b&&(r.register("loadVasRcxCheckoutAsset",function(){}),b=!0)}var h=a.$,b=!1;k();a.on("checkout:reload:spc",k);a.on("checkout:reload:shipoptionselect",k);a.on("checkout:reload:spp-revieworder",k);a.on("checkout:reload:spp-special-delivery-options",k)});"use strict";r.register("time-left-formatter",function(){function a(a,b,f,g,k){return 0>=b?a:a+b+" "+(1===b?k.HOUR:k.HOURS)+(!g&&0<f?" "+k.AND+" ":"")}function k(a,
b,f,g,k){return 0>=b?a:a+b+" "+(1===b?k.MINUTE:k.MINUTES)+(!g&&1>f?" "+k.AND+" ":"")+(1===g&&1>f?" ":"")}return{getTimeLeftFormatted:function(h,b,f){var g="",m=86400<h?(h-h%86400)/86400:0,e=3600<h?(h-h%3600)/3600:0;h-=3600*e;var c=60<h?(h-h%60)/60:0;h-=60*c;if(b&&0<m)return g+m+" "+(1===m?f.DAY:f.DAYS);if(b&&0<e)return a(g,e,c,b,f);if(b&&5<=c)return k(g,c,e,b,f);g=a(g,e,c,b,f);g=k(g,c,e,b,f);1<=e||(g=g+h+" "+(1===h?f.SECOND:f.SECONDS));return g}}});"use strict";r.register("email-validation",function(){function a(a){if(1!==
a.length)throw Error("Invalid length for character");return a}var k={isISOControl:function(h){"string"===typeof h&&(a(h),h=h.charCodeAt(0));return 31>=h||127===h},isWhitespace:function(h){h=a(h);return null!==h.match(/\s/g)},isLetterOrDigit:function(h){h=a(h);return null!==h.match(/[A-Za-z0-9]/g)}};return function(a){var b;if(!a||64<a.length)return!1;for(b=0;b<a.length;b++)if(127<a.charCodeAt(b))return!1;b=a.indexOf("@");if(b!==a.lastIndexOf("@")||1>b||b===a.length-1)return!1;var f=a.substring(0,
b),g=a.substring(b+1);if("."===g.charAt(0)||"."===g.charAt(g.length-1)||g.match(/[a-zA-Z\d\-.]+/)[0]!==g)return!1;for(b=0;b<g.length;b++)if(a=g.charAt(b),b<g.length-1&&"."===a&&"."===g.charAt(b+1))return!1;if(-1===g.indexOf("."))return!1;var m=g=!1;for(b=0;b<f.length;b++)if(a=f.charAt(b),g){switch(a){case "\\":m=!m;break;case '"':m||(g=!1);break;default:if(m&&!k.isLetterOrDigit(a))return!1;m=!1;if(k.isISOControl(a))return!1}if(!g&&('"'===f.charAt(b-1)||f.length-1!==b&&"."!==f.charAt(b+1)))return!1}else switch(a){case '"':if(0!==
b&&"."!==f.charAt(b-1))return!1;g=!0;break;case ".":if(0===b)return!1;break;case "(":case ")":case "\x3c":case "\x3e":case "[":case "]":case "\\":case ":":case ";":case ",":return!1;default:if(k.isISOControl(a)||k.isWhitespace(a))return!1}return!0}});"use strict";r.when("A","page-transition-controller","checkout-general-utils","page-detector","page-detector-current-page","safe-mash","loading-spinner-controller","weblab-helper").register("shipoptionselect-controller",function(a,k,h,b,f,g,m,e){function c(a){var b=
y(".delivery-window-groups .more-window");m.showSpinner(b,!1);a=a.$currentTarget.closest(".delivery-window-groups").data("orderid");b=y("input[name\x3dlineItemEntityIds_"+a+"]").attr("value");y.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/long-calendar-content.html",data:"lineitemids\x3d"+b+"\x26orderid\x3d"+a+"\x26isMobile\x3d1\x26fromPage\x3dsosp",dataType:"json",async:!0,cache:!1,headers:{"x-amz-checkout-page":"sosp"},success:function(a){m.hideSpinner();if(a&&a.deliveryWindowGroups){var b=
y(".delivery-window-groups .a-box-group");b.empty();y.each(a.deliveryWindowGroups,function(a,c){b.append(c)});a=y(".delivery-window-groups .selected-group");a.length&&a.trigger("click")}}})}function p(a,b){var c=y("div.one-shipment:visible");a=w?y("div.one-shipment").slice(parseInt(a,10),parseInt(b,10)+1):y("div.one-shipment#"+a);d&&0!==a.size()&&c.last().attr("id")!==a.last().attr("id")&&(c.hide(),a.show(),y(q).scrollTop(0),c=y(document.activeElement),c.is("button, a, input:enabled")&&c.blur())}
function l(){if(d){var a=(location.hash?location.hash.replace("#",""):"0-"+D).split("-");2===a.length&&p(a[0],a[1])}}function n(){function c(a,b){y.ajax({type:"POST",url:"/gp/buy/gift/handlers/remove-gift-option.html",data:b,dataType:"json",async:!0,cache:!1,headers:{"x-amz-checkout-page":"sosp"},success:a,error:function(a,b,c){k.hide()}})}function h(a){var b=a.closest("div."+m);a.is(":checked")?(b.siblings("div."+m+".selected").removeClass("selected").find(".a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"),
b.addClass("selected").find(".a-icon-touch-radio-inactive").removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active")):b.removeClass("selected").find(".a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");t("triggerChangeEvent",[a])}0<y(".prime-calendar-container").length&&y(".prime-calendar-container").contents().each(function(a,b){8===b.nodeType&&y(b).replaceWith(b.nodeValue)});var n=y(".delivery-window-groups .selected-group");
n.length&&n.trigger("click");z=y(".sosp-continue-button");d="1"===y("#isClientSidePagingEnabled").val()?1:0;D=e.isDigitalAsinIndexingFixedOnSOSPEnabled()?(y("div.shipment-with-ship-options:visible").length-1).toString():(y("div.one-shipment:visible").length-1).toString();u="1"===y("#useMashNavigateForClientSidePaging").val()?1:0;w="1"===y("#collapseDigitalShipmentsEnabled").val()?1:0;var m=(n=q.P&&q.P.AUI_BUILD_DATE)?"selectable-box":"fake-label";d&&(y(".one-shipment:gt("+D+")").hide(),l());z.bind("click",
function(c){function d(a,b){var c=f.getCurrentPage();if(q.history&&q.history.pushState){var e=location.href;0<e.indexOf("#")&&(e=e.substring(0,e.indexOf("#")));e+="#"+a.attr("id")+"-"+b.attr("id");history.pushState({page:c,id:a.attr("id")},y("title"),e)}}var l=y("div.one-shipment:visible input[id\x3d'fresh-block-continue']");if(l){if("1"===l.val())return a.trigger("f3:fresh-sosp-continue:blocked"),c.preventDefault(),!1;"0"===l.val()&&a.trigger("f3:fresh-sosp-continue:allowed")}var h=!1;y("div.one-shipment:visible input[type\x3d'radio'][checked]").each(function(){if(y(this).data("blockingOn"))return alert(y(this).data("blockingOn")),
c.preventDefault(),h=!0,!1});if(h)return!1;if(e.removesGiftOptionOnRush()&&b.isMobile()&&null!=H){var l=y("div.one-shipment:visible"),n=l.find("input[type\x3d'radio']:checked").closest(".shipping-option");if("1"===l.find("input[type\x3dhidden][name\x3disGiftWrapped]").attr("value")&&1===n.data("nosupportforgiftoption"))return H.show(),!1}v();l=y("div.one-shipment:visible");n=l.nextAll("div.one-shipment:hidden");if(0<n.length){c.preventDefault();var k=n.first(),m=k;w&&(m=n.filter(".shipment-with-ship-options"),
m=1<m.length?m.eq(1).prev():n.last());u&&g&&g.navigate?g.navigate({url:null,transitionEffect:"slide",successCallback:function(){d(k,m)},failCallback:function(a){}}):d(k,m);p(k.attr("id"),m.attr("id"));a.trigger("active-shipment-changed")}A("logInlineCalMetrics",[l])});y(".gift-option-removal-cancel-button").bind("click",function(a){H.hide()});y(".gift-option-removal-confirm-button").bind("click",function(a){k.show();H.hide();a="lineItemsToRemoveGiftOptionFrom\x3d"+y("div.one-shipment:visible").find("input[name^\x3dlineItemEntityIds_]").attr("value");
var b=y("div.one-shipment:visible"),d=b.nextAll("div.one-shipment:hidden");c(function(a,c,e){b.find("input[type\x3dhidden][name\x3disGiftWrapped]").each(function(){y(this).remove()});0<d.length?(z.click(),k.hide()):y(".checkout-page-form").submit()},a)});y(q).bind("popstate",function(a){b.isSosp()&&l()});y(document).delegate("div."+m,"click",function(a){a=y(this);a.find("input[type\x3d'radio']").trigger("change",["setActive"]);a.parent().hasClass("timeslot-picker")&&(a=a.find(".a-button-selected").length,
z&&z.length&&(a?z.removeClass("a-button-disabled").addClass("a-button-primary").find("input").prop("disabled",!1):z.removeClass("a-button-primary").addClass("a-button-disabled").find("input").prop("disabled",!0)))});var G;a.declarative("faster-than-same-day-sosp-save",["click","submit"],function(){var b="lineItemsToRemoveGiftOptionFrom\x3d"+G.closest(".one-shipment").find("input[name^\x3dlineItemEntityIds_]").attr("value");a.$("div.a-popover button.a-button-close").trigger("click");k.show();c(function(a,
b,c){G.closest(".one-shipment").find(".isGiftWrapped").each(function(){y(this).remove()});G.attr("checked",!0);h(G);k.hide()},b)});y(document).delegate("div."+m+" input[type\x3d'radio']","change",function(a,b){a=y(this);if("setActive"===b&&!a.attr("disabled")&&e.removesGiftOptionOnRush()&&0<a.closest(".one-shipment").find(".isGiftWrapped").length&&1==a.data("nosupportforgiftoption"))G=a,a.is(":checked")&&(b=a.closest("div."+m).siblings("div."+m+".selected").find('input[type\x3d"radio"]'),G.attr("checked",
!1),b.attr("checked",!0)),setTimeout(function(){y("#faster-than-same-day-sosp-popover").trigger("click")},10);else{if("setActive"===b){if(a.attr("disabled"))return;a.attr("checked",!0)}if("disabling"===b)if(a.attr("disabled",!0),a.is(":checked"))a.removeAttr("checked");else return;h(a)}});y("div."+m+" input[type\x3d'radio']:checked").change();y("h3").children().removeAttr("style");0===y("div."+m+".scheduled-delivery").length&&y("form.checkout-page-form").data("checkoutFormReady",!0).change();n&&y(document).delegate(".a-touch-radio a",
"click",function(a){if(!e.isSOSPExclusiveJSHandlerWeblabOn()||b.isSosp()){var c=y(a.target).attr("href");!c||c.startsWith("#")||c.toLowerCase().startsWith("javascript:")||(g&&g.navigate?g.navigate({url:c,transition:"slide"}):a.preventDefault=!1)}})}function v(){if(1===y("div.store-upsell-ship-options").length){var a="/gp/buy/shared/handlers/store-upsell-async.html",b="ox_store_upsell_continue_",c=y("div.ship-speed, div.store-upsell-ship-options").find("input.shipping-option, input.store-upsell-ship-option"),
d=[],e;y.each(c,function(a,c){a=y(c);c=a.attr("value");d.push(c.toLowerCase());a.is(":checked")&&(e=a.attr("value"),b=a.hasClass("store-upsell-ship-option")?b+"success":b+"failure")});a=h.addQueryStringParameter(a,"ref",b);y.ajax({url:a,type:"POST",async:!0,data:{shown:d.toString(),clicked:e}})}}function t(a,b){r.when("checkout-federation-wrapper","shipspeed-provider").execute(function(c,d){c.wrap(function(){d&&!y.isEmptyObject(d)&&"function"===typeof d[a]&&d[a].apply(this,b)},"VasCheckoutShipSpeedProvider")})}
function A(a,b){r.when("checkout-federation-wrapper","sd-methods").execute(function(c,d){c.wrap(function(){d&&!y.isEmptyObject(d)&&"function"===typeof d[a]&&d[a].apply(this,b)},"CricketInlineCalendarHeavyBulkyIN")})}var y=a.$,z,d,u,D,w=0,H;a.declarative("sosp-change-quantity-link",["click"],function(a){var b=a.$currentTarget,c=y("\x3cinput type\x3d'hidden' /\x3e").attr("name","change-quantities-or-delete").val("1");b.hasClass("pipeline-link")?(a.$event.preventDefault(),b.closest("form").removeClass("checkout-page-form").append(c).find(".sosp-continue-button:first").trigger("click")):
b.closest("form").removeClass("checkout-page-form").append(c).find(".sosp-continue-button:first").trigger("click").end().trigger("submit")});r.when("A","a-sheet").register("shipoptionselect-gift-removal-controller-mobile",function(a,b){H=b.create({name:"gift-removal-popover",height:220,preloadDomId:"gift-option-removal-message",closeType:"icon",sheetType:"web"})});a.declarative("sosp-extender-toggle",["click","touchend"],function(a){if(!h.protectAgainstDoubleAction("sosp-extender-toggle")){var b=
a.$target.closest("a"),d=y(".delivery-window-groups .a-box-group").find(".lazy-loaded");if(b.hasClass("aui-extender"))d.length?d.remove():c(a);else{var e=b.find("i"),b=b.closest("div.extender-section");e.hasClass("a-icon-extender-expand")?(b.find(".collapsed").hide(),b.find(".expanded").slideDown("fast"),e.removeClass("a-icon-extender-expand").addClass("a-icon-extender-collapse"),c(a)):(b.find(".collapsed").show(),b.find(".expanded").slideUp("fast"),e.removeClass("a-icon-extender-collapse").addClass("a-icon-extender-expand"),
d.length&&d.remove())}}});a.declarative("sosp-select-prime-slot",["click","touchend"],function(a){if(!h.protectAgainstDoubleAction("sosp-select-prime-slot")){a=a.$currentTarget;var b=a.closest(".valid-slot");if(b.closest(".prime-calendar").hasClass("long-calendar")){var c=b.closest(".prime-calendar").data("orderid"),d=y("#calendar-"+c),c=y("#calendar-delivery-message-"+c),e=a.closest(".long-calendar");e.find(".selected-slot").removeClass("selected-slot");0<b.length&&b.addClass("selected-slot");y(".a-button-close").trigger("click");
b=a.data("slotid");b=d.find(".slot-"+b);if(0<b.length)d.show(),c.parent().hide(),b.closest(".prime-calendar").find(".selected-slot").removeClass("selected-slot"),b.closest(".valid-slot").addClass("selected-slot");else{var f=a.parent()[0],l=a.parent().parent().find(".rhead")[0],b=l.innerText;b||(b=l.textContent);f=f.cellIndex;e=e.find("th")[f];f=e.innerText;f||(f=e.textContent);c.text(f+" "+b);d.hide();c.parent().show()}}else c=b.closest(".prime-calendar-container").data("orderid"),d=y("#calendar-"+
c).find(".selected-slot"),0<d.length&&(d.removeClass("selected-slot"),0<b.length&&b.addClass("selected-slot"));d=a.closest(".prime-calendar-container").data("orderid");a.data("key")&&y("#order_"+d+"_ShippingSpeed").val(a.data("key"));a.data("isscheduleddeliveryslot")&&y("#sdData"+d).val(a.data("sddatastring"))}});a.declarative("sosp-select-delivery-window",["click","touchend"],function(a){if(!h.protectAgainstDoubleAction("sosp-select-delivery-window")){a=a.$currentTarget;a.length&&!a.hasClass("dwg-button")&&
(a=a.find(".dwg-button"));y(".dwg-button").removeClass("selected-dwg-button");a.addClass("selected-dwg-button");var b=a.closest(".delivery-window-groups").data("orderid"),c=a.data("key");!c&&a.find("button").length&&(c=a.find("button").data("key"));c&&y("#order_"+b+"_ShippingSpeed").val(c);c=a.data("isscheduleddeliveryslot");!c&&a.find("button").length&&(c=a.find("button").data("isscheduleddeliveryslot"));c&&(c=a.data("sddatastring"),!c&&a.find("button").length&&(c=a.find("button").data("sddatastring")),
y("#sdData"+b).val(c))}});a.on("checkout:reload:shipoptionselect",n);a.on("checkout:reload:spp-shipoption",n);a.on("checkout:reload:spp-f3-sosp",n);if(e.isVasTrueSPCEnabled())a.on("checkout:reload:spp-special-delivery-options",n)});r.when("jQuery","page-detector").register("deliv-prefs-sosp",function(a,k){function h(){a(".sosp .order-delivery-time-preference").each(function(){var b=a(this);b.bind("selectionChanged",function(){0===b.find(".delivery-time-preference-group").length?b.hide():(b.show(),
0===b.find("input:checked").length&&b.find("input:first").trigger("change",["setActive"]))}).bind("empty",function(){b.find(".delivery-time-preference-group").detach()});var f=b.closest(".one-shipment").find("input.shipping-option");b.find(".delivery-time-preference-group").each(function(){var f=a(this),h=f.data("shippingoptionid"),h=a("#"+h);f.is(".template")&&f.detach().removeClass("template");h.change(function(){b.trigger("empty");f.appendTo(b);b.trigger("selectionChanged")}).addClass("hasDeliveryTimePreference")});
f.not(".hasDeliveryTimePreference").change(function(f,h){"disabling"===h||a(this).is(":disabled")||(b.trigger("empty"),b.trigger("selectionChanged"))});b.trigger("selectionChanged")})}r.when("A").execute(function(a){a.on("checkout:reload:shipoptionselect",h)})});r.when("A","shipoptionselect-controller").execute(function(a){var k=a.$,h={},b={};a.on("checkout:reload:shipoptionselect",function(){var a=k("#shippingOptionFormId"),g=a.find("input[name\x3dtrialKey]");if(1===g.length){for(var m in h)h.hasOwnProperty(m)&&
(h[m].abort(),delete h[m]);h={};b={};var e=function(a){return a.join("::").replace(/\s+/g,"_")},c=function(){return k.map(a.find("input[type\x3dradio]:checked"),function(a){return a.name})},p=function(){return k.map(a.find("input[type\x3dradio]:checked"),function(a){return a.value})},l=function(a,c){if(h.hasOwnProperty(a)||b.hasOwnProperty(a))return!1;console.debug('initiating ajax call for trial key "'+a+'"');c=k.ajax({type:"POST",url:"/gp/buy/shipoptionselect/handlers/launch-delivery-trial.html",
contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:{"x-amz-checkout-transition":"ajax"},data:c,dataType:"json",async:!0,success:function(c){c?console.debug('trial "'+a+'" success'):console.debug('trial "'+a+'" failed');b[a]=c;delete h[a]},error:function(b,c,e){delete h[a];"abort"!==e&&(console.debug("trial "+a+" error"),r.error("issue with set-delivery-options trial: "+c,e))},cache:!1});h[a]=c;return!0},n=function(){for(var a=p(),a=e(a),b=Object.keys(h),c=0;c<b.length;++c){var f=
b[c];f!==a&&(console.debug('removing ajax call for trial key "'+f+'"'),h[f].abort(),delete h[f])}};k(document).delegate("#shippingOptionFormId","change",function(b){b=p();if(e(b)!==g.val())a:{n(),b=c();var h=p(),m=e(h);g.val(m);var y=l(m,a.serialize()),m=0;y&&++m;for(var z=0;z<b.length;++z)for(var d=a.find('input[type\x3dradio][name\x3d"'+b[z]+'"][value!\x3d"'+h[z]+'"]'),u=0;u<d.length;++u){var D=d[u],y=h.slice(0);y[z]=D.value;for(var y=e(y),w=D.name,D=D.value,H=a.serializeArray(),B=0;B<H.length;++B)H[B].name===
w&&(H[B].value=D),"trialKey"===H[B].name&&(H[B].value=y);w=k.param(H);if((y=l(y,w))&&5===++m)break a}}});k(document).delegate("#shippingOptionFormId","submit",function(a){n()})}})});r.when("A","button-blocker","page-detector").register("scheduled-delivery-readiness-checker",function(a,k,h){function b(){h.isMobile()&&h.isSosp()&&m("div.scheduled-delivery").length&&(m(document).delegate("div."+c+":visible input[type\x3d'radio'].shipping-option","change",function(){g(m(this).closest("div."+c))}),a.on("active-shipment-changed",
g))}function f(a){e||(a.hasClass("scheduled-delivery-loading")?e=a.find(".loading-tooltip").text():a.hasClass("scheduled-delivery-picking")&&(e=a.find(".picking-tooltip").text()))}function g(a){e=null;a?f(a):m("div.one-shipment:visible div."+c+".scheduled-delivery").each(function(){var a=m(this);a.find("input").is(":checked")&&f(a)});e?k.show("scheduled-delivery",e):k.hide("scheduled-delivery")}var m=a.$,e,c=q.P&&q.P.AUI_BUILD_DATE?"selectable-box":"fake-label";if(h.isMobile())a.on("checkout:reload:shipoptionselect",
b);return{check:g}});"use strict";r.when("A","quantity-service","page-conductor","page-detector","ajax-utility","page-transition-controller","gift-utility","client-side-metrics").register("gift-form-base-controller",function(a,k,h,b,f,g,m,e){function c(a){a.is(":checked")||(W?a.is(":checked")||a.closest("label").click():(e.increaseCount("removeauijs4"),a.attr("checked",!0).trigger("change")))}function p(a){a.attr("disabled","disabled");W&&a.closest("div").bind("click.disable",function(a){a.stopPropagation()})}
function l(a){a.removeAttr("disabled");W&&a.closest("div").unbind("click.disable")}function n(){r.when("a-dropdown").execute(function(a){var b=C(".select-recipient");b.empty();for(var c=0;c<Y.length;c++){var d=C("\x3coption/\x3e").attr({value:Y[c].value}).text(Y[c].text);b.append(d)}b.each(function(){var b=C(this).closest(".gift-connection-section"),c=b.find(".include-gift-connection-checkbox").is(":checked"),d=b.find(".item-id").val(),e=b.find(".item-giftlist-type-id").val(),f;!e||"0"!==e&&"1"!==
e&&"2"!==e?e&&"3"===e&&(f=b.find(".item-giftlist-id").val()):f=e;!f&&c&&(c=b.find(".item-registry-id").val())&&ca&&ca[c]&&(f=ca[c]);f&&(a.setValue(C(this).attr("id"),f),(e&&"1"===e||"2"===e)&&b.find(".gift-connection-recipient-extra").removeClass("aok-hidden").show(),D(d))})})}function v(){C(".gift-connection-recipient-section").unbind("click").bind("click",function(){if(!Z)return C(this).find(".select-recipient-spinner").removeClass("aok-hidden").show(),!1});C(".select-recipient").each(function(){C(this).unbind("change").bind("change",
function(){var a=C(this),b=a.next().find(".a-dropdown-prompt"),c=C("\x3cdiv/\x3e").html(a.find(":selected").text()).clone().html();setTimeout(function(){b.html(c)},0)})});r.when("a-dropdown").execute(function(a){C(".gift-connection-section").each(function(){var b=C(this),c=b.find(".item-id").val(),d=b.find(".item-giftlist-type-id").val();b.find(".item-giftlist-id").val();var e=b.find(".item-occasion-id").val(),f=b.find(".item-occasion-month").val(),l=b.find(".item-occasion-day").val(),g=b.find(".item-age").val();
b.find("#input-recipient-first-name-"+c).unbind("keyup").keyup(function(){D(c)});b.find("#input-recipient-last-name-"+c).unbind("keyup").keyup(function(){D(c)});if("1"===d||"2"===d)a.setValue(b.find(".select-recipient").attr("id"),d),b.find(".gift-connection-recipient-extra").removeClass("aok-hidden").show();a.setValue(b.find(".select-occasion").attr("id"),e);a.setValue(b.find(".select-occasion-month").attr("id"),f);a.setValue(b.find(".select-occasion-day").attr("id"),l);a.setValue(b.find(".select-occasion-age").attr("id"),
g);if("1"===e||"2"===e)b.find(".gift-connection-occasion-extra").removeClass("aok-hidden").show(),"2"===d&&b.find(".select-occasion-age-row").removeClass("aok-hidden").show();"1"!==e&&"2"!==e&&"3"!==e&&D(c)})});var a="/gp/buy/pipeline/handlers/list-of-giftlists.html",b=C(".item-registry-id").map(function(){if(C(this).val())return C(this).val()}).get().join();b&&(a+="?fromRegistryIds\x3d"+b);Y?(n(),C(".select-recipient-spinner").hide(),Z=!0):(Z=!1,C.ajax({type:"POST",url:a,dataType:"json",async:!0,
cache:!1,timeout:5E3,success:function(a){!Y&&a.options&&0<a.options.length&&(Y=a.options);a.registryIdMapping&&(ca=a.registryIdMapping);Y&&n();C(".select-recipient-spinner").hide();Z=!0},error:function(a,b,c){C(".select-recipient-spinner").hide();Z=!0}}))}function t(){ba=[];a.state("giftNotificationEmailConstraints",[]);a.state("giftDeliveryDateConstraints",[]);C('[data-action\x3d"gift-form-element"]').each(function(){var a=C(this);a.is("span")?a.find("input, textarea, select:first").trigger({type:"change",
isInit:!0}):a.trigger({type:"change",isInit:!0})});C("textarea").unbind("keyup.gift-textarea click.gift-textarea").bind("keyup.gift-textarea click.gift-textarea",function(){C(this).trigger("change")});0<C(".enable-gift-connections").length&&v()}function A(a,b){var c=31;if("1"===b)c=0===a%4&&0!==a%100||0===a%400?29:28;else if("3"===b||"5"===b||"8"===b||"10"===b)c=30;return c}function y(a,b,c){a=f.jsonify(a);h.redirect(a)}function z(a){r.when("a-dropdown").execute(function(b){C(".gift-connection-recipient-extra-"+
a).hide();b.setValue("select-recipient-"+a,"0");C("#input-recipient-first-name-"+a).val("");C("#input-recipient-last-name-"+a).val("")})}function d(a){r.when("a-dropdown").execute(function(b){C(".gift-connection-occasion-extra-"+a).hide();b.setValue("select-occasion-"+a,"0");b.setValue("select-occasion-month-"+a,"0");b.setValue("select-occasion-day-"+a,"0");b.setValue("select-occasion-age-"+a,"-1");C("#occasion-has-reminder-checkbox-"+a).attr("checked",!0)})}function u(a,b){r.when("a-dropdown").execute(function(c){for(var d=
0;d<Y.length;d++)b&&b===Y[d].value&&Y[d].bMonth&&Y[d].bDay&&(c.setValue("select-occasion-month-"+a,Y[d].bMonth),c.setValue("select-occasion-day-"+a,Y[d].bDay))})}function D(a){r.when("a-dropdown").execute(function(b){var c=C("#select-recipient-"+a).find(":selected").val();"0"!==c&&("1"!==c&&"2"!==c||C("#input-recipient-first-name-"+a).val()||C("#input-recipient-last-name-"+a).val())?b.updateSelect("select-occasion-"+a,{status:"enabled"}):(d(a),b.updateSelect("select-occasion-"+a,{status:"disabled"}))})}
function w(a,b,c){"1"===b&&"2"===c?C("#select-occasion-age-row-"+a).removeClass("aok-hidden").show():C("#select-occasion-age-row-"+a).hide()}function H(){var a=C("#hidePricesCheckbox"),b=C("#kindle-reg-radio-your-account");W?b.is(":checked")?C("#kindle-reg-radio-another-account").closest("label").click():a.is(":checked")||a.closest("label").click():(e.increaseCount("removeauijs6"),a.is(":checked")||a.attr("checked","checked").trigger("change"),b.is(":checked")&&(b.removeAttr("checked").trigger("change"),
C("#kindle-reg-radio-another-account").attr("checked","checked").trigger("change")))}function B(){var a=C("#hidePricesCheckbox"),b=C("#kindle-reg-radio-another-account");W?b.is(":checked")?C("#kindle-reg-radio-your-account").closest("label").click():a.is(":checked")&&a.closest("label").click():(e.increaseCount("removeauijs7"),a.is(":checked")&&a.removeAttr("checked").trigger("change"),b.is(":checked")&&(b.removeAttr("checked").trigger("change"),C("#kindle-reg-radio-your-account").attr("checked","checked").trigger("change")))}
function L(){C("#hidePricesCheckboxLabel").hide();var a=C("#hidePricesCheckbox");W&&(a.is(":checked")||a.closest("label").click());a.attr("disabled",!0).hide().trigger("change");C("#kindle-reg-radio-another-account").attr("disabled",!0).trigger("change");C("#kindle-reg-radio-your-account").attr("disabled",!0).trigger("change");C("#hidePricesDisabledMessage").show();C("#hidePricesDisabledMessage").removeClass("aok-hidden");W&&(C("label.a-touch-checkbox.hide-prices-checkbox").addClass("a-touch-selector-disabled").bind("click.disable",
function(a){a.stopPropagation()}),C("label.a-touch-radio.kindle-reg-option").addClass("a-touch-selector-disabled").bind("click.disable",function(a){a.stopPropagation()}))}function X(a){var b=!1;C(".afn-wrap-checkbox").each(function(){var a=C(this),a=a.is("input")?a:a.find("input");if(a.is(":checked"))return b=!0,!1});C(".mfn-no-wrap-radio").each(function(){var a=C(this),a=a.is("input")?a:a.find("input");if(!a.is(":checked"))return b=!0,!1});if(b)H(),L();else if(C("#hidePricesCheckbox").is(":disabled"))C("#hidePricesCheckboxLabel").show(),
C("#hidePricesCheckbox").removeAttr("disabled").show().trigger("change"),C("#kindle-reg-radio-another-account").removeAttr("disabled").trigger("change"),C("#kindle-reg-radio-your-account").removeAttr("disabled").trigger("change"),C("#hidePricesDisabledMessage").hide(),W&&(C("label.a-touch-checkbox.hide-prices-checkbox").removeClass("a-touch-selector-disabled").unbind("click.disable"),C("label.a-touch-radio.kindle-reg-option").removeClass("a-touch-selector-disabled").unbind("click.disable"));else if(a.is("input")||
(a=a.find("input")),"hidePricesCheckbox"===a.attr("id"))a.is(":checked")?H():B();else if("kindle-reg-radio-another-account"===a.attr("id")||"kindle-reg-radio-your-account"===a.attr("id"))C("#kindle-reg-radio-your-account").is(":checked")?B():H()}function R(a){var b=C("#giftwrap-carousel-wrap-pane-"+a+" ul li").size();b&&(C("#giftwrap-carousel-wrap-holder-"+a).css("width",90*b),C("#giftwrap-carousel-wrap-pane-"+a).css("width",90*ga));G(a)}function G(a){C("#giftwrap-carousel-wrap-holder-"+a).find("ul li, ol li").each(function(b,
c){b=C(c);b.find("input").is(":checked")&&K(b,{itemId:a})})}function K(a,b){a.parent().find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");a.find(".giftwrap-carousel-item-image").addClass("selected-giftwrap-image");a.parent().find(".wrap.a-button-selected").removeClass("a-button-selected");a.addClass("a-button-selected");var c=b.itemId;b=b.wrapNo;var d=h.isSPP(),e=a.find("input[type\x3dradio]");e.attr("checked",!0);d||(d=a.data("giftwrap-id"),e.val(d).change());var e=a.data("wrap-no"),
d=C("#giftwrap-option-preview-imagearea-default-"+c),f=C("#giftwrap-option-preview-imagearea-image-"+c),l=C(".selectedWrapLargeLink","#item-"+c),c=C(".wrapNo-"+c+"-"+b);a.hasClass("none-wrap")?(d.removeClass("aok-hidden"),f.addClass("aok-hidden"),l.length&&(l.addClass("aok-hidden"),l.removeClass("selectedWrapLargeLink"))):(a=a.find("img").attr("src"),f.find("img").attr("src",a),d.addClass("aok-hidden"),f.removeClass("aok-hidden"),l.length&&(l.addClass("aok-hidden"),l.removeClass("selectedWrapLargeLink")),
c.length&&(c.addClass("selectedWrapLargeLink"),c.removeClass("aok-hidden")));a=C(".selectedWrapLargeLink");c=C(".larger-image-link-carousel-"+e);a.removeClass("selectedWrapLargeLink").addClass("aok-hidden");c.removeClass("aok-hidden").addClass("selectedWrapLargeLink")}function V(a,b){var c;c=b.itemId;b=C("#giftwrap-option-preview-imagearea-default-"+c);c=C("#giftwrap-option-preview-imagearea-image-"+c);a.hasClass("none-wrap")?(b.removeClass("aok-hidden"),c.addClass("aok-hidden")):(a=a.find("img").attr("src"),
c.find("img").attr("src",a),b.addClass("aok-hidden"),c.removeClass("aok-hidden"))}function F(a,b){var c=b.itemId;b=C("#giftwrap-option-preview-imagearea-default-"+c);c=C("#giftwrap-option-preview-imagearea-image-"+c);if(a.parent().find(".selected-giftwrap-image").parents("li").hasClass("none-wrap"))b.removeClass("aok-hidden"),c.addClass("aok-hidden");else{var d=".selected-giftwrap-image img";h.isSPP()&&(d="img.selected-giftwrap-image");a=a.parent().find(d).attr("src");c.find("img").attr("src",a);
b.addClass("aok-hidden");c.removeClass("aok-hidden")}}function x(a,b){var c=a.find(".empty-message-warning"),d=a.find(".no-receipt-warning"),e=a.find("textarea");a=a.find(".message-counter");b&&!d.is(":visible")?(a.hide(),c.show(),e.addClass("gift-warning")):(c.hide(),e.removeClass("gift-warning"),a.show())}function P(a){var b=C("#"+a.id),c=m.getCharCount(b.val(),a.useByteSize),b=m.getLineCount(b.val(),a.maxChars/a.maxLines);return{length:c,charDelta:a.maxChars-c,lineDelta:a.maxLines-b}}function T(a,
b){b=C("#item-"+b.itemId);var c=a.is(":checked")&&!a.hasClass("mfn-no-wrap-radio");h.isSPP()&&C("#carouselGiftWrap").length&&(c=!a.hasClass("mfn-no-wrap-radio"));c?(b.find(".gift-message-pslip").hide(),b.find(".gift-message-card").show()):(b.find(".gift-message-card").hide(),b.find(".gift-message-pslip").show())}function U(b,c){var d=c.itemId;c=h.isSPP()?c.currentTab:b.data("current-tab");var e=C("#afn-gift-options-wrapper-"+d).data("active-tab");c!==e&&(b.parent().find(".selected-giftwrap-tab").removeClass("selected-giftwrap-tab"),
b.addClass("selected-giftwrap-tab"),C("#afn-gift-options-wrapper-"+d).data("active-tab",c),b="#item-"+d,e=h.isSPP()?C("#giftwrap-carousel-wrap-holder-"+d,b):b,e.length&&a.trigger("checkout:gift:changeCarouselWrapOptions",e,c,d),c=C(".none-wrap",C(b)).find("input"),c.prop("checked",!0),c.val("").change(),h.isSPP()?(c=C("#afn-gift-options-wrapper-"+d),c.length&&(c=c.data("active-tab"),a.trigger("checkout:gift:adaptCarouselGiftPanel",d,c))):a.trigger("checkout:gift:adaptCarousel",d),C("#giftwrap-carousel-wrap-holder-"+
d).removeClass("a-button-selected").find(".selected-giftwrap-image").removeClass("selected-giftwrap-image"),C("#giftwrap-carousel-item-image-"+d).addClass("selected-giftwrap-image").parents(".wrap").addClass("a-button-selected"),C("#giftwrap-option-preview-imagearea-default-"+d).removeClass("aok-hidden"),C("#giftwrap-option-preview-imagearea-image-"+d).addClass("aok-hidden"),c=C(".selectedWrapLargeLink"),c.length&&(c.addClass("aok-hidden"),c.removeClass("selectedWrapLargeLink")),c=h.isSPP(),b="#item-"+
d,C("#gift-message-noshi-warning-"+d).addClass("aok-hidden"),C("#includeMessageCheckbox-"+d).removeAttr("disabled"),c?C("#afn-message-span-"+d,C(b)).removeClass("aok-hidden"):(C("#afn-message-span",C(b)).removeClass("disable-message-area").addClass("enable-message-area"),C("#gift-message-heading-"+d).removeClass("disable-message-area").addClass("enable-message-area"),C("#message-area-"+d).removeAttr("disabled")))}var ba,ga=4,Y,Z=!1,ca,C=a.$,W=q.P&&q.P.AUI_BUILD_DATE&&b.isMobile(),da=m.getInput;a.declarative("save-gift-for-later",
["click"],function(a){g.show();a=a.$currentTarget.data("entityId")||a.data.entityId;k.call(a,0,{success:y})});r.register("gift-base/init-carousel",function(){return R});r.register("gift-base/set-carousel-size",function(){return function(a){ga=a}});var ia={toggleGiftDataAndDeliveryOptions:function(a){a=a.closest(".gift-options-wrapper");var b=da(a.find(".includeMessageCheckbox"));b&&b.is(":checked")?(a.find(".gift-delivery-option").show(),a.find(".item-wrap-span").show(),a.find(".item-wrap-row").show(),
a.find(".item-gift-message-span").show()):(a.find(".gift-delivery-option").hide(),a.find(".item-wrap-span").hide(),a.find(".item-wrap-row").hide(),a.find(".item-gift-message-span").hide())},toggleGiftDeliveryOptions:function(a){var b=a.closest(".gift-options-wrapper");a.is("input[type\x3dcheckbox]")?a.is(":checked")?b.find(".gift-notification-email").removeClass("a-form-disabled"):b.find(".gift-notification-email").addClass("a-form-disabled"):(b.find(".gift-notification-email").removeClass("a-form-disabled"),
a=b.find(".includeMessageCheckbox"),c(a.find("input[type\x3dcheckbox]")),W&&(a=a.find("i.a-icon"),a.length&&(a.removeClass("a-icon-checkbox-inactive"),a.removeClass("a-icon-touch-checkbox-inactive"),a.addClass("a-icon-checkbox-active"),a.addClass("a-icon-touch-checkbox-active"))))},initGiftNotificationEmail:function(b){var c=a.state("giftNotificationEmailConstraints");c.push({id:b.attr("id")});a.state("giftNotificationEmailConstraints",c)},initGiftDeliveryDate:function(b){var c=a.state("giftDeliveryDateConstraints");
b.hasClass("year-select")||(b=b.parents("div.del-opt-date-section").find("select.year-select:first"));c.push({id:b.attr("id")});a.state("giftDeliveryDateConstraints",c)},updateDateDropdown:function(a){var b=a.closest(".gift-options-wrapper");a=b.find(".month-select").val();var c=b.find(".day-select");c.val();var b=b.find(".year-select").val(),d=A(b,a);if(c.hasClass("a-native-dropdown"))r.when("a-dropdown").execute(function(a){a=a.getSelect(c);if(a.getOptions().size()>d)for(var b=a.getOptions().size()-
1;b>=d;b--)a.removeOption(b);else for(b=a.getOptions().size();b<d;b++)a.addOption({text:b+1,value:b+1},b)});else{if(c.find("option").length>d)c.find("option:gt("+(d-1)+")").remove();else for(a=c.find("option").length+1;a<=d;a++)c.append(C("\x3coption\x3e",{value:a}).text(a));c.trigger("change")}},initSelectedTabAndWrapHolderWidth:R,initGiftMessage:function(a,b){W&&!a.is("textarea")&&(a=a.find("textarea"));ba.push({id:a.attr("id"),maxChars:parseInt(b.maxChars,10),maxLines:parseInt(b.maxLines,10),useByteSize:b.useByteSize});
da(a.closest(".gift-options-wrapper").find(".includeMessageCheckbox")).is(":checked")||a.addClass("a-form-disabled");"1"===C("#multipleAFNGiftWrapOption").val()&&(a=a.attr("id").substring(a.attr("id").lastIndexOf("-")+1,a.attr("id").size),R(a))},enforceSelectorParity:X,enforceGiftReceiptParity:function(a,b){a=C("#item-"+b.itemId);if(0!==a.length){b=a.find(".item-receipt-row label");var d=da(a.find(".includeReceiptCheckbox")),e=a.find(".mfn-hide-price-row label"),f=da(a.find(".mfnHidePriceCheckbox")),
g=a.find(".item-message-row label"),h=da(a.find(".includeMessageCheckbox")).is(":checked"),n=!1;0<a.find(".afn-wrap-checkbox").length?da(a.find(".afn-wrap-checkbox")).is(":checked")&&(n=!0):0<a.find(".mfn-no-wrap-radio").length&&(da(a.find(".mfn-no-wrap-radio")).is(":checked")||(n=!0));if(n||h)c(d),c(f);n||h&&g.is(":visible")?(p(d),b.addClass("checkout-gift-option-disabled"),p(f),e.addClass("checkout-gift-option-disabled")):(l(d),l(f),b.removeClass("checkout-gift-option-disabled"),e.removeClass("checkout-gift-option-disabled"))}},
enforceHidePriceParity:function(a){var b=!1;C(".includeReceiptCheckbox").each(function(){if(da(C(this)).is(":checked"))return b=!0,!1});var c=!1;C(".mfnHidePriceCheckbox").each(function(){if(da(C(this)).is(":checked"))return c=!0,!1});b||c?(H(),C(".kindle-reg-msg-your-account").hide(),C(".kindle-reg-msg-another-account").show()):(B(),C(".kindle-reg-msg-another-account").hide(),C(".kindle-reg-msg-your-account").show())},toggleNoReceiptWarning:function(a){var b=da(a).is(":checked"),d=a.closest(".gift-options-wrapper");
a=d.find(".no-receipt-warning");var f=d.find(".empty-message-warning"),d=d.find(".item-message-row").find(".includeMessageCheckbox"),l=da(d);b?(a.hide(),d.is(":visible")||c(l)):(f.hide(),a.show(),l.is(":checked")&&(W?l.is(":checked")&&l.closest("label").click():(e.increaseCount("removeauijs5"),l.removeAttr("checked").trigger("change"))))},toggleMessageArea:function(a){var b=a.closest(".gift-options-wrapper");if(a.is("textarea"))b=da(b.find(".includeMessageCheckbox")),c(b);else{a=da(b.find(".includeMessageCheckbox")).is(":checked");
var d=b.find(".item-message-row label").is(":visible"),e=0<b.find(".empty-message-warning").length,f=b.find("textarea"),l=f.data("default-text"),g=0<f.val().length;a?(b.find(".gift-message-edit").show(),b.find(".gift-message-label").removeClass("a-color-secondary"),f.removeClass("a-form-disabled"),l&&f.val(l)):(d&&b.find(".gift-message-edit").hide(),b.find(".gift-message-label").addClass("a-color-secondary"),f.addClass("a-form-disabled"),l&&f.val(""));e&&(a&&g?x(b,!1):x(b,!0))}},toggleMessageLocationText:T,
toggleMessageBoxDisplay:function(b,d){var e=C("#item-"+d.itemId);if(0!==e.length){var f=e.find(".item-message-row");d=e.find(".item-receipt-row");var g=e.find(".gift-message-on-card"),h=e.find(".gift-message-on-receipt"),n=f.find("label"),f=da(f.find(".includeMessageCheckbox")),u=a.trim(e.find(".gift-message-default-placeholder").text()),k=a.trim(e.find(".gift-message-with-wrap-placeholder").text()),e=e.find("textarea"),m=b.hasClass("mfn-no-wrap-radio")||b.closest("div").hasClass("mfn-no-wrap-radio");
da(b).is(":checked")&&!m?(h.hide(),g.show(),e.attr("placeholder",k),d.is(":visible")&&(c(f),n.is(":visible")&&(p(f),n.addClass("checkout-gift-option-disabled")))):(g.hide(),h.show(),e.attr("placeholder",u),l(f),n.removeClass("checkout-gift-option-disabled"))}},updateContinueButtons:function(){for(var b=!0,c,d=0;d<ba.length;d++)if(c=C("#"+ba[d].id),c.closest(".gift-options-wrapper").find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]').is(":checked")&&(c=P(ba[d]),0>c.charDelta||0>c.lineDelta))b=
!1;b?(C(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").show(),C(".save-gift-button-box span.a-button-disabled").hide()):(C(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").hide(),b=C(".save-gift-button-box span.a-button-disabled"),b.removeClass("aok-hidden"),b.show());a.trigger("orderSummary:primaryActionButton:mirrorPanelBtnState")},updateMessageCounter:function(a){W&&!a.is("textarea")&&(a=a.find("textarea"));for(var b,c=0;c<ba.length;c++)a.attr("id")===
ba[c].id&&(b=P(ba[c]));if(b){a=a.closest(".gift-options-wrapper");c=a.find(".message-counter");c.find(".remaining-count").hide();if(0<a.find(".empty-message-warning").length){if(0===b.length){x(a,!0);return}x(a,!1)}(-1>b.charDelta?c.find(".remaining-char-over-multiple").show():0>b.charDelta?c.find(".remaining-char-over-single").show():1===b.charDelta?c.find(".remaining-char-single").show():c.find(".remaining-char-multiple").show()).find(".chars-remaining").html(Math.abs(b.charDelta));(-1>b.lineDelta?
c.find(".remaining-line-over-multiple").show():0>b.lineDelta?c.find(".remaining-line-over-single").show():1===b.lineDelta?c.find(".remaining-line-single").show():c.find(".remaining-line-multiple").show()).find(".lines-remaining").html(Math.abs(b.lineDelta));c.show()}},updateSelectedGiftWrap:K,clearGiftConnection:function(a,b){C("#include-gift-connection-checkbox-"+b.itemId).is(":checked")||(z(b.itemId),D(b.itemId))},toggleGiftConnectionAgeDropdown:w,toggleGiftConnectionRecipientArea:function(a,b){a=
C("#select-recipient-"+b.itemId).find(":selected").val();var c=C("#select-occasion-"+b.itemId).find(":selected").val();!a||"1"!==a&&"2"!==a?(C(".gift-connection-recipient-extra-"+b.itemId).hide(),"1"===c&&a&&u(b.itemId,a)):C(".gift-connection-recipient-extra-"+b.itemId).removeClass("aok-hidden").show();w(b.itemId,c,a);D(b.itemId)},toggleGiftConnectionOccasionArea:function(a,b){a=C("#select-occasion-"+b.itemId).find(":selected").val();var c=C("#select-recipient-"+b.itemId).find(":selected").val();
!a||"1"!==a&&"2"!==a?C(".gift-connection-occasion-extra-"+b.itemId).hide():("1"===a&&c&&"1"!==c&&"2"!==c&&u(b.itemId,c),C(".gift-connection-occasion-extra-"+b.itemId).removeClass("aok-hidden").show());w(b.itemId,a,c)},includeGiftConnection:function(a,b){(a=C("#select-recipient-"+b.itemId).find(":selected").val())&&"0"===a||C("#include-gift-connection-checkbox-"+b.itemId).attr("checked",!0)},updateGiftOptionsTabSelection:U,updatePreviewImageOnMouseEnter:V,updatePreviewImageOnMouseLeave:F,toggleGiftMessageWarning:function(a){var b=
C("#"+a.attr("id"));m.toggleGiftMessageWarning(b,a.closest(".item-gift-message-span"))}};a.declarative("gift-form-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(ia[b[c]])ia[b[c]](a.$target,a.data)});a.declarative("gift-form-element","click mouseenter mouseleave",function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(ia[b[c]])ia[b[c]](a.$currentTarget,
a.data,a)});a.declarative("select-gift-wrap","click",function(a){K(a.$target.parents("li"),{itemId:a.data.itemId,wrapNo:a.data.wrapNo});X(a.$target);var b=a.$target.parents("li").find(".gift-hidden-radio");T(b,{itemId:a.data.itemId})});a.declarative("select-gift-wrap","mouseenter",function(a){V(a.$target.parents("li"),a.data)});a.declarative("select-gift-wrap","mouseleave",function(a){F(a.$target.parents("li"),a.data)});a.declarative("update-gift-options-tab-selection",["click"],function(a){var b=
a.$target.parents("li");b.attr("data",a.data);U(b,a.data)});a.on("checkout:reload:giftselect",t);a.on("checkout:reload:spp-giftoptions",t);return{extendFunctions:function(a){C.extend(ia,a)}}});"use strict";r.when("A","page-transition-controller","page-conductor").register("gift-form-del-opt-controller",function(a,k,h){function b(a){var b=a.closest(".expando-box");b&&(b=b.find(".a-expander-header"),a.closest(".expando-content").is(":hidden")&&b.click())}function f(a){var b=a.closest(".gift-options-wrapper"),
e=b.find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]');if(e&&!e.is(":checked"))return!0;e=b.find(".email-error-selector");b.find(".gift-notification-email-error").hide();e.removeClass("a-form-error");if(64<q.unescape(encodeURIComponent(a.val())).length)return e.addClass("a-form-error"),b.find(".gift-notification-email-length-exceeded-error").removeClass("aok-hidden").show(),!1;if(/^\S+[@]\S+[.]\S+$/.test(a.val()))return!0;e.addClass("a-form-error");b.find(".gift-notification-invalid-email-error").removeClass("aok-hidden").show();
return!1}function g(){e("#giftForm").find(".save-gift-button-box span.a-button-primary:not(.a-button-disabled)").unbind("click").bind("click",function(a){a.preventDefault();m(a)});e(".checkout-gift-image-preview-trigger \x3e a").show();e("#gift-kindle-imb").show()}function m(c){c=e("#giftForm");var g=c.find('input[name\x3d"hidePrices"]'),l=g.is(":disabled");l&&g.removeAttr("disabled");for(var n=!0,m=a.state("giftNotificationEmailConstraints"),t=a.state("giftDeliveryDateConstraints"),A=0;A<m.length;A++){var y=
e("#"+m[A].id);f(y)||(n=!1,b(y))}for(m=0;m<t.length;m++){A=e("#"+t[m].id);var y=A.closest(".gift-options-wrapper"),z=y.find(".includeMessageCheckbox").find('input[type\x3d"checkbox"]');if(z&&!z.is(":checked"))y=!0;else{var d=y.find(".month-select").val(),u=y.find(".day-select").val(),z=y.find(".year-select"),D=z.val(),w=y.find("#current-date").val().split("-"),d=new Date(D,d,u),w=new Date(w[0],w[1]-1,w[2]),u=new Date(w.getTime());u.setMonth(u.getMonth()+12);y.find(".gift-delivery-date-error").hide();
D=y.find(".date-error-selector");z=z.hasClass("a-native-dropdown")?"error-border a-form-error":"a-form-error";D.removeClass(z);d>=u||d<w?(y.find(".gift-delivery-date-error").removeClass("aok-hidden").show(),D.addClass(z),y=!1):y=!0}y||(n=!1,b(A))}a.state("continueAction",{enable:n});if(a.state("continueAction").enable)h.isSPP()||k.showPageTransition(),c.submit();else return e("html, body").animate({scrollTop:e(".a-form-error").closest("div").offset().top},500),!1;l&&g.attr("disabled",!0)}var e=a.$;
a.declarative("submit-gift-options","click",function(a){m(a)});a.declarative("discard-gift-options","click",function(a){e('#giftForm input[type\x3d"checkbox"]').prop("checked",!1);e("#giftForm textarea").addClass("a-form-disabled");m(a)});a.on("checkout:reload:giftselect",g);a.on("checkout:reload:spp-giftoptions",g)});"use strict";r.when("A").register("teen-message-controller",function(a){var k=a.$;a.declarative("teen-message-form-element","click keyup",function(a){a=a.data.maxChars;var b=k("#teen-message-box").val(),
f=b.match(/(\r\n|\n|\r)/g),g=0;f&&(g=f.length);b=b.length+g;k(".remaining-char").text(Math.max(a-b,0))});k("#aui-teen-message-box").length&&k(".remaining-char").length&&r.when("A").execute(function(a){function b(a){a=a.val();var b=(a.match(/(\r\n|\n|\r|\n\r)/g)||{}).length||0;return a.length+b}a=a.$;var f,g,m;f=a("#aui-teen-message-box");f.bind("change keypress",function(a){return b(f)>=m?(a.preventDefault(),!1):!0});f.bind("paste",function(a){if(a&&a.originalEvent&&a.originalEvent.clipboardData&&
a.originalEvent.clipboardData.getData("Text")){var c=a.originalEvent.clipboardData.getData("Text"),g=b(f);if(g+c.length>=m)return c=c.substring(0,m-g),c=f.val()+c,f.attr("value",c),a.preventDefault(),!1}return!0});f.bind("click keyup",function(){var a=Math.max(m-b(f),0);g.text(a)});g=a(".remaining-char");m=f.parent().data("maxchars")})});"use strict";r.when("A","page-transition-controller","page-conductor","loading-spinner-controller","client-side-metrics").register("concealment-form-del-opt-controller",
function(a,k,h,b,f){function g(a){var b=e("#concealmentForm");b.find("input:checked").length?(a=a.data.saveConcealmentRefTag,f.increaseCount("CPEX.Checkout.Select.Concealment",1)):(a=a.data.cancelConcealmentRefTag,f.increaseCount("CPEX.Checkout.Cancel.Concealment",1));b.find("input[name\x3dref]").val(a);b.attr("action",b.attr("action")+"/ref\x3d"+a)}function m(a){a=e("#concealmentForm");h.isSPP()||k.showPageTransition();a.submit()}var e=a.$;a.declarative("submit-concealment-options","click",function(a){g(a);
m(a)});a.declarative("discard-concealment-options","click",function(a){e('#concealmentForm input[type\x3d"checkbox"]').prop("checked",!1);g(a);m(a)});a.declarative("submit-concealment-form","click",function(a){g(a);a.$target.closest(".a-button").addClass("a-button-disabled");b.showSpinner(a.$target.closest("form"))})});"use strict";r.when("A","page-transition-controller","page-conductor","address-popovers","checkout-general-utils","a-popover","client-side-metrics","weblab-helper","ajax-utility").register("itemselect-address-controller",
function(a,k,h,b,f,g,m,e,c){function p(){t(".lineitem").each(function(a,b){a=t(b);a.find(".no-js-address-dropdown").remove();a.find(".no-js-address-select").remove();a.find(".js-address-dropdown").prop("disabled",!1);a.find(".address-dropdown").removeClass("a-button-disabled")});t("#suppressAddAddressPopover").val()&&t('select[name^\x3d"addressID."]').find("option").each(function(){var a=t(this);"New"===a.val()&&a.closest("optgroup").remove()})}function l(a){var b=(new Date).getTime(),l=h.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});
e.isHeadersCleaned()?t.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-address\x26cachebuster\x3d"+b,data:a,dataType:"text",headers:l,error:h.ajaxRedirect,success:function(a,b,e){var l=e.getResponseHeader("x-amz-checkout-fatal-error");if(null!==l&&l!==F)q.location=l;else if(n(a)){a=c.jsonify(a);v(a,e);var g;e=d.find('input[name^\x3d"previousAddress."]');if(null!==e||e!==F)g=y||e.val();var p=d.find('select[name^\x3d"addressID."]');null===p&&p===F||r.when("a-dropdown").execute(function(a){a.setValue(p.attr("id").replace(/\./g,
"\\."),g);p.find("option").removeAttr("selected");p.find('option[value\x3d"'+g+'"]').attr("selected","selected")});k.hide()}else h.ajaxUpdatePage(a,b,e),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")}}):t.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-address\x26cachebuster\x3d"+b,data:a,dataType:"text",headers:l,error:h.ajaxRedirect,success:function(a,b,c){var e=c.getResponseHeader("x-amz-checkout-fatal-error");if(null!==e&&e!==F)q.location=
e;else if(n(c)){v(a,c);var l;a=d.find('input[name^\x3d"previousAddress."]');if(null!==a||a!==F)l=y||a.val();var g=d.find('select[name^\x3d"addressID."]');null===g&&g===F||r.when("a-dropdown").execute(function(a){a.setValue(g.attr("id").replace(/\./g,"\\."),l);g.find("option").removeAttr("selected");g.find('option[value\x3d"'+l+'"]').attr("selected","selected")});k.hide()}else h.ajaxUpdatePage(a,b,c),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")}})}function n(a){var b;if(e.isHeadersCleaned()){if(a=
c.jsonify(a))b=a.showAddonWarning}else b=a.getResponseHeader("x-amz-checkout-show-addon-warning");return null!==b&&b!==F}function v(a,b){e.isHeadersCleaned()?(b=a.showAddonWarning,a=a.asins):b=b.getResponseHeader("x-amz-checkout-show-addon-warning");t(".item-list").hide();a.trim().split(",").forEach(function(a){t('[data-asin\x3d"'+a+'"]').show()});a=t("#addon-warning-"+b+"-launcher");a.length&&(t(".delete-title").hide(),t(".reduce-title").hide(),t(".select-address-title").show(),t("input[name\x3duseLiveAUI]").length?
g.get(a).attrs({$trigger:z,position:"triggerHorizontal"}).show():(b=t.Event("keyup",{triggerPositioningElement:z,manualTrigger:!0}),a.trigger(b)))}var t=a.$,A,y,z,d;a.declarative("itemselect-get-address",["click","touchend"],function(a){f.protectAgainstDoubleAction("itemselect-get-address",200)||(y=a.$currentTarget.find(".js-address-dropdown").val())});a.declarative("itemselect-update-address",["change"],function(a){if(!f.protectAgainstDoubleAction("itemselect-update-address",200)){m.resetMetrics();
var c=a.$currentTarget.is("select")?a.$currentTarget:a.$currentTarget.find("select");A=c.val();if("New"===A)b.actionTriggerPopoverFromDropdown(a),r.when("a-dropdown").execute(function(a){a.setValue(c.attr("id").replace(/\./g,"\\."),y)});else{k.show();d=c.closest(".lineitem");var e,g;if(d){var p=d.find('input[name^\x3d"lineItemEntityID."]');p&&(e=p.val());(p=d.find('input[name^\x3d"quantity."]'))&&(g=p.val());(p=d.find(".js-address-dropdown"))&&(A=p.val())}z=a.$currentTarget.is("select")?a.$currentTarget.closest(".address-dropdown"):
a.$currentTarget;a=0;p=t("#addon-indicator");p.length&&"true"===p.attr("data-has-addon-items")&&(a=1);l({lineitems:e,addresses:A,quantities:g,isTrial:a})}}});a.declarative("itemselect-update-pantry-address",["change"],function(a){if(!f.protectAgainstDoubleAction("itemselect-update-pantry-address",200)){A=a.$currentTarget.val();k.show();var b="";a=a.$currentTarget.closest(".pantry-row");t(a).find(".pantry-item").each(function(a,c){a=t(c);b+="lineitems\x3d"+a.find('input[name^\x3d"lineItemEntityID."]').val()+
"\x26";b+="addresses\x3d"+A+"\x26";b+="quantities\x3d"+a.find('input[name^\x3d"quantity."]').val()+"\x26"});l(b)}});a.declarative("addon-delete-items",["click","touchend"],function(a){if(z!==F&&null!==z&&!f.protectAgainstDoubleAction("itemselect-delete-addons",200)){t(".a-button-close").trigger("click");k.show();a=(new Date).getTime();var b=t("#useCase").val(),c=h.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"}),e=d.find('input[name^\x3d"lineItemEntityID."]').val(),l=d.find('input[name^\x3d"quantity."]').val();
t.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-address\x26cachebuster\x3d"+a,data:{lineitems:e,addresses:A,quantities:l,isTrial:0,deleteAddons:1,returnHTML:1,useCase:b},headers:c,error:h.ajaxRedirect,success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==d&&d!==F?q.location=d:(d=c.getResponseHeader("x-amz-checkout-fatal-error"),null!==d&&d!==F?q.location=d:(h.ajaxUpdatePage(a,b,c),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")))}})}});
a.on("checkout:reload:itemselect",p);a.on("checkout:reload:spp-itemselect",p)});"use strict";r.when("A","page-transition-controller","page-conductor","checkout-general-utils","a-popover","client-side-metrics","weblab-helper","ajax-utility").register("itemselect-delete-controller",function(a,k,h,b,f,g,m,e){function c(a,b){p(a,null===b||b===F?a.$currentTarget.closest(".lineitem"):b)}function p(a,c){a.$event.preventDefault();if(!b.protectAgainstDoubleAction("itemselect-delete-single-item",200)){g.resetMetrics();
k.show();y=c;d=a.$currentTarget.is("select")?a.$currentTarget.closest(".quantity-dropdown"):a.$currentTarget;a=y.find('input[name^\x3d"lineItemEntityID."]').val();c=0;(new Date).getTime();var e=A("#addon-indicator");e.length&&"true"===e.attr("data-has-addon-items")&&(c=1);n({lineitems:a,isTrial:c})}}function l(a,c){a.$event.preventDefault();if(!b.protectAgainstDoubleAction("itemselect-delete-multiple-items",200)){k.show();z=c;d=a.$currentTarget;var e="";a=0;c=A("#addon-indicator");c.length&&"true"===
c.attr("data-has-addon-items")&&(a=1);c=z.hasClass("pantry-row")?!0:!1;z.find(c?".pantry-item":".lineitem").each(function(a,b){e+="lineitems\x3d"+A(b).find('input[name^\x3d"lineItemEntityID."]').val()+"\x26"});n(e+"isTrial\x3d"+a)}}function n(a){var b=(new Date).getTime(),c=A('input[name\x3d"useCase"]').val(),d=h.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});A.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3ddelete\x26useCase\x3d"+c+"\x26cachebuster\x3d"+
b,data:a,dataType:"text",headers:d,error:h.ajaxRedirect,success:v})}function v(a,c,d){var f;f=d.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==f&&f!==F?(q.location=f,f=!0):f=!1;if(!f)if(f=d.getResponseHeader("x-amz-checkout-fatal-error"),null!==f&&f!==F)q.location=f;else{var l;if(m.isHeadersCleaned()){if(f=e.jsonify(a))l=f.showAddonWarning}else l=d.getResponseHeader("x-amz-checkout-show-addon-warning");l=null!==l&&l!==F?!0:!1;l?(t(a,d),k.hide()):(h.ajaxUpdatePage(a,c,d),b.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}}
function t(a,b){m.isHeadersCleaned()?(a=e.jsonify(a),b=a.showAddonWarning,a=a.asins):b=b.getResponseHeader("x-amz-checkout-show-addon-warning");A(".item-list").hide();a.trim().split(",").forEach(function(a){A('[data-asin\x3d"'+a+'"]').show()});a=A("#addon-warning-"+b+"-launcher");a.length&&(A(".delete-title").show(),A(".reduce-title").hide(),A(".select-address-title").hide(),A("input[name\x3duseLiveAUI]").length?f.get(a).attrs({$trigger:d,position:"triggerHorizontal"}).show():(b=A.Event("keyup",{triggerPositioningElement:d,
manualTrigger:!0}),a.trigger(b)))}var A=a.$,y,z,d;a.declarative("itemselect-delete-item",["click","touchend"],c);a.declarative("itemselect-delete-item-row",["click","touchend"],function(a){l(a,a.$currentTarget.closest(".item-row"))});a.declarative("addon-delete-items",["click","touchend"],function(a){if(d!==F&&!b.protectAgainstDoubleAction("itemselect-delete-addons",200)){A(".a-button-close").trigger("click");k.show();var c="";null!==z&&z!==F?(a=z.hasClass("pantry-row")?z.find(".pantry-item"):z.find(".lineitem"),
A(a).each(function(a,b){c+="lineitems\x3d"+A(b).find('input[name^\x3d"lineItemEntityID."]').val()+"\x26"})):null!==y&&y!==F&&(c+="lineitems\x3d"+y.find('input[name^\x3d"lineItemEntityID."]').val()+"\x26");n(c+"isTrial\x3d0\x26deleteAddons\x3d1")}});a.declarative("itemselect-delete-pantry-item",["click","touchend"],function(a){p(a,a.$currentTarget.closest(".pantry-item"))});a.declarative("itemselect-delete-pantry",["click","touchend"],function(a){l(a,a.$currentTarget.closest(".pantry-row"))});a.declarative("itemselect-delete-popover-item",
["click","touchend"],function(a){var b=a.$currentTarget.data("entityidtodelete");l(a,A('a[data-entityid\x3d"'+b+'"]').closest(".item-row"))});return{actionDeleteItem:c}});"use strict";r.when("A","page-transition-controller","page-conductor","itemselect-delete-controller","checkout-general-utils","a-popover","client-side-metrics","weblab-helper","ajax-utility").register("itemselect-quantity-controller",function(a,k,h,b,f,g,m,e,c){function p(){z(".lineitem, .pantry-item").each(function(a,b){a=z(b);
a.find(".no-js-quantity").remove();b=a.find(".quantity-dropdown");b.is(":visible")?(a.find(".js-select").prop("disabled",!1),b.removeClass("a-button-disabled")):(a=a.find(".quantity-input"),a.prop("disabled",!1),a.removeClass("a-form-disabled"))})}function l(a){a.find(".quantity-input").val(a.find('input[name^\x3d"previousQuantity."]').val())}function n(a){var b=a.$currentTarget.closest(".quantity-text-field").find(".update-quantity-link"),c=a.$currentTarget.is("input")?a.$currentTarget.val():a.$currentTarget.find("input").val(),
d;d="itemselect-show-update-pantry-button"===a.action?".pantry-item":".lineitem";0===parseInt(c,10)||""===c?("change"===a.type&&l(a.$currentTarget.closest(d)),b.hide()):(a=a.$currentTarget.closest(d).find('input[name^\x3d"previousQuantity."]').val(),c!==a?b.show():b.hide())}function v(a){a.$event.preventDefault();if(!f.protectAgainstDoubleAction("itemselect-update-quantity",200)){m.resetMetrics();D=a.$currentTarget.closest("itemselect-update-pantry-quantity"===a.action||"itemselect-update-pantry-quantity-text-field"===
a.action?".pantry-item":".lineitem");var g=D.find(".js-address-dropdown").val(),p=a.$currentTarget.find("select"),n=p.length?p:a.$currentTarget;d=n.is("select")?n.val():D.find(".quantity-input").val();if(0===parseInt(d,10)||""===d)l(D);else if("Delete"===d)r.when("a-dropdown").execute(function(a){a.setValue(n.attr("id").replace(/\./g,"\\."),u)}),b.actionDeleteItem(a,D);else{k.show();a=D.find('input[name^\x3d"lineItemEntityID."]').val();var p=0,v=(new Date).getTime(),G=z("#useCase").val(),K=z("#addon-indicator");
w=n.is("select")?n.parent():D.find(".quantity-input");K.length&&"true"===K.attr("data-has-addon-items")&&(p=1);K=h.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});e.isHeadersCleaned()?z.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-quantity\x26cachebuster\x3d"+v,data:{lineitems:a,quantities:d,address:g,isTrial:p,returnHTML:1,useCase:G},dataType:"text",headers:K,error:h.ajaxRedirect,success:function(a,b,d){var e=d.getResponseHeader("x-amz-checkout-fatal-error");
null!==e&&e!==F?q.location=e:A(a)?(a=c.jsonify(a),y(a,d),t(u===F?D.find('input[name^\x3d"previousQuantity."]').val():u,d),k.hide()):(h.ajaxUpdatePage(a,b,d),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}}):z.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-quantity\x26cachebuster\x3d"+v,data:{lineitems:a,quantities:d,address:g,isTrial:p,returnHTML:1,useCase:G},dataType:"text",headers:K,error:h.ajaxRedirect,success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-fatal-error");
null!==d&&d!==F?q.location=d:A(c)?(y(a,c),t(u===F?D.find('input[name^\x3d"previousQuantity."]').val():u,c),k.hide()):(h.ajaxUpdatePage(a,b,c),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}})}}}function t(a,b){10>a?(r.when("a-dropdown").execute(function(b){var c=D.find('select[name^\x3d"quantity."]');b.setValue(c.attr("id").replace(/\./g,"\\."),a);c.find("option").removeAttr("selected");c.find('option[value\x3d"'+a+'"]').attr("selected","selected")}),D.find(".quantity-dropdown").show(),
D.find(".quantity-text-field").hide(),D.find(".js-select").prop("disabled",!1),D.find(".quantity-input").prop("disabled",!0)):(D.find(".quantity-dropdown").hide(),D.find(".quantity-text-field").show(),D.find(".update-quantity-link").hide(),D.find(".js-select").prop("disabled",!0),D.find(".quantity-input").prop("disabled",!1));D.find(".quantity-input").val(a);D.find('input[name^\x3d"previousQuantity."]').val(a)}function A(a){var b;if(e.isHeadersCleaned()){if(a=c.jsonify(a))b=a.showAddonWarning}else b=
a.getResponseHeader("x-amz-checkout-show-addon-warning");return null!==b&&b!==F?!0:!1}function y(a,b){e.isHeadersCleaned()?(b=a.showAddonWarning,a=a.asins):b=b.getResponseHeader("x-amz-checkout-show-addon-warning");z(".item-list").hide();a.trim().split(",").forEach(function(a){z('[data-asin\x3d"'+a+'"]').show()});a=z("#addon-warning-"+b+"-launcher");a.length&&0<a.length&&(z(".reduce-title").show(),z(".delete-title").hide(),z(".select-address-title").hide(),z("input[name\x3duseLiveAUI]").length?g.get(a).attrs({$trigger:w}).show():
(b=z.Event("keyup",{triggerPositioningElement:w,manualTrigger:!0}),a.trigger(b)))}var z=a.$,d,u,D,w;a.declarative("itemselect-get-quantity",["click","touchend"],function(a){f.protectAgainstDoubleAction("itemselect-get-quantity",200)||a.$currentTarget.find("select").length&&(u=a.$currentTarget.find("select").val())});a.declarative("itemselect-update-quantity",["change"],v);a.declarative("itemselect-update-pantry-quantity",["change"],v);a.declarative("addon-delete-items",["click","touchend"],function(a){if(w!==
F&&!f.protectAgainstDoubleAction("itemselect-delete-addons",200)){z(".a-button-close").trigger("click");k.show();a=D.find('input[name^\x3d"lineItemEntityID."]').val();var b=(new Date).getTime(),c=z("#useCase").val(),e=h.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});z.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dupdate-quantity\x26cachebuster\x3d"+b,data:{lineitems:a,quantities:d,isTrial:0,deleteAddons:1,returnHTML:1,useCase:c},headers:e,error:h.ajaxRedirect,
success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-redirect-to-cart");null!==d&&d!==F?q.location=d:(d=c.getResponseHeader("x-amz-checkout-fatal-error"),null!==d&&d!==F?q.location=d:(h.ajaxUpdatePage(a,b,c),f.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select")))}})}});a.declarative("itemselect-sanitize-input",["keydown"],function(a){f.limitInputToNumbers(a)});a.declarative("itemselect-update-quantity-text-field",["click","touchend"],v);a.declarative("itemselect-update-pantry-quantity-text-field",
["click","touchend"],v);a.declarative("itemselect-show-update-button",["change","keyup"],n);a.declarative("itemselect-show-update-pantry-button",["change","keyup"],n);a.on("checkout:reload:itemselect",p);a.on("checkout:reload:spp-itemselect",p)});"use strict";r.when("A","page-transition-controller","page-conductor","checkout-general-utils","client-side-metrics").register("itemselect-ship-to-multiple-controller",function(a,k,h,b,f){var g=a.$;a.declarative("itemselect-ship-to-multiple",["click","touchend"],
function(a){a.$event.preventDefault();f.resetMetrics();if(!b.protectAgainstDoubleAction("itemselect-ship-to-multiple",200)){k.show();var e=null,c=null,p=null;a.$currentTarget.closest(".item-row").find(".lineitem").each(function(a,b){a=g(b);b=a.find('select[name^\x3d"quantity."]');var f=a.find('input[type\x3d"number"]');if(a.find(".quantity-dropdown").is(":visible")&&1<b.val())return e=a.find('input[name^\x3d"lineItemEntityID."]').val(),c=b.val(),p=a.find(".js-address-dropdown").val(),!1;if(a.find(".quantity-text-field").is(":visible")&&
1<f.val())return e=a.find('input[name^\x3d"lineItemEntityID."]').val(),c=f.val(),p=a.find(".js-address-dropdown").val(),!1});if(null!==e){a=(new Date).getTime();var l=h.setAjaxTransitionHeader({"x-amz-checkout-page":"itemselect"});g.ajax({type:"POST",url:"/gp/buy/itemselect/handlers/continue.html/?action\x3dship-to-multiple\x26cachebuster\x3d"+a,data:{lineitem:e,quantity:c,address:p},headers:l,dataType:"text",error:h.ajaxRedirect,success:function(a,c,e){var f=e.getResponseHeader("x-amz-checkout-fatal-error");
null!==f&&f!==F?q.location=f:(h.ajaxUpdatePage(a,c,e),b.nukeDropdowns(".js-address-dropdown, .quantity-dropdown-select"))}})}}})});"use strict";r.when("A").register("safe-apx-helper",function(a){var k={},h=a.$;return{get:function(a){return k[a]},set:function(){1===arguments.length?k=h.extend(k,arguments[0]):2===arguments.length?k[arguments[0]]=arguments[1]:q.console&&q.console.error&&q.console.error("Unexpected number of arguments: %d. Expected 1 or 2.",arguments.length)}}});"use strict";r.when("A",
"weblab-helper").register("mobile-carrier-billing-util",function(a,k){var h=!1;return{determineIsMCBEnabled:function(a){h=0<a.paymentRows.find('input[type\x3d"radio"][name\x3dpaymentMethod]').filter("[value^\x3dMCB]").size()},toggleGCForMCB:function(a,f){if(!k.isMCBMultiTenderWeblabEnabled()&&h&&(a=a.find('input[type\x3d"radio"][name\x3dpaymentMethod]'),a.length)){var g=f.paymentRows.find('input[type\x3d"checkbox"][name\x3duseAvailableBalance]'),g=f.existingBalance||g,m=0<f.paymentRows.find('input[type\x3d"hidden"][name\x3d"gcBalance"]').length,
e="paymentsForm"in f&&0<f.paymentsForm.find('input[type\x3d"hidden"][name\x3d"gcBalance"]').length,m=m||e;0<a.filter("[value^\x3dMCB]").size()&&m?(g.length&&(g.prop("checked",!1),g.prop("disabled",!0)),f.mcbBalanceWarning&&f.mcbBalanceWarning.show()):(g.length&&g.prop("disabled",!1),f.mcbBalanceWarning&&f.mcbBalanceWarning.hide())}},showMCBWarningMessageForPoints:function(a){h&&a.mcbPointsWarning&&a.mcbPointsWarning.show()},hideMCBWarningMessageForPoints:function(a){h&&a.mcbPointsWarning&&a.mcbPointsWarning.hide()}}});
"use strict";r.when("A").register("emi-utils",function(a){return{}});"use strict";r.when("A").register("emi-helper",function(a){return{}});"use strict";r.when().register("instant-bank-discount-helper",function(){return{showInstantBankDiscountAmazonPayDeselected:function(){},showInstantBankDiscountAmazonPaySelected:function(){}}});"use strict";r.when("A","page-detector","checkout-general-utils").register("pay-common-lib",function(a,k,h){function b(a,b){b.attr("name")&&(a[b.attr("name")]=b.val());b.attr("id")&&
(a[b.attr("id")]=b.val())}function f(a,b){if(!b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function g(a,b,c){m.each(b,function(b,e){a[b]=c?c.find(e):m(e)})}var m=a.$,e="checkbox hidden password radio text number tel month".split(" "),c={};a.declarative("move-to-next-field",["keypress"],function(a){13===a.$event.charCode&&(h.moveToNextInput(a.$declarativeParent),a.$event.preventDefault())});a.declarative("scroll-to-input",["keypress"],function(a){13===a.$event.charCode&&(m(q).scrollTop(a.$declarativeParent.offset().top),
a.$event.preventDefault())});return{getAttributeData:function(a,b){if(a)return a.attr(b)||a.attr("data-"+b)||a.data(b)},getElements:function(a,b){var c={};g(c,a,b);return c},getInputValues:function(a){var c=a.find(".data-row").data()||{};a.find("input").each(function(){var a=m(this),f=a.attr("type");("radio"!==f&&"checkbox"!==f||a.is(":checked"))&&-1<m.inArray(f,e)&&b(c,a)});a.find("select").each(function(){b(c,m(this))});return c},isDesktopCX:k.isDesktopPayment,isMobileCX:k.isMobilePayment,isPayPage:k.isPayment,
isTouchCX:k.isTabletPayment,mergeFrom:function(a,b){b=f({},b);return f(b,a)},prop:function(a,b,e){if(a){if(1<arguments.length)return b===F?delete c[a]:c[a]={isOneTime:e?1:0,value:b},b;var f=c[a];if(f)return f.isOneTime&&delete c[a],f.value}},refreshElements:g,scrollTopTo:function(a){a&&a.length&&m("html,body").animate({scrollTop:a.offset().top-20},"fast")},selectDefaultPaymentMethodIfNotSelected:function(){var a=m("#existing-payment-methods .payment-row").find('input[type\x3d"radio"][name\x3d"paymentMethod"]'),
b=a.closest("div.payment-selected");b&&0<b.length||(a=a.closest("div.default-payment-marker"))&&a.length&&(a.addClass("payment-selected"),a.find("[name\x3dpaymentMethod]").attr("checked",!0))},processSubmissionParameters:function(a){for(var b={},c=0;c<a.length;c++)b[a[c].name]=a[c].value;return b}}});"use strict";r.when("A","pay-common-lib","a-popover-base","ajax-utility","loading-spinner-controller","page-conductor","page-transition-controller").register("pay-desktop-util",function(a,k,h,b,f,g,m){function e(a){a.$event.preventDefault();
a.$target.closest(".a-popover").hide();a.$target.siblings("span.error-message").hide()}function c(a){a.preventDefault();var b=u(a.currentTarget),c=b.closest("div.expando-section");a=c.find("div.expando-content");var c=c.find("div.expando-reverse-content"),d=a.is(":visible"),e=function(){var a=b.find("i");a.hasClass("a-icon-collapse")||a.hasClass("a-icon-expand")?d?(a.removeClass("a-icon-collapse").addClass("a-icon-expand"),b.find("div.expando-toggle-text-show").show(),b.find("div.expando-toggle-text-hide").hide()):
(a.removeClass("a-icon-expand").addClass("a-icon-collapse"),b.find("div.expando-toggle-text-show").hide(),b.find("div.expando-toggle-text-hide").show()):d?(a.removeClass("a-icon-section-collapse").addClass("a-icon-section-expand"),b.find("div.expando-toggle-text-show").show(),b.find("div.expando-toggle-text-hide").hide()):(a.removeClass("a-icon-section-expand").addClass("a-icon-section-collapse"),b.find("div.expando-toggle-text-show").hide(),b.find("div.expando-toggle-text-hide").show())};d?(c.slideDown("fast"),
a.slideUp("fast",e)):(c.slideUp("fast"),a.slideDown("fast",e))}function p(a){var b=a.$target.closest("a");a=b.closest("div.extender-section");b=b.find("i");b.hasClass("a-icon-extender-expand")?(a.find(".collapsed").hide(),a.find(".expanded").slideDown("fast"),b.removeClass("a-icon-extender-expand").addClass("a-icon-extender-collapse")):(a.find(".collapsed").show(),a.find(".expanded").slideUp("fast"),b.removeClass("a-icon-extender-collapse").addClass("a-icon-extender-expand"))}function l(a){L.msgPopovers.filter(":visible").hide();
a.$event.preventDefault();a.$event.stopPropagation();a=a.$target.parent().find(".a-popover");a.is(":visible")||a.show()}function n(a,b,c){var d=a||{},e="string"===typeof a;c=c&&c.useSif?u('input[type\x3d"hidden"][name\x3d"isAmazonApp"]').val():0;e?(d+="\x26ajaxResponse\x3d1\x26returnjson\x3d1",c&&(d+="\x26isAmazonApp\x3d1")):(d.ajaxResponse=1,d.returnjson=1,c&&(d.isAmazonApp=1));for(c=0;c<B.length;c++){var f=B[c],l=u("input[name\x3d"+f+"]").val();e?-1===b.search(f)&&-1===a.search(f)&&(d=d+"\x26"+
f+"\x3d"+l):d[f]=l}return d}function v(a,b){if(0>a)return 0;isNaN(b)||(a=Number(a).toFixed(b));a=a.toString();b=0<=a.lastIndexOf(".")?a.lastIndexOf("."):a.length;return 3>=b?a:v(a.substring(0,b-3),0)+","+a.substring(b-3)}function t(a,b,c,d){a="timeout"===b?"pay-ajax-timeout":"abort"===b?"pay-ajax-abort":"abort-for-cleanup"===b?"pay-ajax-abort-for-cleanup":"parsererror"===b?"pay-ajax-parsererror":500===a.status?"pay-ajax-500":"pay-ajax-error";if(c){a=c=-1===c.lastIndexOf(".html?")?c+("?ref\x3d"+a):
c+("\x26ref\x3d"+a);L.pageContainer.find("#tempForm").remove();c=u('\x3cform id\x3d"#tempForm" method\x3d"post"\x3e\x3c/form\x3e');c.attr("action",a);if("string"===typeof d){a={};b=d.split("\x26");for(var e=0;e<b.length;e++){var f=b[e].split("\x3d");2===f.length&&(a[f[0]]=f[1])}}else a=d;for(var l in a)"ajaxResponse"!==l&&"returnjson"!==l&&(a=u('\x3cinput type\x3d"hidden"/\x3e').attr("name",l).val(d[l]),c.append(a));L.pageContainer.append(c);c.submit()}}function A(a,c,d,e){var f=g.setAjaxTransitionHeader({"x-amz-checkout-page":"payselect"}),
f={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:n(c,a,e),dataType:"text",headers:f,timeout:w,type:"POST",url:a,beforeSend:function(a,b){d&&d.beforeHandler&&d.beforeHandler(a,b)},complete:function(a,b){d&&d.completeHandler&&d.completeHandler(a,b)},error:function(b,e){d&&d.errorHandler?d.errorHandler(b,e):t(b,e,a,c)},success:function(a,c,e){var f=e.getResponseHeader("x-amz-checkout-page");if("payselect"!==f&&"spp-payment"!==f)return a=b.jsonify(a),g.redirect(a);d&&d.successHandler?
d.successHandler(a,c,e):g.ajaxUpdatePage(a,c,e)}};u.extend(f,e);q.push(u.ajax(f))}function y(a,b,c,d){var e=g.setAjaxTransitionHeader({"x-amz-checkout-page":"payselect"}),e={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:n(b,a,d),dataType:"text",headers:e,timeout:w,type:"POST",url:a,error:function(d,e){c&&c.errorHandler?c.errorHandler(d,e):t(d,e,a,b)},success:function(a,b,d){var e=d.getResponseHeader("x-amz-checkout-page");"payselect"!==e&&"spp-payment"!==e&&c&&c.pageUpdater?
c.pageUpdater(a):g.ajaxUpdatePage(a,b,d)}};u.extend(e,d);q.push(u.ajax(e))}function z(){w=parseInt(u("input[type\x3d'hidden'][name\x3d'paypageTimeoutValue']").val(),10);w=isNaN(w)?1E4:w;k.isMobileCX()?D&&(D=!1):(L=k.getElements(r),D&&(a.declarative("close-popover",["click"],e),a.declarative("toggle-msg-popover",["click"],l),a.declarative("a-extender-toggle",["click"],p),D=!1),L.pageContainer.undelegate(".expando-link","click").delegate(".expando-link","click",c),L.pageContainer.find("form select.a-touch-select-input").unbind("change",
d).bind("change",d),u(".a-dropdown-container").each(function(){h.remove(u(this).find("select").attr("name"))}),u(document).bind("click",function(a){a.isPropagationStopped()||0===u(a.target).closest(".pay-popover-msg").length&&L.msgPopovers.filter(":visible").hide()}))}function d(a){var b=u(a.currentTarget);a=b.siblings("a.a-placeholder");b=b.find(":selected").text();a.html(b);return!1}var u=a.$,D=!0,w,q=[],B=["forceResponsive","fromAnywhere","hasWorkingJavascript"],L={},r={msgPopovers:"div.pay-popover-msg",
pageContainer:"div.a-container"};a.on("checkout:reload:payselect",z);a.on("checkout:reload:spp-payment",z);return k.mergeFrom({decodeJSONResponse:function(a){var b=new RegExp(String.fromCharCode(65340),"g"),c=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))},elements:L,getNumberWithSeparators:v,handleForm:function(a,b,c){a.$event.preventDefault();
var d=a.$declarativeParent;d.is("span")&&(d=d.find("form"));d=d.serializeArray();d=k.processSubmissionParameters(d);A(a.data.action,d,b,c)},makeAjaxCall:A,handleAjaxError:t,handlePaymentsPortalForm:function(a,b,c,d){a=k.processSubmissionParameters(a.submissionParameters);A(b,a,c,d)},handlePaymentsPortalRedeemClaimCodeTransition:function(a,b,c,d){a=k.processSubmissionParameters(a.submissionParameters);a.embedOnlyData=1;y(b,a,c,d)}},k)});"use strict";r.when("A","pay-common-lib","page-transition-controller").register("pay-mobile-util",
function(a,k,h){function b(a,b,c){a=a||{};var d=A.fromAnywhereField.val(),e=c&&c.useSif?n('input[type\x3d"hidden"][name\x3d"isAmazonApp"]').val():0,f=m();"string"===typeof a?(a=a+"\x26ajaxResponse\x3d1\x26currentPage\x3d"+f,-1===b.search("fromAnywhere")&&-1===a.search("fromAnywhere")&&(a=a+"\x26fromAnywhere\x3d"+d),e&&(a+="\x26isAmazonApp\x3d1")):(a.ajaxResponse=1,a.currentPage=f,-1===b.search("fromAnywhere")&&(a.fromAnywhere=d),e&&(a.isAmazonApp=1),c&&c.isAddCardAndContinueEnabled&&(a.isHideSpinnerDisabled=
!0));return a}function f(){v&&v.abort("abort-for-cleanup");v=null}function g(a,b,c,d){a=a&&a.status;b="timeout"===b?"pay-ajax-timeout":"abort"===b?"pay-ajax-abort":"abort-for-cleanup"===b?"pay-ajax-abort-for-cleanup":"parsererror"===b?"pay-ajax-parsererror":500===a?"pay-ajax-500":"unknown"===a?"pay-unknown-page":"pay-ajax-error";c&&(c=-1===c.lastIndexOf(".html?")?c+("?ref\x3d"+b):c+("\x26ref\x3d"+b),p(c,d))}function m(){var a;n.each(t,function(b,c){if(c.pageId&&n(c.pageId).is(":visible"))return a=
b,!1});return a}function e(a){(a=t[a]&&t[a].componentId)&&r.when(a).execute(function(a){a.init&&a.init()})}function c(a,c,f,l,p){p&&p.suppressSpinner||h.show();p={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:b(c,a,l),dataType:"text",timeout:d,type:"POST",url:a,beforeSend:function(a,b){f&&f.beforeHandler&&f.beforeHandler(a,b)},complete:function(a,b){f&&f.completeHandler&&f.completeHandler(a,b);c&&c.isHideSpinnerDisabled||h.hide()},error:function(b,d){f&&f.errorHandler?f.errorHandler(b,
d):g(b,d,a,c)},success:function(b,d,l){var h=l.getResponseHeader("x-amz-checkout-pay-page-name");if(h){var p=l.getResponseHeader("x-amz-checkout-pay-page-title");p&&A.pageTitle.text(decodeURIComponent(p));f&&f.successHandler?f.successHandler(b,d,l):A.pageContainer.html(b);e(h)}else g(null,"unknown",a,c)}};n.extend(p,l);v=n.ajax(p)}function p(a,b,c){var d=n("#tempForm",A.pageContainer);0<d.length&&d.remove();d=n('\x3cform method\x3d"post"\x3e\x3c/form\x3e');d.attr("action",a);c&&c.target&&d.attr("target",
c.target);if("string"===typeof b)for(a=b.split("\x26"),b=0;b<a.length;b++)c=a[b].split("\x3d"),2===c.length&&"ajaxResponse"!==c[0]&&(c=n('\x3cinput type\x3d"hidden"/\x3e').attr("name",c[0]).val(c[1]),d.append(c));else for(var e in b)"ajaxResponse"!==e&&d.append(n('\x3cinput type\x3d"hidden"/\x3e').attr("name",e).val(b[e]));A.pageContainer.append(d);d.submit()}function l(a,c,f,l,p){p&&p.suppressSpinner||h.show();p={contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",data:b(c,a,l),dataType:"text",
timeout:d,type:"POST",url:a,complete:function(a,b){f&&f.completeHandler&&f.completeHandler(a,b);h.hide()},error:function(b,d){f&&f.errorHandler?f.errorHandler(b,d):g(b,d,a,c)},success:function(a,b,c){var d=c.getResponseHeader("x-amz-checkout-pay-page-name");if(!d&&f&&f.pageUpdater)f.pageUpdater(a);else{var l=c.getResponseHeader("x-amz-checkout-pay-page-title");l&&A.pageTitle.text(decodeURIComponent(l));f&&f.successHandler?f.successHandler(a,b,c):A.pageContainer.html(a);e(d)}}};n.extend(p,l);v=n.ajax(p)}
var n=a.$,v=null,t={main:{componentId:"page-main",pageId:"#select-payments-view"},"credit-card-rewards":{componentId:"page-rewards",pageId:"#select-payment-rewards-view"},"financial-offer":{componentId:"page-financial-offer",pageId:"#select-payment-financial-offer-view"},"new-payment-methods":{pageId:"#new-payments-view"},"gil-estimates":{pageId:"#gil-estimates-subpage"}},A={},y={cvvHelper:"div#cvv-help-popover",fromAnywhereField:"input[name\x3dfromAnywhere]",jppoints:"div#jppoints",pageContainer:"div#page-container",
pageTitle:"head title"},z=!0,d;return k.mergeFrom({decodeJSonResponse:function(a){var b=new RegExp(String.fromCharCode(65340),"g"),c=new RegExp(String.fromCharCode(92,92,92,92),"g");a=a.replace(b,String.fromCharCode(92),"g");a=a.replace(c,String.fromCharCode(92));a=a.replace(/\\1/g,String.fromCharCode(34));return a=a.replace(/\\2/g,String.fromCharCode(10))},elements:A,getCurrentPage:function(){return A.pageContainer.children("div.page").filter(":visible")},getCurrentPageName:m,getPageId:function(a){a=
a.getResponseHeader("x-amz-checkout-pay-page-name");return t[a]&&t[a].pageId},handleForm:function(a,b,d){a.$event.preventDefault();c(a.data.action,a.$target.serialize(),{successHandler:function(a,c,d){b(a,c,d)}},d)},submitFormRequest:p,init:function(){k.isMobileCX()&&(q.onbeforeunload=f,k.refreshElements(A,y),d=parseInt(n("input[type\x3d'hidden'][name\x3d'paypageTimeoutValue']").val(),10),d=isNaN(d)?1E4:d,z&&(z=!1,n("div.pay-mobile").bind("keypress",function(a){k.prop("activeGoElement",13===a.keyCode?
document.activeElement:null,!0)})))},makeAjaxCall:c,handleAjaxError:g,pages:t,handlePaymentsPortalForm:function(a,b,d,e){a=k.processSubmissionParameters(a.submissionParameters);c(b,a,d,e)},handlePaymentsPortalRedeemClaimCodeTransition:function(a,b,c,d){a=k.processSubmissionParameters(a.submissionParameters);a.embedOnlyData=1;l(b,a,c,d)}},k)});"use strict";r.when("page-detector","pay-desktop-util","pay-mobile-util").register("pay-common-util",function(a,k,h){return a.isMobile()?h:k});"use strict";
r.when("A","pay-common-util","pay-rewards-currency","checkout-federation-wrapper","safe-apx-helper","weblab-helper").register("pay-validator",function(a,k,h,b,f,g){function m(){function a(b,c,d,e){Z.push({identifier:b,priority:d||100,target:c,isPincodeError:e})}function n(a){if(!a)return null;var b=new RegExp(String.fromCharCode(32),"g"),c=new RegExp(String.fromCharCode(45),"g");return a.replace(b,"").replace(c,"")}function m(){return 0<Z.length}function t(a){if(!a||0===a.length)return!1;for(var b=
0,c=!1,d=a.length-1;0<=d;--d){var e=a.charAt(d);c&&(e*=2,9<e&&(e-=9));b+=parseInt(e,10);c=!c}return 0===b%10}function A(a,b){return a&&a.match(/^[0-9]+$/)&&a.length===b}function y(a,b,c){return a&&a.match(/^[0-9A-Za-z]+$/)&&a.length>=b&&a.length<=c}function z(a,b){if(!a||!b)return!1;a=parseInt(a,10);b=parseInt(b,10);return d(a,b)}function d(a,b){var c=new Date,d=c.getFullYear();return b>d||b===d&&a>=c.getMonth()+1}function u(a){a=a.val();return!a||0===a.length}function q(){var b=e("#pm_pay_by_check").is(":checked"),
c=e("#existing-balance [paymentmethodid\x3d'availablebalance'] input").is(":checked");b&&c&&a("continue_BadCombinationCheckExistingBalance")}function w(b){if(e("#jppoints").length){var c,d=!1;1===b.length&&"jppoints"===b.attr("id")?(c=b,d=!0):c=b.filter("#jppoints");if(c&&c.find("#redeemPoints").is(":checked")){b=c.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val();b=parseInt(b,10);e('input[type\x3d"checkbox"][name\x3d"useAvailableBalance"]').is(":checked")&&(b-=parseInt(c.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]').val(),
10));var f=parseInt(c.find("#redeemableAmount").text(),10),g=c.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]');c.find("#jpPointsMax").is(":checked")?c=f:(c=parseInt(g.val(),10))||(c=0);c>f?a("continue_jpPointsExceedsRedeemableAmount",g):d&&c<b?a("continue_notEnoughJPPoints"):c>b&&a("continue_jpPointsExceedsTotalPurchase")}}}function H(b){b&&(b=b.find(".pci-blocking-cvv"),b.length&&b.is(":visible")&&a("PCI_Block_CVV"))}function B(b){var c=b.find(".currency-list");c.length&&c.is(":visible")&&
(b=c.find("[type\x3dradio]:checked").val(),c=c.find("#cardCurrencyDropDown option:selected").val(),b&&("Other"!==b||"-1"!==c&&"-2"!==c)||a("continue_SelectCardCurrency"))}function L(b){var d=b.find("#existingCvvNum");if(0!==d.length){var e=d.val();b=c?b.data("validcvvlength"):b.attr("validcvvlength");A(e,parseInt(b,10))||a("continue_BadSecurityCode",d)}}function X(b){var c=b.find('input[name\x3d"paymentMethod"]').val();/^creditCard/.test(c)&&b.find("#savedCardSuppressed").length&&a("continue_BankTemporarilyNotAvailable")}
function R(b){b=b.find("#existingPincodeNum");if(0!==b.length){var c=b.val();c?y(c,4,8)||a("existingCreditCard_PincodeInvalid",b,null,!k.isMobileCX()):a("continue_EmptyPincode",b)}}function G(b){if(b&&b.length)for(var c=0;c<b.length;c++){var d=e(b[c]);H(d.parent());L(d);R(d);"netBanking"===d.find('input[name\x3d"paymentMethod"]').val()&&(e("#netBanking_select").val(),e("#net-banking-list").find("option:selected").data("isdisabled")&&a("continue_BankTemporarilyNotAvailable"));X(d);var f=d;f.find('input[name\x3d"paymentMethod"]').val();
f.find("#vdcBanksSelect").val();e("#vdcBanksSelect").find("option:selected").data("isdisabled")&&a("continue_BankTemporarilyNotAvailable");Y(d);d=d.siblings("#upi-acceptance-input").find("#vpaCollect");if(!d||d.length)(f=d.val())&&f.match(/.+@.+/)||a("continue_BadVpaForUpi",d)}}function K(b){var c=b.find("#newMonth"),e=b.find("#newYear");b=b.find("#newExpDate");!(c=c.length&&!z(c.val(),e.val()))&&(c=b.length)&&((b=b.val())?(c=b.split("-"),b=parseInt(c[0],10),c=parseInt(c[1],10),b=d(c,b)):b=!1,c=!b);
c&&a("continue_BadExpiration")}function V(b){"domesticCards"===b.find('input[name\x3d"paymentMethod"]').val()&&((b=b.find("select").val())&&b.match(/^[0-9]*$/)||a("continue_BlankSlate"))}function aa(b){var c=e("#existing-balance input[name\x3duseFlexiblePayments]").is(":checked");b=k.getAttributeData(b,"paymentmethodtype");c&&"creditCard"!==b&&a("continue_FlexiblePaymentsNeedsCreditCard")}function x(b){"thirdPartyAccounts"===b.find('input[name\x3d"paymentMethod"]').val()&&((b=b.find("select").val())&&
0!==b.length||a("continue_BlankSlate"))}function P(b){var c=b.find(".rewards-list");if(c.length&&c.find('input[type\x3d"radio"][value\x3d"rewardscustom"]').is(":checked")){b=c.find("input.custom-rewards-input");var d=b.val();if(c.hasClass("show-currency-input-widget-new")){var c=b.data("country-code"),e=h.getCurrencyFormatByCountryCode(c),c=b.data("min"),d=h.getAmount(d,e.decimalPlace);d<c&&a("continue_BadRewardsMin")}else/^\s*$/.test(d)||isNaN(d)?a("continue_BadRewardsValue"):(d=parseFloat(b.val()),
c=b.data("min"),0>=d||d<c?a("continue_BadRewardsMin"):d>b.data().max&&a("continue_BadRewardsMax"))}}function T(b){var c=b.find('input[name\x3d"paymentMethod"]').val();"verifiedCreditCard"===c?a("continue_BlankSlate"):"verifiedDebitCard"===c&&(c=b.find("#vdcBanksSelect").val(),(""===c||"OtherBanks"===c||"1"===e("#save_citi_card").val()&&"CIT"===c)&&a("continue_BlankSlate"),b.find("option:selected").prop("disabled")&&a("continue_BankTemporarilyNotAvailable"))}function U(b){"cashOnDeliveryCash"===b.find('input[name\x3d"paymentMethod"]').val()&&
b.find(".phonenumberNotVerified").length&&a("continue_OTPforCOD")}function ba(b){if("netBanking"===b.find('input[name\x3d"paymentMethod"]').val()){var c=b.find("#net-banking-select-list").val();b=b.find("option:selected").prop("disabled");""===c&&a("continue_BlankSlate");b&&a("continue_BankTemporarilyNotAvailable")}}function ga(b){"morePaymentMethod"===b.find('input[name\x3d"paymentMethod"]').val()&&""===b.find("#more-payment-methods-select-list").val()&&a("continue_BlankSlate")}function Y(b){var c=
b.find('input[name\x3d"paymentMethod"]').val();if("StandaloneInstallment"===c||"StandaloneCreditCardInstallment"===c||"StandaloneReusableCreditLineInstallment"===c)b.find('input[name\x3d"gilShowContinueBlocker"]').val()&&("StandaloneCreditCardInstallment"===c?a("continue_GilCCContinueError"):"StandaloneReusableCreditLineInstallment"===c?a("continue_GilRCLContinueError"):a("continue_GilContinueError")),b.find('input[name\x3d"showIneligibleItemSubpage"]').val()&&("StandaloneCreditCardInstallment"===
c?a("continue_GilCCContinueErrorIneligibleItems"):"StandaloneReusableCreditLineInstallment"===c?a("continue_GilRCLContinueErrorIneligibleItems"):a("continue_GilContinueErrorIneligibleItems")),b.find('input[name\x3d"gilShowContinueBlockerIfPromotions"]').val()&&0<e("#existing-balance input[name\x3duseAvailableBalance]:checked").length&&("StandaloneCreditCardInstallment"===c?a("continue_GilCCContinueErrorPromotions"):"StandaloneReusableCreditLineInstallment"===c?a("continue_GilRCLContinueErrorPromotions"):
a("continue_GilContinueErrorPromotions"))}var Z=[],ca=null,C=null,W=function(a){p=a};p||(k.isMobileCX()?r.when("rewards-section-mobile").execute(W):r.when("rewards-section-desktop").execute(W));return{displayErrors:function(a,b){(ca=a)&&ca.hide().find(".error-message").hide().addClass("hidden");(C=b)&&C.find(".a-form-error").removeClass("a-form-error");if(m()){for(a=0;a<Z.length;a++){b=Z[a];if(b.target){var c=b.target.parent();c.hasClass("a-input-text-wrapper")&&!c.hasClass("a-form-error")?c.addClass("a-form-error"):
b.target.hasClass("a-form-error")||b.target.addClass("a-form-error")}b=b.identifier;(ca&&ca.length?ca.find("#"+b):e("#"+b)).show().removeClass("hidden")}ca&&ca.length&&ca.show()}},getHighestErrorId:function(){for(var a={priority:100},b=0;b<Z.length;b++){var c=Z[b],d;(d=c.identifier)?(d=ca&&ca.length?ca.find("#"+d):e("#"+d),d=parseInt(k.getAttributeData(d,"priority"),10),d=isNaN(d)?100:d):d=100;d<=a.priority&&(a={identifier:c.identifier,priority:d,isPincodeError:c.isPincodeError,target:c.target})}return a},
hasErrors:m,isValidCardCVV:A,isValidCardPincode:y,validateBankAccountNum:function(b,c){u(b)&&a("addBankAccount_NoAccountNumber",c)},validateBankAccountNumConfirm:function(b,c,d){b.val()!==c.val()&&a("addBankAccount_AccountNumberMismatch",d)},validateBankDriverLicense:function(b,c){u(b)&&a("addBankAccount_NoDLNumber",c)},validateBankDriverLicenseState:function(b,c){b.val()!==F&&""!==b.val()&&"0"!==b.val()||a("addBankAccount_NoDLState",c)},validateBankHolderName:function(b,c){u(b)&&a("addBankAccount_NoName",
c)},validateBankRoutingNum:function(b,c){9!==b.val().length&&a("addBankAccount_ShortRoutingNumber",c)},validateCreditCardCVV2:function(b,c,d){d="true"===b.attr("isaddresschallenge")?b.attr("issuer"):d&&d.charAt(0);"R"!==d&&(b=b.val(),A(b,"A"===d?4:3)||a("addCreditCard_BadSecurityCode",c))},validateCreditCardDate:function(b,c,d,e){z(b.val(),d.val())||(a("addCreditCard_BadExpiration",c),a("addCreditCard_BadExpiration",e))},validateCreditCardMobile:function(b,c){b=b.val();g.isUpdateMobileNumberEnabled()?
b&&b.replace(/[^0-9]/g,"").match(/^1[0-9]{10}$/)||a("addCreditCard_BadMobileNumber",c):b&&b.replace(/[^0-9]/g,"").match(/^1[34578]{1}[0-9]{9}$/)||a("addCreditCard_BadMobileNumber",c)},validateCreditCardPincode:function(b,c){(b=b.val())&&b.match(/^[a-zA-Z0-9]{4,8}$/)||a("addCreditCard_BadPincode",c)},validateCreditCardName:function(b,c){u(b)&&a("addCreditCard_NoName",c)},validateCreditCardNumber:function(b,c){var d=n(b.val());d&&10<d.length&&t(d)||a("addCreditCard_BadNumber",c);d=e("#creditCardIssuersBlocked").val();
b=b.data("issuer");d&&""!==d&&b&&""!==b&&-1<e.inArray(b,d.split(","))&&a("addCreditCard_IssuerUnsupported",c)},validateSBIMaestroCardNumberLength:function(b,c){19!==n(b.val()).length&&a("addCreditCard_SBIMaestro_BadNumberLength",c)},isAMEXCreditCard:function(a){a=n(a.val());return null!==a?0===a.indexOf("37")||0===a.indexOf("34"):!1},validateCreditCardTail:function(b,d){var e=n(b.val());e&&10<e.length&&t(e)?(b=(k.isMobileCX()&&c?b.parent().data():b.data()).tail+"",e.substr(e.length-b.length)!==b&&
a("addCreditCard_NotMatch",d)):a("addCreditCard_NotMatch",d)},validateCreditCardType:function(b,c){b.is(":visible")&&((b=b.val())&&b.match(/^[A-Z][0-9]*$/)||a("addCreditCard_NoType",c))},validateRegistrationResult:function(b){b.cardStatus?1===b.checkStatusCount&&a("addCreditCard_RegisterFailed"):0<b.errors.length&&a("addCreditCard_RegisterFailed")},validateDirectDebitAccountName:function(b,c){u(b)&&a("addDirectDebit_NoAccountOwnerName",c)},validateDirectDebitAccountNum:function(b,c){u(b)&&a("addDirectDebit_NoAccountNumber",
c)},validateDirectDebitRoutingNum:function(b,c){u(b)&&a("addDirectDebit_NoRoutingNumber",c)},validateInvoiceFirstName:function(b,c){u(b)&&a("addInvoiceAccount_NoFirstName",c)},validateInvoiceLastName:function(b,c){u(b)&&a("addInvoiceAccount_NoLastName",c)},validateLocName:function(b,c){u(b)&&a("addLoc_NoName",c)},validateLocNumber:function(b,c){u(b)&&a("addLoc_BadNumber",c)},validateNewGiftPromotion:function(b,c){u(b)&&a("addGiftCardOrPromo_NoCode",c)},validatePayment:function(c){if(k.isMobileCX())G(c),
p&&b.wrap(function(){p.validatePaymentRewardsInRewardsSection(a)},"shopwithpointsmobile");else if(q(),c&&c.length){for(var d=0;d<c.length;d++){var f=e(c[d]);"true"===k.getAttributeData(f,"isaddresschallenge")&&a("continue_AddressChallenge");"true"===k.getAttributeData(f,"isverifiedfail")&&a("continue_VerifiedFail");"true"===k.getAttributeData(f,"iscupcardexpired")&&a("continue_CUPExpired");H(f);B(f);L(f);R(f);K(f);V(f);aa(f);x(f);P(f);T(f);ba(f);ga(f);Y(f);U(f);X(f)}p&&b.wrap(function(){p.validatePaymentRewardsInRewardsSection(a)},
"shopwithpoints");w(c)}else a("continue_BlankSlate")},validateGetCreditCardTypeResult:function(b){if(b.errors&&0<b.errors.length)for(var c=0;c<b.errors.length;c++)a(b.errors[c])},validateEMIMenuForContinueButton:function(b){var c=b.find("#emiPaymentMethodsSelectList").find("option:selected").val();if("CreditCard"===c||"SelectOption"===c)a("continue_BlankSlate");else if(c=c.split("."),1<c.length){var d=c[0];if("emiCreditCard"===d||"netbankingEMI"===d)b=b.find("."+c[1]),b=b.find(".emiMenuTenuresDropDown"),
b.length&&!b.find("option:selected").val()&&a("continue_BlankSlate")}},apxValidatePayment:function(a,b){var c=f.get("payselect");c&&c.validatePayments(this,b,a)},addError:a,errors:Z,validatePCICVVBlock:H}}var e=a.$,c=q.P&&q.P.AUI_BUILD_DATE,p=F;return{create:function(){return new m}}});"use strict";r.when("A","ajax-utility","pay-common-util","pay-validator").register("pay-credit-card",function(a,k,h,b){function f(a,b,e,f){a&&a.length&&(b=e+"-"+b,(e=h.prop(b))&&(a=a.find(f).val(e))&&a.length&&(h.isMobileCX()?
a.closest(".card-cvv-field").hide().data("isHidden",1):a.closest(".a-column").hide(),h.prop(b,F)))}var g=a.$,m={cc:!1,vcc:!1,vdc:!1},e=q.P&&q.P.AUI_BUILD_DATE;return{confirmCreditCard:function(a,b,e){a.currentPaymentInstrumentID=a.paymentmethodid;a.recommendedPaymentMethodId=a.paymentmethodid;if(a.newMonth&&a.newYear)a.month=a.newMonth,a.year=a.newYear;else if(a.newExpDate){var f=a.newExpDate.split("-");a.year=parseInt(f[0],10);a.month=parseInt(f[1],10)}else a.expmonth&&a.expyear&&(a.month=a.expmonth,
a.year=a.expyear);(f="existingCvvNum"in a?a.addCreditCardVerificationNumber=a.existingCvvNum:a.addCreditCardVerificationNumber)&&h.prop("cvv-"+a.paymentmethodid,f);(f="existingPincodeNum"in a?a.addCreditCardPincode=a.existingPincodeNum:a.addCreditCardPincode)&&h.prop("pincode-"+a.paymentmethodid,f);h.makeAjaxCall(e,a,{successHandler:b,errorHandler:function(b,e){a.handler="confirm-credit-card";h.handleAjaxError(b,e,"/gp/buy/payselect/handlers/submit.html",a)}},{useSif:!0})},handleCreditCardType:function(a,
e){var f=a.$target,g=a.data.type,v=b.create();a.$currentTarget.data("issuer","");v.validateCreditCardNumber(f,f);v.hasErrors()||(m[g]=!0,h.makeAjaxCall(a.data.url,{addCreditCardNumber:f.val(),returnjson:1},{completeHandler:function(){m[g]=!1},successHandler:function(b){b=k.jsonify(b);e(b,g);a.$currentTarget.data("issuer",b.issuer)}},{useSif:!0},{suppressSpinner:!0}))},isWaitingForType:function(a){return m[a]},runConfirmCardValidator:function(a,e){var f=a.find("#existingCvvNum"),f=f.length?f:a.find("#addCreditCardVerificationNumber"),
g=a.find("#addCreditCardNumber"),h=a.find("#newMonth"),k=a.find("#newYear"),m=b.create();m.validateCreditCardTail(g,g);h.length&&k.length&&m.validateCreditCardDate(h,h.closest(".card-date").find(".a-button"),k,k.closest(".card-date").find(".a-button"));f.length&&(g=(g=a.find("#issuer"))&&g.val(),m.validateCreditCardCVV2(f,f,g));m.displayErrors(e,a);return m.hasErrors()},setDateSelectorStatus:function(a,b){var e=b.find(".card-date").find("select");e&&e.length&&r.when("a-dropdown").execute(function(b){e.each(function(){var e=
g(this).attr("id");b.updateSelect(e,{status:"21"===a.brand&&"G"===a.issuer?"disabled":"enabled"})})})},setNewCardCVVInputStatus:function(a){(h.prop("cvv-newcard")||h.prop("pincode-newcard"))&&a.each(function(){var a=g(this);if("1"===(e?a.data("isnewcard")+"":a.attr("isnewcard")))return f(a,"newcard","cvv","#existingCvvNum"),f(a,"newcard","pincode","#existingPincodeNum"),!1})},setCardPasswordInputStatus:f}});"use strict";r.when("A","ajax-utility","pay-common-util","pay-validator","page-transition-controller",
"page-conductor","pay-credit-card").register("pay-credit-card-reregistration",function(a,k,h,b,f,g,m){function e(a,c){var e=b.create(),f=p("#cupMobileNumber-"+a),g=p("#cupSecurityCode-"+a),h=p("#reRegisterCCErrors-"+a);a=p("#reRegisterCCInputs-"+a);e.validateCreditCardCVV2(g,g,c);e.validateCreditCardMobile(f,f);e.displayErrors(h,a);return e.hasErrors()}function c(a,b,c){g.ajaxUpdatePage(a,b,c)}var p=a.$;return{actionReregisterCardInBox:function(a){a.$event.preventDefault();f.show();var b=a.data.type,
g=p("#cupMobileNumber-"+a.data.paymentMethodID).val(),t=p("#cupSecurityCode-"+a.data.paymentMethodID).val();e(a.data.paymentMethodID,b)?f.hide():(b={isReregistering:a.data.isReregistering,currentPaymentInstrumentID:a.data.paymentMethodID,name:a.data.holderName,year:a.data.expiredYear,month:a.data.expiredMonth,addCreditCardMobileNumber:g,addCreditCardVerificationNumber:t},g={useSif:h.isMobileCX()?!0:!1,success:function(a,b,e){a=k.jsonify(a);b=p("#reRegisterCCErrors-"+a.paymentInstrumentId);m.waitForCreditCardStatus(a,
c,b)}},a.$event.preventDefault(),h.makeAjaxCall(a.data.url,b,null,g))}}});"use strict";r.when("A","client-side-metrics","ajax-utility","pay-common-util","pay-validator","existing-payments","page-conductor","checkout-modal-popover","page-transition-controller","pay-credit-card","pay-gil","new-verified-debit-card","emi-helper").register("new-payments",function(a,k,h,b,f,g,m,e,c,p,l,n,v){function t(a){a.$event.preventDefault();var d=a.data.type;if(p.isWaitingForType(d))c.show(),setTimeout(function(){t(a)},
50);else{var e;e="vdc"===d?Q.newVDC:"emi"===d?Q.newEMI:Q.newVCC;if(ia(e,d))c.hide();else{c.show();var f=b.getInputValues(e),g="vdc"===d?"_VDC":"_VCC";e=f["addCreditCardVerificationNumber"+g];var l=f["addCreditCardPincode"+g],d={addCreditCardNumber:f["addCreditCardNumber"+g],addCreditCardVerificationNumber:e,addCreditCardPincode:l,handler:f["handler"+g],month:f["month"+g],name:f["name"+g],newPaymentType:d,year:f["year"+g],cctype:f["cctype"+g],isSBIInternationalMaestroSelected:f["isSBIInternationalMaestroSelected"+
g],isCardSavedFromEMIMenu:f["isCardSavedFromEMIMenu"+g]};b.prop("cvv-newcard",e);l&&b.prop("pincode-newcard",l);b.makeAjaxCall(a.data.url,d,{successHandler:function(a,b,c){L(a,b,c);p.setNewCardCVVInputStatus(Q.paymentRows)}},{useSif:!0})}}}function A(a){a.$event.preventDefault();var d=a.data.type;if(p.isWaitingForType(d))c.show(),setTimeout(function(){A(a)},50);else{var e=Q.newCCFormContent;if(ia(e,d))c.hide();else{c.show();d=b.getInputValues(e);d.handler=d.handler_addCCInBox;var e=a.data.url,f={};
N("#cupSecurityCode").is(":visible")&&N("#cupMobileNumber").is(":visible")?(e="/gp/buy/payselect/handlers/add-credit-card.html",f={successHandler:function(a){a=h.jsonify(a);R(a)}}):f={successHandler:L};b.makeAjaxCall(e,d,f,{useSif:!0})}}}function y(a){a.$event.preventDefault();var d=N("#new-giftcard-promotion"),d=b.getInputValues(d);N("input[name\x3disUnifiedActionsDesignEnabled]").length&&z(a)||(d.handler=d.handler_addGCInBox,a=a.data.url,c.show(),b.makeAjaxCall(a,d,{successHandler:function(a,c,
d){m.ajaxUpdatePage(a,c,d);oa||b.scrollTopTo(N("#existing-balance"))}},{useSif:!0}))}function z(a){a=a.$declarativeParent;var b=N("#gcpromoinput"),c=f.create();c.validateNewGiftPromotion(b,b);c.displayErrors(Q.newGCErrors,a);return c.hasErrors()}function d(a){var b=N(a.currentTarget).parents("div.new-payment-line").find(".card-date select");if(b&&b.length){var c=N(a.currentTarget).val();r.when("a-dropdown").execute(function(a){b.each(function(){var b=N(this).attr("id");a.updateSelect(b,{status:"G21"===
c?"disabled":"enabled"})})})}}function u(a){var b=Q.newVDC.find(".vdc-form-fields"),c=Q.newVDC.find("#vdc-logo-prompt"),d=Q.newVDC.find(".top-cell");a?b.show():b.hide();a?c.show():c.hide();a?d.addClass():d.removeClass()}function q(a){var b=N(a.currentTarget).val(),c=Q.newVDC.find("#suppressedVerifiedDebitCard").hide(),d=Q.newVDC.find(".vdc-selected-bank-prompt").hide();u(!1);var e="1"===Q.newVDC.find("#isRupayAsSavedCardEnabled").val()&&"URP"===b;"OtherBanks"===b||"1"===N("#save_citi_card").val()&&
"CIT"===b||e?(u(!0),N.isEmptyObject(n)||n.showExpiryDateAndCvv()):"SMP"!==b||N.isEmptyObject(n)?""!==b&&(b=N(a.currentTarget).find("option:selected").prop("disabled"),a=N(a.currentTarget).find("option:selected").text(),b?c.show().find(".suppressed-card-text").html(a):d.show().find(".bank-name-text").html(a)):(u(!0),n.hideExpiryDateAndCvv())}function w(a,b){if(!N.isEmptyObject(v)&&a)return a(b)}function H(a){w(v.removeEMIMenuSelectionAttributes);Q.newEMI.find(".emi-group").hide();a=N(a.currentTarget).find("option:selected").val();
Q.newEMI.find("#emiMenuErrors_VCC").length&&Q.newEMI.find("#emiMenuErrors_VCC").hide();if(a=w(v.showPaymentOptionBlock,a))w(v.addEMIMenuSelectionAttributes),a.show()}function B(a){p.handleCreditCardType(a,la)}function L(a,c,d){m.ajaxUpdatePage(a,c,d);oa||b.scrollTopTo(g.getSelectedPayment())}function X(a){a.$event.preventDefault();var d=a.data.type;p.isWaitingForType(d)?(c.show(),setTimeout(function(){X(a)},50)):ia(a.$declarativeParent,d)?c.hide():(qa&&qa.hide(),ta&&ta.hide(),c.show(),N("#cupSecurityCode").is(":visible")&&
N("#cupMobileNumber").is(":visible")?(d=a.$declarativeParent.serializeArray(),d=b.processSubmissionParameters(d),b.makeAjaxCall("/gp/buy/payselect/handlers/add-credit-card.html",d,{successHandler:function(a){a=h.jsonify(a);R(a)}},{useSif:!0})):b.handleForm(a,{successHandler:L},{useSif:!0}))}function R(a){var d={};d.paymentInstrumentId=a.paymentInstrumentId;a.checkStatusCount&&(d.checkStatusCount=a.checkStatusCount);var e={successHandler:function(a){a=h.jsonify(a);var d=f.create();"VERIFIED"===a.cardStatus?
b.makeAjaxCall("/gp/buy/payselect/handlers/submit.html",{newPaymentMethodId:a.paymentInstrumentId},{successHandler:L}):"PENDING"===a.cardStatus?(a.checkStatusCount?(a.checkStatusCount=parseInt(a.checkStatusCount,10),isNaN(a.checkStatusCount)&&(a.checkStatusCount=1)):a.checkStatusCount=3,d.validateRegistrationResult(a),1===a.checkStatusCount?(c.hide(),d.displayErrors(Q.newCCErrors)):(--a.checkStatusCount,R(a))):(d.validateRegistrationResult(a),c.hide(),d.displayErrors(Q.newCCErrors))}};setTimeout(function(){b.makeAjaxCall("/gp/buy/payselect/handlers/check-credit-card-status.html",
d,e)},2500)}function G(a){a.$event.preventDefault();var d=a.$declarativeParent,e=d.find("#loc-name"),g=d.find("#loc-number"),l=f.create();l.validateLocName(e,e);l.validateLocNumber(g,g);l.displayErrors(d.find("#error-box-new-loc"),d);l.hasErrors()||(xa&&xa.hide(),c.show(),b.handleForm(a,{successHandler:L}))}function K(a){a.$event.preventDefault();var d=a.$declarativeParent,e=d.find("#gcpromoinput");d.find("#gcpromosuccessblock").hide();var g=f.create();g.validateNewGiftPromotion(e,e);g.displayErrors(Q.newGCErrors,
d);g.hasErrors()||(c.show(),b.handleForm(a,{successHandler:function(a,c,d){m.ajaxUpdatePage(a,c,d);oa?Q.newGCErrors.is(":visible")&&N("#gc-link-expander").trigger("click"):b.scrollTopTo(N("#existing-balance"))}}))}function F(a){a.$event.preventDefault();N("#ccAddCard").trigger("submit")}function aa(a){a.$event.preventDefault();N("#bank-address-popover-submit").trigger("submit")}function x(a){a.$event.preventDefault();N("#direct-debit-popover-submit").trigger("submit")}function P(a){a.$event.preventDefault();
N("#new-loc-popover-submit").trigger("submit")}function T(a){a.$event.preventDefault();N("#new-invoice-popover-submit").trigger("submit")}function U(a){a.$event.preventDefault();N("#brdcAddCard").trigger("submit")}function ba(a){a.$event.preventDefault();var d=a.$declarativeParent,e=f.create(),g=d.find("#bank-name"),l=d.find("#bank-routing-number"),h=d.find("#bank-account-number"),p=d.find("#bank-account-number-confirm"),m=d.find("#bank-dl"),n=d.find("#bank-dl-state");e.validateBankHolderName(g,g);
e.validateBankRoutingNum(l,l);e.validateBankAccountNum(h,h);e.validateBankAccountNumConfirm(h,p,p);e.validateBankDriverLicense(m,m);e.validateBankDriverLicenseState(n,n.parents("div.a-button-dropdown"));e.displayErrors(d.find("#new-bank-error-box"),d);e.hasErrors()||(wa&&wa.hide(),c.show(),b.handleForm(a,{successHandler:L}))}function ga(a){a.$event.preventDefault();var d=a.$declarativeParent,e=f.create(),g=d.find("#debit-bank-routing-number"),l=d.find("#debit-account-number"),h=d.find("#debit-account-name");
e.validateDirectDebitRoutingNum(g,g);e.validateDirectDebitAccountNum(l,l);e.validateDirectDebitAccountName(h,h);e.displayErrors(d.find("#new-direct-debit-error"),d);e.hasErrors()||(O&&O.hide(),c.show(),b.handleForm(a,{successHandler:L}))}function Y(a){a.$event.preventDefault();var d=a.$declarativeParent,e=f.create(),g=d.find("#invoice-first-name"),l=d.find("#invoice-last-name");e.validateInvoiceFirstName(g,g);e.validateInvoiceLastName(l,l);e.displayErrors(d.find("#new-invoice-error-box"),d);e.hasErrors()||
(J&&J.hide(),c.show(),b.handleForm(a,{successHandler:L}))}function Z(a){a=N("#order-summary-total");var c=N("#order-summary-container");a.prev().addClass("a-first");c.addClass("a-box-group");a.show();b.isTouchCX()&&c.parent().find(".bottom-order-summary").show();Q.newCCFormContent.is(":visible")||N("#wrapper-new-cc").find("a.a-link-expander").trigger("click");N("#ecard-help-link").show()}function ca(a){var c="Unknown";b.isDesktopCX()?c="Desktop":b.isMobileCX()?c="Mobile":b.isTouchCX()&&(c="Tablet");
k.increaseCount("PayPage-ClientSide-AddCupClick-"+c,1);c=N("#cupForm");if(0<c.length)c.submit();else{var d=N("\x3cform\x3e\x3c/form\x3e");d.attr({target:"_blank",method:"POST",action:a.data.url});N("#cup-dc").find("input").each(function(){var a=N(this);"hidden"===a.attr("type")&&a.clone().appendTo(d)});N("body").append(d);d.submit();d.remove()}}function C(d){var f=d.$target.closest(".a-popover"),g=f.data("a-popover-id");e.hideById(g);f.hide();N("#a-popover-modal").hide();c.show();b.makeAjaxCall(d.data.url,
void 0,{successHandler:function(b){N("#existing-payment-methods").replaceWith(N(b).find("#existing-payment-methods"));a.trigger("checkout:reload:payselect");c.hide()}})}function W(a){a.$event.preventDefault();a=a.data;c.show();l.submitNewGilPayment(a.subtype)}function da(){if(!b.isMobileCX()){0===N("#form-add-credit-card").length&&(N("#ccAddCard").parents("div.cc-submit").hide(),N("#ccAddCardWithButton").parents("div.cc-submit").show());N("html").hasClass("a-ie6")&&(N("#cup-mbdc").show(),N(".mbdc-link").attr("data-action",
"redirect-cup"));Q=b.getElements(Ba);Q.bankNumberConfirm.show();Q.newVDC.find(".payment-row").data("hasstatus")||Q.newVDC.find(".vdc-form-fields").hide();Q.newVDC.find("#suppressedVerifiedDebitCard").hide();Q.newCCFormContent.find(".cup-card-field").hide();Q.newPayments.find("#cupInfoMessage").hide();Q.newPayments.find("#use-ecard-link").show();Q.newPayments.find(".mbdc-link").show();Q.newPayments.find(".mbdc-button").hide();oa=!1;Q.newPayments.each(function(){var a=N(this),c=a.data();c&&0===c.hasstatus?
(a.find("a.a-link-expander i.js-hide").remove(),a.find("a.a-link-section-expander i.js-hide").remove()):c&&1===c.hasstatus&&!oa&&(b.scrollTopTo(a),oa=!0)});var c=Q.newVCC.find("#requireCVVOrPincode");c&&c.length&&c.val("1");Aa&&(a.declarative("new-cc",["submit"],X),a.declarative("new-brdc",["submit"],X),a.declarative("new-loc",["submit"],G),a.declarative("show-card-image",["change"],B),a.declarative("new-giftcard-promotion",["submit"],K),a.declarative("new-verified-card",["click"],t),a.declarative("new-cc-in-dashboard",
["click"],A),a.declarative("new-gc-in-dashboard",["click"],y),a.declarative("add-bank-account",["submit"],ba),a.declarative("add-direct-debit",["submit"],ga),a.declarative("add-invoice",["submit"],Y),a.declarative("show-order-summary",["click"],Z),a.declarative("redirect-cup",["click"],ca),a.declarative("cup-popover-close",["click"],C),a.declarative("add-new-debit-and-cc-popover-submit",["click"],F),a.declarative("add-bank-account-popover-submit",["click"],aa),a.declarative("add-loc-account-popover-submit",
["click"],P),a.declarative("new-gil-payment",["click"],W),a.declarative("add-direct-debit-popover-submit",["click"],x),a.declarative("add-invoice-account-popover-submit",["click"],T),a.declarative("add-new-br-debit-card-popover-submit",["click"],U),Aa=!1);Q.cardTypeDropdown.unbind("change",d).bind("change",d);Q.vdcBankDropdown.unbind("change",q).bind("change",q);Q.emiCardsDropdown.unbind("change",H).bind("change",H);N("div.pay-desktop a.a-link-expander").unbind("keypress");N("div.pay-desktop .a-declarative, div.pay-desktop .a-button").filter("[data-action\x3da-checkout-modal-popover]").unbind("keypress");
a.on("a:popover:show:add-new-debit-cc-modal",function(a){ta=a.popover});a.on("a:popover:show:add-new-bank-account-modal",function(a){wa=a.popover});a.on("a:popover:show:add-new-direct-debit-modal",function(a){O=a.popover});a.on("a:popover:show:add-new-loc-account-modal",function(a){xa=a.popover});a.on("a:popover:show:add-invoice-account-modal",function(a){J=a.popover});a.on("a:popover:show:add-br-debit-card-modal",function(a){qa=a.popover})}}function ia(a,b){var c,d,e,g,l,h,p,m,n,k,u;"vcc"===b?(c=
"#vccCVVNum",b="#newVCCErrors",d="#vccMonth",e="#vccName",g="#newVerifiedCreditCardNumber",l="#vccType",h="#vccYear",p="#vccPincode",u=k=n=m=void 0):"vdc"===b?(c="#vdcCVVNum",b="#newVDCErrors",d="#vdcMonth",e="#vdcName",g="#newVerifiedDebitCardNumber",l="#vdcType",h="#vdcYear",m="#isSBIMaestroAsSavedCardEnabled",n="#isSBIInternationalMaestroSelected",u=k=p=void 0):"emi"===b?(c="#vccCVVNum",b="#newEMIErrors",d="#vccMonth",e="#vccName",g="#newVerifiedCreditCardNumber",l="#vccType",h="#vccYear",p="#vccPincode",
u=k=n=m=void 0):"brdc"===b?(b="#newBRDCErrors",d="#brdcMonth",e="#brdcName",g="#addCreditCardNumber_BRDC",h="#brdcYear",u=k=n=m=p=l=c=void 0):(k="#cupSecurityCode",u="#cupMobileNumber",c="#ccCVVNum",b="#newCCErrors",d="#ccMonth",e="#ccName",g="#addCreditCardNumber",l="#ccType",h="#ccYear",n=m=p=void 0);c=a.find(c);k&&0===c.length&&a.find(k).is(":visible")&&(c=a.find(k));m="1"===a.find(m).val()&&"1"===a.find(n).val();e=a.find(e);g=a.find(g);u=u?a.find(u):null;d=a.find(d);l=a.find(l);h=a.find(h);var B;
p&&a.find(p).is(":visible")&&(B=a.find(p));p=l.val();n=f.create();n.validateCreditCardName(e,e);n.validateCreditCardNumber(g,g);m&&n.validateSBIMaestroCardNumberLength(g,g);m=d.parent();m=m.hasClass("a-button")?m:m.find(".a-button");e=h.parent();e=e.hasClass("a-button")?e:e.find(".a-button");"G21"!==p&&n.validateCreditCardDate(d,m,h,e);n.validateCreditCardType(l,l.closest(".card-type-field").find(".a-button"));h=p?p.substr(0,1):"";c.length&&"R"!==h&&c.is(":visible")&&n.validateCreditCardCVV2(c,c,
p);u&&u.length&&u.is(":visible")&&n.validateCreditCardMobile(u,u);B&&B.length&&n.validateCreditCardPincode(B,B);n.displayErrors(N(b),a);return n.hasErrors()}function la(a,c){if(a){"1"===a.isDebitCard?Q.newCCWarnings.show().removeClass("hidden"):Q.newCCWarnings.hide().addClass("hidden");if("1"===a.hasErrors){var d=f.create();d.validateGetCreditCardTypeResult(a);if(d.hasErrors()){d.displayErrors(Q.newCCErrors);return}}c="vcc"===c?Q.newVCC:"vdc"===c?Q.newVDC:"emi"===c?Q.newEMI:"brdc"===c?Q.newBRDCFormContent:
Q.newCCFormContent;var d=a.specificFields,e=c.find(".cup-card-field");0!==e.length&&(d&&1===d.securityCode&&1===d.mobileNumber?(b.isTouchCX()&&c.find("#addCreditCardNumber").closest(".a-input-text-wrapper").removeClass("last-child"),e.show()):e.hide());d=a.specificFields;e=c.find(".amex-field");if(0!==e.length){var g=c.find(".cvv-field");0!==g.length&&(d&&1===d.pincode?(g.hide(),e.show()):d&&0===d.pincode&&0===d.securityCode?(e.hide(),g.hide()):(e.hide(),g.show()))}d=c.find(".card-images");d.find("img").hide();
g=a.installmentProgram;e=!1;g&&(g=d.find('img[data-installmentprogram\x3d"'+g+'"]'),0!==g.length&&(g.show(),e=!0));e||(a.issuerdisplayimage?d.find("img[data-issuer\x3dATM]").attr("src",a.issuerdisplayimage).show():(e=a.issuer+a.brand,d.find("img[data-issuer\x3d"+e+"]").show(),c.find(Ba.cardTypeDropdown).val(e).trigger("change")));p.setDateSelectorStatus(a,c)}}var N=a.$,Aa=!0,oa=!1,Q={},Ba={bankNumberConfirm:"#wrapper-bank-account-number-confirm",btnAddCard:"#ccAddCard",btnAddLoc:"#button-new-loc",
btnAddGC:"#button-add-gcpromo",btnAddBank:"#button-add-bank-account",btnAddDirectDebit:"#button-add-direct-debit",btnAddInvoice:"#button-add-invoice",cardImages:"#newCreditCardImages",cardTypeDropdown:".card-type-dropdown select",newCCFormContent:"#new-cc",newBRDCFormContent:"#new-brdc",newGCErrors:"#gcpromoerrorblock",newGCFormContent:"#gc_entry",newPayments:"div.new-payment-line",newVCC:"#new-verified-credit-cards-table",newVDC:"#new-verified-debit-cards-table",newEMI:"#newEmiCard",paymentRows:"#existing-payment-methods .payment-row",
vdcBankDropdown:"#vdcBanksSelect",emiCardsDropdown:"#emiPaymentMethodsSelectList",cardList:"#existing-credit-cards-box",newCCErrors:"#newCCErrors",newCCWarnings:"#newCCWarnings"},ta,wa,xa,O,J,qa;a.on("checkout:reload:payselect",da);a.on("checkout:reload:spp-payment",da);return{actionShowOrderSummary:Z,handleFormHandlerScrollToSelected:L}});r.when("A","page-detector","client-side-metrics","ready").execute(function(a,k,h){function b(a,b,e,c){a=f(b).is(":checked");q.P&&q.P.AUI_BUILD_DATE?a?f(e).val(f(e).parent().data("account-name")):
f(e).val(""):(h.increaseCount("removeauijs8"),a?(f(c).removeClass("a-icon-touch-checkbox-inactive").addClass("a-icon-touch-checkbox-active"),f(e).val(f(e).data("account-name"))):(f(c).removeClass("a-icon-touch-checkbox-active").addClass("a-icon-touch-checkbox-inactive"),f(e).val("")));e="undefined"!==typeof q.ue&&"undefined"!==typeof q.ue.count;c=k.isMobilePayment()?"mobile":"tablet";a=f("#showNameOnCardCheckbox").is(":checked");e&&q.ue.count(c+"NameOnCardCheckBox"+(a?"Checked":"Unchecked"),1)}var f=
a.$;a.declarative("show-card-name",["click"],function(a){b(a,"#showNameOnCardCheckbox","#ccName","#showNameOnCardIcon")});a.declarative("show-br-debit-card-name",["click"],function(a){b(a,"#showNameOnCardCheckbox_BRDC","#brdcName","#showNameOnCardIcon_BRDC")})});"use strict";r.when("A").register("pay-rewards-currency",function(a){var k=function(a,b){b=Math.pow(10,b);a=a.replace(/[^0-9]/g,"");return parseFloat(a)/b},h={CA:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2},DE:{groupingSeparator:".",
decimalSeparator:",",decimalPlace:2},GB:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2},JP:{groupingSeparator:",",decimalSeparator:".",decimalPlace:0},US:{groupingSeparator:",",decimalSeparator:".",decimalPlace:2}},b=function(a,b,e,c,f){this.groupingSeparator=a;this.decimalSeparator=b;this.currencyDecimalPlace=e;this.pointsDecimalPlace=c;this.ratio=f;this.getCurrencyAmount=function(a){return k(a,this.currencyDecimalPlace)};this.getPointsAmount=function(a){return this.getCurrencyAmount(a)/
this.ratio};this.format=function(a,b){var c=parseInt(a,10);a=parseFloat(a-c).toFixed(b);a=this.decimalSeparator+a.slice(2);c=c.toString();b=3<c.length?c.length%3:0;c=(0<b?c.substr(0,b)+this.groupingSeparator:"")+c.substr(b).replace(/(\d{3})(?=\d)/g,"$1"+this.groupingSeparator);return a===F||a===this.decimalSeparator?c:c+a};this.formatCurrency=function(a){return this.format(a,e)};this.formatPoints=function(a){return this.format(a,c)}},f=function(b,f,e,c){this.maxAmount=c;this.rewardsFormatter=e;this.currencyElement=
b;this.pointElement=f;var h=this;this.isControlKey=function(a){switch(a.which){case 8:case 46:return!0;case 86:case 88:return a.ctrlKey;default:return!1}};this.isNavigationKey=function(a){switch(a.which){case 9:case 16:case 17:case 35:case 36:case 37:case 39:return!0;case 65:case 67:return a.ctrlKey;default:return!1}};this.isValidKey=function(a){var b=a.which;return 48<=b&&57>=b||96<=b&&105>=b||8===a.which||46===a.which};this.getCaret=function(){var a=h.currencyElement,b=a.get(0),c=0,e=0;if("number"===
typeof b.selectionStart&&"number"===typeof b.selectionEnd)c=b.selectionStart,e=b.selectionEnd;else{var f=document.selection.createRange();if(f!==F&&f.parentElement()===b){var a=a.val(),e=a.length,g=b.createTextRange();g.moveToBookmark(f.getBookmark());b=b.createTextRange();b.collapse(!1);-1<g.compareEndPoints("StartToEnd",b)?c=e:(c=-g.moveStart("character",-e),c+=a.slice(0,c).length-1,-1<g.compareEndPoints("EndToEnd",b)||(e=-g.moveEnd("character",-e),e+=a.slice(0,e).length-1))}}return{start:c,end:e}};
this.setCaret=function(a){var b=h.currencyElement.get(0);b.setSelectionRange?b.setSelectionRange(a,a):b.createTextRange&&(b=b.createTextRange(),b.collapse(!0),b.moveStart("character",a),b.moveEnd("character",a),b.select())};this.bind=function(){h.currencyElement.unbind();h.currencyElement.bind("keydown",function(a){h.isNavigationKey(a)||h.isControlKey(a)||h.isValidKey(a)||a.preventDefault()});h.currencyElement.bind("keyup",function(b){if(!h.isNavigationKey(b)){b=h.getCaret();var c=h.currencyElement.val().length;
h.format();var e=h.currencyElement.val().length;b.start===b.end&&h.setCaret(Math.min(b.start+(e-c),e));a.trigger("inlineFormatter:formattingCompleted",h)}})};this.unbind=function(){h.currencyElement.unbind("keydown keyup")};this.format=function(a){a=h.currencyElement.val();a=h.rewardsFormatter.getCurrencyAmount(a);isNaN(a)&&(a=0);a>h.maxAmount&&(a=h.maxAmount);a=h.rewardsFormatter.formatCurrency(a);h.currencyElement.val(a)}};a.on("inlineFormatter:formattingCompleted",function(a){var b=a.pointElement,
e=a.currencyElement.val(),e=a.rewardsFormatter.getPointsAmount(e);a=a.rewardsFormatter.formatPoints(Math.round(e));b.html(a)});return{getCurrencyFormatByCountryCode:function(a){(a=h[a])||(a=h["default"]);return a},getAmount:k,initializeInlineFormatting:function(g,h,e){var c=g.maxAmount;e=new b(e.groupingSeparator,e.decimalSeparator,e.decimalPlace,h.decimalPlace,h.ratio);g=new f(g.$element,h.$element,e,c);g.bind();g.format(0);a.trigger("inlineFormatter:formattingCompleted",g)}}});"use strict";r.when("A",
"pay-common-util","pay-validator","page-conductor","mobile-carrier-billing-util","weblab-helper").register("jppoints",function(a,k,h,b,f,g){function m(){!k.isMobileCX()&&D("#jppoints").length&&(w=k.getElements(H),n())}function e(){var a=w.paymentRows.find('input[type\x3d"radio"][name\x3d"paymentMethod"]');a.closest("div.payment-selected").removeClass("payment-selected");a.attr("checked",!1);k.isTouchCX()&&c(a,"radio")}function c(a,b){a.siblings("i").removeClass("a-icon-touch-"+b+"-active").addClass("a-icon-touch-"+
b+"-inactive")}function p(a,b){a.is(":disabled")||a.siblings("i").removeClass("a-icon-touch-"+b+"-inactive").addClass("a-icon-touch-"+b+"-active")}function l(){return D('input[type\x3d"radio"][name\x3d"paymentMethod"][value\x3d"availablebalance"]').is(":checked")}function n(){if(w.jppoints&&w.jppoints.length){l()&&v();w.jppoints.show();var a=w.jppoints.find("#redeemPoints");k.isTouchCX()?a.parents("label").bind("click",q):a.bind("click",q);w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').bind("click",
function(){var a=w.jppoints.find("#jpPointsCustom");a.attr("checked",!0);var b=w.jppoints.find("#redeemPoints");b.attr("checked",!0);k.isTouchCX()&&(p(a,"radio"),c(w.jppoints.find("#jpPointsMax"),"radio"),p(b,"checkbox"))});w.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]').bind("click",t);w.jppoints.find("#jpPointsCustom").bind("click",function(){w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').focus()});w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').bind("keyup",
u)}}function v(){var a=w.jppoints.find("#redeemPoints"),d=w.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),e=w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),f=w.jppoints.find("#redeemableAmount"),g=w.jppoints.find("#redeemableValue");a.attr("checked",!1);a.attr("disabled",!0);d.attr("checked",!1);d.attr("disabled",!0);w.jppoints.find("#jpPointsError").hide();e.val("");e.removeClass("a-form-error");e.attr("disabled",!0);g.text(w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithGC"]').val());
f.text(w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithGC"]').val());b.isSPP()&&(w.jppoints.find("label").addClass("disabled-color"),w.jppoints.removeClass("payment-selected"));k.isTouchCX()&&(c(a,"checkbox"),c(d,"radio"),a.siblings("i").addClass("a-button-disabled"),d.siblings("i").addClass("a-button-disabled"))}function t(b){var d=b.currentTarget,f=w.jppoints.find("#redeemPoints");f.attr("checked",!0);if(k.isTouchCX()){p(D("#"+d.id),"radio");var g;g="jpPointsMax"===d.id?w.jppoints.find("#jpPointsCustom"):
w.jppoints.find("#jpPointsMax");c(g,"radio");p(f,"checkbox")}"true"===d.value&&(w.jppoints.find("#jpPointsError").hide(),d=w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),d.removeClass("a-form-error"),d.val(""),f=w.jppoints.find("#redeemableAmount"),g=parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),10),d=parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),f=parseInt(f.text(),10)*g,D('input[name\x3d"useAvailableBalance"]').is(":checked")&&
(g=w.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]'),d-=parseInt(g.val(),10)),f>=d&&e());r.when("installments-payselect").execute(function(c){a.trigger("installments-payselect:toggleJPPointsInstallmentEligibility",D(b.currentTarget))})}function A(a){var b=w.jppoints.find("#redeemableAmount"),d=w.jppoints.find("#redeemableValue"),f=parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),g;a.is(":checked")?(a=w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithGC"]').val(),
g=w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithGC"]').val(),f-=parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]').val(),10)):(a=w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val(),g=w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithoutGC"]').val());var h=parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),10)*a;b.text(a);d.text(g);0>=parseInt(a,10)?
(b=w.jppoints.find("#redeemPoints"),b.attr("checked",!1),d=w.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),d.attr("checked",!1),k.isTouchCX()&&(c(b,"checkbox"),c(d,"radio"))):w.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"][value\x3d"true"]').is(":checked")?h>=f&&e():u()}function q(){var e=w.jppoints.find("#redeemPoints");if(!e.is(":disabled")){e=e.is(":checked");if(k.isTouchCX())e?(c(w.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]'),"radio"),
d()):(p(w.jppoints.find("#jpPointsMax"),"radio"),c(w.jppoints.find("#jpPointsCustom"),"radio"),z());else if(e)z(),b.isSPP()&&w.jppoints.addClass("payment-selected");else if(d(),b.isSPP()){w.jppoints.removeClass("payment-selected");if(l())return;k.selectDefaultPaymentMethodIfNotSelected()}r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:toggleJPPointsInstallmentEligibility",w.jppoints)})}}function z(){var a=w.jppoints.find("#jpPointsMax");a.attr("checked",!0);
var d=parseInt(w.jppoints.find("#redeemableAmount").text(),10),f=w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val(),g=parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10);k.isTouchCX()&&(c(w.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]'),"radio"),p(a,"radio"));w.jppoints.find("#jpPointsMax").is(":checked")&&(d>=g?e():b.isSPP()&&w.paymentRows.find("#gcPromo, input[name\x3d'useAvailableBalance']").is(":checked")&&(a=w.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsCustomerGCValue"]'),
g-=parseInt(a.val(),10),f>=g&&e()))}function d(){var a=w.jppoints.find('input[name\x3d"jpPointsUseMaxPoints"]');a.attr("checked",!1);var b=w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]');b.val("");b.removeClass("a-form-error");w.jppoints.find("#jpPointsError").hide();k.isTouchCX()&&c(a,"radio")}function u(){var b=w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),c=parseInt(b.val(),10);!c||0>c?(b.val(""),w.jppoints.find("#jpPointsError").hide(),w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').removeClass("a-form-error")):
(b.val(c),parseInt(w.jppoints.find("#redeemableAmount").text(),10)<c?(w.jppoints.find("#jpPointsError").show(),w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').addClass("a-form-error")):(w.jppoints.find("#jpPointsError").hide(),w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]').removeClass("a-form-error"),b=parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"purchaseTotalRaw"]').val(),10),parseInt(w.jppoints.find('input[type\x3d"hidden"][name\x3d"jpPointsConversionRate"]').val(),
10),c>=b&&e(),r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:actionToggleJPPointsSection",c)})))}var D=a.$,w={},H={paymentRows:"#existing-payment-methods .payment-row",jppoints:"#jppoints",mcbPointsWarning:"#mcbPointsWarning"};a.on("checkout:reload:payselect",m);a.on("checkout:reload:spp-payment",m);return{handleJPPointsOnPaymentRows:function(a){a=D(a.currentTarget);if("jppoints"!==a.attr("id"))if("useAvailableBalance"===a.attr("name"))A(a);else{g.isMCBMultiTenderWeblabEnabled()||
f.hideMCBWarningMessageForPoints(w);var c=a.find('input[type\x3d"radio"][name\x3dpaymentMethod]');if(!g.isMCBMultiTenderWeblabEnabled()&&c.length&&0<c.filter("[value^\x3dMCB]").size())f.showMCBWarningMessageForPoints(w),v();else if("availablebalance"===a.attr("value")||a.find("#pm_300")&&"availablebalance"===a.find("#pm_300").attr("value"))v();else{a=w.jppoints.find("#redeemPoints");var c=w.jppoints.find('input[type\x3d"radio"][name\x3d"jpPointsUseMaxPoints"]'),d=w.jppoints.find('input[type\x3d"text"][name\x3d"jpPointsCustomAmount"]'),
e=w.jppoints.find("#redeemableAmount"),h=w.jppoints.find("#redeemableValue");b.isSPP()&&w.jppoints.find("label").removeClass("disabled-color");a.attr("disabled",!1);c.attr("disabled",!1);d.attr("disabled",!1);D('#existing-balance input[type\x3d"radio"][value\x3d"availablebalance"]').length&&(e.text(w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableAmountWithoutGC"]').val()),h.text(w.jppoints.find('input[type\x3d"hidden"][name\x3d"redeemableValueWithoutGC"]').val()));k.isTouchCX()&&(a.siblings("i").removeClass("a-button-disabled"),
c.siblings("i").removeClass("a-button-disabled"))}}},handleJPPointsWithGC:A}});"use strict";r.when("A","ajax-utility","client-side-metrics","pay-common-util","pay-validator","page-transition-controller","page-conductor","a-popover-position","inline-points-register-controller","jppoints","pay-credit-card","checkout-general-utils","a-popover-base","a-dropdown","pay-rewards-currency","cache-page-data-controller","pay-credit-card-reregistration","mobile-carrier-billing-util","emi-helper","instant-bank-discount-helper",
"safe-apx-helper","apb-limit-messaging-helper").register("existing-payments",function(a,k,h,b,f,g,m,e,c,p,l,n,v,t,A,y,z,d,u,D,w,H){function B(){return E.paymentRows.filter(function(){return I(this).hasClass("payment-selected")||I(this).find("#redeemPoints").is(":checked")})}function L(a){g.show();a.$event.preventDefault();var c=B().find(".card-unreg-rewards").data();c.recommendedPaymentMethodId=c.paymentinstrumentid;b.makeAjaxCall(a.$target.attr("href"),c)}function X(c){c=I(c.currentTarget);var d=
c.data();if(!(0>=d.ratio)){var e=c.val()/d.ratio;if(!isNaN(e)){var f=c.val();f<d.min&&(e=0);c=b.getNumberWithSeparators(e,d.decimalplaces);B().find(".custom-reward-points").html(c);r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:actionToggleRewardsSection",f)})}}}function R(a){1===a.data.refresh&&(g.show(),b.makeAjaxCall(a.data.url))}function G(a){Da(a)?(a=E.continueBtns,a.find(".a-button-primary:not(.a-button-disabled)").addClass("aok-hidden"),a.find(".a-button-disabled").removeClass("aok-hidden")):
I("#payPageContinueBtnStateFixEnabled").length&&T(a)}function K(a){b.isTouchCX()&&(Da()?a.$event.preventDefault():(E.continueErrPopover.hide().find(".error-message").hide(),g.show()))}function F(a){b.isTouchCX()&&(Da()||E.continueErrPopover.hide().find(".error-message").hide())}function aa(a){a=I(a.currentTarget);a.click();a=a.closest(".payment-container");a.find("#cc-errors").is(":visible")?a.find(".tv-update .a-button-primary").focus():a.click()}function x(a){a.$event.preventDefault();var c=B();
if(!l.runConfirmCardValidator(c,c.find("#cc-errors"))){g.show();var d=(c=b.getInputValues(c))||{},e=b.getInputValues(E.hiddenFormFields),f;for(f in e)e.hasOwnProperty(f)&&(d[f]=e[f]);l.confirmCreditCard(c,O,a.data.url)}}function P(){E.continueErrPopover.filter(":visible").length&&E.continueErrPopover.hide()}function T(){E.continueErrPopover.filter(":visible").length&&E.continueErrPopover.hide().find(".error-message").hide();var a=B();E.disableSubmitButtons.length?a.find(".no-address").length||(a.find(".continue-center").removeClass("aok-hidden"),
a.find(".a-button-disabled").addClass("aok-hidden")):(E.continueBtns.find(".a-button-primary:not(.a-button-disabled)").removeClass("aok-hidden"),E.continueBtns.find(".a-button-disabled").addClass("aok-hidden"));if(a){var b=a.find(".a-form-error");b&&b.length&&(b.removeClass("a-form-error"),(a=a.find(".pincode-err-block").filter(":visible"))&&a.length&&(E.continueErrPopover.hide().find(".error-message").hide(),E.continueBtns.find(".a-button-primary").removeClass("aok-hidden"),E.continueBtns.find(".a-button-disabled").addClass("aok-hidden"),
a.hide()))}}function U(){E.continueErrPopover.filter(":visible").length||E.continueBtnTop.trigger("click")}function ba(a){if(13===a.which){var c=I(document.activeElement),d=c.closest("div.payment-row"),e=c.closest(".a-button"),c=c.get(0).tagName;if(d.length&&!e.length&&"A"!==c&&"a"!==c)return d=d.find('input[type\x3d"submit"]'),d.length?d.trigger("click"):(E.continueErrPopover.filter(":visible").length&&E.continueErrPopover.hide(),Da(a)?(b.isTouchCX()||(E.continueBtns.find(".a-button-primary").addClass("aok-hidden"),
E.continueBtns.find(".a-button-disabled").removeClass("aok-hidden")),a.preventDefault()):E.continueBtnTop.trigger("click")),!1}}function ga(a){g.show();var c=B(),d=c.find("input[type\x3dradio][name\x3dpaymentMethod]").val(),e=c.find(".card-unreg-rewards").data(),c=b.isTouchCX()?c.find(".flag-register-rewards"):E.rewardsRegister,c=b.getInputValues(c);c.programid=e.programid;c.paymentinstrumentid=e.paymentinstrumentid;c.CARD_EXPIRATION_DATE=e.expiredate;c.CARD_HOLDER_NAME=e.holdername;c.returnRefreshedPage=
a.data.returnRefreshedPage;c.rewardsdateofbirthmonth&&c.rewardsdateofbirthday&&(c.DATE_OF_BIRTH=c.rewardsdateofbirthmonth+c.rewardsdateofbirthday);-1===a.data.url.toLowerCase().indexOf("cachebuster")&&(a.data.url=n.addQueryStringParameter(a.data.url,"cacheBuster",(new Date).getTime()));b.makeAjaxCall(a.data.url,c,{successHandler:function(a,c,e){g.hide();if(a){a=k.jsonify(a);E.rewardsRegister.find(".register-content").hide();var f=b.isTouchCX()?B().find(".register-error"):E.rewardsRegister.find(".register-error");
f.hide();a.error?f.show().find(".error-message").hide().filter("#"+a.error).show():(m.ajaxUpdatePage(a.refreshedPage,c,e),c=E.paymentRows.find('input[type\x3dradio][name\x3dpaymentMethod][value\x3d"'+d+'"]').closest(".payment-row"),c.trigger("click"),b.scrollTopTo(c))}}})}function Y(a){a=I(a.currentTarget).parents("div.currency-list");var b=a.find("label.a-touch-radio");b.length?b.trigger("click"):a.find("input[type\x3dradio][value\x3dOther]").trigger("click")}function Z(a){a=a.$target.closest("div.payment-row");
var c=a.find(".currency-list");if(m.isSPP()){var d=t.getSelect(c.find("select"));null!==d&&d.setValue("")}a.find(".change-currency").hide();c.show();b.isTouchCX()&&(a.find(".top-cell").removeClass("bottom-line").addClass("bottom-line"),a.find(".bottom-cell").show());J();ya()}function ca(a){a=a.$target.closest("div.payment-row");a.find(".expire-info, .expire-date").hide();a.find(".enter-date, .expire-date-fields").show();J();qa()}function C(a){var c=a.$target.closest("div.payment-row"),d="true"===
b.getAttributeData(c,"isaddresschallenge")?1:0;c.find(".expire-date-fields").length?(ca(a),c.find("#newExpDate").focus()):d&&c.find("#addCreditCardNumber").focus()}function W(a){setTimeout(function(a){var b=I(a.target);a=document.createEvent("UIEvents");a.initUIEvent("DOMActivate",!0,!0,q,1);b.get(0).dispatchEvent(a)},0,a)}function da(a){var c=I(a.target).closest("div.payment-row");""!==I(a.target).val()&&("true"===b.getAttributeData(c,"isaddresschallenge")?c.find("#addCreditCardNumber").focus():
U())}function ia(){var a=B();a.find("div.flag-register-rewards").is(":visible")?(a.find(".bottom-cell").hide(),a.find(".top-cell").removeClass("bottom-line"),a.find(".card-unreg-rewards").show()):(a.find(".card-unreg-rewards").hide(),a.find(".bottom-cell").show(),a.find(".top-cell").removeClass("bottom-line").addClass("bottom-line"))}function la(){ia()}function N(a){a.$event.preventDefault();if("1"===B().find("div.flag-register-rewards").attr("cached"))ia();else{var c=a.$target.attr("href");-1===
c.toLowerCase().indexOf("cachebuster")&&(c=n.addQueryStringParameter(c,"cacheBuster",(new Date).getTime()));g.show();b.makeAjaxCall(c,a.data,{successHandler:function(a){g.hide();var c=k.jsonify(a);a=b.decodeJSONResponse(c.widgetHTML);var d=B();d.find("div.flag-register-rewards").html(a);d.find("div.flag-register-rewards").attr("cached",1);d.find("div.flag-register-rewards .error-message").each(function(){var a=I(this),b=a.data("errorid");a.html(c.displaydata[b])});ia()}})}}function Aa(c){var e=I(c.target);
if(!e.is(":visible"))return c.preventDefault(),c.stopPropagation(),!1;m.isSPP()&&(m.isPrefetchFromAddressEnabled()?m.disablePageNoUpdateTransition():I("#payment").find(".panel-cancel-row").hide(),y.clearCache());var f=I(c.currentTarget);E.jppoints.length&&p.handleJPPointsOnPaymentRows(c);var g=f.find("[name\x3duseAvailableBalance]");if("useAvailableBalance"!==c.target.name&&!g.length)if(Q(f),d.toggleGCForMCB(f,E),oa(f),f.hasClass("payment-selected")||f.hasClass("payment-label"))E.disableSubmitButtons.length&&
(ta(f,f,!1),!e.hasClass("continue-center")&&f.find(".continue-center").length||U());else if(c=f.find('input[type\x3d"radio"][name\x3d"paymentMethod"]'),c.length&&"disabled"!==c.attr("disabled")){$a();c=B();m.isSPP()?c.filter(function(){var a=I(this).attr("id");return"gcPromo"===a?(a=I(this).find('input[type\x3d"radio"][name\x3d"paymentMethod"][value\x3d"availablebalance"]'))&&a.length:"jppoints"!==a}).removeClass("payment-selected"):c.removeClass("payment-selected");c.find("[name\x3dpaymentMethod]").attr("checked",
!1);c.find("i[data-a-input-name\x3dpaymentMethod]").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");c.find(".top-cell").removeClass("bottom-line");ra(c);b.isTouchCX()&&(c.find(".bottom-cell").hide(),c.find(".card-unreg-rewards").show());f.addClass("payment-selected");f.find("[name\x3dpaymentMethod]").attr("checked",!0);f.find("i[data-a-input-name\x3dpaymentMethod]").removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active");var e="true"===b.getAttributeData(f,
"isaddresschallenge")?1:0,g=f.find('.rewards-list input[type\x3d"radio"]').length,h="1"===b.getAttributeData(f,"hasDerivedCurrency")?1:0,l=f.find(".vcc-form-fields").length,k=f.find(".card-ref-num").length;b.isTouchCX()&&(e||g||l||k||h)&&(f.find(".top-cell").removeClass("align-top bottom-line").addClass("bottom-line"),f.find(".bottom-cell").show());r.when("rewards-section-desktop").execute(function(b){a.trigger("rewards-section-desktop:select-payment-row",f,ya)});Pa(f);Ma(f);Oa(f);na(f);ab(f);"1"===
I("#suppressionMessageFixEnabledStatus").val()&&bb(f);cb(f);Ta(f);Sa(f);Ua(f);db(f);eb(f);Va(f);Ga(u,u.toggleEMIMenu,f);Wa(f);fb();wa(f);Ca();J();qa();F();fa();xa(f,c);Ra();E.hideInputBoxes.length&&(La(f,c),Qa(f));E.disableSubmitButtons.length&&ta(f,c,!0);Ia();ya();E.disableSubmitButtons.length&&!f.find(".continue-center").length&&U()}}function oa(a){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');var b=I("input[type\x3d'hidden'][name\x3d'paySelectLocale']");b.length&&"IN"===b.val()&&
a.length&&r.when("client-side-metrics").execute(function(a){a.increaseCount("PayPage-COD-NonMobile",1)})}function Q(a){var b=I("#isGlobalCODEligible").val();if(b&&"0"!==b){a=a.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]');var b=I("#button-add-gcpromo"),c=I("#button-add-gcpromo").parent().parent();a.length?(c.addClass("a-button-disabled"),b.attr("disabled","disabled")):(c.removeClass("a-button-disabled"),b.removeAttr("disabled"))}}function Ba(a){r.when("A","a-tv").execute(function(b,
c){b=b.$;var d=b(a);d.length&&(b(".tv-lastSelected").removeClass("tv-lastSelected"),d.addClass("tv-lastSelected"),c.select(d))})}function ta(a,b,c){c&&b.find(".billing-address, .cc-continue-button").hide();if(a.find(".tv-update").length)La(a,b),Qa(a);else{var d=a.find(".billing-address, .cc-continue-button");if(d.length&&!d.is(":visible")){var e=!1;a.find(".no-address").length&&(e=!0,a.find(".a-button-primary").addClass("aok-hidden"),a.find(".a-button-disabled").removeClass("aok-hidden"));r.when("a-tv").execute(function(f){c&&
(b.find(".payment-container").hasClass(".a-tv-navigate")||f.add(b.find(".payment-container")));f.remove(a.find(".payment-container"));f=e?a.find(".billing-address-link"):d.find(".continue-center");Ba(f)});d.show()}}}function wa(a){var b=I("#one-click-final-review-message");b.length&&(a.find("#canTryTFX").length?b.removeClass("aok-hidden"):b.addClass("aok-hidden"))}function xa(a,c){if(b.isTouchCX()&&(c&&c.find(".top-cell .data-row").children(".a-column").height("auto"),a)){a=a.find(".top-cell .data-row");
var d=a.find(".addr-challenge-card-scan .a-box");if(d.length){c=a.height();var d=d.height(),e=a.children(".a-column:first");a.children(".a-column").height(d);e.height(c);e.children(".vertical-center-grid:first").height(d)}else a.children(".a-column").height(a.height())}}function O(c){g.hide();var d=k.jsonify(c);d.imbWidgetHTML&&I("#imb-wrapper").html(b.decodeJSONResponse(d.imbWidgetHTML));if(d.cardWidgetHTML&&(c=B(),c.replaceWith(b.decodeJSONResponse(d.cardWidgetHTML)),null!=d.rewardsAccountsWidgetHTML&&
r.when("rewards-section-desktop").execute(function(c){a.trigger("rewards-section-desktop:refresh-rewards-section",b.decodeJSONResponse(d.rewardsAccountsWidgetHTML))}),a.trigger("checkout:reload"),a.trigger("checkout:reload:payselect"),c=B(),"true"!==b.getAttributeData(c,"isaddresschallenge"))){l.setCardPasswordInputStatus(c,d.newpaymentmethodid,"cvv","#existingCvvNum");l.setCardPasswordInputStatus(c,d.newpaymentmethodid,"pincode","#existingPincodeNum");if(E.cvvColumnLabel.length){var e=!1;E.paymentRows.each(function(){if("true"===
b.getAttributeData(I(this),"isaddresschallenge"))return e=!0,!1});e||E.cvvColumnLabel.hide()}E.disableSubmitButtons.length&&U()}}function J(){E.paymentRows.each(function(){var a=I(this),c=a.find('.currency-list input[type\x3d"radio"]').length,d=a.find('.rewards-list input[type\x3d"radio"]').length,e=a.find(".card-reg-info").is(":visible"),f=a.find(".expire-date-fields").is(":visible"),g=a.find("a[data-action\x3dshow-expire-date-fields]").is(":visible"),h=a.find(".bottom-cell .inner-grid-left"),l=
a.find(".bottom-cell .inner-grid-right");f?c||d||e?(h.removeClass("hidden a-span10 a-span12").addClass("a-span8"),l.removeClass("a-span12 a-span2 hidden").addClass("a-span4")):(h.removeClass("a-span8 a-span10 a-span12").addClass("hidden"),l.removeClass("a-span4 a-span2 hidden").addClass("a-span12")):g?(h.removeClass("a-span12 a-span8 hidden").addClass("a-span10"),l.removeClass("hidden a-span4 a-span12").addClass("a-span2")):(h.removeClass("a-span10 a-span8 hidden").addClass("a-span12"),l.removeClass("a-span2 a-span4 a-span12").addClass("hidden"));
!b.isTouchCX()&&g&&(c||d||e)&&a.find(".bottom-cell").removeClass("align-top").addClass("align-top")});var a=B(),c=a.find("a[data-action\x3dshow-expire-date-fields]").filter(":visible").length,d=a.find(".top-cell.bottom-line").length;c&&!d||a.find(".bottom-cell").removeClass("align-top")}function qa(){b.isTouchCX()&&E.paymentRows.each(function(){var a=I(this),c="true"===b.getAttributeData(a,"isaddresschallenge")?1:0,d=a.find("a[data-action\x3dshow-expire-date-fields]").is(":visible"),e=a.find(".expire-date-fields").is(":visible"),
f=a.find(".card-reg-info").is(":visible"),g=a.find(".rewards-info").is(":visible"),h=a.find(".change-currency").is(":visible");d?a.find(".top-cell .second-row").addClass("align-top"):a.find(".top-cell .second-row").removeClass("align-top");c=c||h||f||g;f=e||d;g=a.find(".top-cell .inner-grid-left");a=a.find(".top-cell .inner-grid-right");c||(g.removeClass("a-span6 a-span8 a-span12").addClass("hidden"),a.removeClass("a-span4 a-span6 hidden").addClass("a-span12"));f||(g.removeClass("a-span6 a-span8 hidden").addClass("a-span12"),
a.removeClass("a-span4 a-span6 a-span12").addClass("hidden"));c&&d&&(g.removeClass("a-span6 a-span12 hidden").addClass("a-span8"),a.removeClass("a-span6 a-span12 hidden").addClass("a-span4"));c&&e&&(g.removeClass("a-span6 a-span8 hidden").addClass("a-span6"),a.removeClass("a-span4 a-span12 hidden").addClass("a-span6"))})}function ra(a){var b=a.find(".currency-list");if(b.length){var c=b.find("[type\x3dradio]:checked").val(),b=b.find("#cardCurrencyDropDown option:selected").val();"Other"!==c||"-1"!==
b&&"-2"!==b||a.find(".currency-list input[type\x3dradio][value!\x3dOther]").attr("checked",!0)}}function S(a){var b=I(a.currentTarget);a=b.find("option:selected");if(""===a.val())b.parents("div.selected-section").find(".selected-note-content").hide();else{var c=a.prop("disabled"),b=b.parents("div.selected-section"),d=b.find("#active-bank-content"),e=b.find("#disable-bank-content");c?(e.show(),d.hide()):(d.show(),e.hide());b.find("span.selected-note-bank").text(a.text()).show()}}function ea(a){var b=
I(a.currentTarget);a=b.find("option:selected");""===a.val()?b.parents("div.selected-section-more-payment-method").find(".selected-more-payment-content").hide():(b=b.parents("div.selected-section-more-payment-method"),b.find("span.selected-payment-option").text(a.text()).show(),b.find("span.selected-more-payment-content").show())}function sa(a){(E.continueErrPopover.filter(":visible").length||Da())&&a.$event.preventDefault()}function ja(b){b=I(b.currentTarget);var c=b.find("input[type\x3dcheckbox]");
c.attr("checked")?(c.attr("checked",!1),b.find(".checked-checkbox").addClass("aok-hidden"),b.find(".empty-checkbox").removeClass("aok-hidden"),b.find(".gc-balance-insufficient-msg").addClass("aok-hidden")):(c.attr("checked",!0),b.find(".checked-checkbox").removeClass("aok-hidden"),b.find(".empty-checkbox").addClass("aok-hidden"),b.find(".gc-balance-insufficient-msg").removeClass("aok-hidden"));r.when("a-tv").execute(function(b){setTimeout(function(){b.select(".tv-lastSelected")},500);a.trigger("a:tv:resize")})}
function Fa(a){a=I(a.currentTarget);"1"===a.attr("isclicked")?a.attr("isclicked",0):a.attr("isclicked",1);fa()}function fa(a){var c=I("#pm_promo");a=I("#pm_gc_radio");var d=I("#pm_gc_checkbox"),e;I("input[name\x3ddoesPurchaseContainOnlyRecurringPrimeMembership]").length&&(e=I("input[name\x3ddoesPurchaseContainOnlyRecurringPrimeMembership]").val());if(a&&a.length||d&&d.length){var f=I("input[name\x3dgcBalanceRaw]").val();I("input[name\x3damBalanceRaw]").length&&(f=I("input[name\x3damBalanceRaw]").val());
var g=I("input[name\x3disAPBLimitMessagingLaunchWeblabEnabled]").val(),h=I("input[name\x3dhasAPBRedeemableLimitExhausted]").val(),l=I("input[name\x3damAvailableBalanceRaw]").val(),p=I("input[name\x3dremainingBalanceRaw]").val(),k=I("input[name\x3dpurchaseTotalRaw]").val(),m,n,ha=I(".purchase-total").length;ha?(n=I(".purchase-total").html(),m=I(".remaining-balance").html()):(n=I("input[name\x3dpurchaseTotal]").val(),m=I("input[name\x3dremainingBalance]").val());var u=I(".balance-applied");ha?u.html(n):
u.text(n);(b.isTouchCX()&&"checkbox"===c.attr("type")?"1"===c.closest(".a-control-row").attr("isclicked"):c.is(":checked"))?(c=p,0<c&&(ha?u.html(m):u.text(m))):c=k;g&&H.renderAPBMessagingRemainingBalance({purchaseTotal:n,remainingBalance:m,balanceApplied:u,isPurchaseTotalInSpan:ha},f,k,l);m=a.closest(".radio-col");n=d.closest(".radio-col");p=I(".amazon-money-limit-breached");ha=I(".long");u=I(".short");"1"===g&&"1"===h?H.displayAPBRedeemableLimitExhaustedMessaging({gcRadioContainer:m,gcCheckboxContainer:n,
gcCheckbox:d,gcRadio:a,shortMsg:u,longMsg:ha,amazonMoneyLimitBreachedMsg:p}):0<=f-k?("disabled"===a.attr("disabled")&&a.removeAttr("disabled"),m.removeClass("hidden"),a.is(":checked")&&m.trigger("click"),n.addClass("hidden"),d.attr("disabled","disabled"),0==f-k?(ha.hide(),u.show()):(ha.show(),u.hide())):0<f-c?0>=c?(n.removeClass("hidden"),d.attr("disabled","disabled"),b.isTouchCX()&&n.find("i").addClass("a-button-disabled checkbox-disabled"),m.addClass("hidden"),a.attr("disabled","disabled"),u.show(),
ha.hide()):("disabled"===a.attr("disabled")&&a.removeAttr("disabled"),m.removeClass("hidden"),a.is(":checked")?m.trigger("click"):b.isTouchCX()&&m.find("i").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"),n.addClass("hidden"),d.attr("disabled","disabled"),ha.show(),u.hide()):("disabled"===d.attr("disabled")&&(d.removeAttr("disabled"),b.isTouchCX()&&n.find("i").removeClass("a-button-disabled checkbox-disabled")),n.removeClass("hidden"),(h=n.closest(".payment-row"))&&
h.hasClass("payment-selected")&&h.removeClass("payment-selected"),m.addClass("hidden"),a.attr("disabled","disabled"),"1"===g?H.renderAPBInsufficientMessaging({shortMsg:u,longMsg:ha},f,l):(u.show(),ha.hide()));"1"===e&&(a.attr("disabled","disabled"),d.attr("disabled","disabled"),(h=n.closest(".payment-row"))&&h.hasClass("payment-selected")&&h.removeClass("payment-selected"))}}function ma(b){var c=B().find(".enter-custom-rewards");if("rewardscustom"===I(b.currentTarget).children('input[type\x3d"radio"]').val()){c.show();
var d=c.find("input.custom-rewards-input");d.focus();E.paymentRows.find(".rewards-list").hasClass("show-currency-input-widget-new")&&(c=d.val().length,d=d.get(0),d.setSelectionRange?d.setSelectionRange(c,c):d.createTextRange&&(d=d.createTextRange(),d.collapse(!0),d.moveStart("character",c),d.moveEnd("character",c),d.select()))}else c.hide();r.when("installments-payselect").execute(function(c){a.trigger("installments-payselect:toggleRewardsInstallmentEligibility",I(b.currentTarget))});ya()}function va(a){a=
a.$target||I(a.currentTarget);ua(a)}function ua(b){if(b.length){var c=E.paymentRows.find('input[type\x3d"radio"][value\x3d"cashOnDeliveryCash"]'),d=E.paymentRows.find(".installments-select.a-row"),e=d.siblings(".installments-message"),f=d.siblings(".card-offers"),g=E.paymentRows.find('input[type\x3d"radio"][value\x3d"morePaymentMethod"]'),h=E.installmentsOnlyCards,l=E.paymentRows.find('input[type\x3d"radio"][id\x3d"pmEmiPaymentOptions"]'),p=E.paymentRows.find('input[type\x3d"radio"][value\x3d"amazonBusinessCredit"]');
if(c.length){var m=c.closest(".payment-row"),k=g.closest(".payment-row"),n=l.closest(".payment-row"),ha=p.closest(".payment-row");b.is(":checked")?(c.prop("disabled",!0),c.is(":checked")&&(c.prop("checked",!1),m.removeClass("payment-selected")),c.parent().siblings().addClass("a-color-secondary"),Ga(u,u.disableEMIPaymentMethods,l),r.when("abc-helper").execute(function(b){a.trigger("abc-helper:disable-payment",p)}),D.showInstantBankDiscountAmazonPaySelected(),ka(g,k),(b=d.find("select"))&&b.each(function(){var a=
this.id.replace(/\./g,"\\.");t.setValue(a,"")}),d.find(".installments-enabled-text").hide(),e.find(".installments-enabled-text").hide(),f.find(".installments-enabled-text").hide(),d.find(".installments-disabled-text").show(),e.find(".installments-disabled-text").show(),f.find(".installments-disabled-text").show(),I("#isGurupaPspToggleGcBugfixEnabled").length&&"1"===I("#isGurupaPspToggleGcBugfixEnabled").val()?h.find("input[name\x3dpaymentMethod]").attr("disabled","disabled").filter(":checked").removeAttr("checked"):
h.find("input[name\x3dpaymentMethod]").attr("disabled","disabled").removeAttr("checked"),h.removeClass("payment-selected")):(m.find(".payment-invalid").length||(c.prop("disabled",!1),c.parent().siblings().removeClass("a-color-secondary")),k.find(".payment-invalid").length||pa(g,k),n.find(".payment-invalid").length||Ga(u,u.enableEMIPaymentMethods,l),ha.find(".payment-invalid").length||r.when("abc-helper").execute(function(b){a.trigger("abc-helper:enable-payment",p)}),D.showInstantBankDiscountAmazonPayDeselected(),
d.find(".installments-disabled-text").hide(),e.find(".installments-disabled-text").hide(),f.find(".installments-disabled-text").hide(),d.find(".installments-enabled-text").show(),e.find(".installments-enabled-text").show(),f.find(".installments-enabled-text").show(),h.find("input[name\x3dpaymentMethod]").removeAttr("disabled"))}}}function pa(a,b){a.prop("disabled",!1);a.parent().siblings().removeClass("a-color-secondary");b.find(".selected-section-more-payment-method").show();b.find(".more-payment-gc-disabled-text").hide()}
function ka(a,b){a.prop("disabled",!0);a.is(":checked")&&(a.prop("checked",!1),b.removeClass("payment-selected"));a.parent().siblings().addClass("a-color-secondary");b.find(".selected-section-more-payment-method").hide();b.find(".more-payment-gc-disabled-text").show()}function za(a){var c=a.$target||I(a.currentTarget);a=c.closest(".currency-list");c=c.val();!0===(b.isTouchCX()?"Other"===c:"Other"!==c)?(a.find("select").attr("disabled",!0),a.find(".a-button.a-button-dropdown").addClass("a-button-disabled"),
a.find(".a-button.a-touch-select").addClass("a-button-disabled")):(a.find("select").attr("disabled",!1),a.find(".a-button.a-button-dropdown").removeClass("a-button-disabled"),a.find(".a-button.a-touch-select").removeClass("a-button-disabled"));ya()}function M(a){z.actionReregisterCardInBox(a);b.scrollTopTo(B())}function ha(a){ya()}function Ea(){E.paymentRows.each(function(){var a=I(this),c=".card-ref-num, .addr-challenge, .addr-challenge-msg, .cup-expired-msg, .enter-date, .expire-date-fields, .rewards-static-help-link, .verified-fail-msg, .tv-update, .billing-address, .cc-continue-button",
d=".card-info, .card-name, .card-reg-info, .expire-info, .rewards-err-msg, .rewards-list label, .rewards-list div.a-radio, .rewards-dynamic-help-link, .financial-offer-err-detail";a.hasClass("payment-selected")&&("1"===b.getAttributeData(a,"hasDerivedCurrency")||"1"===b.getAttributeData(a,"hasPreferredCurrency")&&"1"===b.getAttributeData(a,"isNewCard"))||(c+=", .currency-list");"1"===b.getAttributeData(a,"hasPreferredCurrency")&&"1"!==b.getAttributeData(a,"isNewCard")&&(d+=", .change-currency");a.find(c).hide();
a.find(d).show()})}function Ca(){E.paymentRows.each(function(){var a=I(this),c="#cc-errors, .enter-date, .expire-date-fields",d=".expire-info";if(a.hasClass("payment-selected")&&"1"===b.getAttributeData(a,"hasDerivedCurrency"))c+=", .change-currency",d+=", .currency-list";else{var e=a.find(".currency-list"),f=e.find("[type\x3dradio]:checked").val();if(f){var g;if("Other"!==f)g=e.find(".currencyNameLabel").html();else{var f=e.find("#cardCurrencyDropDown option:selected"),h=f.val();"-1"!==h&&"-2"!==
h&&(g=f.text())}g&&(d+=", .change-currency",e.closest("div.payment-row").find(".change-currency .currencyNameLabel").html(g))}c+=", .currency-list"}a.find(c).hide();a.find(d).show()})}function Ya(){var a=I("#aan-ads-box");if(a.length){var b=a.data("adsendpoint"),c=a.data("adsclient"),d="https://"+b+"/2009-09-09/ad/",b="/jsc?pt\x3dstatic\x26slot\x3dlib\x26pt2\x3daanjs";a.data("useaannojq")&&(b+="-nojq");I.getScript(d+c+b,function(){q.d16g&&q.d16g.requestAanAd({elemId:"aan-ads-box",baseUrl:d,afterOnload:!0,
client:c,pt:"checkout",slot:"display-ad-right",pt2:"payselect"})})}}function Za(){Xa&&(a.declarative("auto-rewards-reg",["click"],L),a.declarative("complete-rewards-register",["click"],R),a.declarative("confirm-card",["click"],x),a.declarative("register-card-rewards",["click"],ga),a.declarative("cancel-register-card-rewards",["click"],la),a.declarative("show-currencies",["click"],Z),a.declarative("show-expire-date-fields",["click"],ca),a.declarative("focus-cc-update-fields",["click"],C),a.declarative("show-rewards-reg",
["click"],N),a.declarative("submit-payment-form",["submit"],sa),a.declarative("toggle-tfx-option",["click"],za),a.declarative("reregister-cc-in-dashboard",["click"],M),a.declarative("modify-expire-date-fields",["change"],ha),b.isTouchCX()&&a.declarative("continue-button",["click"],K),Xa=!1);E.paymentRows.unbind("click").has("input[name\x3dpaymentMethod]:enabled").bind("click",Aa);r.when("apx-payselect-helper").execute(function(){var a=w.get("payselect");a&&a.initEvents(E.paymentRows,ya)});E.paymentRows.find("input[name\x3dusePromoBalance]").unbind("change",
fa).bind("change",fa);E.disableSubmitButtons.length&&E.paymentRows.has("input[type\x3dcheckbox]:enabled").unbind("click",ja).bind("click",ja);E.existingPincodeNum.unbind("click",Ja).bind("click",Ja);E.paymentRows.find("select#cardCurrencyDropDown").unbind("change",Y).bind("change",Y);E.paymentRows.find(".rewards-list").hasClass("show-currency-input-widget-new")?E.paymentRows.find(".rewards-list").undelegate("label","click").delegate("label","click",ma).each(function(b,c){c=a.$(c);b=c.find("input.custom-rewards-input");
c=c.find(".custom-reward-points");var d=a.$(b);b={$element:d,maxAmount:d.data("max")};c={$element:a.$(c),decimalPlaces:d.data("decimalplaces"),ratio:d.data("ratio")};d=d.data("country-code");d=A.getCurrencyFormatByCountryCode(d);A.initializeInlineFormatting(b,c,d)}):E.paymentRows.find(".rewards-list").undelegate("label","click").delegate("label","click",ma).undelegate("input.custom-rewards-input","keyup").delegate("input.custom-rewards-input","keyup",X);if(b.isTouchCX())E.pageContainer.find("#existing-payment-methods").find("select, input[type\x3dtext], input[type\x3dpassword]").unbind("change",
F).bind("change",F),E.pageContainer.find("#existing-payment-methods").find("div.currency-list label.a-touch-radio").unbind("click").bind("click",za),E.pageContainer.find("#existing-payment-methods").find("label.promoLabel").unbind("click").bind("click",Fa);else if(!m.isSPP()){var c=E.continueBtns.find(".a-button-text");I("#payPageContinueBtnStateFixEnabled").length?c.filter('input[type\x3d"button"]').unbind("mouseenter",Ha).bind("mouseenter",Ha).unbind("focus",Ha).bind("focus",Ha).unbind("mouseleave",
P).bind("mouseleave",P).unbind("blur",P).bind("blur",P):(c.filter('input[type\x3d"submit"]').unbind("mouseenter").bind("mouseenter",G).unbind("focus").bind("focus",G),c.filter('input[type\x3d"button"]').unbind("mouseleave").bind("mouseleave",T).unbind("blur").bind("blur",T))}E.netBankingSelect.unbind("change",S).bind("change",S);E.morePaymentMethodsSelect.unbind("change",ea).bind("change",ea);E.continueBtnBottom.unbind("click").bind("click",U);0<I("input[name\x3d'needDisableCODandEMIforGC']").length&&
(c=I("input#pm_300[type\x3d'checkbox'], #pm_gc_checkbox"),c.length&&(c.bind("change",va),c.is(":checked")&&ua(c)));E.jppoints.length&&E.paymentRows.find('input[name\x3d"useAvailableBalance"]').bind("click",p.handleJPPointsOnPaymentRows);r.when("installments-payselect").execute(function(){a.trigger("installments-payselect:initEvents")});E.hideInputBoxes.length&&(E.paymentRows.find("#confirm-card").unbind("focus").bind("focus",aa),E.paymentRows.find("#newExpDate").unbind("focus").bind("focus",W),E.paymentRows.find("#newExpDate").unbind("change").bind("change",
da))}function Ia(){var a=f.create();a.validatePayment(B());a.hasErrors()||m.makePrefetch(E.existingPaymentForm)}function Ja(a){a=E.showAmexWarning;null!==a&&(a.removeClass("hidden"),a.removeClass("amex_display"))}function Ka(){if(!b.isMobileCX()){E=b.getElements(gb);E.paymentRows.filter(".payment-selected-marker").removeClass("payment-selected-marker").addClass("payment-selected");var e=B();r.when("rewards-section-desktop").execute(function(b){a.trigger("rewards-section-desktop:page-load",ya)});r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:page-load")});
na(e);Sa(e);wa(e);Ea();Pa(e);Ma(e);Oa(e);Ua(e);Va(e);Wa(e);Ta(e);fa();Ra();I(document).undelegate("div.pay-desktop .checkout-page-form","keypress").delegate("div.pay-desktop .checkout-page-form","keypress",ba);I(document).undelegate("div.pay-desktop .checkout-page-form .enter-custom-rewards","keyup").delegate("div.pay-desktop .checkout-page-form .enter-custom-rewards","keyup",ya);E.addressChallengeCardList.length&&E.addressChallengeCardList.show();E.paymentRows.find('input[type\x3d"radio"][value\x3d"rewardsmax"]').each(function(){I(this).siblings('[type\x3d"checkbox"]').remove()}).removeClass("hidden");
qa();J();Za();E.existingPaymentForm.data("checkoutFormReady",!0);Ia();Ya();E.orderSummaryBottom.show();xa(e);F();ya();Q(e);d.determineIsMCBEnabled(E);d.toggleGCForMCB(e,E);I(".a-popover-preload").each(function(){var b=I(this).find(".rewards-registration").data("parentPaymentMethodId");b&&(a.off("a:popover:show:rewards-registration-"+b,c.displayRewardsRegister),a.off("a:popover:hide:rewards-registration-"+b,c.hideRewardsRegister),a.on("a:popover:show:rewards-registration-"+b,c.displayRewardsRegister),
a.on("a:popover:hide:rewards-registration-"+b,c.hideRewardsRegister))});r.when("a-tv").execute(function(b){a.trigger("a:tv:resize");e.find(".a-tv-navigate").length&&ta(e,e,!1)})}}function ya(b){m.isSPP()?(Da()?E.disableSubmitButtons.length?(b=B(),b.find(".continue-center").addClass("aok-hidden"),b.find(".a-button-disabled").removeClass("aok-hidden")):(E.continueBtns.find(".a-button-primary:not(.a-button-disabled)").addClass("aok-hidden"),E.continueBtns.find(".a-button-disabled").removeClass("aok-hidden")):
T(),a.trigger("orderSummary:primaryActionButton:mirrorPanelBtnState")):I("#payPageContinueBtnStateFixEnabled").length&&G(b)}function Na(a,b){a=I(a.target).closest(".order-summary-box").find(".continue-button-errors");a.length&&b.length&&(b=e.triggerLeft(a,b),a.show(),a.offset(b))}function Ha(a){if((!E.continueErrPopover.filter(":visible").length||b.isTouchCX())&&E.continueErrPopover.find(".error-message:not(.hidden)").length&&a&&("mouseenter"===a.type||"focus"===a.type)){var c=I(a.target).closest(".continue-buttons").find(".a-button-disabled");
Na(a,c)}}function Da(a){if(E.continueErrPopover.filter(":visible").length&&!b.isTouchCX())return!0;var c=B(),d=f.create();Ga(u,u.isEMIPaymentInstrument,c)&&(d.validateEMIMenuForContinueButton(c),c=Ga(u,u.getEMIMenuSelectedCardSection));d.validatePayment(c);d.apxValidatePayment(c,E.paymentRows);d=d.getHighestErrorId();if(!d||!d.identifier)return!1;E.continueErrPopover.find(".error-message").hide();c=c.find(".pincode-err-block");c.hide();c&&c.length&&d.target&&d.target.length&&d.target.addClass("a-form-error");
d.isPincodeError?(c.show(),c.addClass("a-form-error")):(E.continueErrPopover.find("#"+d.identifier).show(),E.continueErrPopover.find("#"+d.identifier).removeClass("hidden"),!a||"mouseenter"!==a.type&&"focus"!==a.type?m.isSPP||E.continueBtns.find(".a-button input").filter(":visible").each(function(){var a=I(this).closest(".order-summary-box").find(".continue-button-errors"),b=e.triggerLeft(a,I(this));a.show();a.offset(b)}):(c=I(a.target).closest(".continue-buttons").find(".a-button-primary"),Na(a,
c)));return!0}function Pa(c){E.paymentRows.find(".addr-challenge, .addr-challenge-msg").hide();E.hideInputBoxes.length?E.paymentRows.find(".card-name").show():E.paymentRows.find(".card-info").show();if("true"===b.getAttributeData(c,"isaddresschallenge")){var d=c.find(".addr-challenge, .addr-challenge-msg");0===d.length&&h.increaseCount("Checkout:Payment:AddressChallengeMissingInputAndMsg");d.show();E.hideInputBoxes.length?c.find(".card-name").hide():c.find(".card-info").hide();c=c.attr("paymentmethodid")?
c.attr("paymentmethodid"):c.attr("data-paymentmethodid");a.trigger("checkout:payment:challenge:log",c)}}function Qa(a){E.paymentRows.find(".expire-date-fields").hide();a=a.find(".expire-date-fields");a.length&&a.show()}function Ra(){E.paymentRows.find(".pci-blocking-cvv").length&&E.paymentRows.each(function(){var a=I(this),b=a.find(".pci-blocking-cvv");a.find("[type\x3dradio]:checked").val()&&b.length?b.show():b.length&&b.hide()})}function La(a,b){r.when("a-tv").execute(function(c){c.add(b.find(".payment-container"));
b.find(".tv-update").hide();var d=a.find(".tv-update");d.length&&(c.remove(a.find(".payment-container")),d.show(),Ba(d.find(".a-button-primary")))})}function Ma(a){E.paymentRows.find(".verified-fail-msg").hide();"true"===b.getAttributeData(a,"isverifiedfail")&&a.find(".verified-fail-msg").show()}function Oa(a){E.paymentRows.find(".cup-expired-msg").hide();"true"!==b.getAttributeData(a,"iscupcardexpired")&&"true"!==b.getAttributeData(a,"iscupcardexpiringsoon")||a.find(".cup-expired-msg").show()}function na(c){E.paymentRows.find(".rewards-list").hide();
E.paymentRows.find(".top-cell .inner-grid-left").show().find(".rewards-info").show();var d=c.find('.rewards-list input[type\x3d"radio"]'),e=d.filter(":checked");E.paymentRows.find('.rewards-list input[type\x3d"radio"]').prop("checked",!1);0<e.length?e.prop("checked",!0):c.find(".rewards-list").hasClass("apply-by-default")?d.filter('[value\x3d"rewardsmax"]').prop("checked",!0):d.filter('[value\x3d"rewardsnone"]').prop("checked",!0);d=c.find(".rewards-list").show();d.find('input[type\x3d"radio"][value\x3d"rewardscustom"]').is(":checked")&&
d.children(".enter-custom-rewards").show();b.isTouchCX()&&d.length&&(c.find(".rewards-info").hide(),c.find(".top-cell").addClass("bottom-line"),c.find(".bottom-cell").show());r.when("installments-payselect").execute(function(b){a.trigger("installments-payselect:toggleRewardsInstallmentEligibility",c)})}function Sa(a){E.paymentRows.find(".financial-offer-list").hide();E.paymentRows.find(".financial-offer-err-detail").hide();var c=a.find('.financial-offer-list input[type\x3d"radio"]'),d=c.filter(":checked");
c.prop("checked",!1);0<d.length?d.prop("checked",!0):c.first().prop("checked",!0);c=a.find(".financial-offer-list").show();a.find(".financial-offer-err-detail").show();b.isTouchCX()&&c.length&&(a.find(".top-cell").addClass("bottom-line"),a.find(".bottom-cell").show())}function $a(){I(document.body).find(".a-dropdown").each(function(){v.hide(I(this))})}function ab(a){E.paymentRows.find(".installments-select").hide();E.paymentRows.find(".installments-message").show();a.find(".installments-select").show();
a.find(".installments-message").hide()}function bb(a){E.paymentRows.find("#savedCardSuppressed").hide();a.find("#savedCardSuppressed").show()}function cb(a){E.paymentRows.find(".installments-list").hide();a.find(".installments-list").show()}function Ta(a){E.paymentRows.find(".card-ref-num, .selected-note, .selected-more-payment-option").hide();E.paymentRows.find(".card-benefit").show();a.find(".card-ref-num, .selected-note, .selected-more-payment-option").show();a.find(".card-benefit").hide()}function db(a){E.paymentRows.find(".otpBlock").hide();
a.find(".otpBlock").show()}function eb(a){E.paymentRows.find(E.ovdWidgetSection).hide();a.find(E.ovdWidgetSection).show()}function Ua(a){E.paymentRows.find(".vcc-info-prompt,.vcc-form-fields").hide();a.find(".vcc-info-prompt,.vcc-form-fields").show()}function Va(a){var b=E.newVDC.find("#vdcBanksSelect"),c=E.newVDC.find(".vdc-selected-bank-prompt").hide(),d=E.newVDC.find("#suppressedVerifiedDebitCard").hide(),e=b.val(),f="1"===I("#save_citi_card").val()?"CIT"!==e:!0,g="1"===I("#save_citi_card").val()&&
"CIT"===e;a.find("#vdcBanksSelect").length?""!==e&&"OtherBanks"!==e&&f&&(E.newVDC.find("option:selected").prop("disabled")?(d.show(),c.hide()):(d.hide(),c.show())):(("OtherBanks"===e||g)&&b.val(b.children("option").first().val()).trigger("change"),c.hide())}function Ga(a,b,c){if(!I.isEmptyObject(a)&&b)return b(c)}function Wa(a){var b=I("#cash-back-ineligible-for-cod-message");b&&b.length&&((a=a.find("#cashOnDeliveryCash"))&&a.length?b.removeClass("hidden"):b.addClass("hidden"))}function fb(){var a=
I("#imb-wrapper");if(a.length&&a.is(":visible")){var b=a.find(".defaultPaymentMethodExpired"),c=a.find(".codUnavailable"),d=a.find("p").length;0===b.length&&0===c.length||1!==d||a.hide()}}var I=a.$,Xa=!0,E={},gb={cardImages:"#newCreditCardImages",continueBtns:".continue-buttons:not(.place-order-button)",continueBtnTop:"#continue-top",continueBtnBottom:"#continue-bottom",continueErrPopover:".continue-button-errors",cvvColumnLabel:"#cvvColumnLabel",existingPaymentForm:"form.checkout-page-form",netBankingSelect:"#net-banking-select-list",
morePaymentMethodsSelect:"#more-payment-methods-select-list",newVDC:"#new-vdc",newEMI:"#newEmiCard",orderSummaryBottom:"#order-summary-bottom",pageContainer:"div.a-container",paymentRows:"#existing-payment-methods .payment-row",rewardsRegister:"#rewards-register",addressChallengeCardList:".address-challenge-card",hiddenFormFields:"#hiddenFormFields",jppoints:"#jppoints",gcpromo:"#gcPromo",disableSubmitButtons:"#disableSubmitButtons",hideInputBoxes:"#hideInputBoxes",showAmexWarning:"#showAmexWarning",
existingPincodeNum:"#existingPincodeNum",mcbBalanceWarning:"#mcbBalanceWarning",installmentsOnlyCards:".installments-only-card",ovdWidgetSection:"#ovdWidgetSection"};a.on("checkout:reload:payselect",Ka);a.on("checkout:reload:spp-payment",Ka);return{getSelectedPayment:B}});"use strict";r.when("A","page-detector").register("wechat-detector",function(a,k){var h=a.$,b=function(a){a&&!1!==a.isWeChatInstalled&&(a=h("#wechat_payment"),a.length&&a.show())},f=function(a){},g="MShopWeChatPayment";a.on("checkout:reload:payselect",
function(){h("#wechat_payment").length&&(h("#mShopWeChatApiName").length&&(g=h("#mShopWeChatApiName").val()),r.when("safe-mash").execute(function(a){q.cordova.require("cordova/exec")(b,f,g,"isWeChatInstalled",[])}))})});"use strict";r.when("A","page-main","client-side-metrics","ready").register("otp-for-cod",function(a,k,h){function b(){A=t("#cashOnDeliveryCash");if(A.length&&(q=A.find(x.verifyOTP),z=A.find(x.sendOTP),r=q.length&&z.length,X=t(x.payMobile).length?1:0,r&&(d=A.find(x.submitSendOTP),
u=A.find(x.submitVerifyOTP),D=A.find(x.submitResendOTP),w=A.find(x.changeOTPNumber),H=A.find(x.OTPPhoneNumber),B=A.find(x.otpCode),d.length&&u.length&&D.length&&w.length))){R=A.find(x.addURLHash).length;h.increaseCount(T.metricPrefix+T.block,1,1);d.click(function(){v();h.increaseCount(T.metricPrefix+T.send,1,1)});u.click(function(){G=H.val();aa=B.val();n();var a=g(G),b;b=/^\d{6}$/;b=aa&&b.test(aa);a&&b&&""!==K?l("VerifyOTP",K):b?a||A.find(x.otpServiceFailed).removeClass(x.aokHidden):A.find(x.invalidOTPError).removeClass(x.aokHidden);
h.increaseCount(T.metricPrefix+T.verify,1,1)});if(R&&location.hash&&location.hash.length){for(var a=location.hash,a=a.replace("#",""),a=a.split(";"),b=0;b<a.length;b++)0<=a[b].indexOf(P.codehandle)&&(K=a[b].replace(P.codehandle,"")),0<=a[b].indexOf(P.contactid)&&(V=a[b].replace(P.contactid,"")),0<=a[b].indexOf(P.phonenumber)&&(G=a[b].replace(P.phonenumber,""),H.val(G));""!==K&&""!==V&&""!==G&&e()}D.click(function(){h.increaseCount(T.metricPrefix+T.resend,1,1);v()});w.click(function(){q.addClass(x.aokHidden);
z.removeClass(x.aokHidden);f(D,!1);f(u,!1);n();h.increaseCount(T.metricPrefix+T.changeNumber,1,1)})}}function f(a,b){b?a.addClass(x.aButtonDisabled):a.removeClass(x.aButtonDisabled);X?a.find("button").prop("disabled",b):a.find("input").prop("disabled",b)}function g(a){var b=/^\d{10}$/;return a&&b.test(a)}function m(){A.find(x.otpServiceFailed).removeClass(x.aokHidden)}function e(){var a=A.find(x.verifyOTPPhoneNumber);A.find(x.invalidPhoneNumber).addClass(x.aokHidden);z.hasClass(x.aokHidden)?A.find(x.otpResentSuccess).removeClass(x.aokHidden):
X&&A.find(x.otpSentSuccess).removeClass(x.aokHidden);z.addClass(x.aokHidden);q.removeClass(x.aokHidden);var b=G.substr(0,2)+"*****"+G.substr(7,9);a.text(b);f(D,!1)}function c(a){if(a!==F&&"object"!==typeof a)try{a=t.parseJSON(a)}catch(b){a={}}a=a||{};var c,d=R&&location.hash?location.hash:"#";R&&location.hash&&";"!==d.slice(-1)&&(d+=";");c=a.status;a.codeHandle&&null!==a.codeHandle&&(K=a.codeHandle,R&&"SEND-SUCCESS"===c&&(d=p(d,P.codehandle,K)));a.contactId&&null!==a.contactId&&(V=a.contactId,R&&
"SEND-SUCCESS"===c&&(d=p(d,P.contactid,V),d=p(d,P.phonenumber,G)));R&&(location.hash=d);A.find(x.otpAlertClass).addClass(x.aokHidden);if(U[c])U[c]();else U.DEFAULT()}function p(a,b,c){var d=a.indexOf(b);if(0<=d){var e=a.indexOf(";",d),e=0<=e?e:a.length;a=a.substring(0,d)+a.substring(e+1,a.length+1)}return a+b+c+";"}function l(b,d){a.ajax("/gp/buy/payselect/handlers/otpAjaxHandler.html",{method:"get",params:{phoneNumber:G,method:b,codeHandle:d,contactId:V,otp:aa},success:c,error:function(){c({status:"SERVICE-FAILED"})}})}
function n(){B.val("");A.find(x.otpAlertClass).addClass(x.aokHidden)}function v(){n();G=H.val();g(G)?l("SendOTP",K):A.find(x.invalidPhoneNumber).removeClass(x.aokHidden)}var t=a.$,A,q,z,d,u,D,w,H,B,r,X,R,G="",K="",V="",aa="",x={aokHidden:"aok-hidden",aRadio:".a-radio",aButtonHidden:"a-button-hidden",aButtonDisabled:"a-button-disabled",payMobile:".pay-mobile",invalidOTPError:".invalidOTPError",verifyOTP:"#verifyOTP",sendOTP:"#sendOTP",submitSendOTP:"#submitSendOTP",submitVerifyOTP:"#submitVerifyOTP",
submitResendOTP:"#submitResendOTP",changeOTPNumber:"#changeOTPNumber",OTPPhoneNumber:"#OTPPhoneNumber",otpCode:"#otpCode",cashOnDeliveryCash:"#cashOnDeliveryCash",invalidPhoneNumber:".invalidPhoneNumber",otpServiceFailed:".otpServiceFailed",enterOTPLabel:"#enterOTPLabel",reEnterOTPLabel:"#reEnterOTPLabel",maxOTPError:".maxOTPError",numberAlreadyUsed:".numberAlreadyUsed",verifiedOTPSuccess:".verifiedOTPSuccess",verifyOTPPhoneNumber:"#verifyOTPPhoneNumber",otpResentSuccess:".otpResentSuccess",otpSentSuccess:".otpSentSuccess",
otpAlertClass:".otpAlertClass",phonenumberNotVerified:"phonenumberNotVerified",addURLHash:".addURLHash"},P={codehandle:"codehandle:",contactid:"contactid:",phonenumber:"phonenumber:"},T={metricPrefix:"PayPage-COD-OTP-",block:"Block",send:"Send",verify:"Verify",resend:"ReSend",changeNumber:"ChangeNumber"},U={"SERVICE-FAILED":m,"SEND-SUCCESS":e,"VERIFY-SUCCESS":function(){z.addClass(x.aokHidden);q.addClass(x.aokHidden);A.find(x.verifiedOTPSuccess).removeClass(x.aokHidden);A.find("."+x.phonenumberNotVerified).removeClass(x.phonenumberNotVerified);
X&&k.setContinueButtonStatus(!0)},"INVALID-NUMBER":function(){A.find(x.invalidPhoneNumber).removeClass(x.aokHidden)},"NUMBER-ALREADY-USED":function(){f(D,!0);f(u,!0);A.find(x.numberAlreadyUsed).removeClass(x.aokHidden)},"MAX-OTP-REACHED":function(){A.find(x.maxOTPError).removeClass(x.aokHidden);f(D,!0)},"INVALID-OTP":function(){A.find(x.invalidOTPError).removeClass(x.aokHidden);B.val("");X?B.attr("placeholder","Re-enter OTP"):(A.find(x.enterOTPLabel).addClass(x.aokHidden),A.find(x.reEnterOTPLabel).removeClass(x.aokHidden))},
DEFAULT:m};a.on("checkout:reload:payselect",b);a.on("checkout:reload:spp-payment",b)});"use strict";r.when("A","pay-common-util","ready").execute(function(a,k){var h={productGls:"#productGls",gcTypes:"#gcDeliveryTypes",device:"#device"},b=k.getElements(h);a.on("checkout:payment:challenge:log",function(f){var g={},k;for(k in h)h.hasOwnProperty(k)&&b[k]&&b[k].val()&&(g[k]=b[k].val());f&&(g.paymentInstrumentId=f);Object.keys&&Object.keys(g).length&&a.ajax("/gp/buy/payselect/handlers/log-payment-challenge.html?ref_\x3dcheckout-payment-challenge",
{method:"POST",params:g,timeout:1E3,cache:!1})})});"use strict";r.when("A","page-spinner-controller","page-main","page-transition-controller","page-conductor","client-side-metrics","button-blocker","ready").register("pay-auth",function(a,k,h,b,f,g,m){function e(){var a=n("#otp_id").val(),b=/^\d{6}$/;a&&b.test(a)?m.hide("pay-auth-otp-checks"):(a=n("#otp_invalid_msg").val(),m.show("pay-auth-otp-checks",a))}function c(b,c){k.show();a.ajax("validate-otp.html",{method:"post",params:{otp_name:b,paystationRequestId:c},
success:function(a){!a||"APPROVED"!==a.status&&"PENDING"!==a.status?(n("#otp_id").addClass("a-form-error"),n("#otpBadCode").removeClass("hidden"),k.hide()):(n("#isFormValidated").val("1"),t.submit())},error:function(a){k.hide()}})}function p(){n("#otp_id").removeClass("a-form-error");n("#otpBadCode").addClass("hidden")}function l(){g.increaseCount(A.metricPrefix+A.resend,1,1);var b="1"===n("#isPaystationFlow").val(),c;b?(c="resend-otp.html?returnHtml\x3d0\x26isPaystationFlow\x3d1",k.show()):c="resend-otp.html?returnHtml\x3d0";
a.ajax(c,{method:"get",success:function(a){b&&(a&&1===a.successful&&(n("#authSourceId").val(a.authSourceId),n("#paystationRequestId").val(a.paystationRequestId)),k.hide())},error:function(a){b&&k.hide()}})}var n=a.$,v,t,A={metricPrefix:"Payauth-",resend:"Resend"};a.on("checkout:reload:payauth",function(){v=n("#resend_form");t=n("#otp_form");t.submit(function(a){var b=n(a.currentTarget);if("1"===b.find('input[id\x3d"isPaystationFlow"]').val()&&(p(),"1"!==b.find('input[id\x3d"isFormValidated"]').val()))return a=
b.find('input[id\x3d"otp_id"]').val(),b=b.find('input[id\x3d"paystationRequestId"]').val(),c(a,b),!1});v.submit(function(a){"1"===n("#isPaystationFlow").val()&&p();l();return!1});e();n("#otp_id").unbind("keyup").bind("keyup",e)})});"use strict";r.when("A","ajax-utility","client-side-metrics","loading-spinner-controller","pay-common-lib","pay-common-util","page-conductor","page-transition-controller","quantity-service","weblab-helper").register("pay-gil",function(a,k,h,b,f,g,m,e,c,p){function l(a){r=
a.popover;var b=d(r);D("#gil-estimates-popover-"+b+" .gil-popover-content").html("");D("#gil-estimates-popover-"+b+" .gil-popover-error").html("");a.popover.updatePosition(!0)}function n(a){r=a.popover;var c=d(r),e=D("#gil-estimates-popover-"+c);e.find("input[name\x3dgil-subtype]").val(c);b.showSpinner(e,!1,r);a="/gp/buy/payselect/handlers/get-gil-popover-content.html?cachebuster\x3d"+(new Date).getTime();var f="hasWorkingJavascript\x3d1\x26subtype\x3d"+encodeURIComponent(c);D.ajax({type:"POST",url:a,
data:f,dataType:"text",async:!0,cache:!1,dataFilter:function(a){return k.jsonify(a)},success:function(a,f,g){d(r)===c&&(h.increaseCount("Checkout:GIL:"+c+":IneligiblePopoverSuccess",1),f=r,b.hideSpinner(e),a&&a.errors&&0<a.errors.length?e.find(".gil-popover-error").show():a&&a.widgetHTML?e.find(".gil-popover-content").html(decodeURIComponent(a.widgetHTML)):e.find(".gil-popover-error").show(),f.updatePosition(!0))},error:function(a){d(r)===c&&(h.increaseCount("Checkout:GIL:"+c+":IneligiblePopoverError",
1),a=r,b.hideSpinner(e),e.find(".gil-popover-error").show(),a.updatePosition(!0))}})}function v(a){a.$event.preventDefault();a.$target.closest(".a-popover").find(".a-button-close").trigger("click")}function t(a){a.$event.preventDefault();var f=d(r),g=D("#gil-estimates-popover-"+f);b.showSpinner(g,!1,r);var l=A(a.$currentTarget.parents("#gil-estimates-popover-"+f));b.showSpinner(g,!1,r);c.callBatch(l,{success:function(b,c,g){d(r)===f&&(h.increaseCount("Checkout:GIL:"+f+":SubmitIneligiblePopoverSuccess",
1),v(a),e.show(),1==parseInt(D("input[name\x3d'gil-rendered-using-apx']").val(),10)&&p.isGILCreditCardEnabled()?(b=D(".pmts-select-payment-instrument-form"),c=r,"APX_PSP_TO_RCX_SPC"==(c.attrs?c.attrs("data").onSubmit:c.data.onSubmit)&&b&&0<b.length?m.continueClicked(null,b):h.increaseCount("Checkout:GIL:"+f+"Popover:ErrorRedirectingToSPC",1)):z(f))},error:function(a){d(r)===f&&(h.increaseCount("Checkout:GIL:"+f+":SubmitIneligiblePopoverError",1),a=r,b.hideSpinner(g),g.find(".gil-popover-error").show(),
a.updatePosition(!0))},isTrial:0})}function A(a){var b={};a.find(".gil-ineligible-items").children(".gil-ineligible-item").each(function(a,c){a=D(c).find('input[name^\x3d"ineligible-item"]').val();b[a]=0});return b}function q(a){a.$event.preventDefault();var b=D("#gil-ineligible-"+a.data.subtype).find(".gil-ineligible-items"),c=b.data("index"),d=b.data("size"),c=(c+("next"===a.data.direction?1:-1)+d)%d,d=(c+1)%d;b.find(".gil-ineligible-item").addClass("aok-hidden").removeClass("a-span-last");a=b.find("#gil-ineligible-item-"+
c);d=b.find("#gil-ineligible-item-"+d);a.removeClass("aok-hidden");d.addClass("a-span-last").removeClass("aok-hidden");b.data("index",c)}function z(b){g.makeAjaxCall("/gp/buy/payselect/handlers/submit.html",{handler:"new-gil-payment",subtype:b},{successHandler:function(c,d,e){h.increaseCount("Checkout:GIL:"+b+":NewToExistingSuccess",1);m.ajaxUpdatePage(c,d,e);g.scrollTopTo(D("#existing-payment-methods [value\x3d"+b+"]"));if(m.isSPP())a.on("checkout:afterReload",function K(){D("#existing-gil input[value\x3d"+
b+"]").trigger("click");a.off("checkout:afterReload",K)});else D("#existing-gil input[value\x3d"+b+"]").trigger("click")},errorHandler:function(a,c,d){h.increaseCount("Checkout:GIL:"+b+":NewToExistingError",1);m.ajaxUpdatePage(a,c,d)}})}function d(a){return a.attrs?a.attrs("data").subtype:a.data.subtype}function u(){w&&(a.declarative("gil-close-popover",["click"],v),a.declarative("gil-submit-popover",["click"],t),a.declarative("gil-ineligible-pagination",["click"],q));D("#gil-cc-payment-type").length&&
(a.off("a:popover:beforeShow:gil-estimates",l),a.off("a:popover:show:gil-estimates",n),a.on("a:popover:beforeShow:gil-estimates",l),a.on("a:popover:show:gil-estimates",n));D("#gil-payment-type").length&&(a.off("a:popover:beforeShow:gil-si-estimates",l),a.off("a:popover:show:gil-si-estimates",n),a.on("a:popover:beforeShow:gil-si-estimates",l),a.on("a:popover:show:gil-si-estimates",n));w=!1}var D=a.$,w=!0,r;a.on("checkout:reload:payselect",u);a.on("checkout:reload:spp-payment",u);return{submitNewGilPayment:z,
displayGILEstimatesMobile:function(a,b,c){var d="/gp/buy/payselect/handlers/get-gil-popover-content.html?cachebuster\x3d"+(new Date).getTime(),e="hasWorkingJavascript\x3d1\x26subtype\x3d"+encodeURIComponent(a);g.makeAjaxCall(d,e,{successHandler:function(c,d,e){var f=k.jsonify(c);f&&!f.errors&&f.widgetHTML?h.increaseCount("Checkout:GIL:"+a+":Mobile:IneligibleSubPageSuccess",1):h.increaseCount("Checkout:GIL:"+a+":Mobile:IneligibleSubPageError",1);b(c,d,e)},errorHandler:function(b){h.increaseCount("Checkout:GIL:"+
a+":Mobile:IneligibleSubPageError",1);c(b)}})},actionCloseGilMobileSubpage:function(a){a.$event.preventDefault();D("#gil-estimates-subpage").remove();D(g.pages.main.pageId).show()},actionSubmitGilMobileSubpage:function(a,b,d){a.$event.preventDefault();D("#gil-ineligible-view");var e=A(a.$currentTarget.parents("#gil-ineligible-view"));c.callBatch(e,{success:function(c,d,e){h.increaseCount("Checkout:GIL:"+a.data.subtype+":Mobile:SubmitIneligibleSubPageSuccess",1);b(c,d,e)},error:function(b){h.increaseCount("Checkout:GIL:"+
a.data.subtype+":Mobile:SubmitIneligibleSubPageError",1);d(b)},isTrial:0})}}});"use strict";r.when("A","ready").register("new-verified-debit-card",function(a){});"use strict";r.when("A").register("apb-limit-messaging-helper",function(a){return{}});"use strict";r.when("A").register("temporary-preference-indicator",function(a){return{}});"use strict";r.when("A","page-conductor","page-transition-controller","quantity-service").register("rentals-ineligible-util",function(a,k,h,b){function f(a){var b=
{};a.find(".rentals-ineligible-item").each(function(a,e){a=m(e).find('input[name^\x3d"ineligible-item"]').val();b[a]=0});return b}function g(){var a=m(".pmts-select-payment-instrument-form");a.attr("data-pmts-ajax-continuation","false");a.submit();h.show()}var m=a.$;return{actionSubmitRentalsIneligibleItemsInSfl:function(a,c,h,l,k){h=f(h);b.callBatch(h,{success:function(){l(a,c);g()},error:function(){k(c)},isTrial:0,ref:"chk_pay_rental_sfl"})},continueWithPaymentMethod:g,toggleButton:function(a,b){b?
a.removeClass("a-button-disabled").removeAttr("disabled"):a.addClass("a-button-disabled").attr("disabled","disabled")}}});"use strict";r.when("A","ajax-utility","client-side-metrics","loading-spinner-controller","pay-common-lib","pay-common-util","rentals-ineligible-util","a-modal").register("rentals-ineligible",function(a,k,h,b,f,g,m,e){function c(a){"undefined"!==typeof e?(w=e.get(a.popover.name),w.update({content:"\x3cdiv id\x3d'rentals-ineligible-popover-loading'\x3e\x3c/div\x3e",height:400,width:600,
padding:"none",footer:null})):(w=a.popover,H=a.popover.$popover,w.update("\x3cdiv id\x3d'rentals-ineligible-popover-loading'\x3e\x3c/div\x3e"),H.find(".a-popover-inner").css("padding","0"),H.find(".a-popover-footer").html(""),H.find(".a-popover-footer").css("width",600),w.updatePosition(!0));p()}function p(){var a=d("#rentals-ineligible-popover-loading");b.showSpinner(a,!1,w);d.ajax({type:"POST",url:"/gp/buy/payselect/handlers/get-rentals-ineligible-content.html?ref_\x3dchk_pay_rentals_ineligible",
data:"hasWorkingJavascript\x3d1",dataType:"text",async:!0,cache:!1,dataFilter:k.jsonify,success:function(c,f,k){b.hideSpinner(a);c&&c.widgetHTML?(h.increaseCount("Checkout:Rentals:RenderIneligiblePopoverDesktopSuccess",1),c=d(g.decodeJSONResponse(c.widgetHTML)),c.find("#no-ineligible-items").length?(w.$popover.find(".a-button-close").trigger("click"),m.continueWithPaymentMethod()):(k=c.find("#rentals-ineligible-popover-footer"),f=k.removeClass("aok-hidden"),k.remove(),r&&(m.toggleButton(f.find("#rentals-ineligible-submit"),
!1),m.toggleButton(f.find("#rentals-ineligible-cancel"),!1)),"undefined"!==typeof e?(k=c.find(".rentals-ineligible-item").length,w.update({content:c.html(),height:2<k?400:0,footer:f.html()}),q()):(w.update(c.html()),H.find(".a-popover-inner").css("padding","0"),H.find(".a-popover-footer").html(f.html()),H.find(".a-popover-footer").css("width",600),w.updatePosition(!0)))):l(a)},error:function(b){l(a)}})}function l(a){h.increaseCount("Checkout:Rentals:RenderIneligiblePopoverDesktopError",1);b.hideSpinner(a);
a=d("#rentals-ineligible-content-unavailable-error");"undefined"!==typeof e?w.update({content:a.val(),padding:null,footer:null}):(w.update(a.val()),H.find(".a-popover-inner").css("padding","100px"),H.find(".a-popover-footer").html(""),H.find(".a-popover-footer").css("width",600),w.updatePosition(!0))}function n(a){a.$event.preventDefault();r=!0;m.toggleButton(d("#rentals-ineligible-submit"),!1);m.toggleButton(d("#rentals-ineligible-cancel"),!1);var c=d("#rentals-ineligible-popover-container");b.showSpinner(c,
!1,w);var e=d(".rentals-ineligible");m.actionSubmitRentalsIneligibleItemsInSfl(a,c,e,v,t)}function v(a,c){h.increaseCount("Checkout:Rentals:SubmitIneligibleItemsInSflDesktopSuccess",1);r=!1;b.hideSpinner(c);A(a)}function t(a){h.increaseCount("Checkout:Rentals:SubmitIneligibleItemsInSflDesktopError",1);r=!1;m.toggleButton(d("#rentals-ineligible-submit"),!0);m.toggleButton(d("#rentals-ineligible-cancel"),!0);d("#rentals-ineligible-sfl-error").removeClass("aok-hidden");b.hideSpinner(a);"undefined"!==
typeof e&&q()}function A(a){a.$event.preventDefault();"undefined"!==typeof e?w.hide():w.$popover.find(".a-button-close").trigger("click")}function q(){var a=w.$popover.find(".a-popover-inner").outerHeight(!0),b=d("#rentals-ineligible-popover-fixed-content").outerHeight(!0);d("#rentals-ineligible-popover-items-container").css("height",a-b)}function z(){u&&(a.declarative("rentals-ineligible-cancel",["click"],A),a.declarative("rentals-ineligible-submit",["click"],n),a.on("a:popover:show:rentals-ineligible-popover",
c));u=!1}var d=a.$,u=!0,r=!1,w,H;a.on("checkout:reload:payselect",z);a.on("checkout:reload:spp-payment",z);return{displayRentalsIneligible:function(){d("#rentals-ineligible-popover-trigger").trigger("click")}}});"use strict";r.when("A").register("payment-marketplace-helper",function(a){return{}});"use strict";r.when("A","cvf","page-detector","weblab-helper","ready").register("cvf-old-amazon-aui-fixes",function(a,k,h,b){function f(){a.$(".cvf-widget-form .a-button-dropdown .a-button-text").css("text-overflow",
"unset")}function g(){var a=n(this).parent(),b=a.find(".a-native-dropdown option")[0];if(b&&b.hasAttribute("data-a-html-content")){var c=[];a.find(".cvf-widget-input.a-native-dropdown option").each(function(){c.push({phone_country_code:n(this).data("a-html-content"),country_iso:n(this).val()})});var d=setInterval(function(){if(n(".a-popover-inner ul").length){var a="rtl"===n("html").attr("dir");n(".a-popover-inner ul").addClass("a-cvf-list-link");n.each(c,function(b,c){if(b=c.phone_country_code){if(a){b=
b.split("+");var d=b[1];b=b[0].trim()+" "+d+"+"}n(".a-popover-inner [data-value\x3d'"+c.country_iso+"']").html(b)}});clearInterval(d)}},0)}n(".cvf-widget-form .a-button-dropdown").die("click")}function m(){var a=n(this).data("value");n(".cvf-widget-form .a-native-dropdown.cvf-widget-input").val(a).change()}function e(){var a=n(this).parent().find(".a-dropdown-prompt"),b=n(this).find("option:selected").html().trim(),c=setTimeout(function(){a.html(b);clearTimeout(c)},0)}function c(){a.$(".cvf-widget-form .a-alert-inline.cvf-hidden").remove()}
function p(){0===n(".cvf-widget-form").length&&(n("#apx-content .a-alert-info").first().remove(),n("[data-testid\x3d'pmts-cod-cash-description']").closest(".pmts-portal-component").find(".a-radio input").trigger("click"))}function l(){if(!v)if(t)a.on("a:pageUpdate a:ajax:complete",c);else a.on("a:pageUpdate a:ajax:complete",f),n(".cvf-widget-form .a-button-dropdown").live("click",g),n(".a-cvf-list-link a").live("click",m),n(".cvf-widget-input.a-native-dropdown").live("change",e);a.on("cvf:verification:complete",
p)}var n=a.$,v=h.isMobile(),t=q.P&&q.P.AUI_BUILD_DATE;b.isCvfOldAmazonUiFixesEnabled()&&(a.on("checkout:reload:payselect",l),a.on("checkout:reload:spp-payment",l))});"use strict";r.when("A","page-detector").register("alipay-detector",function(a,k){var h=a.$,b=function(){var a=h("input[name\x3d'isAlipayAppPayment']");0<a.length&&k.isMobileSpc&&a.val("1")},f=function(a){},g=function(){var a=h("input[name\x3d'isAlipayRedirect']");0<a.length&&k.isMobileSpc&&a.val("1")},m=function(a){};a.on("checkout:reload:spc",
function(){h("input[name\x3d'isAlipayAppPayment']").length&&r.when("safe-mash").execute(function(a){a=q.cordova.require("cordova/exec");a(b,f,"AlipayPlugin","isAlipayInstalled",[]);h("input[name\x3d'isAlipayRedirect']").length&&a(g,m,"AlipayPlugin","isAlipayFailReturnSupported",[])})})});"use strict";r.when("A","page-transition-controller","page-detector").execute(function(a,k,h){function b(){var a=f("#backButtonProtection");a.length&&"1"===a.val()&&(k.showPageTransition(),document.location.reload())}
var f=a.$;r.register("back-button-protection",function(){return{markAsDirty:function(){f("#backButtonProtection").val(1)}}});a.on("checkout:reload:spc",b);a.on("checkout:reload:spp-revieworder",b)});"use strict";r.when("A","page-transition-controller","loading-spinner-controller","ajax-utility","page-conductor","checkout-general-utils","page-detector","client-side-metrics","delivery-preferences-csm-helper").register("delivery-preferences-controller",function(a,k,h,b,f,g,m,e,c){function p(){m.isTabletSpc()&&
(u=d("#spc-orders .delivery-preferences-options"),y(),u.find("select").trigger("change"),t())}function l(){var a=u.find("input[name\x3dpreference]:checked").val(),b=u.find("select[name\x3dSafePlaceLocation]");"NeighborDelivery"===a?(u.find("input[name\x3dneighbor-name]").removeAttr("disabled").removeClass("a-form-disabled"),u.find("input[name\x3dneighbor-house]").removeAttr("disabled").removeClass("a-form-disabled"),f.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"disabled"})}):
b.attr("disabled","disabled").closest(".a-button").addClass("a-button-disabled"),u.find(".safe-place-error").hide()):"SafePlaceDelivery"===a?(f.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"enabled"})}):b.removeAttr("disabled").closest(".a-button").removeClass("a-button-disabled"),u.find("input[name\x3dneighbor-name]").attr("disabled","disabled").addClass("a-form-disabled"),u.find("input[name\x3dneighbor-house]").attr("disabled","disabled").addClass("a-form-disabled"),
u.find(".neighbor-name-error").hide(),u.find(".neighbor-house-error").hide()):(u.find("input[name\x3dneighbor-name]").attr("disabled","disabled").addClass("a-form-disabled"),u.find("input[name\x3dneighbor-house]").attr("disabled","disabled").addClass("a-form-disabled"),f.isSPP()?r.when("a-dropdown").execute(function(a){a.getSelect(b).update({status:"disabled"})}):b.attr("disabled","disabled").closest(".a-button").addClass("a-button-disabled"),u.find(".neighbor-name-error").hide(),u.find(".neighbor-house-error").hide(),
u.find(".safe-place-error").hide());n(!0)}function n(a){var b=u.find("input[name\x3dpreference]:checked").val();u.find(".safe-place-error").hide();u.find(".neighbor-name-error").hide();u.find(".neighbor-house-error").hide();u.find("input").removeClass("a-form-error");u.find("div.a-input-text-wrapper").removeClass("a-form-error");u.find("select").closest(".a-button").removeClass("a-button-error");0<d("div.spc-tablet").length?u.find(".set-delivery-preferences-button").removeClass("a-button-disabled"):
u.find(".set-delivery-preferences-button").show();u.find(".save-disabled").hide();u.find(".current-blocker-content").text("");var c=!1;if("NeighborDelivery"===b){var e=u.find("input[name\x3dneighbor-name]");e.data("defaultValueRemoved")&&e.val()||(u.find(".neighbor-name-error").show(),e.addClass("a-form-error"),e.closest(".a-input-text-wrapper").addClass("a-form-error"),u.find(".current-blocker-content").html(u.find(".neighbor-name-error-text").text()),c=!0);e=u.find("input[name\x3dneighbor-house]");
e.data("defaultValueRemoved")&&e.val()||(u.find(".neighbor-house-error").show(),e.addClass("a-form-error"),e.closest(".a-input-text-wrapper").addClass("a-form-error"),u.find(".current-blocker-content").html(u.find(".neighbor-house-error-text").text()),c=!0)}else"SafePlaceDelivery"===b&&(e=u.find("select[name\x3dSafePlaceLocation]"),e.val()||(u.find(".safe-place-error").show(),e.closest(".a-button").addClass("a-button-error"),u.find(".current-blocker-content").html(u.find(".safe-place-error-text").text()),
c=!0));e=d("#disableSaveBtnWhenNoDeliveryPrefSelected").val();if(a&&c||"true"===e&&b===F)0<d("div.spc-tablet").length?u.find(".set-delivery-preferences-button").addClass("a-button-disabled"):u.find(".set-delivery-preferences-button").hide(),u.find(".save-disabled").show();return!c}function v(a){a&&a.$event&&a.$event.preventDefault();a="hasWorkingJavascript\x3d1\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26";var g="",l=u.find(".popover-deliv-prefs-content");l.data("obfuscatedEntityId")?
g=l.data("obfuscatedEntityId"):u.data("obfuscatedEntityId")&&(g=u.data("obfuscatedEntityId"));a+="obfuscatedEntityId\x3d"+g+"\x26";g=u.find("input[name\x3dpreference]:checked").val();""!==g&&(a+="prefDelLocation\x3d"+g+"\x26","NeighborDelivery"===g?(a+="neighborName\x3d"+encodeURIComponent(u.find("input[name\x3dneighbor-name]").val())+"\x26",a+="houseNo\x3d"+encodeURIComponent(u.find("input[name\x3dneighbor-house]").val())+"\x26"):"SafePlaceDelivery"===g&&(a+="safePlaceLocation\x3d"+u.find("select[name\x3dSafePlaceLocation]").val()+
"\x26"),g=u.find("input[name\x3ddefaultPreference]:checked").val(),g!==F&&""!==g&&(a+="isDefaultPreference\x3d1"));0<d("div.spc-tablet").length?k.show():h.showSpinner(u.find(".popover-deliv-prefs-content"),!1,D);c.recordCSMWithCurrentFieldValues("popover-submitted","preference","defaultPreference");d.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-delivery-preference.html",data:a,dataType:"text",contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc",
"x-amz-checkout-transition":"ajax"},success:function(a,c,g){w=!0;0<d("div.spc-tablet").length?k.hide():h.hideSpinner(u.find(".popover-deliv-prefs-content"));g.getResponseHeader("x-amz-checkout-page")?(u.find(".a-button-close").trigger("click"),f.ajaxUpdatePage(a,c,g)):(a=b.jsonify(a),f.redirect(a));e.increaseCount("checkoutSpcDeliveryPref-save",1)},error:function(a,b,c){0<d("div.spc-tablet").length?k.hide():h.hideSpinner(u.find(".popover-deliv-prefs-content"));n(!0)}})}function t(){u.find("input[name\x3d'neighbor-name'], input[name\x3d'neighbor-house']").unbind("focus").bind("focus",
function(){if(!d(this).data("defaultValueRemoved")){if(m.isMobileSpc()||m.isDesktopSpc())d(this).val(""),d(this).css("color","black");d(this).data("defaultValueRemoved",!0)}}).each(function(){(m.isMobileSpc()||m.isDesktopSpc())&&d(this).data("defaultValueRemoved")&&d(this).css("color","black")});u.find("input:radio[name\x3dpreference]").unbind("click").bind("click",l);u.find("input[name^\x3dneighbor]").unbind("keyup").bind("keyup",function(){n(!1)});0<d("div.spc-tablet").length?u.find("select[name\x3dSafePlaceLocation]").unbind("change").bind("change",
q):u.find("select[name\x3dSafePlaceLocation]").unbind("change").bind("change",function(){n(!1)})}function q(a){n(!0)&&v(a)}function y(a){var b=d("#spc-orders .delivery-preferences-options"),c,e="";a?(c=a.$currentTarget.find("input"),e=b.find("input[name\x3dpreference]:checked").val()):c=b.find("input[name\x3dpreference]:checked");b=c.val();if(e!==b){u.find(".expand-content").hide();var e=c,f=e.closest(".delivery-preferences-options");f.find("i.a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");
f.find("input").attr("checked",!1);e.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive");e.attr("checked",!0);"NeighborDelivery"===b||"SafePlaceDelivery"===b?c.closest(".deliverypreference-option").siblings(".expand-content").show():a&&v(a)}}function z(a){(a=u.find("#delivery-preferences-set-default-checkbox"))&&1===a.length&&(a.prop("checked")?e.increaseCount("checkoutSpcDeliveryPref-setAsDefault",1):e.increaseCount("checkoutSpcDeliveryPref-setAsTemporary",
1))}var d=a.$;if(!d("html").hasClass("a-ie6")){var u,D,w;a.on("a:popover:beforeShow",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-delivprefs")&&(a.popover.$popover.find(".a-popover-inner").html(u.find(".current-blocker-content").text()),a.popover.updatePosition())});a.on("a:popover:show",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(e.increaseCount("checkoutSpcDeliveryPref-open",1),D=a.popover,u=D.$popover,w=!1,t(),c.recordCSMWithCurrentFieldValues("popover-displayed",
"preference","defaultPreference"),l(),u.find("select").trigger("change"))});a.on("a:popover:dismiss",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(w||e.increaseCount("checkoutSpcDeliveryPref-dismissed",1))});a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("deliv-prefs")&&(w||c.recordCSM("popover-dismissed"))});a.declarative("delivery-preferences-switch-tablet",["click"],function(a){y(a)});a.declarative("delivery-preferences-expander-toggle",
["click"],function(a){g.toggleExpanderContent(a)});a.declarative("set-delivery-preferences",["click","touchend"],function(a){a.$event.preventDefault();g.protectAgainstDoubleAction("set-delivery-preferences")||n(!0)&&v()});a.declarative("delivery-preferences-set-default-checkbox-triggered","change",z);a.on("checkout:reload:spc",p)}});"use strict";r.when("A","page-detector","time-left-formatter","weblab-helper").register("fast-track-controller",function(a,k,h,b){function f(){for(var b in t)t[b]&&clearInterval(t[b]);
a.defer(g)}function g(){n.DAY=l("#fasttrack-day").html();n.DAYS=l("#fasttrack-days").html();n.HOUR=l("#fasttrack-hour").html();n.HOURS=l("#fasttrack-hours").html();n.AND=l("#fasttrack-and").html();n.MINUTE=l("#fasttrack-minute").html();n.MINUTES=l("#fasttrack-minutes").html();n.SECOND=l("#fasttrack-second").html();n.SECONDS=l("#fasttrack-seconds").html();(l("#isfresh").length&&l(".checkout.spc-mobile").length||l("#lazy-fresh-promise-delivery-message").length?l("#spc-form"):l("#spc-orders")).find(".fasttrack-span").each(function(){var b=
l(this),c=b.find("input[name\x3d'countdownId']").val();v[c]=parseInt(b.find("input[name\x3d'fasttrackExpiration']").val());q[c]=a.now()/1E3+v[c];m(b.find("input[name\x3d'countdownThreshold']").val(),b,b.find("input[name\x3d'showSimplifiedCountdown']").val(),c);b.show()})}function m(a,b,d,f){0>=v[f]?c(b,null):a&&0<a&&v[f]>a?b.find("span.fasttrackavailable").hide():(e(b,d),t[f]=setInterval(function(){e(b,d,f)},1E3))}function e(b,e,d){0<v[d]?(v[d]=Math.round(q[d]-a.now()/1E3),e=h.getTimeLeftFormatted(v[d],
1===e||"1"===e?!0:!1,n),l("html").hasClass("a-tablet")?b.find("span[data-field\x3d'fasttrackcountdown']").html("\x26nbsp;"+e):b.find("span[data-field\x3d'fasttrackcountdown']").html(e),b.find("span.fasttrackexpired").hide(),b.find("span.fasttrackcountdown").show(),b.find("span.fasttrackavailable").show()):c(b,d)}function c(a,b){b?(t[b]&&clearInterval(t[b]),a.find("span.fasttrackavailable").hide(),a.find("span.fasttrackexpired").show()):clearInterval(t[b])}function p(){f()}var l=a.$;if(!l("html").hasClass("a-ie6")){var n=
{},v={},t={},q={};a.on("checkout:reload:spc",f);a.on("checkout:reload:spp-revieworder",f);return{spcLiteLazyLoadFastTrack:p}}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","client-side-metrics").register("gc-redeem-controller",function(a,k,h,b,f){function g(a){if(!v){a.preventDefault();n(a.currentTarget);var e;0<n("#spc-gcpromoinput").length&&(e=encodeURIComponent(n("#spc-gcpromoinput").val()));0<n("#gc-promo-input").length&&(e=encodeURIComponent(n("#gc-promo-input").val()));
var f=encodeURIComponent(n("#spc-usePromoOnly").val());if(e&&0!==e.length){var d=encodeURIComponent(n("input[name\x3dpurchaseTotal]").val());n("#gc-error").hide();n("#gc-promo-success").hide();n("#gc-success").hide();n("#gc-ineligible").hide();n("#promo-success").hide();b.isSPP()?(k.blockAllActions(),k.showTransitionInContainer(n("#payment"))):k.show();var g=(new Date).getTime();a="/gp/buy/spc/handlers/add-giftcard-promotion.html/ref\x3dox_pay_page_gc_add";n(".checkout.spc.aui-templatized").length&&
(a="/gp/buy/spc/handlers/add-giftcard-promotion.html/ref\x3dox_spc_gc_add");e="purchaseTotal\x3d"+d+"\x26claimcode\x3d"+e+"\x26disablegc\x3d"+f+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+n("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+g;f=b.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});n.ajax({type:"POST",url:a,data:e,headers:f,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",
dataType:"text",complete:function(){v=!1},success:m,error:b.ajaxRedirect});v=!0}else c("addGiftCardOrPromo_NoCode")}}function m(a,f,g){var d=g.getResponseHeader("x-amz-checkout-page");if(d){if(b.ajaxUpdatePage(a,f,g),"spc"===d||"spclite"===d||"spp-revieworder"===d)(a=parseInt(n("#checkoutDisplayPage").data("delaySetTitle"),10)||parseInt(n("#gc-promo-delay").data("egcDelayUpdateRedemptionMessage"),10)||0)?setTimeout(function(){e(g)},a):e(g)}else{a=h.jsonify(a);if(!a)return b.redirect();if(a.error)return c(a.error);
if(a.errors)return c(a.errors);if(a.autohandlererror)return p(a.autohandlererror);b.redirect(a)}}function e(a){var b=a.getResponseHeader("x-updated-promo-type");a=a.getResponseHeader("x-updated-gc-applied-but-ineligible");b&&(a||n("#gc-promo-success").show(),0<n("div.spc-desktop").length?(n("#spc-gcpromoinput").removeClass("a-form-error"),n("#gc-promo-input").removeClass("a-form-error")):(n("#spc-gcpromoinput").closest(".a-input-text-wrapper").removeClass("a-form-error"),n("#gc-promo-input").closest(".a-input-text-wrapper").removeClass("a-form-error")),
"giftcard"===b?(l("applied"),a?(n("#gc-ineligible").show(),l("gcIneligible")):n("#gc-success").show()):n("#promo-success").show())}function c(a){k.hide();n("#gc-error p").hide();n("#gc-error").show();l("error");0<n("div.spc-desktop").length?(n("#spc-gcpromoinput").addClass("a-form-error"),n("#gc-promo-input").addClass("a-form-error")):(n("#spc-gcpromoinput").closest(".a-input-text-wrapper").addClass("a-form-error"),n("#gc-promo-input").closest(".a-input-text-wrapper").addClass("a-form-error"));n(0<
n("#gc-promo-input").length?"."+t[a]:"#"+a).show()}function p(a){if(a){var b=a.action,c="/gp/buy/payselect/handlers/error.html?errorType\x3d"+encodeURIComponent(a.type?a.type:b&&b.code?b.code:"string"===typeof a?a:"Unknown:pipelineJSError");"fatal"===b?c+="\x26errorAction\x3dfatal":"redirect"===b&&(a.url?c=a.url:"cart"===a.page&&(c="/gp/cart/view.html"));q.location.href=c}else q.location.href="/gp/buy/payselect/handlers/error.html?errorType\x3dUnknown:pipelineJSError"}function l(b){var c=a.state("cxt-gc-redemption-method").method;
f.increaseCount("rcxGCRedeem:"+c+":"+b,1)}var n=a.$,v=!1;if(!n("html").hasClass("a-ie6")){a.state("cxt-gc-redemption-method",{method:"type"});var t={addGiftCardOrPromo_Unknown:"UNKNOWN",addGiftCardOrPromo_NoCode:"NO_CODE",addPromo_InvalidForPurchase:"PROMO_INVALID_FOR_PURCHASE",addPromo_BadCode:"PROMO_BAD_CODE",addPromo_ExpiredCode:"PROMO_EXPIRED_CODE",addPromo_InvalidForOrgUnit:"PROMO_INVALID_FOR_ORG_UNIT",addPromo_OfferNotYetBegun:"USED_BEFORE_START_DATE",addPromo_AlreadyRedeemed:"PROMO_ALREADY_REDEEMED",
addGiftCard_AlreadyRedeemedByAnotherAccount:"GC_ALREADY_REDEEMED_BY_ANOTHER_ACCOUNT",addGiftCard_AlreadyRedeemedByThisAccount:"GC_ALREADY_REDEEMED_BY_THIS_ACCOUNT",addGiftCard_BadCode:"GC_BAD_CODE",addGiftCard_ExpiredCode:"GC_EXPIRED_CODE",addGiftCard_Cancelled:"CANCELLED_CODE",addGiftCard_WrongOrgUnit:"GC_WRONG_ORG_UNIT",addGiftCard_ServiceDown:"GC_SERVICE_DOWN",addGiftCard_InvalidForAGS:"GC_INVALID_FOR_AGS",addGiftCard_PassedClaimByDate:"PASSED_CLAIM_BY_DATE",addGiftCard_OfferNotYetBegun:"GC_NOT_YET_BEGUN",
addGiftCard_ExceededMaxLimit:"GC_EXCEED_MAX_LIMIT",addGiftCard_Disabled:"GC_DISABLED",addGiftCard_OTP_Required:"GC_OTP_REQUIRED",addGiftCard_SEVIS_Decline:"GC_SEVIS_DECLINE",addGiftCard_OCRAH_Decline:"GC_OCRAH_DECLINE",addGiftCard_DEFAULT_Message:"GC_DEFAULT_MESSAGE"};a.declarative("gc-element",["click"],function(a){var b=a.data.click;b&&null!==b&&g(a.$event)});a.on("a:expander:redeem-gc-expander:toggle:expand",function(a){f.increaseCount("checkout:spp-payment:expand_addgc_coll",1)});n(document).delegate("#spc-gcpromoinput, #gc-promo-input",
"keypress",function(a){13===a.which&&g(a)});return{actionAddGiftPromotion:g,giftSystemErrorHandling:p}}});"use strict";r.when("A","page-transition-controller","loading-spinner-controller","ajax-utility","page-conductor","checkout-general-utils","page-detector","client-side-metrics","gift-utility","weblab-helper").register("gift-popover-controller",function(a,k,h,b,f,g,m,e,c,p){function l(){var a=S;a.find("#select-recipient").empty();for(var b=0;b<ma.length;b++){var c=J("\x3coption/\x3e").attr({value:ma[b].value}).text(ma[b].text);
a.find("#select-recipient").append(c)}pa&&(b=a.find('#select-recipient option[value\x3d"'+pa+'"]').attr("selected","selected"),a.find("#select-recipient").closest("#popover-gift-connection-recipient").find(".a-placeholder").text(b.text()),ia())}function n(){a.defer(function(){J("#spc-orders").find(".gift-popover-link").each(function(){J(this).data("action")&&J(this).removeAttr("href").attr("tabindex",0)})});J(".larger-image-link").find("a").removeAttr("href")}function v(a){var b=S;b.find(".gift-error-box").hide();
b.find(".fake-label").each(function(){J(this).unbind("click").bind("click",function(){J(this).closest(".popover-checkbox").find("input").trigger("click")})});a&&a.item&&a.item.title&&b.find(".popover-gift-top .gift-item-title span").html(a.item.title);a&&a.item&&a.item.isAutoripEligible?b.find("#gift-autorip-unavailable-msg").show():b.find("#gift-autorip-unavailable-msg").hide();if(a&&a.obfuscatedEntityId){var d=b.find(".set-gift-options-button input");d.unbind("click").bind("click",{obfuscatedentityid:a.obfuscatedEntityId,
giftData:a},t);g.bindActionEnterKeyOnButton(d)}ja?(fa=a&&a.item&&a.item.isAmazonFulfilled,na=!(a&&a.address&&0===a.address.shipToSelf),fa&&(a&&a.options&&a.options.canHaveMessage||a&&a.options&&a.options.canBeWrapped)?(z(!0),b.find(".mfn-hide-prices").hide(),b.find(".include-gift-receipt").show()):fa||(z(!0),b.find(".include-gift-receipt").hide(),b.find(".mfn-hide-prices").show(),b.find(".include-gift-message").show()),ka=b.find(".include-gift-message").is(":visible"),H()):a&&a.options&&a.options.canHidePrices?
b.find(".hide-prices-checkbox").closest("div").show():b.find(".hide-prices-checkbox").closest("div").hide();a&&a.selected&&(d=M(b.find(".hide-prices-checkbox")),a.selected.hidePrices?d.attr("checked",!0):d.removeAttr("checked"));if(a&&a.item&&a.item.purchaseIsKindle){if(d=b.find(".kindle-registration-box"),d.show(),d.find(".register-kindle-customer-name").html(b.find(".gift-customer-name").html()),!ja){var d=M(b.find(".kindle-reg-radio-another-account")),e=M(b.find(".kindle-reg-radio-your-account"));
a.selected.hidePrices||a.selected.isWrapped?(e.removeAttr("checked"),d.attr("checked",!0)):(d.removeAttr("checked"),e.attr("checked","checked"));M(b.find(".hide-prices-checkbox")).trigger("change")}}else b.find(".kindle-registration-box").hide();if(a&&a.options&&a.options.canHaveMessage){a&&a.selected&&(d=a.selected.message,e=M(b.find(".include-gift-message-checkbox")),d&&d.length?(b.find("textarea[name\x3d'gift-message-text']").val(d),u(!0)):null===d&&(a.selected.isWrapped||a.selected.hasReceipt)?
(e.removeAttr("checked"),b.find(".textarea[name\x3d'gift-message-text']").val("")):(b.find("textarea[name\x3d'gift-message-text']").val(""),d="",ja?(d+=b.find(".sample-gift-msg-greeting").html(),a&&a.address&&a.address.firstName&&!na&&(d+=" "+a.address.firstName),d=d+",\n"+b.find(".sample-gift-msg").html(),d+="\n"):(d+=b.find(".sample-gift-msg").html(),d+="\n\n"),d+=b.find(".sample-gift-msg-from").text(),d=ja?d+c.getNameWithNoTitle(b.find(".gift-customer-name").html()):d+c.getFirstName(b.find(".gift-customer-name").html()),
b.find("textarea[name\x3d'gift-message-text']").val(d),!ja||na&&ka||u(!0)));var f=J(".gift-message-warning").length,d=function(){ja&&u(!0);K(a.options.maxMessageChars,a.options.maxMessageLines,a.options.hasFixedGiftMsgLimit);if(f){var b=S.find("textarea[name\x3d'gift-message-text']");c.toggleGiftMessageWarning(b,S)}};if(a&&a.options){var k=b.find("textarea[name\x3d'gift-message-text']");k.bind("keyup",d);k.bind("mouseup",d);K(a.options.maxMessageChars,a.options.maxMessageLines,a.options.hasFixedGiftMsgLimit);
f&&c.toggleGiftMessageWarning(k,b);M(b.find(".include-gift-message-checkbox")).bind("change",function(){var d=J(this).is(":checked"),e=a.options.maxMessageChars,g=a.options.maxMessageLines,h=a.options.hasFixedGiftMsgLimit,l=S,p=l.find("textarea[name\x3d'gift-message-text']");d?ja&&w():(0<l.find(".validateInputCharactersOnBlur.a-form-error").size()&&(l.find(".validateInputCharactersOnBlur.a-form-error").removeClass("a-form-error"),0<l.find("#onblur-character-validation-error-gift-message-text").size()&&
l.find("#onblur-character-validation-error-gift-message-text").remove()),ja?H():(p.val(""),K(e,g,h)));f&&c.toggleGiftMessageWarning(k,b)})}}else b.find(".popover-gift-message-text").css("visibility","hidden"),b.find(".include-gift-message").css("visibility","hidden"),ja&&(b.find(".include-gift-message").hide(),b.find(".popover-gift-message").css("visibility","hidden")),b.find(".popover-gift-message-not-available").show();a&&a.options&&!a.options.canBeWrapped?(b.find(".wrap-option").hide(),b.find(".popover-gift-no-wrap-available").show(),
b.find(".hide-prices-amazon-msg").hide(),b.find(".hide-prices-note").hide(),b.find(".hide-prices-merchant-msg").show(),M(b.find(".hide-prices-checkbox")).attr("disabled",!1)):a&&a.item&&a.item.isAmazonFulfilled?(b.find(".wrap-option").hide(),b.find(".popover-gift-fba-wrap").show(),b.find(".hide-prices-amazon-msg").show(),b.find(".hide-prices-merchant-msg").hide(),(d=a.options.wraps[0].imageurl)&&0<d.length&&(b.find(".large-preview").find("img").attr("src",d),b.find(".large-preview").show(),b.find(".fba-wrap-checkbox").show(),
e=b.find(".larger-image-link"),e.unbind("click").bind("click",{imageURL:d},V),g.bindActionEnterKeyOnButton(e)),a.options.wraps[0].description&&b.find(".gift-wrap-title").show().html(a.options.wraps[0].description),"1"===J("#multipleAFNGiftWrapOption").val()?a.options&&a.options.wraps&&1<=a.options.wraps.length&&(d=b.find(".popover-gift-amazon-wrap"),r(b,d),Y(a,"afn",d)):a.options&&a.options.wraps&&1===a.options.wraps.length?(b.find(".popover-gift-amazon-wrap").hide(),b.find(".popover-gift-merchant-wrap").hide(),
b.find(".fba-wrap-checkbox .gift-wrap-price").html(a.options.wraps[0].price),e=M(b.find(".amazon-gift-wrap")),e.val(a.options.wraps[0].id),d=M(b.find(".hide-prices-checkbox")),a.selected.isWrapped?(e.attr("checked",!0),a.item.purchaseIsKindle||(d.attr("checked",!0),d.attr("disabled",!0),b.find(".hide-prices-note").show())):(e.removeAttr("checked"),d.attr("disabled",!1),b.find(".hide-prices-note").hide())):a.options&&a.options.wraps&&1<a.options.wraps.length&&(d=b.find(".popover-gift-amazon-wrap"),
r(b,d),ca(a,"afn",d))):(b.find(".wrap-option").hide(),M(b.find(".hide-prices-checkbox")).removeAttr("disabled"),b.find(".hide-prices-amazon-msg").hide(),b.find(".hide-prices-note").hide(),b.find(".hide-prices-merchant-msg").show(),b.find(".large-preview").hide(),d=b.find(".popover-gift-merchant-wrap").show(),d.find(".mfn-wrap-copy").remove(),ca(a,"mfn",d));ja&&(R(),G(),B());if(0<J(".enable-gift-connections").length){b.find("#popover-gift-connection select.a-touch-select-input").each(function(){J(this).unbind("change").bind("change",
function(){var a=J(this),b=a.siblings("a.a-placeholder"),a=a.find(":selected").text();b.text(a);return!1})});b.find("#select-recipient").bind("change",function(a){N(a);return!1});b.find("#select-occasion").bind("change",function(a){Aa(a);return!1});b.find("#input-recipient-first-name").keyup(function(){ia()});b.find("#input-recipient-last-name").keyup(function(){ia()});b.find("#popover-gift-connection-recipient").unbind("click").bind("click",function(a){a=S;va||a.find("#select-recipient-spinner").show()});
pa=F;if(a.giftConnection){typeof a.giftConnection.giftlistTypeId!==F&&"0"===a.giftConnection.giftlistTypeId&&typeof a.giftConnection.occasionId!==F&&"0"===a.giftConnection.occasionId&&b.find("#include-gift-connection-checkbox").attr("checked",!1);a.giftConnection.firstName&&b.find("#input-recipient-first-name").val(a.giftConnection.firstName);a.giftConnection.lastName&&b.find("#input-recipient-last-name").val(a.giftConnection.lastName);if("1"===a.giftConnection.giftlistTypeId||"2"===a.giftConnection.giftlistTypeId)d=
b.find('#select-recipient option[value\x3d"'+a.giftConnection.giftlistTypeId+'"]').attr("selected","selected"),b.find("#select-recipient").closest(".a-button-inner").find(".a-placeholder").text(d.text()),b.find(".gift-connection-recipient-extra").show();if(a.giftConnection.giftlistId&&"0"!==a.giftConnection.giftlistId)pa=a.giftConnection.giftlistId;else if("0"===a.giftConnection.giftlistTypeId||"1"===a.giftConnection.giftlistTypeId||"2"===a.giftConnection.giftlistTypeId)pa=a.giftConnection.giftlistTypeId;
a.giftConnection.occasionId&&(d=b.find('#select-occasion option[value\x3d"'+a.giftConnection.occasionId+'"]').attr("selected","selected"),b.find("#select-occasion").closest(".a-button-inner").find(".a-placeholder").text(d.text()));a.giftConnection.occasionMonth&&(d=b.find('#select-occasion-month option[value\x3d"'+a.giftConnection.occasionMonth+'"]').attr("selected","selected"),b.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(d.text()));a.giftConnection.occasionDay&&
(d=b.find('#select-occasion-day option[value\x3d"'+a.giftConnection.occasionDay+'"]').attr("selected","selected"),b.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(d.text()));a.giftConnection.age&&(d=b.find('#select-occasion-age option[value\x3d"'+a.giftConnection.age+'"]').attr("selected","selected"),b.find("#select-occasion-age").closest(".a-button-inner").find(".a-placeholder").text(d.text()));if("1"===a.giftConnection.occasionId||"2"===a.giftConnection.occasionId)b.find(".gift-connection-occasion-extra").show(),
"2"===a.giftConnection.giftlistTypeId&&b.find("#select-occasion-age-row").show();a.giftConnection.hasReminder&&"0"===a.giftConnection.hasReminder&&b.find("#occasion-has-reminder-checkbox").attr("checked",!1)}(!a.giftConnection||typeof a.giftConnection.occasionId===F||"1"!==a.giftConnection.occasionId&&"2"!==a.giftConnection.occasionId&&"3"!==a.giftConnection.occasionId)&&ia();ma&&(typeof pa!==F||a.registryId in ua)?(typeof pa===F&&(pa=ua[a.registryId]),l(),b.find("#select-recipient").show(),b.find("#select-recipient-spinner").hide(),
va=!0):(va=!1,typeof pa!==F?oa():oa(a.registryId))}S.find(".content-container").css("visibility","visible");ea.updatePosition(!0);h.hideSpinner(b.find(".popover-content-main"))}function t(a){var c=S,d="";if(!(0<c.find(".validateInputCharactersOnBlur.a-form-error").size())){a&&a.data&&a.data.obfuscatedentityid&&(d+="obfuscatedEntityId\x3d"+a.data.obfuscatedentityid+"\x26");fa&&(d+="isAFN\x3d1\x26");M(c.find(".include-gift-receipt-checkbox")).is(":checked")&&(d+="includeReceipt\x3d1\x26");M(c.find(".include-gift-message-checkbox")).is(":checked")?
(d+="includeMessage\x3d1\x26message\x3d"+encodeURIComponent(c.find("textarea[name\x3d'gift-message-text']").val())+"\x26",d+="maxChars\x3d"+a.data.giftData.options.maxMessageChars+"\x26",d+="maxLines\x3d"+a.data.giftData.options.maxMessageLines+"\x26"):d+="includeMessage\x3d0\x26";d=M(c.find(".hide-prices-checkbox")).is(":checked")?d+"hidePrices\x3d1\x26":d+"hidePrices\x3d0\x26";c.find(".kindle-registration-box").is(":visible")&&(d+="isKindlePurchase\x3d1\x26");var e;if(c.find(".popover-gift-fba-wrap").is(":visible"))if(c.find(".popover-gift-amazon-wrap").is(":visible")){if((e=
c.find("input[name\x3d'afn-gift-wrap']:checked").eq(0).val())&&e.length)for(d+="giftWrap\x3d"+e+"\x26",e=0;e<a.data.giftData.options.wraps.length;e++)if(c.find(".popover-gift-amazon-wrap").find(".afn-wrap-"+e).is(":checked")){d+="currencyAmount\x3d"+a.data.giftData.options.wraps[e].priceAmount+"\x26";d+="currencyUnit\x3d"+a.data.giftData.options.wraps[e].unit+"\x26";break}}else e=M(c.find(".amazon-gift-wrap")),e.is(":checked")&&(d+="giftWrap\x3d"+e.val()+"\x26",a.data.giftData.options&&(d+="currencyAmount\x3d"+
a.data.giftData.options.wraps[0].priceAmount+"\x26",d+="currencyUnit\x3d"+a.data.giftData.options.wraps[0].unit+"\x26"));else if(c.find(".popover-gift-merchant-wrap").is(":visible")&&(e=c.find("input[name\x3d'mfn-gift-wrap']:checked").eq(0).val())&&e.length)for(d+="giftWrap\x3d"+e+"\x26",e=0;e<a.data.giftData.options.wraps.length;e++)if(c.find(".popover-gift-merchant-wrap").find(".mfn-wrap-"+e).is(":checked")){d+="currencyAmount\x3d"+a.data.giftData.options.wraps[e].priceAmount+"\x26";d+="currencyUnit\x3d"+
a.data.giftData.options.wraps[e].unit+"\x26";break}if(0<J(".enable-gift-connections").length)if(c.find("#include-gift-connection-checkbox").is(":checked")){d+="includeGiftConnection\x3d1\x26";a=c.find("#select-recipient").val();d+="gcGiftlistTypeId\x3d"+a+"\x26";if("1"===a||"2"===a)d+="gcFirstName\x3d"+c.find("#input-recipient-first-name").val()+"\x26",d+="gcLastName\x3d"+c.find("#input-recipient-last-name").val()+"\x26";e=c.find("#select-occasion").val();d+="gcOccasionId\x3d"+e+"\x26";if("1"===e||
"2"===e)d+="gcMonth\x3d"+c.find("#select-occasion-month").val()+"\x26",d+="gcDay\x3d"+c.find("#select-occasion-day").val()+"\x26","1"===e&&"2"===a&&(d+="gcAge\x3d"+c.find("#select-occasion-age").val()+"\x26"),d+="gcHasReminder\x3d"+(c.find("#occasion-has-reminder-checkbox").is(":checked")?"1":"0")+"\x26"}else d+="includeGiftConnection\x3d0\x26";(a=J("input#executionId").val())&&(d+="executionId\x3d"+a+"\x26");a=(new Date).getTime();d+="isClientTimeBased\x3d"+J("input[name\x3d'useCtb']").val()+"\x26returnjson\x3d1\x26isDecoupleSPC\x3d1\x26hasWorkingJavascript\x3d1\x26returnFullHTML\x3d1\x26cachebuster\x3d"+
a;f.isSPP()&&(ea.hide(),a=J("#setOrderingPrefsCheckbox"),a.length&&a.is(":checked")&&(d+="\x26saveAsDefaultsSelected\x3d1"));k.show();a=f.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"});J.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/update-gift.html",data:d,dataType:"text",async:!0,cache:!1,headers:a,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,d,e){e.getResponseHeader("x-amz-checkout-page")?(f.isSPP()||c.find(".a-button-close").trigger("click"),
f.ajaxUpdatePage(a,d,e)):(a=b.jsonify(a),f.redirect(a))},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}}function r(a,b){a.find(".fba-wrap-checkbox").hide();a.find(".large-preview").hide();b.show();b.find(".afn-wrap-copy").remove()}function y(){var a=S,b=a.find(".popover-gift-amazon-wrap").is(":visible"),c=M(a.find(".amazon-gift-wrap")),d=M(a.find(".afn-wrap-none")),e=M(a.find(".hide-prices-checkbox"));if(c.is(":checked")||!d.is(":checked")&&b)e.attr("checked",!0),e.attr("disabled",!0),a.find(".hide-prices-note").show();
else if(c.not(":checked")||d.is(":checked")&&b)e.attr("checked",!0),e.attr("disabled",!1),a.find(".hide-prices-note").hide()}function z(a){var b=S,c=M(b.find(".include-gift-receipt-checkbox")),b=M(b.find(".mfn-hide-prices-checkbox"));a?(fa&&!c.is(":checked")&&c.attr("checked",!0).trigger("change"),fa||b.is(":checked")||b.attr("checked",!0).trigger("change")):(fa&&c.is(":checked")&&c.removeAttr("checked").trigger("change"),!fa&&b.is(":checked")&&b.removeAttr("checked").trigger("change"))}function d(a){var b=
S,c=M(b.find(".include-gift-receipt-checkbox")),b=M(b.find(".mfn-hide-prices-checkbox"));a?(z(!0),fa?c.attr("disabled","disabled"):b.attr("disabled","disabled")):fa?c.removeAttr("disabled"):b.removeAttr("disabled")}function u(a){var b=M(S.find(".include-gift-message-checkbox"));a?(b.is(":checked")||b.attr("checked",!0).trigger("change"),D(!1),w()):(b.is(":checked")&&b.removeAttr("checked").trigger("change"),H())}function D(a){var b=S,c=b.find(".no-message-warning"),d=b.find(".no-receipt-warning"),
e=b.find("textarea[name\x3d'gift-message-text']"),b=b.find(".message-remaining-text");a&&!d.is(":visible")?(p.showGiftTextAreaOnWarning()||e.addClass("gift-message-warning"),b.hide(),c.show()):(p.showGiftTextAreaOnWarning()||e.removeClass("gift-message-warning"),c.hide(),b.show())}function w(){var a=S,b=a.find("textarea[name\x3d'gift-message-text']"),a=a.find(".gift-message-label");b.removeClass("gift-message-inactive");a.removeClass("a-color-secondary")}function H(){var a=S,b=a.find("textarea[name\x3d'gift-message-text']"),
a=a.find(".gift-message-label");b.addClass("gift-message-inactive");a.addClass("a-color-secondary")}function B(){var b=S,c=M(b.find(".include-gift-message-checkbox")),d=b.find(".gift-msg-on-card"),e=b.find(".gift-msg-on-receipt"),f=a.trim(b.find(".gift-message-default-placeholder").text()),g=a.trim(b.find(".gift-message-with-wrap-placeholder").text()),h=b.find("textarea"),l=!1;b.find(".amazon-gift-wrap").each(function(){M(J(this)).is(":checked")&&(l=!0)});b.find(".afn-gift-wrap").each(function(){M(J(this)).is(":checked")&&
(l=!0)});b.find(".mfn-gift-wrap").each(function(){M(J(this)).is(":checked")&&(l=!0)});l?(e.hide(),d.show(),h.attr("placeholder",g),fa&&(u(!0),ka&&c.attr("disabled","disabled"))):(d.hide(),fa&&e.show(),h.attr("placeholder",f),c.removeAttr("disabled"))}function L(){var a=S,b=M(a.find(".include-gift-message-checkbox")),a=a.find("textarea[name\x3d'gift-message-text']");!na&&fa&&(b.is(":checked")&&0<a.val().length?D(!1):D(!0))}function X(){var a=S,b=M(a.find(".include-gift-receipt-checkbox")),c=a.find(".no-receipt-warning"),
a=a.find(".no-message-warning");b.is(":checked")?(c.hide(),ka||u(!0)):(a.hide(),c.show(),u(!1))}function R(a){a=S;var b=M(a.find(".include-gift-receipt-checkbox")),b=fa&&b.is(":checked"),c=M(a.find(".mfn-hide-prices-checkbox")),c=!fa&&c.is(":checked");b||c?(P(),a.find(".kindle-reg-msg-your-account").hide(),a.find(".kindle-reg-msg-another-account").show()):(T(),d(!1),a.find(".kindle-reg-msg-another-account").hide(),a.find(".kindle-reg-msg-your-account").show())}function G(a){a=S;var b=!1;M(a.find(".include-gift-message-checkbox")).is(":checked")&&
(b=!0);var c=!1;a.find(".amazon-gift-wrap").each(function(){M(J(this)).is(":checked")&&(c=!0)});a.find(".afn-gift-wrap").each(function(){M(J(this)).is(":checked")&&(c=!0)});a.find(".mfn-gift-wrap").each(function(){M(J(this)).is(":checked")&&(c=!0)});(b||c)&&z(!0);b&&ka||c?d(!0):d(!1)}function K(a,b,c){var d=S;qa=a;ra=b;if(a=d.find("textarea[name\x3d'gift-message-text']")){b=c?a.val().length:q.unescape(encodeURIComponent(a.val())).length;ja&&!na&&fa&&(0<b?D(!1):D(!0));var e=a.val().split("\n").length;
c=qa-b;e=ra-e;!ja&&0<b&&d.find(".include-gift-message-checkbox").not(":checked")&&d.find(".include-gift-message-checkbox").attr("checked",!0);a=a.val().split("\n");for(var g in a)24<a[g].length&&(e=0===a[g].length%24?e-(Math.floor(a[g].length/24)-1):e-Math.floor(a[g].length/24));d.find(".popover-gift-center .remainder-count").hide();(-1>c?d.find(".popover-gift-center .remaining-char-over-multiple").show():0>c?d.find(".popover-gift-center .remaining-char-over-single").show():1===c?d.find(".popover-gift-center .remaining-char-single").show():
d.find(".popover-gift-center .remaining-char-multiple").show()).find(".chars-remaining").html(Math.abs(c));(-1>e?d.find(".popover-gift-center .remaining-line-over-multiple").show():0>e?d.find(".popover-gift-center .remaining-line-over-single").show():1===e?d.find(".popover-gift-center .remaining-line-single").show():d.find(".popover-gift-center .remaining-line-multiple").show()).find(".lines-remaining").html(Math.abs(e));if(0>c||0>e)f.isSPP()?(d.find(".set-gift-options-button").addClass("aok-hidden"),
d.find(".set-gift-options-button-disabled").removeClass("aok-hidden")):(d.find(".set-gift-options-button").hide(),d.find(".set-gift-options-button-disabled").show()),0>c?(d.find(".gift-char-limit-error").find(".char-limit-error").html(qa),d.find(".current-blocker-content").html(d.find(".gift-char-limit-error").html())):0>e&&(d.find(".gift-line-limit-error").find(".line-limit-error").html(ra),d.find(".current-blocker-content").html(d.find(".gift-line-limit-error").html()));-1<c&&-1<e&&(f.isSPP()?(d.find(".set-gift-options-button").removeClass("aok-hidden"),
d.find(".set-gift-options-button-disabled").addClass("aok-hidden")):(d.find(".set-gift-options-button").show(),d.find(".set-gift-options-button-disabled").hide()))}}function V(a){a.stopPropagation();var b=S;b.find(".popover-content-main").fadeOut(100,function(){b.find(".popover-content-gift-wrap-preview .gift-wrap-preview-image").attr("src",a.data.imageURL);b.find(".popover-content-gift-wrap-preview").fadeIn(100)});var c=b.find(".popover-content-gift-wrap-preview .back-to-gift-options-button");c.unbind("click").bind("click",
aa);g.bindActionEnterKeyOnButton(c);sa=!0}function aa(a){sa=!1;var b=S;a?b.find(".popover-content-gift-wrap-preview").fadeOut(100,function(){b.find(".popover-content-main").fadeIn(100)}):setTimeout(function(){b.find(".popover-content-gift-wrap-preview").hide();b.find(".popover-content-main").show()},500)}function x(a){var b=S,c=!1;J(".amazon-gift-wrap").each(function(){M(J(this)).is(":checked")&&(c=!0)});J(".afn-gift-wrap").each(function(){M(J(this)).is(":checked")&&(c=!0)});J(".mfn-gift-wrap").each(function(){M(J(this)).is(":checked")&&
(c=!0)});if(c)P(),U();else if(M(b.find(".hide-prices-checkbox")).is(":disabled"))ba();else if(a.is("input[type\x3dcheckbox]")&&(a.closest(".a-checkbox").hasClass("hide-prices-checkbox")||a.hasClass("hide-prices-checkbox")))a.is(":checked")?P():T();else if(f.isSPP())(b=a.closest(".a-radio"))&&a.is(":checked")&&(b.hasClass("kindle-reg-radio-your-account")?T():b.hasClass("kindle-reg-radio-another-account")&&P());else if(a.hasClass("kindle-reg-radio-another-account")||a.hasClass("kindle-reg-radio-your-account"))b.find(".kindle-reg-radio-your-account").is(":checked")?
T():P()}function P(){var a=S,b=M(a.find(".hide-prices-checkbox"));b.is(":checked")&&!f.isSPP()||b.attr("checked","checked");M(a.find(".kindle-reg-radio-your-account")).is(":checked")&&M(a.find(".kindle-reg-radio-another-account")).attr("checked",!0)}function T(){var a=S,b=M(a.find(".hide-prices-checkbox"));b.is(":checked")&&b.removeAttr("checked");M(a.find(".kindle-reg-radio-another-account")).is(":checked")&&M(a.find(".kindle-reg-radio-your-account")).attr("checked",!0)}function U(){var a=S;M(a.find(".hide-prices-checkbox")).attr("disabled",
"true");M(a.find(".kindle-reg-radio-another-account")).attr("disabled",!0);M(a.find(".kindle-reg-radio-your-account")).attr("disabled",!0);a.find(".hide-prices-merchant-cant").is(":visible")||a.find(".hide-prices-note").show()}function ba(){var a=S;M(a.find(".hide-prices-checkbox")).removeAttr("disabled");M(a.find(".kindle-reg-radio-another-account")).removeAttr("disabled");M(a.find(".kindle-reg-radio-your-account")).removeAttr("disabled");a.find(".hide-prices-note").hide()}function ga(a){var b=g.getPosition(a,
"#",2),c=g.getPosition(a,"#",3);return"60"===a.substring(b+1,c)}function Y(b,c,d){var e=Z(),f,g;e?(f=d.find('li[class\x3d"a-carousel-card gift-wrap noshi-wrap none-wrap"]'),g=d.find(".carousel-gift-wrap").find("ol")):(f=d.find("."+c+"-wrap-template"),g=d.find("ul.allGiftWrapList"));e&&a.trigger("checkout:gift:removeEmptyCarouselCards",g);var h=(d.data("lineitemid")||b.obfuscatedEntityId||"").replace(":","-");"afn"!==c||e||(g.find('li[class!\x3d"none-wrap gift-wrap noshi-wrap"]').remove(),J("#giftwrap-carousel-wrap-holder-"+
h).css("width",90*(b.options.wraps.length+1)),J("#giftwrap-carousel-wrap-pane-"+h).css("width",360));for(var l=S,k=l.find(".larger-image-link-carousel-template"),p=0;p<b.options.wraps.length;p++){var m=f.clone(!0).removeClass(c+"-wrap-template").addClass(c+"-wrap-copy"),n=k.clone(!0).removeClass("larger-image-link-carousel-template").addClass("larger-image-link-carousel-"+p),u=c,v=b,t=p,q=m,r=n,W=v.options.wraps[t].id;q.find("input").addClass(u+"-wrap-"+t).val(W);q.find("label").attr("for",u+"-wrap-"+
t);W=v.options.wraps[t].description;q.find("."+u+"-wrap-description").html(W);W=v.options.wraps[t].price;q.find("."+u+"-wrap-price").html(W);(v=v.options.wraps[t].imageurl)&&v.length?(q.find("."+u+"-image").attr("src",v).show(),u=q.find(".larger-image-link"),u.show(),u.unbind("click").bind("click",{imageURL:v},V),r.unbind("click").bind("click",{imageURL:v},V),r.find("a").unbind("click").bind("click",{imageURL:v},V)):"mfn"!==u||Z()||(q.find(".a-span3").hide(),q.find(".a-span9").addClass("a-span12").removeClass("a-span9"),
q.find(".a-color-price").removeClass("wrap-price"));if("afn"===c){t=b;r=p;q=h;u=g;v=l;W=t.options.wraps[r].id;m.data("giftwrap-id",W);m.data("wrap-no",r);if(t.selected.wrap===W){u.find("li.none-wrap").find("img").removeClass("selected-giftwrap-image");m.find("img").addClass("selected-giftwrap-image");var t=m.find("img").attr("src"),z=J("#giftwrap-option-preview-imagearea-image-"+q);z.find("img").attr("src",t);z.removeClass("aok-hidden");J("#giftwrap-option-preview-imagearea-default-"+q).addClass("aok-hidden");
x(m.find("input"));y();n.removeClass("aok-hidden");n.addClass("selectedWrapLargeLink")}Z()?(q=ga(W)?"gift-wrap":"noshi-wrap",m.removeClass(q).removeClass("none-wrap"),u.append(m.show())):(q=ga(W)?"\x3cli class\x3dnoshi-wrap\x3e":"\x3cli class\x3dgift-wrap\x3e",u.append(J(q).append(m.show())));m=v.find("#carousel-larger-image-div");m.find(".larger-image-link-carousel-"+r).length||m.append(n.show())}}d.find("."+c+"-wrap-checkbox").removeAttr("checked");b.selected&&b.selected.isWrapped?d.find("input[value\x3d'"+
b.selected.wrap+"']").attr("checked",!0):M(d.find("."+c+"-wrap-none")).attr("checked",!0);e&&a.trigger("checkout:gift:adjustCarouselInitial",b,d)}function Z(){return f.isSPP()&&J("input[name\x3dsppGiftPopoverWithCarousel]").length}function ca(a,b,c){for(var d=c.find("."+b+"-wrap-template"),e=0;e<a.options.wraps.length;e++){var g=d.clone(!0).removeClass(b+"-wrap-template").addClass(b+"-wrap-copy"),h=a.options.wraps[e].id;g.find("input").addClass(b+"-wrap-"+e).val(h);g.find("label").attr("for",b+"-wrap-"+
e);h=a.options.wraps[e].description;g.find("."+b+"-wrap-description").html(h);h=a.options.wraps[e].price;g.find("."+b+"-wrap-price").html(h);if((h=a.options.wraps[e].imageurl)&&h.length){var l=g.find("."+b+"-image");f.isSPP()&&l.removeClass("hidden");l.attr("src",h).show();l=g.find(".larger-image-link");f.isSPP()&&l.removeClass("hidden");l.show();l.unbind("click").bind("click",{imageURL:h},V)}else g.find(".a-span3").hide(),g.find(".a-span9").addClass("a-span12").removeClass("a-span9"),g.find(".a-color-price").removeClass("wrap-price");
f.isSPP()&&g.removeClass("hidden");g.insertAfter(d).show()}c.find("."+b+"-wrap-checkbox").removeAttr("checked");a.selected&&a.selected.isWrapped?c.find("input[value\x3d'"+a.selected.wrap+"']").attr("checked",!0):M(c.find("."+b+"-wrap-none")).attr("checked",!0)}function C(){S.find("#include-gift-connection-checkbox").attr("checked",!0)}function W(){if(S.find(".include-gift-connection-checkbox").not(":checked")){var a=S;a.find(".gift-connection-recipient-extra").hide();var b;b=a.find('#select-recipient option[value\x3d"0"]').attr("selected",
"selected");a.find("#select-recipient").closest(".a-button-inner").find(".a-placeholder").text(b.text());a.find("#input-recipient-first-name").val("");a.find("#input-recipient-last-name").val("");ia()}}function da(a){for(var b=S,c=0;c<ma.length;c++)if(a&&a===ma[c].value&&ma[c].bMonth&&ma[c].bDay){var d;d=b.find('#select-occasion-month option[value\x3d"'+ma[c].bMonth+'"]').attr("selected","selected");b.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(d.text());
d=b.find('#select-occasion-day option[value\x3d"'+ma[c].bDay+'"]').attr("selected","selected");b.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(d.text())}}function ia(){var a=S,b=a.find("#popover-gift-connection #select-recipient").find(":selected").val();if(""!==b&&"0"!==b&&("1"!==b&&"2"!==b||a.find("#input-recipient-first-name").val()||a.find("#input-recipient-last-name").val()))a.find("#select-occasion").prop("disabled",!1),a.find("#popover-gift-connection-occasion .a-touch-select").css({opacity:1});
else{b=S;b.find(".gift-connection-occasion-extra").hide();var c;c=b.find('#select-occasion option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion").closest(".a-button-inner").find(".a-placeholder").text(c.text());c=b.find('#select-occasion-month option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion-month").closest(".a-button-inner").find(".a-placeholder").text(c.text());c=b.find('#select-occasion-day option[value\x3d"0"]').attr("selected","selected");b.find("#select-occasion-day").closest(".a-button-inner").find(".a-placeholder").text(c.text());
c=b.find('#select-occasion-age option[value\x3d"-1"]').attr("selected","selected");b.find("#select-occasion-age").closest(".a-button-inner").find(".a-placeholder").text(c.text());b.find("#occasion-has-reminder-checkbox").attr("checked",!0);a.find("#select-occasion").prop("disabled",!0);a.find("#popover-gift-connection-occasion .a-touch-select").css({opacity:.5})}}function la(a,b){var c=S;"1"===a&&"2"===b?c.find("#select-occasion-age-row").show():c.find("#select-occasion-age-row").hide()}function N(a){a=
S;var b=a.find("#popover-gift-connection #select-recipient").find(":selected").val(),c=a.find("#popover-gift-connection #select-occasion").find(":selected").val();!b||"1"!==b&&"2"!==b?(a.find(".gift-connection-recipient-extra").hide(),"1"===c&&b&&da(b)):a.find(".gift-connection-recipient-extra").show();la(c,b);ia()}function Aa(a){a=S;var b=a.find("#popover-gift-connection #select-occasion").find(":selected").val(),c=a.find("#popover-gift-connection #select-recipient").find(":selected").val();!b||
"1"!==b&&"2"!==b?a.find(".gift-connection-occasion-extra").hide():("1"===b&&c&&"1"!==c&&"2"!==c&&da(c),a.find(".gift-connection-occasion-extra").show());la(b,c)}function oa(a){var b=S,c="/gp/buy/pipeline/handlers/list-of-giftlists.html?escape\x3d0";ma&&(c+="\x26mappingOnly\x3d1");a&&(c+="\x26fromRegistryIds\x3d"+a);J.ajax({type:"POST",url:c,dataType:"json",async:!0,cache:!1,timeout:5E3,success:function(c){b.find("#select-recipient").hide();!ma&&c.options&&0<c.options.length&&(ma=c.options);a&&c.registryIdMapping?
(ua[a]=c.registryIdMapping[a],pa=c.registryIdMapping[a]):a&&(ua[a]=F);ma&&l();b.find("#select-recipient").show();b.find("#select-recipient-spinner").hide();va=!0},error:function(){b.find("#select-recipient").show();b.find("#select-recipient-spinner").hide();va=!0}})}function Q(b,c){var d=Z(),e=c.lineItemId;c=Z()?c.currentTab:b.data("current-tab");var f=J("#popover-gift-options-wrapper-"+e).data("active-tab");c!==f&&(b.parent().find(".selected-giftwrap-tab").removeClass("selected-giftwrap-tab"),b.addClass("selected-giftwrap-tab"),
b=J("#giftwrap-carousel-wrap-holder-"+e),d||b.css("left",0),f=J("#giftwrap-carousel-wrap-holder-"+e+" li"),d?(a.trigger("checkout:gift:changeCarouselWrapOptions",b,c,e),a.trigger("checkout:gift:adaptCarouselSPCPanel",e,c)):"all"===c?f.show():(f.hide(),f.filter("."+{"gift-wrap":"gift-wrap",noshi:"noshi-wrap"}[c]).show()),J("#popover-gift-options-wrapper-"+e).data("active-tab",c),f.find(".selected-giftwrap-image").removeClass("selected-giftwrap-image"),f.filter(".none-wrap").find("img").addClass("selected-giftwrap-image"),
J("#giftwrap-option-preview-imagearea-default-"+e).removeClass("aok-hidden"),J("#giftwrap-option-preview-imagearea-image-"+e).addClass("aok-hidden"),d=J("#allGiftWrapList-"+e).find(".none-wrap").find("input"),e=J(".selectedWrapLargeLink"),d.prop("checked",!0),d.val("").change(),e.length&&(e.addClass("aok-hidden"),e.removeClass("selectedWrapLargeLink")))}function Ba(a,b,c){c.$event.preventDefault();a=b.lineItemId;b=parseInt(J("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);0>b&&(b=b+90+"px",J("#giftwrap-carousel-wrap-holder-"+
a).css("left",b))}function ta(a,b,c){c.$event.preventDefault();a=b.lineItemId;var d=J("#allGiftWrapList-"+a);b=d.find("li").size();c=d.find("li.gift-wrap").size();var d=d.find("li.noshi-wrap").size(),e=J("#popover-gift-options-wrapper-"+a).data("active-tab"),f;"all"===e?f=b:"gift-wrap"===e?f=c:"noshi"===e&&(f=d);b=parseInt(J("#giftwrap-carousel-wrap-holder-"+a).css("left"),10);b>-90*(f-4)&&(b=b-90+"px",J("#giftwrap-carousel-wrap-holder-"+a).css("left",b))}function wa(a,b){var c=b.lineItemId;J("#allGiftWrapList-"+
c).find(".selected-giftwrap-image").removeClass("selected-giftwrap-image");a.find(".afn-image").addClass("selected-giftwrap-image");b=a.parent();var d=a.data("giftwrap-id"),e=a.find("input"),f=a.data("wrap-no");e.prop("checked",!0);e.val(d).change();d=J("#giftwrap-option-preview-imagearea-default-"+c);c=J("#giftwrap-option-preview-imagearea-image-"+c);e=J(".selectedWrapLargeLink");f=J(".larger-image-link-carousel-"+f);b.hasClass("none-wrap")?(d.removeClass("aok-hidden"),c.addClass("aok-hidden"),e.length&&
(e.addClass("aok-hidden"),e.removeClass("selectedWrapLargeLink"))):(a=a.find("img").attr("src"),c.find("img").attr("src",a),d.addClass("aok-hidden"),c.removeClass("aok-hidden"),e.length&&(e.addClass("aok-hidden"),e.removeClass("selectedWrapLargeLink")),f.length&&(f.addClass("selectedWrapLargeLink"),f.removeClass("aok-hidden")))}function xa(a,b){var c=b.lineItemId;b=J("#giftwrap-option-preview-imagearea-default-"+c);c=J("#giftwrap-option-preview-imagearea-image-"+c);a.hasClass("none-wrap")?(b.removeClass("aok-hidden"),
c.addClass("aok-hidden")):(a=a.find("img").attr("src"),c.find("img").attr("src",a),b.addClass("aok-hidden"),c.removeClass("aok-hidden"))}function O(a,b){var c=b.lineItemId;a=J("#giftwrap-option-preview-imagearea-default-"+c);b=J("#giftwrap-option-preview-imagearea-image-"+c);J("#allGiftWrapList-"+c).find(".selected-giftwrap-image").parentsUntil("ul","li").hasClass("none-wrap")?(a.removeClass("aok-hidden"),b.addClass("aok-hidden")):(c=J("#allGiftWrapList-"+c).find(".selected-giftwrap-image").attr("src"),
b.find("img").attr("src",c),a.addClass("aok-hidden"),b.removeClass("aok-hidden"))}var J=a.$;if(!J("html").hasClass("a-ie6")){var qa,ra,S,ea,sa=!1,ja=!1,na=!0,fa=!0,ma,va=!1,ua={},pa,ka=!1;a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("gift-")&&(f.isSPP()&&e.increaseCount("checkout:spp-revieworder:gift_pop_cancel_sec",1),sa&&aa(),ja&&(a=S,a.find(".gift-msg-on-card").hide(),a.find(".popover-gift-warning").hide(),a.find(".message-remaining-text").show(),M(a.find(".amazon-gift-wrap")).removeAttr("checked"),
u(!1),a.find('input[type\x3d"checkbox"]').removeAttr("disabled")))});a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("gift-")){S=a.popover.$popover;ea=a.popover;0<S.find(".include-gift-receipt-checkbox").length&&(ja=!0);h.showSpinner(S.find(".popover-content-main"),!1,ea);S.find(".content-container").css("visibility","hidden");a="returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isDecoupleSPC\x3d1\x26cachebuster\x3d"+(new Date).getTime();try{var c=ea.data;
if(c)a+="\x26obfuscatedEntityId\x3d"+c;else throw{name:"MissingData",message:"lineItemId is undefined"};}catch(d){q.ueLogError&&q.ueLogError(d,{logLevel:"FATAL",attribution:"gift-popover",message:"[No lineItemId to open the gift-popover with]. "})}J.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/gift-select-content.html",data:a,dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},dataFilter:function(a){return b.jsonify(a)},success:function(a,b,c){a&&a.conductoraction&&a.conductoraction.url&&
f.redirect(a);null!==a?v(a,b,c):f.ajaxRedirect()},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}});a.on("a:popover:beforeShow",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-gift"))b=S,a.popover.$popover.find(".a-popover-inner").html(b.find(".current-blocker-content").text()),a.popover.updatePosition(!0);else if(a.popover&&a.popover.$popover){var b=a.popover.$popover;a=b.find(".validateInputCharactersOnBlur.a-form-error");0<a.size()&&a.removeClass("a-form-error");
b=b.find("#onblur-character-validation-error-gift-message-text");0<b.size()&&b.remove()}});var za={enforceSelectorParity:x,enforceGiftReceiptParity:G,enforceHidePriceParity:R,disableHidePrice:y,toggleMessageBoxDisplay:B,toggleEmptyMsgWarning:L,toggleNoReceiptWarning:X,includeGiftConnection:C,clearGiftConnection:W,toggleGiftConnectionRecipientArea:N,toggleGiftConnectionOccasionArea:Aa,updateGiftOptionsTabSelection:Q,updateCarouselOnLeftClick:Ba,updateCarouselOnRightClick:ta,updateSelectedGiftWrap:wa,
updatePreviewImageOnMouseEnter:xa,updatePreviewImageOnMouseLeave:O},M=c.getInput;a.declarative("gift-popover-element",["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(za[b[c]])za[b[c]](a.$target,a.data)});a.declarative("gift-popover-element","click mouseenter mouseleave",function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(za[b[c]])za[b[c]](a.$currentTarget,
a.data,a)});a.declarative("spc-update-gift-options-tab-selection","click",function(a){var b=a.$target.parents("li");b.attr("data",a.data);Q(b,a.data)});a.on("checkout:reload:spc",n);a.on("checkout:reload:spp-revieworder",n)}});"use strict";r.when("A","page-transition-controller","loading-spinner-controller","ajax-utility","page-conductor","checkout-general-utils","page-detector","client-side-metrics").register("concealment-popover-controller",function(a,k,h,b,f,g,m,e){function c(){v("#spc-orders").find(".concealment-widgets-desktop").removeClass("no-js-hide");
a.defer(function(){v("#spc-orders").find(".concealment-popover-link").each(function(){v(this).data("action")&&v(this).removeAttr("href").attr("tabindex",0)})})}function p(a){return a.is("input")?a:a.find("input")}function l(a){var b=t;b.find(".fake-label").each(function(){v(this).unbind("click").bind("click",function(){v(this).closest(".popover-checkbox").find("input").trigger("click")})});a&&a.item&&a.item.title&&b.find(".concealment-item-title").html(a.item.title);if(a&&a.obfuscatedEntityId){var c=
b.find(".set-concealment-options-button input");c.unbind("click").bind("click",{obfuscatedentityid:a.obfuscatedEntityId,concealmentData:a,quantity:a.quantity},n);g.bindActionEnterKeyOnButton(c)}y=a&&a.item&&a.item.isAmazonFulfilled;a&&a.selected&&(c=p(b.find(".conceal-item-checkbox")),a.selected.concealItem?c.attr("checked",!0):c.removeAttr("checked"));t.find(".content-container").css("visibility","visible");r.updatePosition(!0);h.hideSpinner(b.find(".popover-content-main"))}function n(a){var c=t,
g="";a&&a.data&&a.data.obfuscatedentityid&&(g+="obfuscatedEntityId.0\x3d"+a.data.obfuscatedentityid+"\x26");a&&a.data&&a.data.quantity&&(g+="quantity.0\x3d"+a.data.quantity+"\x26");var h="";a&&a.data&&a.data.concealmentData&&a.data.concealmentData.saveConcealmentRefTag&&(h=a.data.concealmentData.saveConcealmentRefTag);var l="";a&&a.data&&a.data.concealmentData&&a.data.concealmentData.cancelConcealmentRefTag&&(l=a.data.concealmentData.cancelConcealmentRefTag);(a=p(c.find(".conceal-item-checkbox")).is(":checked"))?
(y&&(g+="isAFN.0\x3d1\x26"),g=g+"includeReceipt.0\x3d1\x26includeMessage.0\x3d1\x26"+("message.0\x3d"+encodeURIComponent(v("input[name\x3d'concealment-item-message']").val())+"\x26"),g=g+"hidePrices.0\x3d0\x26saveOnly\x3d1"+("ref\x3d"+h+"\x26")):g+="ref\x3d"+l+"\x26";var m=v("input#executionId").val();m&&(g+="executionId\x3d"+m+"\x26");m="/gp/buy/gift/handlers/save-all.html/ref\x3d";a?(m+=h,e.increaseCount("CPEX.Checkout.Select.Concealment",1)):(m+=l,e.increaseCount("CPEX.Checkout.Cancel.Concealment",
1));f.isSPP()&&(c.find(".a-button-close").trigger("click"),h=v("#setOrderingPrefsCheckbox"),h.length&&h.is(":checked")&&(g+="\x26saveAsDefaultsSelected\x3d1"));k.show();v.ajax({type:"POST",url:m,data:g,dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"},contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",success:function(a,d,e){e.getResponseHeader("x-amz-checkout-page")?(f.isSPP()||c.find(".a-button-close").trigger("click"),f.ajaxUpdatePage(a,
d,e)):(a=b.jsonify(a),f.redirect(a))},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}var v=a.$;if(!v("html").hasClass("a-ie6")){var t,r,y=!0;v(document).delegate(".concealment-popover-link, .concealment-options-button","click",function(){e.increaseCount("CPEX.Checkout.Concealment.Button.click",1)});a.on("a:popover:hide",function(a){a.popover&&a.popover.name&&0===a.popover.name.indexOf("concealment-")&&(f.isSPP()&&e.increaseCount("checkout:spp-revieworder:concealment_pop_cancel_sec",1),p(t.find(".conceal-item-checkbox")).removeAttr("checked"))});
a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("concealment-")){t=a.popover.$popover;r=a.popover;h.showSpinner(t.find(".popover-content-main"),!1,r);t.find(".content-container").css("visibility","hidden");a="returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isDecoupleSPC\x3d1\x26cachebuster\x3d"+(new Date).getTime();try{var c=r.data.lineItemEntityId,e=r.data.itemId;if(c)a+="\x26obfuscatedEntityId\x3d"+c;else if(e)a+="\x26lineItemEntityId\x3d"+e;else throw{name:"MissingData",
message:"lineItemId is undefined"};var g=r.data.quantity;if(g)a+="\x26quantity\x3d"+g;else throw{name:"MissingData",message:"quantity is undefined"};}catch(k){q.ueLogError&&q.ueLogError(k,{logLevel:"FATAL",attribution:"concealment-popover",message:"[Data missing to open the concealment-popover]. "})}c=r.data.ref;v.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/concealment-select-content.html/ref\x3d"+c,data:a+("\x26ref\x3d"+c),dataType:"text",async:!0,cache:!1,headers:{"x-amz-checkout-page":"spc"},
dataFilter:function(a){return b.jsonify(a)},success:function(a,b,c){a&&a.conductoraction&&a.conductoraction.url&&f.redirect(a);null!==a?l(a,b,c):f.ajaxRedirect()},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}});a.on("a:popover:beforeShow",function(a){if(a.popover&&a.popover.name&&0===a.popover.name.indexOf("button-blocker-concealment")){var b=t;a.popover.$popover.find(".a-popover-inner").html(b.find(".current-blocker-content").text());a.popover.updatePosition(!0)}});var z={};a.declarative("concealment-popover-element",
["change"],function(a){var b;b=a.$event.isInit?a.data.onInit||[]:a.data.onChange||[];for(var c=0;c<b.length;c++)if(z[b[c]])z[b[c]](a.$target,a.data)});a.declarative("concealment-popover-element","click mouseenter mouseleave",function(a){var b;if(b=a.data[{click:"onClick",mouseenter:"mouseEnter",mouseleave:"mouseLeave"}[a.type]])for(var c=0;c<b.length;c++)if(z[b[c]])z[b[c]](a.$currentTarget,a.data,a)});a.on("checkout:reload:spc",c);a.on("checkout:reload:spp-revieworder",c)}});"use strict";r.when("A",
"page-conductor","scroll-controller","page-detector","client-side-metrics","button-blocker","weblab-helper").register("gold-box-controller",function(a,k,h,b,f,g,m){function e(){a.defer(l);a.defer(n)}var c=a.$,p={};if(!c("html").hasClass("a-ie6")){var l=function(){var a=c("#goldbox-countdown"),b=c("#spc-orders");b&&0!==b.length||(b=c("#spclite-items-block"));b=b.find("input[name\x3dgoldboxexpirelefttime]");if(0!==b.length){if(1<b.size()){var e=parseInt(b.attr("data-timeleftms"),10),g=b;c.each(b,function(){var a=
c(this),b=parseInt(a.attr("data-timeleftms"),10);b<e&&(g=a,e=b)});b=g}var l=parseFloat(b.attr("data-pagestarttime")),d=parseFloat(b.attr("data-timeleftms")/1E3);if(!(isNaN(l)||isNaN(d)||0>=d)){var n=(new Date).getTime();m.isTSPCGoldBoxTimerFixEnabled()&&(isNaN(p[l])?(p={},p[l]=n):n=p[l]);var r=a.find("span[data-timefield\x3dminute]"),w=a.find("span[data-timefield\x3dsecond]"),H=q.setInterval(function(){var b=(new Date).getTime();d-=(b-n)/1E3;n=b;if(0>d&&H)w.html("00"),q.clearInterval(H),H=null,k.isSPP()&&
f.increaseCount("checkout:spp-revieworder:deal_expired",1),c("#gold-box-modal-launcher").trigger("click"),h.scrollToTop(),h.toggleScrollOff();else{var b=Math.floor(d/60%60),e=Math.floor(d%60),e=10>e?"0"+e:e;r.html(b);w.html(e);a.is(":visible")||a.show()}},1E3);k.isSPP()&&f.increaseCount("checkout:spp-revieworder:deal_countdown",1)}}},n=function(){var a=c("#gold-box-button-blocker");1===a.length&&g.show("place-order-gold-box-blocker",a.attr("data-blocker-message"))};a.on("checkout:reload:spc",e);a.on("checkout:reload:spclite",
e);a.on("checkout:reload:spp-revieworder",e)}});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","currency-formatter","page-detector","client-side-metrics","pay-rewards-currency","weblab-helper").register("inline-points-controller",function(a,k,h,b,f,g,m,e,c){function p(){d("#spc-points-input")&&d("#spc-points-input").data("points-used")&&(d("#points-applied").show(),d("#inline-points-button").hide());d("#inline-points-register")&&d("#inline-points-register").removeAttr("href");
d("#spc-loyalty-points-input")&&d("#spc-loyalty-points-input").val()&&(d("#loyalty-points-applied").show(),d("#loyalty-points-button").hide());d("#spc-points-input")&&d("#spc-points-input").hasClass("show-currency-input-widget-new")&&d("#spc-points-input").each(function(b,c){var f=a.$(c);b={$element:f,maxAmount:f.data("max-dollar-amount")};c={$element:a.$("#inline-raw-points"),decimalPlaces:f.data("decimal-places"),ratio:f.data("conversion-ratio")};var g=f.data("country-code"),g=e.getCurrencyFormatByCountryCode(g);
e.initializeInlineFormatting(b,c,g);d(document).delegate("#spc-points-input","keydown",function(a){if(f.data("points-used")!==f.val){a=d("#inline-points-button");var b=!1;a.is("span")&&(b=!0);var c=a.find("span.apply"),e=a.find("span.change");d("#points-applied").hide();f.data("points-used")?(c.hide(),e.show()):(c.show(),e.hide());b?a.addClass("display-inline-block"):a.show()}})})}function l(a,c){a.preventDefault();if(n(c)){b.isSPP()?(k.blockAllActions(),k.showTransitionInContainer(d("#payment"))):
k.show();var e;a={"x-amz-checkout-page":"spc"};if(c)e=d("#loyalty-points-hidden-fields"),c="/gp/buy/spc/handlers/update-loyalty-points.html/ref\x3dox_spc_points_edit",e="\x26jpPointsPaymentInstrumentId\x3d"+encodeURIComponent(e.find("input[name\x3d'jpPointsPaymentInstrumentId']").val())+"\x26jpPointsCustomerRequestedAmount\x3d"+d("#spc-loyalty-points-input").val()+"\x26jpPointsConversionRate\x3d"+e.find("input[name\x3d'jpPointsConversionRate']").val()+"\x26jpPointsBaseCurrencyCode\x3d"+e.find("input[name\x3d'jpPointsBaseCurrencyCode']").val()+
"\x26jpPointsTargetCurrencyCode\x3d"+e.find("input[name\x3d'jpPointsTargetCurrencyCode']").val()+"\x26jpPointsAvailablePoints\x3d"+e.find("input[name\x3d'jpPointsAvailablePoints']").val()+"\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+d("input[name\x3duseCtb]").val();else{a=b.setAjaxTransitionHeader(a);e=d("#inline-points-hidden-fields");var f=e.find("input[name\x3d'useGCBalance']").val();c="/gp/buy/pipeline/handlers/update-reward-points.html/ref\x3d"+(b.isSPP()?"chk_pay_addswp_coll":"ox_pay_page_points_apply");
e="paymentMethodId\x3d"+e.find("input[name\x3d'paymentMethodId']").val()+"\x26paymentMethodType\x3d"+e.find("input[name\x3d'paymentMethodType']").val()+"\x26rewardAccountId\x3d"+e.find("input[name\x3d'rewardAccountId']").val()+"\x26rewardAccountAmount\x3d"+d("#spc-points-input").val()+"\x26rewardAccountRate\x3d"+e.find("input[name\x3d'rewardAccountRate']").val()+"\x26useGCBalance\x3d"+f+"\x26usePromoBalance\x3d"+f+"\x26returnFullHTML\x3d1\x26returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+
d("input[name\x3duseCtb]").val()}d.ajax({type:"POST",url:c,data:e,dataType:"text",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",headers:a,success:function(a,c,d){d.getResponseHeader("x-amz-checkout-page")?b.ajaxUpdatePage(a,c,d):(a=h.jsonify(a),b.redirect(a))},error:function(a,c,d){b.ajaxRedirect(a,c,d)}})}}function n(a){var b=!1,c=d("input[name\x3drewardAccountAmount]"),e=d("#inline-points-error-block");a||d("#spc-points-input")&&!d("#spc-points-input").hasClass("show-currency-input-widget-new")?
(a&&(c=d("input[name\x3dloyaltyPointsValue]"),e=d("#loyalty-points-error")),e.hide(),e.find("p").hide(),q(c))?r(c,a)?y(c,a)||(e.find("p").filter(function(){return"badMax"===d(this).data("error")}).show().css("display","inline"),b=!0):(e.find("p").filter(function(){return"badMin"===d(this).data("error")}).show().css("display","inline"),b=!0):(e.find("p").filter(function(){return"badValue"===d(this).data("error")}).show().css("display","inline"),b=!0):a||r(c,a)||(e.find("p").filter(function(){return"badMin"===
d(this).data("error")}).show().css("display","inline"),b=!0);if(b)return e.show(),c.addClass("a-form-error"),!1;c.removeClass("a-form-error");return!0}function v(a,b){var c=d(a.currentTarget),e=c.val();a=d("#inline-raw-points");b&&(a=d("#loyalty-points-applied-value"));var g=a.html();if(b)!/^\s*$/.test(e)&&!isNaN(e)&&0<e?a.html(e):a.html(0);else if(!d("#spc-points-input").hasClass("show-currency-input-widget-new")){var h=c.data("min-dollar-amount");!/^\s*$/.test(e)&&!isNaN(e)&&0<e&&!isNaN(h)&&e>=
h?(h=c.data("conversion-ratio"),c=c.data("decimal-places"),e=f.getNumberWithSeparators(e/h,c),a.html(e)):a.html(0)}(b||d("#points-applied").is(":visible"))&&g!==a.html()&&(a=d("#spc-loyalty-points-display"),g=d("#loyalty-points-applied"),e=d("#loyalty-points-button"),c=!1,b||(a=d("#inline-points-button"),a.is("span")&&(c=!0),g=a.find("span.apply"),e=a.find("span.change"),d("#points-applied").hide()),g.hide(),e.show(),c?a.css("display","inline-block"):a.show())}function q(a){a=a.val();return/^\s*$/.test(a)||
!isNaN(a)}function r(a,b){if(b)return!0;b=a.val();if(/^\s*$/.test(b))return!0;b=parseFloat(b);return isNaN(b)||!a.data("min-dollar-amount")?!0:0===b||b>=a.data("min-dollar-amount")}function y(a,b){var c=a.val();if(/^\s*$/.test(c))return!0;var c=parseFloat(c),d=a.data("max-dollar-amount");b&&(d=a.data("available-points"));return isNaN(c)||!d?!0:c<=d}function z(a){switch(a.keyCode?a.keyCode:a.which){case 13:case 10:var b=d("#loyalty-points-button"),c=d("#spc-points-input");0<b.length&&b.is(":visible")?
l(a,1):0<c.length&&l(a,0)}}var d=a.$;d("html").hasClass("a-ie6")||(d(document).delegate("#spc-loyalty-points-input","keypress",function(a){z(a)}),d("#spc-points-input")&&!d("#spc-points-input").hasClass("show-currency-input-widget-new")&&(d(document).delegate("#spc-points-input","keypress",function(a){z(a)}),d(document).delegate("#spc-points-input","keyup",function(a){v(a,0)})),d(document).delegate("#spc-loyalty-points-input","keyup",function(a){v(a,1)}),d(document).delegate("#inline-points-button",
"click",function(a){l(a,0)}),d(document).delegate("#loyalty-points-button","click",function(a){l(a,1)}),a.on("a:expander:apply-point-expander:toggle:expand",function(a){m.increaseCount("checkout:spp-payment:expand_addswp_coll",1)}),a.on("checkout:reload:spc",p),a.on("checkout:reload:spp-revieworder",p))});"use strict";r.when("A","client-side-metrics","ready").execute(function(a,k){var h=a.$;a.on("checkout:reload:spc",function(){var a=h("input[name\x3d'rewardsProgramId']").val(),f=h("input[name\x3d'swpWidgetCase']").val();
a&&f&&k.increaseCount("Checkout::SPC::SWPWidgetCSM::"+a+"::"+f,1)})});"use strict";r.when("A","client-side-metrics","ready").execute(function(a,k){function h(){"1"!==b("meta[name\x3dSWP_TPP_FEATURE_ENABLED]").attr("content")||f||b.ajax({type:"POST",url:"/gp/shopwithpoints/temporaryPreference/verify-and-log-temporary-preference.html",data:{sourcePage:"SPC"},dataType:"text",async:!0,success:function(){f=!0;k.increaseCount("Checkout::SPC::LogTemporaryPaymentPreferenceAppliedAjax::Success",1)},error:function(){k.increaseCount("Checkout::SPC::LogTemporaryPaymentPreferenceAppliedAjax::Failure",
1)}})}var b=a.$,f=!1;a.on("checkout:reload:spc",h);a.on("checkout:reload:spclite",h);a.on("checkout:reload:spp-revieworder",h);a.on("checkout:reload:spp-collapsed",h)});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor").register("inline-fps-balance-controller",function(a,k,h,b){function f(a){a.preventDefault();g("#inline-fps-balance-checkbox").prop("disabled","disabled");b.isSPP()?(k.blockAllActions(),k.showTransitionInContainer(g("#payment"))):k.show();var e=g("#inline-fps-balance-hidden-fields"),
c=0;g("#inline-fps-balance-checkbox").prop("checked")&&(c=1);a=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});var f="/gp/buy/pipeline/handlers/update-fps-balance.html/ref\x3d"+(b.isSPP()?"chk_pay_"+(c?"apply":"remmove")+"_fps_balance_coll":"ox_spc_page_fps_balance_apply"),e="fpsPaymentMethodId\x3d"+e.find("input[name\x3d'fpsPaymentMethodId']").val()+"\x26useFlexiblePayments\x3d"+c+"\x26returnFullHTML\x3d1\x26returnjson\x3d1\x26hasWorkingJavascript\x3d1\x26isClientTimeBased\x3d"+g("input[name\x3duseCtb]").val();
g.ajax({type:"POST",url:f,data:e,dataType:"text",async:!0,cache:!1,headers:a,success:function(a,c,e){e.getResponseHeader("x-amz-checkout-page")?b.ajaxUpdatePage(a,c,e):(a=h.jsonify(a),b.redirect(a))},error:function(a,c,e){b.ajaxRedirect(a,c,e)}})}var g=a.$;g("html").hasClass("a-ie6")||g(document).delegate("#inline-fps-balance-checkbox","click",function(a){f(a)})});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","checkout-general-utils","error-feature-detection",
"page-detector","client-side-metrics","weblab-helper","a-modal").register("shipping-speed-selection-controller",function(a,k,h,b,f,g,m,e,c,p){function l(){U?x("fieldset div.a-radio").addClass("a-touch-radio"):a.defer(function(){var a=x("#spc-orders").find("div.ship-option");a.filter(".no-scheduled-delivery");a.each(function(){x(this).find("input.radio-image").remove()});a.each(function(){var a=x(this).find("input.radio-standard");a.attr("checked")&&a.attr("checked",!0)})});Y=x("#spc-orders").find("div.ship-option").find('input[type\x3d"radio"]:checked');
Z=Y.attr("value");n();g.markFeatureAvailable("shipping-speed-selection-controller");v()}function n(){var a=0<x("#trigger-case-call-to-resolve-cv").length||0<x(".force-resolve-invalid-ship-option").length;if(b.isSPP()&&a){var a=function(){var a=q.setInterval(function(){b.isAnimating()||(k.show(),q.clearInterval(a))},50)},c=x("div.ship-option").filter(".call-set-to-resolve-cv").first().find("input[type\x3d'radio']");if(c&&c.length){var d=c.parents(".shipping-speeds").find("input.lineitemidinput[type\x3dhidden]").val();
B(c,null,null,{transitionAction:a,refTag:"chk_revieworder_set_ship_option_no_default",extraData:{callingCASEResolveCV:1,lineItemIds:d}})}}}function v(){x("#buy-button-disabled-state").length&&t(function(a){A(a)})}function t(a){c.isSDGoldenCXSPCDesktopEnabled()?x("div.sd-widgets").each(function(b,c){a(c)}):x("div.sd_widget_root").each(function(b,c){a(c)})}function A(a){var b=setInterval(x.proxy(function(){if(x(this).hasClass("sd_widget_initialized")){var a=x(this),c=x(a).attr("id");c&&(a=y(a),a["ScheduledDeliveryEntity.startDeliveryDate"]&&
B(null,c,a));q.clearInterval(b)}},a),1E3)}function y(a){var b={};z(a,function(a){var c=x(a).attr("key");a=x(a).val();b[c]=a||""});return b}function z(a,b){x(a).find("input[type\x3d'hidden']").each(function(a,c){b(c)})}function d(){P||(P=x("input[type\x3d'hidden'][name\x3d'scopeId']").val());return P}function u(a,d,e){if(e.getResponseHeader("x-amz-checkout-page")){var f=h.jsonify(a);return f&&f.success&&f.trialkey&&T[f.trialkey]?(a=T[f.trialkey],b.isSPP()&&"object"===typeof a&&(a=JSON.stringify(T[f.trialkey])),
c.isSPCMobileDisplayMoreShipOptionsEnabled()&&0<x(".mobile-view").length?b.ajaxUpdatePage(a,d,e,{pushNewFrame:"false"}):b.ajaxUpdatePage(a,d,e),ba&&(clearTimeout(ba),ba=null),T={},!0):c.isSPCMobileDisplayMoreShipOptionsEnabled()&&0<x(".mobile-view").length?b.ajaxUpdatePage(a,d,e,{pushNewFrame:"false"}):b.ajaxUpdatePage(a,d,e)}return b.redirect(a)}function D(a,b){if(a){var c=a.data(b);if(c!==F)return c;(a=a.closest(".radio-standard"))&&(c=a.data(b));return c}}function w(a){a.closest("fieldset").find("i.a-icon-touch-radio-active").removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive");
a.siblings("i").addClass("a-icon-touch-radio-active").removeClass("a-icon-touch-radio-inactive")}function H(a){var b=a;x(".shipping-group").each(function(a,c){var d=!1;x(c).parents().each(function(a,b){return x(b).hasClass("shipment")?(d=!0,!1):!0});d||(b=b.add(c))});return b}function B(a,g,h,l){U&&w(a);l&&l.transitionAction?l.transitionAction():k.show();for(var p in ga)ga.hasOwnProperty(p)&&(ga[p].abort(),delete ga[p]);h=x("#spc-orders").find("input[type\x3d'hidden'][name\x3d'shiptrialprefix']").val();
var m;a||(a=x("#"+g).closest(".shipping-speed").find("input[type\x3d'radio']"));a.attr("value")!==Z&&(e.increaseCount("checkout:spc:shipoption:change",1),Z=a.attr("value"));m=a.closest(".shipment").data("orderid");a&&a.length&&a.hasClass("valid-btn")&&a.closest(".prime-calendar").hasClass("long-calendar")&&(m=a.closest(".prime-calendar").data("orderid"));var n="returnpipedata\x3d0\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1";if(l&&l.extraData)for(var q in l.extraData)l.extraData.hasOwnProperty(q)&&
(n+="\x26"+q+"\x3d"+l.extraData[q]);var v=x(".shipment"),t=0;g=v.length;v=H(v);n+="\x26groupsadded\x3d"+(v.length-g);v.each(function(b,d){var e=x(d),f="",g=e.has(".prime-calendar-container"),h=e.find("input[name\x3d'currentshippingspeed']").attr("value"),l=e.find("input[name\x3d'currentshipsplitpreference']").attr("value");1===v.length&&(n+="\x26oldoption\x3d"+h+"."+l);var k=e.find("input[name\x3d'defaultshipsplitpreference."+t+"']").attr("value"),p=e.find("input[name\x3d'usingprimeshipping."+t+"']").attr("value");
k&&p&&(n+="\x26defaultshipsplitpreference."+t+"\x3d"+k,n+="\x26usingprimeshipping."+t+"\x3d"+p);k=e.find(".shipping-speed");p=a?k.find('input[type\x3d"radio"]:checked'):k.find("input[src*\x3dradio-on]");g&&!p.length&&(p=e.find("input[name\x3d'hiddenSelection"+t+"']"));k=e.find(".ship-split-preferences").find("input[type\x3d'radio']:checked");1!==k.length&&(k=e.find(".ship-split-preferences").find("input[type\x3d'hidden'][name^\x3d'shippriority']"));m===e.data("orderid")&&(D(a,"shippingofferingid")?
p=a:k=a,1===v.length&&(f=g?f+("\x26option\x3d"+p.data("key")+"."+(k?k.attr("value"):"")):f+("\x26option\x3d"+p.attr("value")+"."+(k?k.attr("value"):""))));var q=e.find("input[name\x3d'lineitemids"+t+"']");0<q.length&&(f+="\x26lineitemids"+t+"\x3d"+q.attr("value"));c.isSecureUnifiedDeliveryEnabled()&&(q=e.find("input[name\x3d'issecureunifieddelivery"+t+"']"),0<q.length&&(f+="\x26issecureunifieddelivery"+t+"\x3d"+q.attr("value")));f+=V(e,t);if(p.length){h=p;l=k;q="";d=t;D(h,"rcxsspdecoupling")?(q={},
q["shippingspeed"+d]=g?h.attr("key"):h.attr("value"),q["shippingofferingid"+d]=D(h,"shippingofferingid"),q["guaranteetype"+d]=D(h,"guaranteetype"),q["issss"+d]=D(h,"issss"),q["forceshipsplitpreference"+d]=D(h,"forceshipsplitpreference"),g="shipWhenComplete",l&&(g=l.attr("value")),1===D(h,"isscheduleddelivery")&&(q["isscheduleddelivery"+d]="1",g="shipWhenComplete"),q["shippriority"+d]=g,q["preferredSSP"+d]=D(h,"shipsplitpriority"),q["currentSSP"+d]=l.attr("value"),q["isShipWheneverValid"+d]=D(h,"isshipwhenevervalid"),
q["isShipWhenCompleteValid"+d]=D(h,"isshipwhencompletevalid"),q=x.param(q),g="\x26"+q):(q=g?q+("\x26shippingspeed"+d+"\x3d"+h.data("key")):q+("\x26shippingspeed"+d+"\x3d"+h.attr("value")),q+="\x26shippingofferingid"+d+"\x3d"+D(h,"shippingofferingid"),q+="\x26guaranteetype"+d+"\x3d"+D(h,"guaranteetype"),q+="\x26issss"+d+"\x3d"+D(h,"issss"),q+="\x26forceshipsplitpreference"+d+"\x3d"+D(h,"forceshipsplitpreference"),g="shipWhenComplete",l&&(g=l.attr("value")),1===D(h,"isscheduleddelivery")&&(q+="\x26isscheduleddelivery"+
d+"\x3d1",g="shipWhenComplete"),g=q+("\x26shippriority"+d+"\x3d"+g));f+=g;if(1===D(p,"isscheduleddelivery")){g=p.closest(".shipping-speed").find('[id^\x3d"sd_widgets_"]');if(h=c.isSDGoldenCXSPCDesktopEnabled())h=g,h=c.isExcludeMdwFromGoldenCXWidgetRenamingWeblabEnabled()?!(h&&h[0]&&h[0].classList&&h[0].classList.contains("sd-mdw-widget-root")):!0;h&&(g=x("#sd-widgets-"+b));f+="\x26"+g.children(":input").serialize()}else 1===D(p,"isscheduleddeliveryslot")&&D(p,"sddatastring")&&(f+="\x26ScheduledDeliveryEntity.data."+
t+"\x3d"+encodeURIComponent(p.data("sddatastring")));c.isRushIspuSpeedInputUpdateFixEnabled()&&"rush-ispu"===p.attr("value")&&(b=f,p=t,g=""+("\x26preferredSSP"+p+"\x3d"+e.find("input[type\x3d'hidden'][name^\x3d'shipsplitpriority']").val()),g+="\x26currentSSP"+p+"\x3d"+k.attr("value"),"shipWhenever"==e.find("input[name\x3d'ispuShipSplitPriority']").attr("value")&&(g=g+("\x26isShipWheneverValid"+p+"\x3d1")+("\x26isShipWhenCompleteValid"+p+"\x3d0")),f=b+g)}else b=c.isVasTrueSPCEnabled()?"1"===x.trim(e.data("iahiddenshipment"))||
0<e.find(".vas-scheduling-prefBlock").length:0<e.find(".vas-scheduling-prefBlock").length,b?(b=f,k=t,p=""+("\x26shippingofferingid"+k+"\x3d"+e.find("input[type\x3d'hidden'][name^\x3d'shippingofferingid']").val()),p+="\x26guaranteetype"+k+"\x3d"+e.find("input[type\x3d'hidden'][name^\x3d'guaranteetype']").val(),p+="\x26issss"+k+"\x3d"+e.find("input[type\x3d'hidden'][name^\x3d'issss']").val(),p+="\x26forceshipsplitpreference"+k+"\x3d"+e.find("input[type\x3d'hidden'][name^\x3d'forceshipsplitpreference']").val(),
f=b+(p+("\x26shippingspeed"+k+"\x3d"+h)+("\x26shippriority"+k+"\x3d"+l))):c.isRemoveDigitalFlagForScheduledDeliveryShipmentEnabled()&&"1"===x(d).find("input[type\x3d'hidden'][name\x3d'previousSDSelected"+t+"']").attr("value")||(f+="\x26isdigital"+t+"\x3d1");t++;n+=f});0<t&&(n+="\x26groupcount\x3d"+t);g="ox_spc_set_ship_option";b.isSPP()&&(g="chk_revieworder_set_ship_option",q=x("#setOrderingPrefsCheckbox"),q.length&&q.is(":checked")&&(n+="\x26saveAsDefaultsSelected\x3d1"));q=x("input[name\x3duseCtb]").val();
n+="\x26isClientTimeBased\x3d"+q;1===D(a,"istrial")?(h=d()+":"+a.attr("name")+":"+a.attr("value"),n+="\x26trialkey\x3d"+h,T[h]&&(ba&&clearTimeout(ba),g="ox_spc_set_cached_ship_option",b.isSPP()&&(g="chk_revieworder_set_cached_ship_option"),n=n.replace("returnFullHTML\x3d1","returnFullHTML\x3d0"),n+="\x26trialSuccess\x3d1")):"undefined"!==typeof h&&(h=h+":"+a.attr("name")+":"+a.attr("value"),n+="\x26trialkey\x3d"+h);l&&l.refTag&&(g=l.refTag);l&&l.removeGiftOption&&(n+="\x26giftOrderid\x3d"+a.closest(".shipment").data("orderid"));
0===n.indexOf("\x26")&&(n=n.substr(1));l="/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+g;h=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});c.isSPCMobileDisplayMoreShipOptionsEnabled()&&0<x(".mobile-view").length&&(h=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"}));x.ajax({type:"POST",url:l,data:n,dataType:"text",async:!0,cache:!1,headers:h,success:function(a,b,c){u(a,b,c);f.nukeDropdowns("#b2brd-cadence-dropdown")},error:function(a,c,
d){b.ajaxRedirect(a,c,d)}})}function L(a,c){U&&w(a);a=c.find("input[name\x3d'ispuLoadingText']").attr("value");if(b.isSPP()&&a){var d=x("#shipaddress");d&&d.length&&(d.hasClass("expanded")?k.show():(k.shrinkPanel(x(".spp-panel.expanded"),!1),k.shrinkPanel(d,!0,a)))}else k.show();a="returnpipedata\x3d0\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1";var d=c.find("input[name\x3d'storeAddressID']").attr("value"),e=c.find("input[name\x3d'storeId']").attr("value"),
f=c.find("input[name\x3d'storeOwnerId']").attr("value"),g=c.find("input[name\x3d'lineItemsQuantity']").attr("value"),h=c.find("input[name\x3d'destinationType']").attr("value"),l=c.find("input[name\x3d'ispuShippingOfferingId']").attr("value"),p=c.find("input[name\x3d'ispuShipSplitPriority']").attr("value"),n=c.find("input[name\x3d'ispuGuaranteeType']").attr("value"),m=c.find("input[name\x3d'ispuPageType']").attr("value");a=a+("\x26storeId\x3d"+e)+("\x26storeAddressId\x3d"+d)+("\x26storeOwnerId\x3d"+
f);a+="\x26lineItemsQuantity\x3d"+g;a+="\x26destinationType\x3d"+h;a+="\x26shippingOfferingId\x3d"+l;a+="\x26shipPriority\x3d"+p;a+="\x26guaranteeType\x3d"+n;a+="\x26pageType\x3d"+m;c=c.find("input[name\x3d'retailProgram']");c.length&&(a+="\x26retailProgram\x3d"+c.attr("value"));c="chk_spc_ispu_ship_option";b.isSPP()&&(c="chk_revieworder_ispu_ship_option");c="/gp/buy/ispu/handlers/ispu-select-store.html/ref\x3d"+c;d=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});0<x(".mobile-view").length&&
(d=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"}));x.ajax({type:"POST",url:c,data:a,dataType:"text",async:!0,cache:!1,headers:d,success:function(a,b,c){u(a,b,c)},error:function(a,c,d){b.ajaxRedirect(a,c,d)}})}function X(a){var b=[a.closest(".shipment").data("orderid")];G(a,b)}function R(a){var b=[];x("#spc-orders").find(".shipment").each(function(a,c){b.push(a)});e.increaseCount("checkout:spc:mobile:same-day-upsell-banner:clicked",1);G(a,b)}function G(a,
c){k.show();var e="returnpipedata\x3d0\x26returnFullHTML\x3d1\x26cachebuster\x3d"+(new Date).getTime()+"\x26hasWorkingJavascript\x3d1",f="/gp/buy/spc/handlers/set-delivery-options.html/ref\x3d"+a.data("reftag");x("#spc-orders").find(".shipment").each(function(b,d){e+="\x26lineitemids"+b+"\x3d"+x(d).find("input[type\x3d'hidden'][name\x3d'lineitemids"+b+"']").attr("value");e+=V(x(d),b);var f=x(d).find("input[type\x3d'hidden'][name^\x3d'shippriority']");if(d=-1===c.indexOf(b)?x(d).find("#selected-ship-option-"+
b):a)e+="\x26shippingofferingid"+b+"\x3d"+d.data("shippingofferingid"),e+="\x26guaranteetype"+b+"\x3d"+d.data("guaranteetype"),e+="\x26issss"+b+"\x3d"+d.data("issss"),e+="\x26forceshipsplitpreference"+b+"\x3d"+d.data("forceshipsplitpreference"),e+="\x26shippriority"+b+"\x3d"+d.data("targetshipoptionkey"),d.data("rcxsspdecoupling")&&(e+="\x26preferredSSP"+b+"\x3d"+d.data("shipsplitpriority"),e+="\x26currentSSP"+b+"\x3d"+f.attr("value"),e+="\x26isShipWheneverValid"+b+"\x3d"+d.data("isshipwhenevervalid"),
e+="\x26isShipWhenCompleteValid"+b+"\x3d"+d.data("isshipwhencompletevalid"))});var g=x("#spc-orders").find("input[type\x3d'hidden'][name\x3d'groupcount']").val(),e=e+("\x26groupcount\x3d"+g),e=e+("\x26isClientTimeBased\x3d"+x("input[type\x3d'hidden'][name\x3d'useCtb']").attr("value")),e=e+("\x26trialkey\x3d"+d()+":"+a.data("orderindex")+":"+a.data("targetshipoptionkey")),g=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});x.ajax({type:"POST",url:f,data:e,dataType:"text",async:!0,cache:!1,headers:g,
success:function(a,b,c){u(a,b,c)},error:function(a,c,d){b.ajaxRedirect(a,c,d)}})}function K(b,c,d,e){f.protectAgainstDoubleAction(c)||C||(a.trigger(d,b),b=b.$currentTarget.find("a"),e&&e(b))}function V(a,b){var c=a.find("input[name\x3d'onOrAfterAppointment"+b+"']").val();a=a.find("input[name\x3d'onOrAfterLineItemId"+b+"']").val();var d="";c&&a&&(d=d+("\x26onOrAfterAppointment"+b+"\x3d"+c)+("\x26onOrAfterLineItemId"+b+"\x3d"+a));return d}function aa(){ca.closest("div.shipping-speed").find('input[type\x3d"radio"]').attr("checked",
!0);"undefined"!==typeof p?(0<x(".mobile-view").length?p.get(x("#faster-than-same-day-sosp-popover")):p.get(x("#faster-than-same-day-spc-popover"))).hide():a.$("div.a-popover button.a-button-close").trigger("click");B(ca,null,null,{removeGiftOption:!0})}var x=a.$;if(!x("html").hasClass("a-ie6"))if(q.spcpage){var P,T={},U=x("html").hasClass("a-touch"),ba,ga={},Y,Z,ca;q.spcpage.scheduledDeliverySetSOCallback=function(c,d){b.isSPP()&&a.objectIsEmpty(c)||(q.spcpage&&x("#spcpagecontent").is(":visible")?
q.spcpage.actionSetShipOptions(null,d,c):B(null,d,c))};q.spcpage.scheduledDeliverySetSOCallbackWithTarget=function(c,d,e){b.isSPP()&&a.objectIsEmpty(d)||(q.spcpage&&x("#spcpagecontent").is(":visible")?q.spcpage.actionSetShipOptions(null,e,d):B(c,e,d))};q.spcpage.scheduledDeliveryEnableSOCallback=function(){};q.spcpage.scheduledDeliveryMdwSetSOCallback=function(d,e,f){c.isSsdMdwEnabled()&&(b.isSPP()&&a.objectIsEmpty(e)||(q.spcpage&&x("#spcpagecontent").is(":visible")?q.spcpage.actionSetShipOptions(null,
f,e):B(d,f,e)))};q.spcpage.secureDeliverySetSOCallback=function(a,b){c.isSecureUnifiedDeliveryEnabled()&&B(a,null,null,b)};x(document).delegate(".ship-option","click",function(b){var d=x(b.target);c.isSPCMobileDisplayMoreShipOptionsEnabled()&&x(b.target).closest(".ship-option").hasClass("mobile-view")&&b.preventDefault();var g=x(b.currentTarget);e.resetMetrics();if(!(d.is('a[target\x3d"AmazonHelp"]')||d.is('a[target\x3d"PromoDetails"]')||d.hasClass("no-ship-option-selection-change")||g.is("input")||
d.hasClass("a-button")||d.closest("a-button").length||d.is("img")&&(d.closest("div").is(".prime-ship-speed")||d.closest(".prime-fake-radio").parent().is(".prime-ship-speed"))))if(d=g.find("div.prime-ship-speed"),0<d.length)d.find("a:first img").trigger("click");else if((d=g.find("input[type\x3d'image']").attr("src"))&&d.match(/radio-off/)&&x(".ap_popover_sprited").hide(),g=g.find("input[type\x3d'radio']"),(d=g.closest("div.shipping-speeds").data("sospargs"))&&1===g.data("isscheduleddelivery")&&!g.is(":checked"))k.show(),
g.attr("checked",!0),w(g),f.redirectWithJavascript("/gp/buy/shipoptionselect/handlers/display.html?"+d);else if(c.removesGiftOptionOnRush()&&0<g.closest(".shipment").find("input[name^\x3dItemIsGift]").length&&1===g.closest(".radio-standard").data("nosupportforgiftoption")){ca=g;ca.is(":checked")&&(ca.attr("checked",!1),Y.attr("checked",!0));var h=0<x(".mobile-view").length?x("#faster-than-same-day-sosp-popover"):x("#faster-than-same-day-spc-popover");"undefined"!==typeof p?p.get(h).show():a.delay(function(){h.trigger("click")},
10)}else if(g.hasClass("js-no-serverside-callback")&&(g.attr("checked",!0),w(g),g.closest(".a-section-expander-container").find(".a-link-section-expander").click()),!c.isSsdMdwEnabled()||1!==g.closest(".radio-standard").data("callcaseforsdoverride"))if(!c.isSDGoldenCXSPCDesktopEnabled()||1!==D(g,"isscheduleddelivery")||!m.isDesktopSpc()){var d=x("#disableSubmitButtons").length,l=!1;c.isSPCMobileDisplayMoreShipOptionsEnabled()&&(b=x(b.currentTarget).closest(".ship-option"),b.hasClass("mobile-view")&&
!b.hasClass("mobile-selected-option")&&(l=!0));!d&&g.is(":checked")&&!l||1===g.data("isscheduleddelivery")||(g.attr("checked",!0),B(g))}});x(document).delegate(".ship-option input[type\x3d'radio']","change",function(a){if(!c.isSPCMobileDisplayMoreShipOptionsEnabled()||!x(a.target).closest(".ship-option").hasClass("mobile-view")){a=x(a.currentTarget);var b=a.closest("div.prime-ship-speed");c.removesGiftOptionOnRush()&&0<a.closest(".shipment").find("input[name^\x3dItemIsGift]").length&&1===a.closest(".radio-standard").data("nosupportforgiftoption")||
c.isSsdMdwEnabled()&&1===a.closest(".radio-standard").data("callcaseforsdoverride")||c.isSDGoldenCXSPCDesktopEnabled()&&1===D(a,"isscheduleddelivery")&&m.isDesktopSpc()||(0<b.length?b.find('input[type\x3d"radio"]').attr("checked",!1):1!==a.data("isscheduleddelivery")&&B(a))}});x(document).delegate(".ispu-ship-option","click",function(a){if(c.isISPUMasterEnabled()){x(a.target).closest(".ispu-ship-option").hasClass("mobile-view")&&a.preventDefault();x(a.target);var b=x(a.currentTarget);e.resetMetrics();
var d=b.find("input[type\x3d'radio']"),f=!1;a=x(a.currentTarget).closest(".ispu-ship-option");a.hasClass("mobile-view")&&!a.hasClass("mobile-selected-option")&&(f=!0);if(!d.is(":checked")||f)d.attr("checked",!0),L(d,b)}else e.increaseCount("checkout:ispu:selection:weblab:disabled",1)});x(document).delegate(".ispu-ship-option input[type\x3d'radio']","change",function(a){if(!c.isISPUMasterEnabled())e.increaseCount("checkout:ispu:selection:weblab:disabled",1);else if(!x(a.target).closest(".ispu-ship-option").hasClass("mobile-view")){a=
x(a.currentTarget);var b=a.closest(".ispu-ship-option");L(a,b)}});x(document).delegate(".rush-ispu-ship-option","click",function(a){if(c.isRushISPUMasterEnabled()){x(a.target).closest(".rush-ispu-ship-option").hasClass("mobile-view")&&a.preventDefault();x(a.target);var b=x(a.currentTarget);e.resetMetrics();var d=b.find("input[type\x3d'radio']"),f=!1;a=x(a.currentTarget).closest(".rush-ispu-ship-option");a.hasClass("mobile-view")&&!a.hasClass("mobile-selected-option")&&(f=!0);if(!d.is(":checked")||
f)d.attr("checked",!0),L(d,b)}else e.increaseCount("checkout:rushIspu:selection:weblab:disabled",1)});x(document).delegate(".rush-ispu-ship-option input[type\x3d'radio']","change",function(a){if(!c.isRushISPUMasterEnabled())e.increaseCount("checkout:rushIspu:selection:weblab:disabled",1);else if(!x(a.target).closest(".rush-ispu-ship-option").hasClass("mobile-view")){a=x(a.currentTarget);var b=a.closest(".rush-ispu-ship-option");L(a,b)}});x(document).delegate(".rush-ispu-view-details-link","click",
function(a){a.preventDefault();a.stopPropagation()});x(document).delegate(".mfn-ispu-view-details-link","click",function(a){a.preventDefault();a.stopPropagation()});a.declarative("shipping-speed-expander-toggle",["click"],function(a){var b=a.$target.closest(".a-box"),c,d;b.hasClass("a-single")?(c=b.find(".expanded-header-content"),d=b.find(".collapsed-header-content"),d.hide(),c.hasClass("prime-title")&&c.find("div").attr("style",""),c.show()):(d=b.find(".collapsed-header-content"),c=b.find(".expanded-header-content"),
b=b.siblings(".a-expander-content").find(".a-icon-touch-radio-active").siblings(".a-radio-label").html(),d.html(b),c.hide(),d.show());f.toggleExpanderContent(a)});a.declarative("select-prime-slot",["click"],function(a){a=a.$currentTarget;x(".a-button-close").trigger("click");a.closest(".valid-slot").hasClass("selected-slot")||B(a)});var C=!1;x(document).delegate(".mobile-upsell","touchmove",function(a){C=!0});x(document).delegate(".mobile-upsell","touchstart",function(a){C=!1});a.declarative("select-upsell-shipping-speed",
["click","touchend"],function(a){K(a,"select-upsell-shipping-speed","a:checkout:mobile-upsell-shipping-speed:select",X)});a.declarative("select-all-upsell-shipping-speed",["click","touchend"],function(a){K(a,"select-all-upsell-shipping-speed","a:checkout:mobile-upsell-shipping-speed:select-all",R)});a.declarative("faster-than-same-day-save",["click"],aa);a.declarative("faster-than-same-day-sosp-save",["click"],aa);a.on("checkout:reload:spc",l);a.on("checkout:reload:spp-revieworder",l)}else r.log("window.spcpage undefined, shipping-speed-selection-controller not initialized",
"WARN","ship-speed")});"use strict";r.when("A","page-detector","spc-page-state","client-side-metrics","page-conductor","page-transition-controller","weblab-helper").register("order-summary-controller",function(a,k,h,b,f,g,m){function e(){c();H=d("#transactionalRadio");B=d("#marketplaceRadio");D=d("#tfx-see-exchange-rates");w=d("#tfx-switch-currency-options");u||(b.increaseCount("removeauijs15"),d("#transactionalRadioImage").remove(),d("#marketplaceRadioImage").remove(),d("#acceptAccImage").remove());
var a=d("#exchange-rate-link"),e=d("#switch-currency-link");if(0!==B.length){var f=w.find('input[name\x3d"switchCurrency"]'),g=f.not(":checked"),f=h.prop("currencyType")||f.filter(":checked").val();g.val()===f?g.trigger("click"):r(f);u||(b.increaseCount("removeauijs16"),a.find("i.a-icon-collapse").remove(),e.find("i.a-icon-collapse").remove())}}function c(){if(0!==d("#currencyConverterFooter").length){d("#tfx-header").hide();var a=d("input[name\x3d'placeYourOrderButtonText']").val();d(".place-your-order-button").val(a);
u&&(f.isSPP()?d(".place-order-button-text"):d(".place-your-order-button + span")).text(a);var a=p(),b=d("#subtotals-marketplace-table"),c=d("#subtotals-marketplace-spp-bottom"),e=d("#vatRetailSubtotals-marketplace-table"),g=d("#vatGlobalSubtotals-marketplace-table"),h=d("#vatMerchantSubtotals-marketplace-table"),k=d("#subtotals-transactional-table"),n=d("#subtotals-transactional-spp-bottom"),m=d("#vatRetailSubtotals-transactional-table"),q=d("#vatGlobalSubtotals-transactional-table"),v=d("#vatMerchantSubtotals-transactional-table");
"LOCAL"===a?(l("transactional"),k.show(),n.show(),m.show(),q.show(),v.show(),b.hide(),c.hide(),e.hide(),g.hide(),h.hide()):"MARKETPLACE"===a&&(l("marketplace"),k.hide(),n.hide(),m.hide(),q.hide(),v.hide(),b.show(),c.show(),e.show(),g.show(),h.show())}}function p(){return d("input[name\x3d'selectedCurrencyOption']").val()}function l(a){d(".tfx-currency").each(function(){d(this).text(d(this).data(a))})}function n(a,b){var e=f.setAjaxTransitionHeader(),h="/checkout/p/p-"+d("input[name\x3d'purchaseID']").val()+
"/currency-converter";g.show();d.ajax({type:"POST",url:h,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8",data:d.param(JSON.parse(JSON.stringify({termsAndConditions:a,currencyOption:b})),!0),dataType:"text",cache:!1,async:!0,headers:e,success:function(a,b,d){g.hide();f.ajaxUpdatePage(a,b,d);c()},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}function v(){var a=p(),b=d("input[name\x3d'currencyOptions']:checked").val();b!==a&&n(F,b)}function t(){var a=d("input[name\x3d'currencyConverterTCAgreement']"),
b=a.val(),a=a.is(":checked").toString();a!==b&&n(a,F)}function r(c){l(c);h.prop("currencyType",c);var e=d("#subtotals-marketplace-table"),g=d("#subtotals-transactional-table"),p=d("#subtotals-marketplace-spp-bottom"),n=d("#subtotals-transactional-spp-bottom"),m=d("#vatRetailSubtotals-transactional-table"),q=d("#vatGlobalSubtotals-transactional-table"),v=d("#vatMerchantSubtotals-transactional-table"),t=d("#vatRetailSubtotals-marketplace-table"),z=d("#vatGlobalSubtotals-marketplace-table"),A=d("#vatMerchantSubtotals-marketplace-table"),
y=d(".place-your-order-button"),w=d("#fx-enable"),F=f.isSPP()?d(".place-order-button-text"):d(".place-your-order-button + span");f.isSPP()||setTimeout(function(){var a=Math.max(e.outerHeight(),g.outerHeight());0<a&&(e.height(a),g.height(a))},500);if(!u){b.increaseCount("removeauijs17");var Z=B.siblings("i"),ca=H.siblings("i");if(Z.hasClass("a-icon-touch-radio-inactive")||Z.hasClass("a-icon-touch-radio-active"))"marketplace"===c?(Z.removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active"),
ca.removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive")):(ca.removeClass("a-icon-touch-radio-inactive").addClass("a-icon-touch-radio-active"),Z.removeClass("a-icon-touch-radio-active").addClass("a-icon-touch-radio-inactive"))}"marketplace"===c?(d("#fxGoodNews-transactional").hide(),d("#fxGoodNews-marketplace").show(),g.hide(),e.show(),n.hide(),p.show(),m.hide(),q.hide(),v.hide(),t.show(),z.show(),A.show(),D&&D.hide(),w&&w.hide(),y.val(d("#placeYourOrderTextMarketplace").val()),
u&&F.text(d("#placeYourOrderTextMarketplace").val()),d("#currencyChanged").attr("value","true"),d("#fxCurrencyChoice").attr("value","marketplace"),d("#tfx-total-header").addClass("aok-hidden"),d("#mkt-total-header").removeClass("aok-hidden")):(d("#fxGoodNews-transactional").show(),d("#fxGoodNews-marketplace").hide(),e.hide(),g.show(),p.hide(),n.show(),t.hide(),z.hide(),A.hide(),m.show(),q.show(),v.show(),D&&D.show(),w&&w.show(),y.val(d("#placeYourOrderTextTransactional").val()),u&&F.text(d("#placeYourOrderTextTransactional").val()),
d("#currencyChanged").attr("value","false"),d("#fxCurrencyChoice").attr("value","transactional"),d("#mkt-total-header").addClass("aok-hidden"),d("#tfx-total-header").removeClass("aok-hidden"));a.trigger("checkout:spc:ordersummary:sizeChanged");k.isMobileSpc()&&(p=d("#vatBreakdownNote"),0<p.size()&&(n=p.attr("href"),n=0<n.lastIndexOf(".html?")?n+("\x26currencyType\x3d"+c):n+("?currencyType\x3d"+c),p.attr("href",n)))}function y(a){var c=d("#tfx-footer"),e=d("#tfx-header");if(!u){b.increaseCount("removeauijs18");
var f=d("#fxApplicabilityDecision").siblings("i"),g=d("#fxApplicabilityAdoption").siblings("i");if(g.hasClass("a-icon-touch-checkbox-inactive")||g.hasClass("a-icon-touch-checkbox-active"))g.removeClass("a-icon-touch-checkbox-active").addClass("a-icon-touch-checkbox-inactive"),f.removeClass("a-icon-touch-checkbox-inactive").addClass("a-icon-touch-checkbox-active")}"accept"===a?(z()?(d("#fx-terms-and-conditions").show(),d("#fxCardCurrencySubcondition").hide()):(d("#fx-enable").show(),d("#fx-disable").hide()),
d("#fxApplicabilityDecision").prop("checked",!0),e.show(),r("transactional"),c.show(),d("#marketplaceRadio").prop("checked",!1),d("#transactionalRadio").prop("checked",!0),d("#fxApplicabilityChoice").attr("value","accept")):(z()?(d("#fx-terms-and-conditions").hide(),d("#fxCardCurrencySubcondition").show()):(d("#fx-enable").hide(),d("#fx-disable").show()),d("#fxApplicabilityAdoption").prop("checked",!1),e.hide(),r("marketplace"),c.hide(),d("#transactionalRadio").prop("checked",!1),d("#marketplaceRadio").prop("checked",
!0),d("#fxApplicabilityChoice").attr("value","decline"))}function z(){return f.isSPP()&&d("input[name\x3disNewTFXExperienceEnabled]").length}var d=a.$;if(!d("html").hasClass("a-ie6")){var u=q.P&&q.P.AUI_BUILD_DATE;d(document).delegate("input[name\x3d'currencyOptions']","click",v);d(document).delegate("input[name\x3d'currencyConverterTCAgreement']","click",t);var D,w,H,B;m.isTFXCurrencyToggleOnTabletFixed()?(d(document).delegate("#checkoutCurrencyTransactional","click",function(){r("transactional")}),
d(document).delegate("#checkoutCurrencyMarketplace","click",function(){r("marketplace")})):(d(document).delegate("#transactionalRadio","click",function(){r("transactional")}),d(document).delegate("#marketplaceRadio","click",function(){r("marketplace")}));d(document).delegate("#fxApplicabilityDecisionCheckbox","click",function(){y("decline")});d(document).delegate("#fxApplicabilityAdoptionCheckbox","click",function(){var a=z()&&!d("#fxApplicabilityAdoption").is(":checked");y(a?"decline":"accept")});
a.on("a:expander:tfx-options-expander:toggle:expand",function(a){b.increaseCount("checkout:spp-ordersummary:expand_tfx_options",1)});a.on("a:expander:tfx-see-rate-expander:toggle:expand",function(a){b.increaseCount("checkout:spp-ordersummary:expand_tfx_see_rate",1)});return{updateCurrencyOption:v,updateTermsAndConditionsAgreement:t,changeCurrency:r,initOrderSummary:e}}});"use strict";r.when("A","ready").register("spc-page-state",function(a){var k={};return{prop:function(a,b){if(a&&"string"===typeof a)return 1<
arguments.length&&(k[a]=b),k[a]}}});"use strict";r.when("A","ready").execute(function(a){function k(){0<h("#spcCachedPromiseData").length&&(b=(new Date).getTime(),h(".place-your-order-button").click(function(){var a=(new Date).getTime()-b;h("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'spcWaitingTime' value\x3d'"+a+"' /\x3e")}))}var h=a.$,b=0;a.on("checkout:reload:spc",k);a.on("checkout:reload:spclite",k);a.on("checkout:reload:spp-revieworder",k)});"use strict";r.when("A","client-side-metrics",
"ready").register("spc-apx-standin",function(a,k){function h(b){var g=a.state("apx-standin-state");g.timestamp=(new Date).toISOString();g.metricName=b;return g}if(a.state("apx-standin-state")){var b=h("APX_STANDIN_ENABLED");k.emitNexusMetrics(b,b.producerId,b.schemaId);a.on("a:popover:show",function(a){if(a.popover&&a.popover.name&&"apx-popover"==a.popover.name||a.popover&&a.popover.originalFocus&&a.popover.originalFocus.id&&"payChangeButtonId"==a.popover.originalFocus.id)a=h("APX_STANDIN_POPOVER_SHOW"),
k.emitNexusMetrics(a,a.producerId,a.schemaId)});a.on("a:sheet:afterShow:apx_standin_bottom_sheet_instance",function(a){a=h("APX_STANDIN_POPOVER_SHOW");k.emitNexusMetrics(a,a.producerId,a.schemaId)})}});"use strict";r.when("A","page-transition-controller","scroll-controller","loading-spinner-controller","page-conductor","checkout-general-utils","ready").register("changeCustomerDetailsPopover",function(a,k,h,b,f,g){function m(){return 0<p("#onblur-character-validation-error-changeNameInput").size()}
function e(){l&&l.find("button[data-action\x3da-popover-close]").trigger("click")}function c(){var a=p("#saveButton");if(a.length){var b=p("#changeNameInput"),c=p("#changePostNumberInput"),e=p("#changePhoneInput"),f=1,g=1,d=1;b.length&&!b.val()&&(f=0);c.length&&!c.val()&&(g=0);e.length&&!e.val()&&(d=0);f&&g&&d&&!m()?(a.removeClass("a-button-disabled"),a.removeAttr("disabled")):(a.addClass("a-button-disabled"),a.attr("disabled","true"))}}var p=a.$,l;a.declarative("clickedsave","click submit",function(a){if(!m()){var b=
p("#changeNameInput").val(),c=p("#changePhoneInput").val(),g=p("#changePostNumberInput").val(),h=p("#changeAccountNameCheckBox").is(":checked")?1:0,l=p("#changePostNumberCheckBox").is(":checked")?1:0,b="custName\x3d"+encodeURIComponent(b)+"\x26changeAccountName\x3d"+encodeURIComponent(h);c&&(b=b+"\x26custPhoneNumber\x3d"+encodeURIComponent(c));g&&(b=b+"\x26dhlPostNumber\x3d"+encodeURIComponent(g),l&&(b=b+"\x26changeDhlPostNumberInEmbu\x3d"+encodeURIComponent(l)));c=a.data.changeDetailUrl;f.isSPP()&&
(c=a.$target.data("changedetailurl"),p("#cancelReminderPopover").click());f.isSPP()||(b+="\x26usePipelineDispatch\x3d1");k.show();c&&p.ajax({type:"POST",data:b,url:c,dataType:"html",contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",async:!0,cache:!1,headers:f.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"}),success:function(a,b,c){e();k.hide();f.ajaxUpdatePage(a,b,c)},error:function(a,b,c){f.ajaxRedirect(a,b,c)}})}});a.declarative("clickedsave","mouseenter mousemove touchstart",
function(a){c()});a.declarative("changeNameKeyIn changePostNumberKeyIn changePhoneNumberKeyIn","keydown keyup change keypress mouseenter mouseleave mousemove",function(a){c()});a.declarative("clickedcancel","click submit",function(a){e()});a.on("a:popover:beforeShow:changeDetailPopover",function(a){m()&&p("#onblur-character-validation-error-changeNameInput").remove()});a.on("a:popover:show:changeDetailPopover",function(a){if(!f.isSPP()){var b=p(q).width(),e=p(q).height(),b=parseInt(.6*b,10),e=parseInt(.7*
e,10);l=a.popover.$popover;var g=a.popover;l.css("position","absolute");l.css("top","50px");l.css("height",e+"px");l.css("width",b+"px");g.updatePosition()}b=f.isSPP()?a.popover.originalnamevalue:a.popover.$trigger.data("original-name-value");e=f.isSPP()?a.popover.originalcellphonevalue:a.popover.$trigger.data("original-cellphone-value");a=f.isSPP()?a.popover.originalpostnumbervalue:a.popover.$trigger.data("original-postnumber-value");var g=p("#changeNameInput"),h=p("#changePhoneInput"),k=p("#changePostNumberInput");
g.val(b);h.val(e);k.val(a);c()})});"use strict";r.when("A","page-transition-controller","ajax-utility","page-conductor","page-detector","checkout-general-utils").register("prime-decline-controller",function(a,k,h,b,f,g){function m(){c("input[name\x3d'changeCardNoEndDatePrime']").attr("data-action","prime-decline-element")}function e(a,c,e){if(e.getResponseHeader("x-amz-checkout-page"))b.ajaxUpdatePage(a,c,e);else{a=h.jsonify(a);if(!a)return b.redirect();a.error?k.hide():a.errors?k.hide():a.autohandlererror?
(c=(a=a.autohandlererror)?a.action:null,e=a&&a.type?a.type:c&&c.code?c.code:"string"===typeof a?a:"Unknown:pipelineJSError",q.location.href="fatal"===c?"/gp/buy/payselect/handlers/error.html?errorAction\x3dfatal\x26errorType\x3d"+encodeURIComponent(e):"redirect"===c?a.url:"/gp/buy/payselect/handlers/error.html?errorType\x3d"+encodeURIComponent(e)):b.redirect(a)}}var c=a.$;c("html").hasClass("a-ie6")||(a.declarative("prime-decline-element",["click","touchend"],function(a){g.protectAgainstDoubleAction("prime-decline-element")||
(a.$event.preventDefault(),k.show(),a=(new Date).getTime(),a="changeCardNoEndDatePrime\x3d1\x26hasWorkingJavascript\x3d1\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26fromAnywhere\x3d"+c("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+a,c.ajax({type:"POST",url:"/gp/buy/spc/handlers/stuff-handler.html/ref\x3dox_spc_prime_renew_nodate",data:a,headers:{"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"},contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",
dataType:"text",success:e,error:b.ajaxRedirect}))}),a.on("checkout:reload:spc",m),a.on("checkout:reload:spp-revieworder",m))});"use strict";r.when("A","loading-spinner-controller","page-conductor").register("prime-popover-controller",function(a,k,h){function b(){g={};a.defer(function(){0!==f("#spc-orders").find(".prime-popover-link").length&&(f("#spc-orders").find(".prime-popover-link").each(function(){var a=f(this);if(a.data("action")){a.removeAttr("href").attr("tabindex",0);var b=a.data("aCheckoutModalPopover");
var c=b.name,h="";b.width&&b.height&&(h="width:"+b.width+"px;height:"+b.height+"px;");0<f("#spc-orders").find("#"+c+"-popover").length||(b=f(['\x3cdiv id\x3d"a-popover-'+c+'" class\x3d"a-popover-preload" style\x3d"display:none;"\x3e','\x3cdiv id\x3d"'+c+'-popover" class\x3d"checkout" style\x3d"'+h+'"\x3e\x3c/div\x3e',"\x3c/div\x3e"].join("")),f("#spc-orders").append(b));a=a.data("aCheckoutModalPopover").name;g[a]||(b=f(".prime-popover-content").html())&&0<b.length&&(g[a]=b,f("#"+a+"-popover").html(b))}}),
f("#spc-orders").find(".a-box").each(function(){var a=f(this),b=a.find(".prime-ad-banner-content .prime-popover-link");1<b.length&&(b=b.first());a.find("a.primeAdLauncher").each(function(){var a=f(this);a.wrap('\x3cspan class\x3d"a-declarative" data-action\x3d"prime-event" data-prime-event\x3d\'{"metric":"lm3"}\'\x3e\x3c/span\x3e');a.replaceWith(b.clone().text(a.text()).addClass("a-size-mini"))})}))})}var f=a.$;if(!f("html").hasClass("a-ie6")){var g={};a.on("a:popover:show",function(a){if(a.popover&&
a.popover.name&&0===a.popover.name.indexOf("prime")&&(a=a.popover.name,!g[a])){var b=f("input#primePopopverFallbackContent").val()||"";g[a]=b;f("#"+a+"-popover").html(b)}});a.on("checkout:reload:spc",b);a.on("checkout:reload:spp-revieworder",b)}});"use strict";r.when("A","page-transition-controller","back-button-protection","page-conductor","weblab-helper").register("place-order-controller",function(a,k,h,b,f){function g(){if(!b.isAnimating()){var c=e("#spc-form");if("0"===e("#showPageTransition").attr("content"))if(c.hasClass("paylast-spc"))k.show();
else{if(0<e("#enableAlternatePYOBlocker").length){var g=c.find(".a-button.continue-button");if("disabled"===g.find("input").attr("disabled"))return;g.find("input").attr("disabled","disabled");g.addClass("a-button-disabled");setTimeout(function(){g.removeClass("a-button-disabled");g.find("input").removeAttr("disabled")},4E4)}}else k.showPageTransition();var l=e("#currencyChanged");0<l.length&&"true"===l.val()&&(l='\x3cinput type\x3d"hidden" name\x3d"checkoutCurrencySelection.'+e("#tfx-switch-currency-options").find("input:radio:checked").val()+
'" /\x3e',e("#spc-form-inputs").append(l));if(f.isMfaPSD2DeviceDescriptionCollectionEnabled())for(var l=[{name:"javaEnabled",value:q&&q.navigator&&q.navigator.javaEnabled()},{name:"language",value:q&&q.navigator&&q.navigator.language},{name:"screenColorDepth",value:q&&q.screen&&q.screen.colorDepth},{name:"screenHeight",value:q&&q.screen&&q.screen.height},{name:"screenWidth",value:q&&q.screen&&q.screen.width},{name:"timeZone",value:(new Date).getTimezoneOffset()}],n=0;n<l.length;n++)if(l[n].name!==
F&&l[n].value!==F){var m='\x3cinput type\x3d"hidden" name\x3d"'+l[n].name+'" value\x3d"'+l[n].value+'" /\x3e';e("#spc-form-inputs").append(m)}0==c.find("input[type\x3d'hidden'][name\x3d'placeYourOrder1']").length&&c.append("\x3cinput type\x3d'hidden' name\x3d'placeYourOrder1' value\x3d'1' /\x3e");(l=a.state("firetv-aws-attributes"))&&l.queryParams&&(n=c.attr("action"),n+=0<=n.indexOf("?")?"\x26":"?",n+=e.param(l.queryParams),c.attr("action",n));b.isSPP()&&c.append(e("#subtotalsSection").find("input").hide());
h.markAsDirty();c.submit()}}function m(a){a.preventDefault();g(a.target)}var e=a.$;if(!e("html").hasClass("a-ie6"))return a.declarative("a-checkout-place-order",["click"],function(a){g(a.target)}),e(document).delegate("span.place-order-button-link","click",m),{placeOrderClick:g,placeOrderClickDelegate:m,PLACE_ORDER_BUTTON_LINK_SELECTOR:"span.place-order-button-link"}});"use strict";r.when("A","page-conductor","button-blocker","client-side-metrics","weblab-helper").register("verification-checkbox-controller",
function(a,k,h,b,f){function g(a){y?m(a):e(a);z&&a&&a.blocking&&(b.setmarker("fn"),z=!1)}function m(a){var b=v(".continue-button"),c=v(".continue-button-blocker"),e=v(".place-order-blocker-message.custom-blocker-message");if(a.blocking||!l())a.blocking?(e.text(a.message),b.addClass("aok-hidden"),c.removeClass("aok-hidden")):(e.empty(),b.removeClass("aok-hidden"),c.addClass("aok-hidden"),r.when("a-tooltip").execute(function(a){(a=a.get(c))&&a.isActive()&&a.hide()}))}function e(a){a.blocking?h.show("place-order-imb-checks",
a.message):(h.hide("place-order-imb-checks"),v("#hasTVNavigation").length&&r.when("a-tv").execute(function(a){a.select(".continue-button")}))}function c(){var c,e={blocking:!1,message:""};if(y)c=v("#spc-imb").find(".verification-checkbox input:not(:checked)"),0<c.length&&(e={blocking:!0,message:c.first().closest(".verification-checkbox").attr("data-blocker-message")});else{b.increaseCount("removeauijs23");if(!v("#spc-imb").find(".verification-checkbox").length)return;c=k.isSPP()?v("#spc-imb").find(".verification-checkbox input:not(:checked)"):
v("#spc-imb").find(".verification-checkbox:not(:checked)");0<c.length&&(e={blocking:!0,message:k.isSPP()?c.first().closest(".spp-panel").hasClass("aok-hidden")?c.first().closest(".verification-checkbox").data("non-review-panel-blocker-msg"):c.first().closest(".verification-checkbox").data("blocker-message"):c.first().attr("data-blocker-message")})}f.isPyoClientSideInitiationEnabled()?g(e):a.trigger("checkbox:primaryActionBlocker:blockingStateChanged",e)}function p(){var a=v("#wineNoticeCheckbox");
a&&a.length&&(t?(a.attr("checked",""),A&&(a=a.siblings(".a-icon-touch-checkbox-inactive"))&&a.length&&(a.removeClass("a-icon-touch-checkbox-inactive"),a.addClass("a-icon-touch-checkbox-active"))):(a.removeAttr("checked",""),A&&(a=a.siblings(".a-icon-touch-checkbox-active"))&&a.length&&(a.removeClass("a-icon-touch-checkbox-active"),a.addClass("a-icon-touch-checkbox-inactive"))))}function l(){var a=v("input[name\x3disINExpressCheckoutCC]");return a&&a.length?1===parseInt(a.val(),10):!1}function n(){f.isPyoClientSideInitiationEnabled()||
p();v('[data-client-component\x3d"PrimaryActionBlockerCheckbox"]').length||(c(),f.isPyoClientSideInitiationEnabled()&&p());var a=q.P&&q.P.AUI_BUILD_DATE?'.verification-checkbox input[type\x3d"checkbox"]':"input.verification-checkbox";v("#spc-imb").find(a).unbind("change.verification-checkbox").bind("change.verification-checkbox",c)}var v=a.$,t,A=v("html").hasClass("a-touch"),y=!k.isSPP()&&q.P&&q.P.AUI_BUILD_DATE,z=!0;if(!v("html").hasClass("a-ie6")){if(!f.isPyoClientSideInitiationEnabled())a.on("checkbox:primaryActionBlocker:blockingStateChanged",
g);a.declarative("change-wine-notice-checkbox",["change"],function(a){t=a.$target.is(":checked")?1:0});a.on("checkout:reload:spc",n);a.on("checkout:reload:spclite",n);a.on("checkout:reload:spp-revieworder",n);a.on("checkout:reload:spp-collapsed",n);a.on("checkout:unload",function(){z=!0});a.on("checkout:afterReload",function(){z=!1});return{verifyCheckboxes:c,updatePyo:g}}});"use strict";r.when("A","page-transition-controller","scroll-controller","ajax-utility","page-conductor","quantity-service",
"checkout-modal-popover","page-detector","checkout-general-utils","a-popover","client-side-metrics","weblab-helper").register("quantity-update-controller",function(a,k,h,b,f,g,m,e,c,p,l,n){function v(){U=T=!1;a.defer(function(){var a=G("#spc-orders");a.find("a.quantity-change-button-static").remove();"1"!==G("#spc-form-inputs").find("input[name\x3d'isQuantityInvariant']").val()&&a.find("div.quantity-value-static").remove()});G(".lineitem").each(function(a,b){a=G(b);a.find(".no-js-quantity").remove();
b=a.find(".quantity-dropdown");b.is(":visible")?(a.find(".js-select").prop("disabled",!1),b.removeClass("a-button-disabled")):(a=a.find(".quantity-input"),a.prop("disabled",!1),a.removeClass("a-form-disabled"))});var b=G("#pantry-mov-popover-content"),c=G("#pantry-mov-popover-placeholder");!b.length&&c.length&&(b=c.attr("data-device"),G.ajax({type:"GET",url:"/gp/pantry/checkout/mov/get-pantry-mov-popover-contents.html",data:"device\x3d"+b,dataType:"text",async:!0,cache:!1,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",
success:function(a,b,d){~a.indexOf("pantry-mov-popover-content")?c.append(a):l.increaseCount("checkout:pantry:pantry_mov_popover_contents:bad-content",1)},error:function(a,b,c){l.increaseCount("checkout:pantry:pantry_mov_popover_contents:"+c,1)}}))}function t(a,b){a=G('.update-quantity-error[data-itemid\x3d"'+a+'"]');a.find(".error-message").hide();a.find('.error-message[data-error-type\x3d"'+b+'"]').show();a.find("i").show();a.find(".a-span12").show();a.show();b=a.closest(".item-details-right-column");
b.find(".spc-quantity-dropdown-button").addClass("a-button-error");b.find(".spc-quantity-input").addClass("a-form-error");b=a.parents("div.update-quantity-error");a=b.siblings(".item-details");0<a.length&&(a.find(".a-input-text-wrapper").addClass("a-form-error"),a.removeClass("a-spacing-large"),a.find(".a-touch-select").addClass("a-input-text a-form-error"));b.show()}function A(a,d,e){var g=e.getResponseHeader("x-amz-checkout-new-cart-quantity");c.updateCartByMash(g);if(e.getResponseHeader("x-amz-checkout-page"))f.ajaxUpdatePage(a,
d,e,{pushNewFrame:"false"}),a=e.getResponseHeader("x-amz-checkout-updated-itemid"),e=e.getResponseHeader("x-amz-checkout-quantity-error"),a&&e&&t(a,e);else if(a=b.jsonify(a))if(a&&a.errors&&a.errors.pantry&&a.errors.pantry.mov)z(a.errors.pantry.showAddonInfo);else{if(a&&a.errors&&a.errors.addon&&(f.isSPP()&&l.increaseCount("checkout:spp-revieworder:addon_warn_pri",1),e=a.errors.addon.type,d=a.errors.addon.asins,y(),G(".item-list").hide(),d.forEach(function(a){G('[data-asin\x3d"'+a+'"]').show()}),
e=G("#addon-warning-"+e+"-launcher"),e.length)){G("input[name\x3duseLiveAUI]").length?p.get(e).attrs({$trigger:ba}).show():ga&&G("div.checkout.spc-mobile.aui-templatized").length?e.click():(l.increaseCount("removeauijs19"),a=G.Event("keyup",{triggerPositioningElement:ba,manualTrigger:!0}),e.trigger(a),0<G("div.spc-mobile").length&&(h.scrollToTop(),h.toggleScrollOff()));k.hide();return}return f.redirect(a)}else f.redirect()}function y(){G("#a-popover-addon-warning-normal .select-address-title").hide();
0<K?(G("#a-popover-addon-warning-normal .reduce-title").show(),G("#a-popover-addon-warning-normal .delete-title").hide()):(G("#a-popover-addon-warning-normal .delete-title").show(),G("#a-popover-addon-warning-normal .reduce-title").hide())}function z(a){var b=G("#pantry-mov-popover-launcher"),c=G(".pantry-mov-reduce-prompt"),d=G(".pantry-mov-delete-prompt"),e=G("#pantry-mov-addon-info-container");b.length?(R()||l.increaseCount("checkout:pantry:pantry_mov_popover:non_spc",1),e.length&&e.empty(),a&&
G("#addon-warning-normal-popover-content").length&&(y(),e.length||(e=G("\x3cdiv/\x3e",{id:"pantry-mov-addon-info-container"})),e.append('\x3chr class\x3d"a-divider-normal"\x3e').append(G("#addon-warning-normal-popover-content").html()).appendTo("#pantry-mov-popover-content")),0<K?(c.show(),d.hide()):(d.show(),c.hide()),b.length&&(b.click(),k.hide())):(l.increaseCount("checkout:pantry:pantry_mov_popover_contents:no-launcher",1),f.redirect())}function d(a,b){k.show();var c={isClientTimeBased:G('input[name\x3d"useCtb"]').val(),
fromAnywhere:G("input[name\x3dfromAnywhere]").val(),success:A};if(b)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);f.isSPP()?(c.ref="chk_ship_chg_qty_pri",b=G("#setOrderingPrefsCheckbox"),b.length&&b.is(":checked")&&(c.saveAsDefaultsSelected=1)):G(".spc-mobile.aui-templatized").length&&(c.ref="ox_spc_change_quantity");b=G("#addon-indicator")&&"true"===G("#addon-indicator").attr("data-has-addon-items");d=G("#pantry-mov-indicator")&&"true"===G("#pantry-mov-indicator").attr("data-has-pantry-items");
a||!b&&!d||(c.istrial=1);g.call(aa,K,c);x?x.data("currentQuantity",K):P&&P.data("currentQuantity",K)}function u(){k.hide();q.location="/gp/aw/c/ref\x3dox_spc_deal_expired?app-action\x3dcart"}function D(a){var b=V;K=V;x&&r.when("a-dropdown").execute(function(a){x&&(a.getSelect(x).setValue(b.toString()),x.data("currentQuantity",K))});a===Y.addOn&&h.toggleScrollOn();P&&(P.val(b),P.data("currentQuantity",K),a=P.closest(".quantity-block"),a.find(".change-quantity-button").closest(".a-declarative").removeClass("hidden"),
a.find(".quantity-display").removeClass("hidden"),a.find(".quantity-display-block-tablet").removeClass("hidden"),a.find(".dynamic-quantity-update").hasClass("stay-visible")||a.find(".dynamic-quantity-update").addClass("hidden").children().addClass("hidden"))}function w(a,b){var c=a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a");aa=c.data("entityId");K=0;x=null;V=c.data("currentQuantity");ba=G("a.quantity-delete-button[data-entity-id\x3d'"+aa+"']");ba.length||(ba=a.$currentTarget);
P=c.closest(".dynamic-quantity-update").find(".quantity-input");P.length||(P=null);c.data("isBundleDelete")?G("#pb-delete-trigger-"+c.data("bundleGroupId")).trigger("click"):n.isItemAssociationDeleteConfirmationPopoverForWirelessPlansEnabled()&&c.data("showItemAssocDeletePopover")?(l.increaseCount("checkout:item-association:delete:selected",1),setTimeout(function(){G("#ia-delete-trigger-"+c.data("itemAssocGroupId")).trigger("click")},100)):(d(!1,b),m.hideById(c.closest(".a-popover").data("aPopoverId")))}
function H(a){if(!c.protectAgainstDoubleAction("order-summary-update-quantity",200)){l.resetMetrics();var b=a.$currentTarget,e=b.closest(".lineitem"),f=b.find("select"),g=f.length?f:b;aa=e.data("entityId");f=G('.update-quantity-error[data-itemid\x3d"'+aa+'"]');P=x=null;g.is("select")?(x=b.find("select"),K=g.val()):(P=e.find(".quantity-input"),K=P.val());V!==K&&(ba=g.is("select")?x.parent():P,""===K?F(e):"Delete"===K||0===parseInt(K,10)?(a.$event.preventDefault(),c.protectAgainstDoubleAction("delete-item")||
(e=a.$currentTarget.closest(".lineitem"),aa=e.data("entityId"),K=0,e.data("isBundleDelete")?G("#pb-delete-trigger-"+e.data("bundleGroupId")).trigger("click"):(d(!1,void 0),m.hideById(e.closest(".a-popover").data("aPopoverId"))))):(a=parseInt(G("#quantity-input-max-value").val(),10),c.validateNumber(K,0,a)?(f.hide(),e.blur(),e.data("isBundleDelete")?G("#pb-delete-trigger-"+e.data("bundleGroupId")).trigger("click"):d(!1)):t(aa,"changeQuantity_quantityNotInRange")))}}function B(a){var b=a.$currentTarget.closest(".quantity-text-field").find(".update-quantity-link"),
c=a.$currentTarget.is("input")?a.$currentTarget.val():a.$currentTarget.find("input").val(),d=a.$currentTarget.find("input").data("currentQuantity");V=d;-1===parseInt(c,10)||""===c?("change"===a.type&&F(a.$currentTarget.closest(".lineitem")),b.hide()):parseInt(c,10)!==d?b.show():b.hide()}function F(a){a.find(".quantity-input").val(V)}function X(b,c,d){var e=c.data("itemAssocGroupId"),f="a:sheet:beforeShow:ia-delete-mbs-"+e,g="a:sheet:afterHide:ia-delete-mbs-"+e;a.on(f,function N(b){b=b.sheet.getContentContainer();
var c=G("#ia-delete-"+e).html();c&&(b.empty(),b.html(c));a.off(f,N)});r.when("a-dropdown").execute(function(c){a.on(g,function oa(){l.increaseCount("checkout:item-association:delete:canceled",1);G("#ia-delete-trigger-"+e).data("isItemAssocAlreadyDeleted")||(K=d,x.data("currentQuantity",d),c.getSelect(b).setValue(d));a.off(g,oa)})});G("#ia-delete-trigger-"+e).trigger("click")}function R(){return f.isSPP()?G("#revieworder").hasClass("expanded")?!0:!1:0<G("div.spc").length?!0:!1}var G=a.$;if(!G("html").hasClass("a-ie6")){var K,
V,aa,x,P,T=!1,U=!1,ba,ga=q.P&&q.P.AUI_BUILD_DATE,Y={addOn:"addOn",pantryMOV:"pantryMOV"};a.declarative("change-quantity",["click","touchend"],function(a){if(!c.protectAgainstDoubleAction("lock-update-quantity",200)){a=a.$currentTarget;var b=!0;a.addClass("hidden");a=a.closest(".quantity-block");a.find(".change-quantity").addClass("hidden");a.find(".quantity-display").addClass("hidden");a.find(".quantity-display-block-tablet").addClass("hidden");a.find(".dynamic-quantity-update").removeClass("hidden").find(".hidden").each(function(){var a=
G(this);a.removeClass("hidden");a.is("input")&&(a.focus(),a.select(),a.unbind("keydown.update-quantity-spc").bind("keydown.update-quantity-spc",function(a){13===a.which&&a.preventDefault()}),a.unbind("keyup.update-quantity-spc").bind("keyup.update-quantity-spc",function(a){13!==a.which||b||G(a.target).closest(".dynamic-quantity-update").find(".update-quantity-button").trigger("click")}))});setTimeout(function(){b=!1},500)}});a.declarative("order-summary-get-quantity",["click","touchend"],function(a){c.protectAgainstDoubleAction("order-summary-get-quantity",
200)||a.$currentTarget.find("select").length&&(V=a.$currentTarget.find("select").val())});a.declarative("order-summary-update-quantity",["change"],H);a.declarative("order-summary-update-quantity-text-field",["click","touchend"],H);a.declarative("order-summary-handle-text-input",["keydown"],function(a){13===a.$event.which?(a.$event.preventDefault(),H(a)):c.limitInputToNumbers(a)});a.declarative("order-summary-show-update-button",["change","keyup"],B);a.declarative("trigger-update-quantity-button",
["keydown"],function(a){13===a.$event.which&&(a.$event.preventDefault(),a.$currentTarget.closest(".quantity-block").find(".update-quantity-button").trigger("click"))});a.declarative("toggle-update-quantity-button",["change","keyup"],function(a){var b=a.$currentTarget.closest(".quantity-block").find(".update-quantity-button"),c=a.$currentTarget.find("input"),d=c.val(),e=c.data("currentQuantity");""===d?("change"===a.type&&c.val(e),b.hide()):parseInt(d,10)!==e?b.show():b.hide()});a.declarative("update-quantity",
["click","touchend"],function(a){l.resetMetrics();a=a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a");var b=a.closest(".quantity-block"),e=a.closest(".dynamic-quantity-update"),f=e.find(".quantity-input");e.length||(f=b.find(".quantity-input"));if(c.protectAgainstDoubleAction("lock-update-quantity",200))f.focus();else{var g=f.val();aa=a.data("entityId");var h=G('.update-quantity-error[data-itemid\x3d"'+aa+'"]'),k=parseInt(G("#quantity-input-max-value").val(),10);c.validateNumber(g,
0,k)?(h.hide(),e.find(".a-form-error").removeClass("a-form-error"),f.removeClass("a-form-error"),g=parseInt(g,10),P=f,V=P.data("currentQuantity"),V=parseInt(V,10),g===V?(b.find(".change-quantity-button").closest(".a-declarative").removeClass("hidden"),b.find(".quantity-display").removeClass("hidden"),b.find(".quantity-display-block-tablet").removeClass("hidden"),e.addClass("hidden").children().addClass("hidden")):(K=g,ba=a,a.blur(),a.data("isBundleDelete")?G("#pb-delete-trigger-"+a.data("bundleGroupId")).trigger("click"):
d(!1))):t(aa,"changeQuantity_quantityNotInRange")}});G(document).delegate(".spc-quantity-dropdown","change",function(a){x=G(a.currentTarget);l.resetMetrics();ga?(a=x.next(),aa=a.data("entityId"),V=a.data("currentQuantity")):(l.increaseCount("removeauijs21"),aa=x.data("entityId"),V=x.data("currentQuantity"));a=x.find(":selected");K=parseInt(a.val(),10);if(V!==K){var b=G("#toggleDropdownQuantityTrigger");b.length&&K===parseInt(b.val(),10)?(a=x.closest(".quantity-block"),a.find(".spc-quantity-dropdown-button").hide(),
a.find(".quantity-input").show()):(ba=x.parent(),x.blur(),a&&a.data("isBundleDelete")?G("#pb-delete-trigger-"+a.data("bundleGroupId")).trigger("click"):n.isItemAssociationDeleteConfirmationPopoverForWirelessPlansEnabled()&&a&&a.data("showItemAssocDeletePopover")||d(!1))}});a.on("a:dropdown:select",function(a){if(n.isItemAssociationDeleteConfirmationPopoverForWirelessPlansEnabled()&&(a=G(a.nativeItemNode))&&a.data("showItemAssocDeletePopover")){l.increaseCount("checkout:item-association:delete:selected",
1);var b=a.closest("select"),c=ga?b.next().data("currentQuantity"):b.data("currentQuantity");X(b,a,c)}});a.declarative("item-assoc-delete-confirm",["click","touchend"],function(a){if(!c.protectAgainstDoubleAction("item-assoc-delete-confirm")){l.increaseCount("checkout:item-association:delete:confirmed",1);d(!1);var b=G(a.$target).data("itemAssocGroupId");G("#ia-delete-trigger-"+b).data("isItemAssocAlreadyDeleted",1);r.when("a-sheet").execute(function(a){var c=a.get("ia-delete-mbs-"+b);c&&a.hideSheet(c)})}});
a.declarative("item-assoc-delete-cancel",["click","touchend"],function(){c.protectAgainstDoubleAction("item-assoc-delete-cancel")||(l.increaseCount("checkout:item-association:delete:canceled",1),K=V)});a.declarative("dont-delete-item",["click","touchend"],function(a){a.$event.preventDefault();c.protectAgainstDoubleAction("dont-delete-item")||m.hideById(a.$currentTarget.closest(".a-popover").data("aPopoverId"))});a.declarative("delete-item",["click","touchend"],function(a){a.$event.preventDefault();
c.protectAgainstDoubleAction("delete-item")||w(a)});a.declarative("delete-prime-membership-item-confirm",["click","touchend"],function(a){a.$event.preventDefault();if(!c.protectAgainstDoubleAction("delete-prime-membership-item-confirm")){var b={additionalData:{deletePrimeMembership:1,primeMembershipASIN:(a.$currentTarget.is("a")?a.$currentTarget:a.$currentTarget.find("a")).data("asin")}};w(a,b)}});a.declarative("bundle-delete",["click","touchend"],function(){c.protectAgainstDoubleAction("bundle-delete")||
d(!1)});a.declarative("bundle-delete-action",["click","touchend"],function(a){c.protectAgainstDoubleAction("bundle-delete-action")||(r.when("a-popover-base").execute(function(b){b.get(a.data.popoverName).hide()}),d(!1))});a.declarative("egc-delete",function(a){aa=a.entityId;K=0;d(!0)});a.declarative("bundle-dont-delete",["click","touchend"],function(){c.protectAgainstDoubleAction("bundle-dont-delete")||(K=V,r.when("a-dropdown").execute(function(a){x&&(a.getSelect(x).setValue(V.toString()),x.data("currentQuantity",
K))}))});a.declarative("pantry-return-to-cart-btn",["click","touchend"],function(){c.protectAgainstDoubleAction("pantry-return-to-cart-btn")||R()&&u()});a.declarative("pantry-delete-items-btn",["click","touchend"],function(){!c.protectAgainstDoubleAction("pantry-delete-items-btn")&&R()&&(U=!0,G(".a-button-close").trigger("click"),d(!0))});a.declarative("pantry-cancel-delete-btn",["click","touchend"],function(){c.protectAgainstDoubleAction("pantry-cancel-delete-btn")||R()&&D(Y.pantryMOV)});a.on("a:popover:hide:pantry-mov-popover",
function(){R()&&(U||D(Y.pantryMOV))});a.declarative("addon-return-to-cart",["click","touchend"],function(){c.protectAgainstDoubleAction("addon-return-to-cart")||R()&&u()});a.declarative("addon-delete-items",["click","touchend"],function(){c.protectAgainstDoubleAction("addon-delete-items")||(R()&&(T=!0,G(".a-button-close").trigger("click"),d(!0)),f.isSPP()&&l.increaseCount("checkout:spp-revieworder:addon_delete_pri",1))});a.declarative("addon-dont-delete",["click","touchend"],function(){c.protectAgainstDoubleAction("addon-dont-delete")||
(R()&&D(Y.addOn),f.isSPP()&&l.increaseCount("checkout:spp-revieworder:addon_keep_pri",1))});a.on("a:popover:hide:addon-warning-normal",function(){0<G("div.spc-mobile").length?u():R()&&(T||D(Y.addOn))});a.on("a:popover:hide:addon-warning-special",function(){R()&&(T||D(Y.addOn))});a.on("checkout:reload:spc",v);a.on("checkout:reload:spp-revieworder",v)}});r.when("A","ready").execute(function(a){a.on("a:popover:beforeShow",function(a){if(a.popover.$trigger.hasClass("quantity-dropdown-button")){var h=
a.popover.$popover,b=h.closest("div.a-dropdown");b.length&&(a.popover.$iframe.css("max-height","260px"),h.css("max-height","260px"),h=b.find("div.a-popover-inner"),h.css({"max-height":"260px"}),a.popover.updatePosition(),h.css({"overflow-y":"scroll"}))}})});"use strict";r.when("A","page-transition-controller","page-conductor","ajax-utility").register("tax-exemption-controller",function(a,k,h,b){function f(a,c,f){return f.getResponseHeader("x-amz-checkout-page")?h.ajaxUpdatePage(a,c,f,{pushNewFrame:"false"}):
(a=b.jsonify(a))?h.redirect(a):h.redirect()}function g(a,b){var g=b.$target.data("entityId");if(g){k.show();var l={isClientTimeBased:m('input[name\x3d"useCtb"]').val(),fromAnywhere:m("input[name\x3dfromAnywhere]").val()},l=l||{};b={returnFullHTML:1,cachebuster:(new Date).getTime(),isClientTimeBased:0,hasWorkingJavascript:1};m.extend(b,l);b.entityId=g;b.optOut=a;a=h.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});m.ajax({type:"POST",url:"/gp/buy/pipeline/handlers/tax-exemption-optout.html",
data:m.param(b),dataType:"text",async:!0,cache:!1,headers:a,success:f,error:h.ajaxRedirect})}else q.ueLogError&&q.ueLogError({name:"MissingData",message:"lineItemId is undefined, when trying to opt out from tax exemption",logLevel:"FATAL"})}var m=a.$;m("html").hasClass("a-ie6")||(a.declarative("tax-exemption-opt-out",["click","touchend"],function(a){g(!0,a)}),a.declarative("tax-exemption-opt-in",["click","touchend"],function(a){g(!1,a)}))});"use strict";r.when("A").execute(function(a){return{}});
"use strict";r.when("A","page-transition-controller","page-conductor").register("sns-subscription-controller",function(a,k,h){function b(){var b=m(document);b.delegate(".sns-option","click",function(a){a=m(this);g(a.closest(".sns-upsell"),a)});b.delegate(".sns-option-mobile","click",function(a){var b=m(this);a.target.name&&"snsSetCreateSubscription"===a.target.name&&g(b.closest(".sns-upsell-mobile"),b)});b.delegate(".sns-option-tablet","click",function(a){a=m(this);g(a.closest(".sns-upsell-tablet"),
a)});b.delegate(".sns-upsell-nextdelivery","change",function(){f(m(this))});a.declarative("sns-upsell-nextdelivery-dropdown","change",function(a){f(m(a.$target))});b.delegate(".sns-upsell-learn-more","click",function(a){var b=m(this);a=b.width();var e=b.height(),f=b.position(),b=b.find(".sns-upsell-popover-learn-more");b.removeClass("aok-hidden");var g=b.width();b.height();b.css({top:f.top+e,left:f.left-(g-a)/2,position:"absolute"})});b.delegate(".sns-upsell-learn-more-close","click",function(a){(a=
m(this))&&a.closest(".sns-upsell-popover-learn-more")&&a.closest(".sns-upsell-popover-learn-more").addClass("aok-hidden");return!1})}function f(a){var b=a.closest(".sns-upsell,.sns-upsell-mobile,.sns-upsell-tablet");if(a.length&&b.length){var f=b.data("index"),g=b.find("span.sns-change-delivery-txt");g&&g.text(a.find("option:selected").data("date"));g=a.find("option:selected").data("epoch");a=a.find("option:selected").val();b.find("input[type\x3d'hidden'][name\x3d'sns_nextDelivery"+f+"']").val(g);
b.find("input[type\x3d'hidden'][name\x3d'sns_frequency"+f+"']").val(a)}}function g(a,b){k.show();var f=a.data("index"),g=(new Date).getTime(),n=a.find("input[type\x3d'hidden'][name\x3d'sns_lineItemIdentifier"+f+"']").attr("value"),q=a.find("input[type\x3d'hidden'][name\x3d'sns_merchantId"+f+"']").attr("value"),t=a.find("input[type\x3d'hidden'][name\x3d'sns_asin"+f+"']").attr("value");a=a.find("input[type\x3d'hidden'][name\x3d'sns_frequency"+f+"']").attr("value");b=b.prop("checked")||b.find("[type\x3dcheckbox]").is(":checked");
g={returnpipedata:0,returnFullHTML:1,cachebuster:g,hasWorkingJavascript:1};g.lineItemIdentifier=n;g.isONMLSelected=b?1:0;g.merchantId=q;g.asin=t;g.frequency=a;n=h.setAjaxTransitionHeader({"x-amz-checkout-page":"spc"});m.ajax({type:"POST",url:"/gp/buy/spc/handlers/set-sns-options.html",data:m.param(g),dataType:"text",async:!0,cache:!1,headers:n,success:function(a,b,c){return h.ajaxUpdatePage(a,b,c)},error:function(a,b,c){h.ajaxRedirect(a,b,c)}})}var m=a.$;m("html").hasClass("a-ie6")||b()});"use strict";
r.when("A","page-detector","page-detector-current-page","page-conductor","page-transition-controller","ajax-utility","place-order-controller","client-side-metrics").execute(function(a,k,h,b,f,g,m,e){function c(a){"function"===typeof q.ues&&(q.ues("t0",a,new Date),q.ues("ctb",a,"1"));"function"===typeof q.uet&&q.uet("tc",a,{wb:1})}function p(a,b){"function"===typeof q.uet&&q.uet(a,b,{wb:1})}function l(a){q.ueLogError&&q.ueLogError({message:a},{logLevel:"WARN",attribution:"ajax-typ"})}function n(){var a=
H("span#typ-load").attr("data-typ-args");q.location.href="https://"+q.location.hostname+"/gp/buy/thankyou/handlers/display.html?"+a}function v(){p("cf","ajax-typ:place-your-order");if(x){var a=H("#typ-desktop-frame").contents(),b=x;if(b.deliveryestimates)for(var c in b.deliveryestimates)if(b.deliveryestimates.hasOwnProperty(c)){var d=a.find("span#"+c);d&&d.replaceWith(b.deliveryestimates[c])}b.autorip&&(a=a.find("#thank-you-rogue"))&&a.replaceWith(b.autorip)}b=H("#typ-desktop-frame").contents();a=
b.find("span#typ-rewrite-url");history&&history.pushState&&a&&0<a.length&&(history.pushState({},"",a.attr("data-url")),a.attr("data-view"));b=b.find("title").text();H("#checkoutDisplayPage").hide();H("#typ-desktop").show();document.title=b;f.hide();H("span#typ-load").attr("data-typ-args");p("be","ajax-typ:place-your-order");e.setmarker&&(b=e.getscope(),T&&e.setscope("ajax-typ"),e.setmarker("cf"),T&&e.setscope(b));T||(e.sendUEPageLoadStats(),"function"===typeof q.uex&&q.uex("ld","ajax-typ:place-your-order",
{wb:1}))}function t(a,c,d){a&&a.conductoraction&&a.conductoraction.url?b.redirect(a):(p("af","ajax-typ:place-your-order"),x=a,R?v():F?G=1:(l("No TYP data available after place-order, redirecting to static TYP"),n()))}function r(){if(!ga)if(ba&&clearTimeout(ba),3===U.readyState){var a;try{a=g.jsonify(U.responseText)}catch(c){a=null}null!==a?(ga=1,t(a)):ba=setTimeout(r,50)}else 4===U.readyState&&(ga=1,200===U.status?(a=g.jsonify(U.responseText),null!==a?t(a):(l("No results from place-order, calling ajaxRedirect"),
b.ajaxRedirect())):(l("Error calling place-order, calling ajaxRedirect"),b.ajaxRedirect()))}function y(){X=1;V&&clearTimeout(V);aa&&clearTimeout(aa);var a=H("#currencyChanged");0<a.length&&"true"===a.val()&&(a='\x3cinput type\x3d"hidden" name\x3d"checkoutCurrencySelection.'+H("#tfx-switch-currency-options").find("input:radio:checked").val()+'" /\x3e',H("#spc-form-inputs").append(a));H("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'placeYourOrder1' value\x3d'1' /\x3e");a=(new Date).getTime()-
Y;H("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'waitingTime' value\x3d'"+a+"' /\x3e");H("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'returnjson' value\x3d'1' /\x3e");Z&&H("#spc-form").append("\x3cinput type\x3d'hidden' name\x3d'isAsyncTYPEnabled' value\x3d'1' /\x3e");var a=H("#spc-form").serialize(),c=H("#typ-desktop-frame").contents().find("input#cached-promise-data");0<c.length&&(a+="\x26cachedPromiseData\x3d"+c.val());if(P){if(q.XMLHttpRequest)U=new XMLHttpRequest;else if(q.ActiveXObject)try{U=
new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(d){U=null}if(!U){l("Can't get XMLHttpRequest for data stream, calling standard placeOrderController");X=1;m.placeOrderClick();return}U.open("POST","/gp/buy/spc/handlers/place-your-decoupled-order.html",!0);U.setRequestHeader("Content-type","application/x-www-form-urlencoded");U.setRequestHeader("Content-length",a.length);U.setRequestHeader("Connection","close");U.onreadystatechange=r;U.overrideMimeType("text/plain");U.send(a)}else H.ajax({type:"POST",
url:"/gp/buy/spc/handlers/place-your-decoupled-order.html",data:a,dataType:"text",async:!0,cache:!1,dataFilter:function(a){return g.jsonify(a)},success:function(a,c,d){null!==a?t(a,c,d):(l("No results from place-order, calling ajaxRedirect"),b.ajaxRedirect())},error:function(a,c,d){l("Error calling place-order, calling ajaxRedirect");b.ajaxRedirect(a,c,d)}});"function"===typeof q.uet&&q.uet("bb","ajax-typ:place-your-order",{wb:1})}function z(){R=F=K=0;H("div#typ-desktop").empty()}function d(a,b,d){K||
(K=1,clearTimeout(aa),F=0,R=1,B++,(a=H("#typ-desktop-frame").contents().find("span#typ-rewrite-url"))&&0<a.length&&(a=a.attr("data-requestid"),c("ajax-typ:place-your-order"),T||(e.setAsyncRequestId(a),"function"===typeof q.ues&&q.ues("id","ajax-typ:place-your-order",a))),G?v():!X&&5>B&&(V=setTimeout(function(){z();u()},12E4)))}function u(){if(!(X||F||5<=B)){F=1;var a=H("span#typ-load").attr("data-typ-args");aa=setTimeout(function(){z();G&&(l("Timed out waiting for TYP fetch after place-order, redirecting to static TYP"),
n())},45E3);H("\x3ciframe /\x3e",{name:"typ-desktop-frame",id:"typ-desktop-frame",width:"100%",height:"100%",frameborder:"0",src:"/gp/buy/thankyou/handlers/display.html?"+a}).appendTo("div#typ-desktop").load(d)}}function D(){d()}function w(){k.isSpc()&&0<H("span#typ-load").length&&(Y=(new Date).getTime(),B=0,H("div#typ-desktop").length?z():H("body").append('\x3cdiv id\x3d"typ-desktop" style\x3d"position:absolute;left:0;right:0;bottom:0;top:0;display:none;"\x3e\x3c/div\x3e'),P=H("span#typ-load").attr("data-early-json-flush")&&
!H("html").hasClass("a-lt-ie10"),Z=0<H("span#async-typ-enabled").length,T=H("span#typ-load").attr("data-use-cds-stub"),H(document).undelegate("span.place-order-button-link","click"),H(document).delegate("span.place-order-button-link","click",function(a){a.preventDefault();T?(a=e.getscope(),e.setscope("ajax-typ"),e.setctb(),e.resetue(),e.setmarker("tc"),e.setscope(a)):(e.resetMetrics(),e.setmarker("tc"));F||R?(f.show(),y()):(X=1,m.placeOrderClick())}),u())}var H=a.$;if(!H("html").hasClass("a-ie6")){var B=
0,F=0,X=0,R=0,G=0,K=0,V,aa,x,P=0,T=0,U,ba,ga=0,Y=0,Z=0;a.on("ajax-typ-cf",D);a.on("checkout:reload:spc",w);a.on("checkout:reload:spp-revieworder",w);a.on("checkout:reload:spclite",w)}});"use strict";r.when("A","client-side-metrics").register("trialSignPrefetchCommon",function(a,k){function h(){b()&&(l().val(0),k.increaseCount("TrialSign:js:activated"),f(),t!==F&&p(),t=a.interval(c,5E4),r=0)}function b(){return 0!==l().length&&0!==n("input[name\x3d'purchaseID']").length}function f(){q!==F&&q.abort();
q=a.ajax("/gp/buy/spc/handlers/trigger-trial-sign.html",{method:"post",params:{purchaseId:n("input[name\x3d'purchaseID']").val()},success:g,error:m,abort:e})}function g(a,b,c){l().val(a.signPurchaseTrialId);q=F;k.increaseCount("TrialSign:js:success")}function m(a,b,c){p();q=F;k.increaseCount("TrialSign:js:failed")}function e(){p();q=F;k.increaseCount("TrialSign:js:aborted")}function c(){r++;10<r?p():(k.increaseCount("TrialSign:js:retry"),k.increaseCount("TrialSign:js:retry:"+r),f())}function p(){t!==
F&&(clearInterval(t),t=F)}function l(){return n("input[name\x3d'trialSignId']")}var n=a.$,q,t,r=0;a.on("checkout:reload:spc",h);a.on("checkout:reload:spclite",h);a.on("checkout:billing-address-update",h);return{makeTrialSignCall:f,trialSignCallSucceeded:g,isTrialSignActivated:b}});"use strict";r.when("A","page-transition-controller","client-side-metrics","page-conductor").register("recurring-delivery-line-item",function(a,k,h,b){function f(a,b,e){if("undefined"===typeof a)throw h.increaseCount("Checkout:B2B:RD:RecurrencePeriod:Update:JSFailure:VariableUndefined:"+
b,1),e.show(),Error("Provided variable is undefined");e.hide()}function g(a,g,l){f(a,"updateRecurrencePeriod",g);f(a.lineItemId,"updateRecurrencePeriod-lineItemId",g);var n=b.setAjaxTransitionHeader({"x-amz-checkout-page":"spc","x-amz-checkout-transition":"ajax"});m.ajax({type:"POST",url:"/gp/buy/spc/handlers/update-recurrence-period.html",data:{recurrencePeriod:e,encodedLineItemEntityId:a.lineItemId,relatedRequestId:a.relatedRequestId},dataType:"json",cache:!1,headers:n,success:function(a,b){h.increaseCount("Checkout:B2B:RD:RecurrencePeriod:Update:"+
b,1);m("#b2brd-frdd").text(a.firstRecurringDeliveryDate);l.hide();g.hide();k.hide()},error:function(b){h.increaseCount("Checkout:B2B:RD:RecurrencePeriod:Update:"+b,1);m("#b2brd-cadence-selector").find(".a-dropdown-prompt").text(a.selectedRecurrencePeriodDisplayString);l.hide();g.show();k.hide()}});k.show()}var m=a.$,e;a.declarative("b2brd-cadence-dropdown-change","change",function(a){var b=m("#update-recurrence-period-error"),g=m("#update-recurrence-period-link");f(a,"b2brd-cadence-dropdown-change",
b);a=a.$event.target.value;f(a,"handleDropdownChange",b);g.show();e=a});a.declarative("update-recurrence-period","click",function(a){var b=m("#update-recurrence-period-error"),e=m("#update-recurrence-period-link");f(a,"update-recurrence-period",b);g(a.data,b,e)});a.declarative("update-recurrence-period-mobile","change",function(a){var b=m("#update-recurrence-period-error"),h=m("#update-recurrence-period-link");f(a,"update-recurrence-period-mobile",b);var k=a.$event.target.value;f(k,"handleDropdownChange",
b);h.show();e=k;g(a.data,b,h)})});"use strict";r.when("A","client-side-metrics","ajax-utility","button-blocker","button-blocker-popover","spclite-items-viewer","fast-track-controller").register("get-final-results-update",function(a,k,h,b,f,g,m){function e(){for(var b=function(){a.trigger("checkout:spc:ordersummary:sizeChanged")},c=0;20>c;++c)setTimeout(b,100*c)}function c(a,b){setTimeout(function(){var c=g.prepare(a);c&&t("#spclite-items-operation").show();t("#spclite-items-header-dynamic").fadeIn(b?
0:300,function(){c&&t("#spclite-items-operation").find(".spclite-items-view-switch").each(function(){var a=t(this).attr("view-name");a&&t(this).find("a").click(function(){k.increaseCount("SPCLite:ClientSide:SwitchViewClick:"+a,1);g.switchToView(a);t("#spclite-items-operation").fadeOut(b?0:300);e()})})})},b?0:800)}function p(b,c,e){if(b&&t.isArray(b))for(var f=!1,g=0;g<b.length;g++){var h=b[g];if(h.identifier&&h.content){var l=t("#"+c+"-"+h.identifier);l&&0!==l.length?a.slideDown(l.html(h.content),
e?0:500,"ease-out",function(){}):(k.increaseCount("SPCLite:LazyContentPlaceHolderMissing:Item:"+c,1),f||(k.increaseCount("SPCLite:LazyContentPlaceHolderMissing:Page:"+c,1),f=!0))}}}function l(b,d){if(b.presentCVs&&0<b.presentCVs.countOfCVs)n();else{b.orderSummaryHTML&&(a.fadeOut(t("#order-summary-footer"),d?0:250,"ease-out"),a.fadeOut(t("#spc-order-summary"),d?0:250,"ease-out",function(){t("#spc-order-summary").replaceWith(b.orderSummaryHTML).hide();b.additionalOrderSummaryHTML&&t("#order-summary-footer").html(b.additionalOrderSummaryHTML);
a.fadeIn(t("#spc-order-summary"),d?0:400,"ease-out");a.fadeIn(t("#order-summary-footer"),d?0:400,"ease-out")}));b.freshDeliveryMessageHTML&&(t("#lazy-fresh-promise-delivery-message").html(b.freshDeliveryMessageHTML),a.slideDown(t("#lazy-fresh-promise-delivery-message"),d?0:500,"ease-out"),m.spcLiteLazyLoadFastTrack());p(b.itemToPrimeMembershipDelivery,"lazy-membership-delivery",d);p(b.itemToGiftContentMapping,"lazy-gift-options",d);p(b.itemToShipOfferingMapping,"lazy-ship-method",d);p(b.itemToPromise,
"lazy-promise",d);b.freshDeliverySlotInformationHTML&&(t("#lazy-fresh-delivery-slot-information").html(b.freshDeliverySlotInformationHTML),a.slideDown(t("#lazy-fresh-delivery-slot-information"),d?0:250,"ease-out"));b.freshDeliveryInstructionsHTML&&(t("#lazy-fresh-delivery-instructions").html(b.freshDeliveryInstructionsHTML),a.slideDown(t("#lazy-fresh-delivery-instructions"),d?0:250,"ease-out"));if(b.itemToPromoMapping&&t.isArray(b.itemToPromoMapping))for(var f=t("#items-block"),g=0;g<b.itemToPromoMapping.length;g++){var h=
b.itemToPromoMapping[g];"lightningdeal"===h.type?f.find(".lazy-lightning-promo-details-"+h.identifier).removeClass("aok-hidden"):"promotion"===h.type&&f.find(".lazy-promo-details-"+h.identifier).removeClass("aok-hidden")}b.freeShippingId&&t("#"+b.freeShippingId).removeClass("aok-hidden");t("input#isOrderSummaryReady").val(1);c(b.itemGroupData,d);e()}}function n(){var c=t("#spclite-block-order-place-message").html()||"";b.show("disabled-order-place",c);b.lock();f.create({name:"disabled-order-place",
content:c});f.lock();var d=b.getButtonBlocker().data("a-popover-id");a.on("checkout:beforeReload",function(){f.unlock();b.unlock();f.destroy();t("#a-popover-"+d).remove()})}function v(a){if(a&&a.data){var b;try{b=q.atob(a.data)}catch(c){return k.increaseCount("SPCLite:FinalResult:Base64Decode:Failure",1),null}if((b=h.jsonify(b))&&!t.isEmptyObject(b))return b}return null}var t=a.$,r,y=function(a,b){function c(){if(g&&0!==g.length){for(var a="",b=0;b<e%3+1;b++)a+=".";g.html(a);e++}}var e=0,f,g;this.start=
function(){b&&b.useTextAnimate&&(e=0,g=a.find(".spclite-loading-text .spclite-processing-indicator"),f=setInterval(c,800))};this.stop=function(){f&&(clearInterval(f),g&&0<g.length&&g.html(""),e=0);a.find(".spclite-loading-spinner").hide();b&&b.showTextAlways||a.find(".spclite-loading-text").hide()}};a.on("checkout:reload:spclite",function(){if("1"===t('script[type\x3d"spclite-encoding"]').attr("data-base64-encode-final-results")){var a=v(q.__spcliteFinalResultsData);if(a){l(a,!0);return}}else if(q.__spcliteFinalResultsData){l(q.__spcliteFinalResultsData,
!0);return}var a="",b=t("input#executionId").val();b&&(a+="executionId\x3d"+b);return t.ajax({type:"GET",url:"/gp/buy/spclite/handlers/get-final-results.html/ref\x3dox_spclite_get_final_results",data:a,dataType:"text",async:!0,beforeSend:function(a){r=new y(t("#spclite-order-summary-loading-indicator"),{showTextAlways:!0});r.start();q.uet&&q.uet("bb","SPCLite:ClientSide:Perf:FinalAjax",{wb:1})},success:function(a,b,c){a=h.jsonify(a);"1"===t('script[type\x3d"spclite-encoding"]').attr("data-base64-encode-final-results")?
(a=v(a))?l(a,!1):n():a&&!t.isEmptyObject(a)?l(a,!1):n()},error:function(a,b,c){n()},complete:function(a){r.stop();q.uex&&q.uex("ld","SPCLite:ClientSide:Perf:FinalAjax",{wb:1})},cache:!1})});a.on("checkout:beforeLoadPage",function(){q.__spcliteFinalResultsData=F})});"use strict";r.when("A","client-side-metrics").register("spclite-items-viewer",function(a,k){function h(){var a=f("#spclite-items-block").find(".spclite-item-detail");a&&0<a.length&&(m={},a.each(function(a){a=f(this).attr("entity-id");
m[a]=f("\x3cp\x3e\x3c/p\x3e").append(f(this).clone().removeClass("a-span-last")).html()}))}function b(a,b){if(!b||0===b.length)return null;a=f('\x3cdiv class\x3d"a-row spclite-item-view" view-type\x3d"order-by-delivery"\x3e\x3c/div\x3e');var g=b;b=[];for(var h=[],k=0;k<g.length;k++){var q=g[k];if("normal"!==q.type)h.push(q);else{for(var t=0;t<b.length;)if(q.data.destinationAddressId!==b[t].data.destinationAddressId)t++;else break;for(;t<b.length;)if(q.data.destinationAddressId===b[t].data.destinationAddressId&&
q.data.promise.starttime.dayepoch>b[t].data.promise.starttime.dayepoch)t++;else break;b.splice(t,0,q)}}for(g=0;g<h.length;g++)switch(q=h[g],q.type){case "primemembership":b.unshift(q);break;case "vas":case "digital":case "no-promise":case "exception":b.push(q);break;default:b.push(q)}for(h=0;h<b.length;h++){q=b[h];if(g=q.content)k='\x3cdiv class\x3d"row spclite-item-group-title"\x3e',g.destination&&(k+='\x3cdiv class\x3d"row destination"\x3e'+g.destination+"\x3c/div\x3e"),g.promise&&(k+='\x3cdiv class\x3d"row promise"\x3e'+
g.promise+"\x3c/div\x3e"),k+="\x3c/div\x3e",a.append(k);a:if(g=q.items,m&&g&&0!==g.length){k="";for(t=0;t<g.length;t++){0===t%2&&(k+='\x3cdiv class\x3d"a-row"\x3e');var r=g[t].identifier;if(!m[r]){g=null;break a}r=f(m[r]);1===t%2&&r.addClass("a-span-last");k+=f("\x3cp\x3e\x3c/p\x3e").append(r).html();1===t%2&&(k+="\x3c/div\x3e")}1===g.length%2&&(k+='\x3cdiv class\x3d"a-column a-span6 a-span-last"\x3e\x3c/div\x3e\x3c/div\x3e');g=k}else g=null;if(g)g=f(g),("no-promise"===q.type||"normal"===q.type&&
q.data&&q.data.promise&&"scheduled"!==q.data.promise.type)&&g.find(".spclite-promise").hide(),a.append(g);else return null;h<b.length-1&&a.append("\x3chr\x3e")}return a}var f=a.$,g,m;return{prepare:function(a){try{var c;a:{h();if(m){var f=b("order-by-delivery",a);if(f){g={"order-by-delivery":f};c=!0;break a}}c=!1}return c}catch(l){k.increaseCount("SPCLite:ClientSide:Exception:SwitchViewPrepare",1)}return!1},switchToView:function(a,c){var h;g&&g[a]?h=g[a]:(k.increaseCount("SPCLite:ClientSide:SwitchViewNoPrepared:"+
a,1),"order-by-delivery"===a&&(h=b(a,c)));if(h){var l=f("#spclite-items-block");l.find(".spclite-item-view").fadeOut(300,function(){l.empty();l.append(h.clone().hide());l.find(".spclite-item-view").fadeIn(500)})}}}});"use strict";r.when("A","loading-spinner-controller").register("cpf-controller",function(a,k){function h(a){var b,h,e;if(/^\d{11}$/.test(a)||/^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(a)){a=a.replace(/[^\w\s]|_/g,"");if(/(\d)\1{10}/.test(a))return!1;b=a.substring(0,9);h=a.substring(9);e=0;for(var c=
10;1<c;c--)e+=b.charAt(10-c)*c;if((2>e%11?0:11-e%11)!==h.charAt(0))return!1;b=a.substring(0,10);e=0;for(a=11;1<a;a--)e+=b.charAt(11-a)*a;return(2>e%11?0:11-e%11)!==h.charAt(1)?!1:!0}return!1}var b=a.$;a.on("checkout:reload:spp-taxid",function(){b("#useThresholdTaxIdService").length||b("#taxidForm").submit(function(){var a=b("#taxidregistration-imb");if(!h(b("#taxid-field").val()))return k.hideSpinner(b("#spinner-anchor"),!0),a.show(),!1;a.hide();return!0})})});"use strict";r.when("A","page-conductor",
"ready").register("taxid-threshold-controller",function(a,k){function h(){var a=b();k.isSPP()?a?(f("#taxid-continue-disabled").hide(),f("#taxid-continue-enabled").show()):(f("#taxid-continue-enabled").hide(),f("#taxid-continue-disabled").show()):a?f("span.#continue").removeClass("a-button-disabled").find('input[type\x3d"submit"]').removeAttr("disabled"):f("span.#continue").addClass("a-button-disabled").find('input[type\x3d"submit"]').attr("disabled","disabled")}function b(){var a=!0,b=f("#taxIdForm");
b.length&&b.find('input[type\x3d"text"]').each(function(){var b=f(this);if(!b.val()||7>b.val().length)b.parents(".taxid-form").find('input[type\x3d"checkbox"]').attr("checked")||(a=!1)});return a}var f=a.$;a.on("checkout:reload:spp-taxid",function(){if(f("#useThresholdTaxIdService").length){var a=f("#taxIdForm");a.length&&(a.find('input[type\x3d"text"]').keyup(h),a.find('input[type\x3d"checkbox"]').change(h));h()}})});"use strict";r.when("A","page-conductor","loading-spinner-controller","taxaddress-page-config",
"ready").register("taxaddress-controller",function(a,k,h,b){function f(){k.isSPP()&&m()}function g(){if(k.isSPP()){var a=p(q.taxregistrationnumberInputIdSelector).val();p(q.taxregistrationnumberInputIdSelector).val(a.replace(n,""));a=p(q.businesslegalnameInputIdSelector).val();p(q.businesslegalnameInputIdSelector).val(a.trim());m()}}function m(){var a=p("#taxid-continue-enabled"),b=p("#taxid-continue-disabled"),e;e=p(q.taxregistrationnumberInputIdSelector).val();var d=p(q.businesslegalnameInputIdSelector).val();
if(c(e)&&c(d))e=!0;else{var d=!d||c(d.toString().trim()),f=c(p(q.taxaddressInputNameSelector).val());e=c(e)||!l.test(e)||d||f?!1:!0}e?(a.show(),b.hide()):(a.hide(),b.show());e=c(p(q.taxregistrationnumberInputIdSelector).val())&&c(p(q.businesslegalnameInputIdSelector).val())?q.continueLabel:q.saveContinueLabel;a.find("span.a-button-text").text(e);b.find("span.a-button-text").text(e)}function e(){if(t)t=!1;else{var a=p(q.taxregistrationnumberInputIdSelector).val().trim(),b=p(q.businesslegalnameInputIdSelector).val().trim();
if(!c(a)||!c(b)){var e={tax_registration_number:a,business_legal_name:b};p.ajax({type:"POST",url:q.sifEncryptionUrl,dataType:"json",data:e,success:function(a,b,f){c(e.tax_registration_number)?p(q.taxregistrationnumberInputIdSelector).val(""):p(q.taxregistrationnumberInputIdSelector).val(a.sifEncryptedTaxId);c(e.business_legal_name)?p(q.businesslegalnameInputIdSelector).val(""):p(q.businesslegalnameInputIdSelector).val(a.sifEncryptedLegalName);t=!0;p(q.taxaddressFormIdSelector).submit()},error:function(a,
b,c){console.log("[taxaddress-controller.js] Error while encrypting the input fields. Error Type: "+b+" tax_registration_number: "+e.tax_registration_number+" business_legal_name: "+e.business_legal_name)}});return!1}}}function c(a){return!a||0===a.toString().length}var p=a.$,l=/^\d{11}$/,n=/\s+/g,q=b.getConfig(),t=!1;a.on("checkout:reload:spp-taxaddress",function(){p(q.taxregistrationnumberInputIdSelector).keyup(g).blur(g);p(q.businesslegalnameInputIdSelector).keyup(f).blur(g);p('input:radio[name\x3d"'+
q.taxaddressInputName+'"]').each(function(){p(this).change(f)});p(q.taxaddressFormIdSelector).submit(e);f()});return{getNewTaxAddressPopoverURL:function(){return q.newTaxAddressPopoverURL},submitTaxAddressFormWithNewAddressId:function(a){p(q.newTaxaddressInputIdSelector).val(a);h.showSpinner(p(q.taxAddressPanelSelector),!1);p(q.taxaddressFormIdSelector).submit()}}});r.when("A","address-popovers","taxaddress-controller","ready").register("taxaddress-addresspopover-helper",function(a,k,h){k.actionRegisterTaxAddressController(h)});
"use strict";r.when("A","page-spinner-controller","ajax-utility","page-conductor","client-side-metrics").execute(function(a,k,h,b,f){function g(){function c(a){if(!h)if(a.preventDefault(),a=encodeURIComponent(m("#spc-deliverytipinput").val()),m("#tip-error").addClass("aok-hidden"),m("#tip-promo-success").addClass("aok-hidden"),m("#tip-success").addClass("aok-hidden"),m("#tip-ineligible").addClass("aok-hidden"),m("#tip-success").addClass("aok-hidden"),a&&0!==a.length)if(0>a)g("invalidDeliveryTip_NoAmount");
else if(/^[0-9]*(\.[0-9]{1,2})?$/.test(a)){k.show();q=m("#spc-deliverytipnoticecheckbox").attr("checked")?1:0;var c=(new Date).getTime();a="tipamount\x3d"+a+"\x26isDefaultTip\x3d"+q+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+m("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+c;c=b.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});m.ajax({type:"POST",url:"/gp/buy/spc/handlers/add-delivery-tip.html/ref\x3dox_tip_page_delivery_tip_add",
data:a,headers:c,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",complete:function(){h=!1;k.hide()},success:f,error:b.ajaxRedirect});h=!1}else g("invalidDeliveryTip_NoAmount");else g("addDeliveryTip_NoAmount")}function f(a,b,c){k.hide()}function g(a){k.hide();m("#tip-error").removeClass("aok-hidden");0<m("div.spc-desktop").length?m("#spc-deliverytipinput").addClass("a-form-error"):m("#spc-deliverytipinput").closest(".a-input-text-wrapper").addClass("a-form-error");
m("#"+a).removeClass("aok-hidden")}var h=!1,q=0;e&&(a.declarative("tip-element",["click"],function(a){var b=a.data.click;b&&null!==b&&c(a.$event)}),e=!1)}var m=a.$;if(!m("html").hasClass("a-ie6")){var e=!0;a.on("checkout:reload:spc",g);a.on("checkout:reload:spclite",g)}});"use strict";r.when("A","checkout-general-utils","page-conductor","loading-spinner-controller").register("checkout-feedback-controller",function(a,k,h,b){function f(){if(!m||"function"!==typeof m)return"";var a=m(),b="";if(a)for(var f in a)if("number"===
typeof a[f]||"string"===typeof a[f]||"boolean"===typeof a[f])b+="\x26__pagedata_"+f+"\x3d"+a[f];return b}var g=a.$,m;a.declarative("checkout-submit-feedback",["click","touchend"],function(a){if(!k.protectAgainstDoubleAction("checkout-submit-feedback",200)&&(a=g("#checkout-feedback-form"),a.length)){b.showSpinner(a,!1);var c=a.serialize(),c=c+f();g.ajax({type:"POST",url:a.attr("action"),data:c,dataType:"text",error:h.ajaxRedirect,success:function(a,b,c){b=c.getResponseHeader("checkout-feedback-submitted");
g(".a-button-close").trigger("click");null!==b&&b!==F&&g("#checkout-feedback-banner").append(a)}})}});return{registerPageDataCollecter:function(a){a&&"function"===typeof a&&(m=a)}}});"use strict";r.when("A","page-spinner-controller","scroll-controller","ajax-utility","page-conductor","checkout-modal-popover","page-detector-current-page","checkout-general-utils","a-popover","client-side-metrics").execute(function(a,k,h,b,f,g,m,e,c,p){function l(){function c(a){a=a.$currentTarget.closest(".delivery-instructions-block");
a.find(".edit-delivery-instructions-link").addClass("aok-hidden");a.find(".delivery-instructions-display").addClass("aok-hidden");var b=a.find(".dynamic-delivery-instructions-update").find(".delivery-instructions-input").attr("maxlength");a.find(".dynamic-delivery-instructions-update").removeClass("aok-hidden");n("#deliveryInstructions").focus();n("#deliveryInstructions").select();n("#deliveryInstructions").keydown(function(a){10===a.which&&a.preventDefault()});n("#deliveryInstructions").keyup(function(){n("#delivery-instructions-left-text").hasClass("aok-hidden")&&
n("#delivery-instructions-left-text").removeClass("aok-hidden");var a=b-n(this).val().length;0>a&&(a=0);n("#delivery-instructions-left").text(a)});setTimeout(function(){},500)}function e(a){k.show();a=a.$currentTarget;var b=n("#deliveryInstructions").val(),c=a.closest(".delivery-instructions-block"),h=a.closest(".dynamic-delivery-instructions-update");c.find(".edit-delivery-instructions-link").removeClass("aok-hidden");c.find(".delivery-instructions-display").removeClass("aok-hidden");h.addClass("aok-hidden");
c=(new Date).getTime();b="deliveryInstructions\x3d"+encodeURIComponent(b)+"\x26returnjson\x3d1\x26returnFullHTML\x3d1\x26hasWorkingJavascript\x3d1\x26fromAnywhere\x3d"+n("input[name\x3dfromAnywhere]").val()+"\x26cachebuster\x3d"+c;c=f.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":m.getCurrentPage()});n.ajax({type:"POST",url:"/gp/buy/spc/handlers/add-delivery-instructions.html/ref\x3dox_instructions_page_delivery_instructions_update",data:b,headers:c,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",
dataType:"text",complete:function(){k.hide()},success:g,error:f.ajaxRedirect});a.blur()}function g(a,c,e){(a=b.jsonify(a))&&!n.isEmptyObject(a)&&n("#deliveryInstructionsDisplay").html(a.deliveryInstructions);k.hide()}q&&(a.declarative("edit-delivery-instructions",["click"],c),a.declarative("update-delivery-instructions",["click"],e),q=!1)}var n=a.$;if(!n("html").hasClass("a-ie6")){var q=!0;a.on("checkout:reload:spc",l);a.on("checkout:reload:spclite",l);a.on("checkout:reload:spp-shipaddress",l);a.on("checkout:reload:spp-f3-sosp",
l);a.on("checkout:reload:spp-payment",l)}});"use strict";r.when("A","page-conductor","page-transition-controller").register("installments-service",function(a,k,h){var b=a.$;return{call:function(a,g,m){h.show();b.ajax({type:"POST",url:"/gp/buy/installments/handlers/set-item-installments.html/ref\x3dox_spc_inst_toggle",data:{itemId:a,programId:g},dataType:"text",async:!0,cache:!1,headers:k.setAjaxTransitionHeader(),success:m.success||null,error:m.error||null})},sendReftag:function(a){b.post("/gp/buy/spc/handlers/pmts-continue-widget.html/ref\x3d"+
a)}}});"use strict";r.when("A","page-transition-controller","page-conductor","page-detector","button-blocker","installments-service","client-side-metrics","widgets/installmentsModal/state","allow-installments-page-transition").register("installments-controller",function(a,k,h,b,f,g,m,e,c){function p(){a.defer(n)}function l(a,b,e){c.isEnabled?h.ajaxUpdatePage(a,b,e,{pushNewFrame:"true"}):(k.hide(),h.ajaxUpdatePage(a,b,e,{pushNewFrame:"false"}))}function n(){var a=q("#installments-button-blocker");
1===a.length&&(a=a.data("blocker-message"),f.show("place-order-installments-blocker",a))}var q=a.$;a.declarative("installments-sync-state",["change"],function(a){var b=q("#trigger-installments-modal"),c;if(b.length)if(e.$target=a.$target,e.bundleAsin=a.data.bundleAsin,e.asin=a.data.asin,e.itemId=a.data.itemId,e.isChecked=e.$target.is(":checked"),e.programId=e.isChecked?a.data.programId:"",a={success:l,error:h.ajaxRedirect},e.handlerData=a,c=e.isChecked?"Checkout:Installments:UpdateOptIn":"Checkout:Installments:UpdateOptOut",
e.isChecked)b=e.asin,a=e.bundleAsin,g.call(e.itemId,e.programId,e.handlerData),a?g.sendReftag("installments_toggle_on_asin_"+b+"_bundle_asin_"+a):g.sendReftag("installments_toggle_on_asin_"+b);else{a=e.itemId;var f=e.programId,d=e.handlerData,k=e.asin,n=e.bundleAsin;n&&b.length?(g.sendReftag("installments_toggle_off_asin_"+k+"_bundle_asin_"+n),b.click()):(g.sendReftag("installments_toggle_off_asin_"+k),g.call(a,f,d))}else b=a.data.itemId,f=(c=a.$target.is(":checked"))?a.data.programId:"",a={success:l,
error:h.ajaxRedirect},c=c?"Checkout:Installments:UpdateOptIn":"Checkout:Installments:UpdateOptOut",g.call(b,f,a);m.increaseCount(c)});a.declarative("page-transit-invalidate-ric","click",function(a){h.isAnimating()||(a.$event.preventDefault(),a=a.$currentTarget.closest("div.spp-panel"),k.shrinkPanel(a,!0),a={invalidate:!0,gurupaRicCSRFToken:q("#gurupaRicCSRFToken").val()},m.increaseCount("Checkout:RetailInstallmentContract:Invalidate"),q.ajax({type:"POST",url:"/gp/buy/retailinstallmentcontract/handlers/set-line-item-ric.html?_from\x3dgurupa",
data:a,async:!0,cache:!1,headers:h.setAjaxTransitionHeader(),success:h.redirect,error:h.redirect}))});a.on("checkout:reload:spp-revieworder",p);a.on("checkout:reload:spc",p)});"use strict";r.when("A","page-conductor","checkout-modal-popover","page-transition-controller","ajax-utility","page-detector","payments-portal-common","ready").register("spc-payments-portal",function(a,k,h,b,f,g,m){function e(b,c){c={refTag:c,callbackBeforePageUpdate:function(){a.$("div.a-popover button.a-button-close").trigger("click")}};
k.isSPP()&&(c.keepCachedPagesData=1);k.loadPage("spc",b,null,c)}function c(a,c,e){k.isSPP()?(b.blockAllActions(),b.showTransitionInContainer(p("#payment"))):b.show();a="/gp/buy/spc/handlers/pmts-continue-widget.html/ref\x3d"+a;var f=k.setAjaxTransitionHeader({"Cache-Control":"no-cache",pragma:"no-cache","x-amz-checkout-page":"spc"});p.ajax({type:"POST",url:a,data:c,headers:f,contentType:"application/x-www-form-urlencoded; charset\x3dUTF-8;",dataType:"text",success:function(a,b,c){c.getResponseHeader("x-amz-checkout-page")?
k.ajaxUpdatePage(a,b,c):e(a)},error:k.ajaxRedirect})}var p=a.$;return{prepareDelegatedPopovers:function(b){function c(a,b){a=p(a);a.data("aCheckoutModalPopover",b);h.createModal({$declarativeParent:a},b)}a.on("pmts:retail:billing-address-popover",function(a){c(".pmts-change-address-link",{header:b.billingAddressPopoverHeader,footer:"",name:"billing-address",allowScrollOnPage:!0})});a.on("pmts:retail:rewards-registration",function(a){c(".pmts-shop-with-points-learn-more-link",{header:b.rewardsRegistrationPopoverHeader,
footer:"",name:"rewards-registration",allowScrollOnPage:!0})})},handleClaimCodeSubmittedEvent:function(a,b){var e={returnjson:"1",returnFullHTML:"1",hasWorkingJavascript:"1",fromAnywhere:p("input[name\x3dfromAnywhere]").val(),cachebuster:(new Date).getTime(),nextAction:"pipeline-dispatch",embedOnlyData:"1"};a=p.param(a)+"\x26"+p.param(e);c("ox_pay_page_gc_add",a,function(a){m.claimCodePageUpdater(b,a)})},handleChangeBillingAddressRequestedEvent:function(){g.isDesktopSpc()?k.isSPP()?p("#pmts-change-billing-address-popover").trigger("click"):
a.trigger("pmts:retail:billing-address-popover"):(b.show(),k.isPipeliningOn()&&e("billingaddressselect","ox_spc_change_ship_addr"))},handleChangePaymentInstrumentRequestedEvent:function(){b.show();k.isPipeliningOn()&&e("payselect","ox_spc_change_payment")},handleRewardsAccountLearnMoreRequestedEvent:function(){a.trigger("pmts:retail:rewards-registration")},handlePointsAccountSubmittedEvent:function(a){var b={hasWorkingJavascript:"1",isClientTimeBased:p("input[name\x3duseCtb]").val(),nextAction:"dispatch"};
a=p.param(a)+"\x26"+p.param(b);c("ox_spc_points_edit",a,function(a){a=f.jsonify(a);k.redirect(a)})}}});"use strict";r.when("ajax-utility","gc-redeem-controller","page-transition-controller","ready").register("payments-portal-common",function(a,k,h){return{claimCodePageUpdater:function(b,f){f=a.jsonify(f);null!==f?f.widgetJsonData?(b.update(f.widgetJsonData),h.hide()):f.autohandlererror&&k.giftSystemErrorHandling(f.autohandlererror):h.hide()}}});"use strict";r.when("A","page-detector-current-page",
"a-button","a-meter").register("checkout-throttle-error",function(a,k,h,b){var f=a.$;a.on("checkout:reload:throttle",function(){if(f("#checkout-throttle-meter").length){var a=1E3*f('input[name\x3d"waiting-time"]').val()/100;h("#checkout-throttle-return-to-cart").disable();var k=b("#checkout-throttle-meter"),e=0,c=setInterval(function(){k.percent(e);if(100>e)e+=1;else{clearInterval(c);var a=h("#checkout-throttle-return-to-cart");a.text(f("#checkout-throttle-primary-button-active-text").text());a.enable()}},
a)}})});"use strict";r.when("A","weblab-helper").register("nav-bar-helper",function(a,k){function h(){try{r.register("navCF")}catch(a){if(-1===a.message.toLowerCase().indexOf("already registered"))throw a;}}if(k.isNavCFWeblabOn())a.on("checkout:reload",h)});r.when("A").execute(function(a){a.declarative("remaining-customizations-action","click",function(a){a.$currentTarget.parent().find(".remaining_customization_info").removeClass("aok-hidden");a.$currentTarget.hide();a.$event.preventDefault()})});
"use strict";r.when("A","checkout-federation-utilities","client-side-metrics").register("checkout-federation-wrapper",function(a,k,h){function b(a){for(var b=[],e=f;e<a.length;e++)b.push(a[e]);return b}var f=2;return{wrap:function(a,f){try{return a.apply(null,b(arguments))}catch(l){var e=f,c=l,p;p=e;p=k.getExternalDependecies()[p];p=p!==F&&null!==p?p.cti:"Undefined";h.logError(c,"["+e+"] Javascript error thrown while executing wrapper",p,"FATAL");q.console&&q.console.error&&q.console.error(c,e,p)}}}});
"use strict";r.when("A","jQuery","checkout-federation-utilities").register("checkout-federation-injector",function(a,k,h){function b(a){a=a.assetsModule;if(f[a]?0:0<k('script[type\x3d"checkout-asset-trigger"][data-checkout-asset-trigger\x3d"'+a+'"]').length)f[a]=!0,r.register("trigger"+a,function(){})}var f={};a.on("checkout:reload",function(){var a=h.getExternalDependecies(),f;for(f in a)a.hasOwnProperty(f)&&b(a[f])})});"use strict";r.when("A","client-side-metrics").register("checkout-federation-utilities",
function(a,k){return{getExternalDependecies:function(){var h=a.state("triggerExternalDependencies");Object&&Object.keys&&k.increaseCount("Checkout:ExternalDependencies:count:"+(h?Object.keys(h).length:"undefined"));return h===F||null===h?{}:h}}});"use strict";r.register("allow-installments-page-transition",function(){return{isEnabled:!0}})});
/* ******** */
